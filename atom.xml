<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Just Do IT.</title>
  
  
  <link href="https://ljd0620.github.io/atom.xml" rel="self"/>
  
  <link href="https://ljd0620.github.io/"/>
  <updated>2025-03-19T08:10:41.998Z</updated>
  <id>https://ljd0620.github.io/</id>
  
  <author>
    <name>Liujiduo</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Goè¯­è¨€ç¼–ç¨‹æœ€ä½³å®è·µ</title>
    <link href="https://ljd0620.github.io/2025/03/19/Go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"/>
    <id>https://ljd0620.github.io/2025/03/19/Go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</id>
    <published>2025-03-19T08:10:17.000Z</published>
    <updated>2025-03-19T08:10:41.998Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨ Go è¯­è¨€è¿›è¡Œå¼€å‘æ—¶ï¼Œéµå¾ªæœ€ä½³å®è·µå¯ä»¥å¸®åŠ©ä½ ç¼–å†™é«˜æ•ˆã€å¯ç»´æŠ¤å’Œå¯é çš„ä»£ç ã€‚ä»¥ä¸‹æ˜¯ Go è¯­è¨€ç¼–ç¨‹çš„ä¸€äº›æœ€ä½³å®è·µï¼Œæ¶µç›–äº†ä»£ç è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–ã€æµ‹è¯•ã€å¹¶å‘ç­‰å¤šä¸ªæ–¹é¢ã€‚</p><hr>        <h2 id="1-ä»£ç è®¾è®¡"   >          <a href="#1-ä»£ç è®¾è®¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ä»£ç è®¾è®¡" class="headerlink" title="1. ä»£ç è®¾è®¡"></a><strong>1. ä»£ç è®¾è®¡</strong></h2>              <h3 id="1-1-å•ä¸€èŒè´£åŸåˆ™"   >          <a href="#1-1-å•ä¸€èŒè´£åŸåˆ™" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-1-å•ä¸€èŒè´£åŸåˆ™" class="headerlink" title="1.1 å•ä¸€èŒè´£åŸåˆ™"></a><strong>1.1 å•ä¸€èŒè´£åŸåˆ™</strong></h3>      <p>â€¢ æ¯ä¸ªåŒ…ã€å‡½æ•°æˆ–ç±»å‹åº”è¯¥åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½ã€‚<br>â€¢ é¿å…è®©ä¸€ä¸ªåŒ…æ‰¿æ‹…è¿‡å¤šçš„èŒè´£ï¼Œä¿æŒåŠŸèƒ½çš„å•ä¸€æ€§ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š"   >          <a href="#ç¤ºä¾‹ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸æ¨èï¼šä¸€ä¸ªåŒ…åŒæ—¶å¤„ç†æ–‡ä»¶è¯»å†™å’Œç½‘ç»œè¯·æ±‚</span></span><br><span class="line"><span class="keyword">package</span> fileutils</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadFile</span><span class="params">(filename <span class="type">string</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) &#123; ... &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SendRequest</span><span class="params">(url <span class="type">string</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨èï¼šå°†åŠŸèƒ½æ‹†åˆ†ä¸ºå¤šä¸ªåŒ…</span></span><br><span class="line"><span class="keyword">package</span> fileutils</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReadFile</span><span class="params">(filename <span class="type">string</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> httpclient</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SendRequest</span><span class="params">(url <span class="type">string</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) &#123; ... &#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="1-2-å°è£…ä¸æŠ½è±¡"   >          <a href="#1-2-å°è£…ä¸æŠ½è±¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-2-å°è£…ä¸æŠ½è±¡" class="headerlink" title="1.2 å°è£…ä¸æŠ½è±¡"></a><strong>1.2 å°è£…ä¸æŠ½è±¡</strong></h3>      <p>â€¢ ä½¿ç”¨æ¥å£æ¥å®šä¹‰è¡Œä¸ºï¼Œè€Œä¸æ˜¯ç›´æ¥ä¾èµ–å…·ä½“å®ç°ã€‚<br>â€¢ éšè—å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œæä¾›æ¸…æ™°çš„å…¬å…±æ¥å£ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-1"   >          <a href="#ç¤ºä¾‹ï¼š-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-1" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Reader <span class="keyword">interface</span> &#123;</span><br><span class="line">    Read() ([]<span class="type">byte</span>, <span class="type">error</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç°æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> FileReader <span class="keyword">struct</span> &#123;</span><br><span class="line">    Filename <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *FileReader)</span></span> Read() ([]<span class="type">byte</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> os.ReadFile(r.Filename)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="1-3-ä½¿ç”¨æœ‰æ„ä¹‰çš„å‘½å"   >          <a href="#1-3-ä½¿ç”¨æœ‰æ„ä¹‰çš„å‘½å" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-3-ä½¿ç”¨æœ‰æ„ä¹‰çš„å‘½å" class="headerlink" title="1.3 ä½¿ç”¨æœ‰æ„ä¹‰çš„å‘½å"></a><strong>1.3 ä½¿ç”¨æœ‰æ„ä¹‰çš„å‘½å</strong></h3>      <p>â€¢ åŒ…åã€å‡½æ•°åã€å˜é‡ååº”è¯¥æ¸…æ™°ã€ç®€çŸ­ä¸”æœ‰æ„ä¹‰ã€‚<br>â€¢ å¯¼å‡ºåç§°ï¼ˆåŒ…å¤–å¯è§ï¼‰ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œæœªå¯¼å‡ºåç§°ä»¥å°å†™å­—æ¯å¼€å¤´ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-2"   >          <a href="#ç¤ºä¾‹ï¼š-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-2" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸æ¨è</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(a <span class="type">int</span>)</span></span> <span class="type">int</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨è</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddNumbers</span><span class="params">(x, y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123; ... &#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="1-4-é¿å…è¿‡åº¦è®¾è®¡"   >          <a href="#1-4-é¿å…è¿‡åº¦è®¾è®¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-4-é¿å…è¿‡åº¦è®¾è®¡" class="headerlink" title="1.4 é¿å…è¿‡åº¦è®¾è®¡"></a><strong>1.4 é¿å…è¿‡åº¦è®¾è®¡</strong></h3>      <p>â€¢ ä¸è¦åœ¨é¡¹ç›®åˆæœŸè¿‡åº¦è®¾è®¡ï¼Œä¿æŒä»£ç ç®€å•ã€‚<br>â€¢ éšç€éœ€æ±‚çš„å˜åŒ–é€æ­¥ä¼˜åŒ–å’Œæ‰©å±•ä»£ç ã€‚</p><hr>        <h2 id="2-é”™è¯¯å¤„ç†"   >          <a href="#2-é”™è¯¯å¤„ç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-é”™è¯¯å¤„ç†" class="headerlink" title="2. é”™è¯¯å¤„ç†"></a><strong>2. é”™è¯¯å¤„ç†</strong></h2>              <h3 id="2-1-æ˜¾å¼å¤„ç†é”™è¯¯"   >          <a href="#2-1-æ˜¾å¼å¤„ç†é”™è¯¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-1-æ˜¾å¼å¤„ç†é”™è¯¯" class="headerlink" title="2.1 æ˜¾å¼å¤„ç†é”™è¯¯"></a><strong>2.1 æ˜¾å¼å¤„ç†é”™è¯¯</strong></h3>      <p>â€¢ Go è¯­è¨€ä¸­ï¼Œé”™è¯¯æ˜¯å€¼ï¼Œåº”è¯¥æ˜¾å¼è¿”å›å’Œå¤„ç†ã€‚<br>â€¢ ä¸è¦å¿½ç•¥é”™è¯¯ï¼Œå§‹ç»ˆæ£€æŸ¥å¹¶å¤„ç†å¯èƒ½çš„é”™è¯¯ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-3"   >          <a href="#ç¤ºä¾‹ï¼š-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-3" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸æ¨è</span></span><br><span class="line">data, _ := os.ReadFile(<span class="string">&quot;file.txt&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨è</span></span><br><span class="line">data, err := os.ReadFile(<span class="string">&quot;file.txt&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatalf(<span class="string">&quot;Failed to read file: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="2-2-è‡ªå®šä¹‰é”™è¯¯ç±»å‹"   >          <a href="#2-2-è‡ªå®šä¹‰é”™è¯¯ç±»å‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-2-è‡ªå®šä¹‰é”™è¯¯ç±»å‹" class="headerlink" title="2.2 è‡ªå®šä¹‰é”™è¯¯ç±»å‹"></a><strong>2.2 è‡ªå®šä¹‰é”™è¯¯ç±»å‹</strong></h3>      <p>â€¢ å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥å®šä¹‰è‡ªå®šä¹‰é”™è¯¯ç±»å‹ã€‚<br>â€¢ ä½¿ç”¨ <code>errors</code> åŒ…æˆ– <code>fmt.Errorf</code> åˆ›å»ºé”™è¯¯ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-4"   >          <a href="#ç¤ºä¾‹ï¼š-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-4" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyError <span class="keyword">struct</span> &#123;</span><br><span class="line">    Msg <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *MyError)</span></span> Error() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> e.Msg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DoSomething</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;MyError&#123;Msg: <span class="string">&quot;Something went wrong&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="2-3-ä½¿ç”¨-errors-Is-å’Œ-errors-As"   >          <a href="#2-3-ä½¿ç”¨-errors-Is-å’Œ-errors-As" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-3-ä½¿ç”¨-errors-Is-å’Œ-errors-As" class="headerlink" title="2.3 ä½¿ç”¨ errors.Is å’Œ errors.As"></a><strong>2.3 ä½¿ç”¨ <code>errors.Is</code> å’Œ <code>errors.As</code></strong></h3>      <p>â€¢ Go 1.13 å¼•å…¥äº† <code>errors.Is</code> å’Œ <code>errors.As</code>ï¼Œç”¨äºæ›´ä¼˜é›…åœ°å¤„ç†é”™è¯¯é“¾ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-5"   >          <a href="#ç¤ºä¾‹ï¼š-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-5" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> errors.Is(err, os.ErrNotExist) &#123;</span><br><span class="line">    log.Println(<span class="string">&quot;File does not exist&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h2 id="3-å¹¶å‘ç¼–ç¨‹"   >          <a href="#3-å¹¶å‘ç¼–ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-å¹¶å‘ç¼–ç¨‹" class="headerlink" title="3. å¹¶å‘ç¼–ç¨‹"></a><strong>3. å¹¶å‘ç¼–ç¨‹</strong></h2>              <h3 id="3-1-ä½¿ç”¨-Goroutine-å’Œ-Channel"   >          <a href="#3-1-ä½¿ç”¨-Goroutine-å’Œ-Channel" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-1-ä½¿ç”¨-Goroutine-å’Œ-Channel" class="headerlink" title="3.1 ä½¿ç”¨ Goroutine å’Œ Channel"></a><strong>3.1 ä½¿ç”¨ Goroutine å’Œ Channel</strong></h3>      <p>â€¢ Goroutine æ˜¯ Go çš„è½»é‡çº§çº¿ç¨‹ï¼Œé€‚åˆå¤„ç†å¹¶å‘ä»»åŠ¡ã€‚<br>â€¢ ä½¿ç”¨ Channel åœ¨ Goroutine ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œé¿å…å…±äº«å†…å­˜ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-6"   >          <a href="#ç¤ºä¾‹ï¼š-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-6" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(id <span class="type">int</span>, jobs &lt;-<span class="keyword">chan</span> <span class="type">int</span>, results <span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> job := <span class="keyword">range</span> jobs &#123;</span><br><span class="line">        results &lt;- job * <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    jobs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">100</span>)</span><br><span class="line">    results := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> w := <span class="number">1</span>; w &lt;= <span class="number">3</span>; w++ &#123;</span><br><span class="line">        <span class="keyword">go</span> worker(w, jobs, results)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= <span class="number">9</span>; j++ &#123;</span><br><span class="line">        jobs &lt;- j</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(jobs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> a := <span class="number">1</span>; a &lt;= <span class="number">9</span>; a++ &#123;</span><br><span class="line">        &lt;-results</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="3-2-é¿å…ç«æ€æ¡ä»¶"   >          <a href="#3-2-é¿å…ç«æ€æ¡ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-2-é¿å…ç«æ€æ¡ä»¶" class="headerlink" title="3.2 é¿å…ç«æ€æ¡ä»¶"></a><strong>3.2 é¿å…ç«æ€æ¡ä»¶</strong></h3>      <p>â€¢ ä½¿ç”¨ <code>sync.Mutex</code> æˆ– <code>sync.RWMutex</code> æ¥ä¿æŠ¤å…±äº«èµ„æºã€‚<br>â€¢ ä½¿ç”¨ <code>go run -race</code> æ£€æµ‹ç«æ€æ¡ä»¶ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-7"   >          <a href="#ç¤ºä¾‹ï¼š-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-7" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mu sync.Mutex</span><br><span class="line"><span class="keyword">var</span> counter <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">increment</span><span class="params">()</span></span> &#123;</span><br><span class="line">    mu.Lock()</span><br><span class="line">    counter++</span><br><span class="line">    mu.Unlock()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="3-3-ä½¿ç”¨-sync-WaitGroup"   >          <a href="#3-3-ä½¿ç”¨-sync-WaitGroup" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-3-ä½¿ç”¨-sync-WaitGroup" class="headerlink" title="3.3 ä½¿ç”¨ sync.WaitGroup"></a><strong>3.3 ä½¿ç”¨ <code>sync.WaitGroup</code></strong></h3>      <p>â€¢ ä½¿ç”¨ <code>sync.WaitGroup</code> ç­‰å¾…ä¸€ç»„ Goroutine å®Œæˆã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-8"   >          <a href="#ç¤ºä¾‹ï¼š-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-8" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(id <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Worker %d is working\n&quot;</span>, id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> worker(i)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h2 id="4-æ€§èƒ½ä¼˜åŒ–"   >          <a href="#4-æ€§èƒ½ä¼˜åŒ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="4. æ€§èƒ½ä¼˜åŒ–"></a><strong>4. æ€§èƒ½ä¼˜åŒ–</strong></h2>              <h3 id="4-1-é¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…"   >          <a href="#4-1-é¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-1-é¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…" class="headerlink" title="4.1 é¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…"></a><strong>4.1 é¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…</strong></h3>      <p>â€¢ ä½¿ç”¨å€¼ç±»å‹ï¼ˆå¦‚ç»“æ„ä½“ï¼‰ä»£æ›¿æŒ‡é’ˆç±»å‹ï¼Œå‡å°‘å †å†…å­˜åˆ†é…ã€‚<br>â€¢ é¢„åˆ†é…åˆ‡ç‰‡å®¹é‡ï¼Œé¿å…åŠ¨æ€æ‰©å®¹ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-9"   >          <a href="#ç¤ºä¾‹ï¼š-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-9" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸æ¨è</span></span><br><span class="line">slice := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">    slice = <span class="built_in">append</span>(slice, i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨è</span></span><br><span class="line">slice := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">    slice = <span class="built_in">append</span>(slice, i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="4-2-ä½¿ç”¨-strings-Builder"   >          <a href="#4-2-ä½¿ç”¨-strings-Builder" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-2-ä½¿ç”¨-strings-Builder" class="headerlink" title="4.2 ä½¿ç”¨ strings.Builder"></a><strong>4.2 ä½¿ç”¨ <code>strings.Builder</code></strong></h3>      <p>â€¢ åœ¨éœ€è¦é¢‘ç¹æ‹¼æ¥å­—ç¬¦ä¸²æ—¶ï¼Œä½¿ç”¨ <code>strings.Builder</code> æ›¿ä»£ <code>+</code> æˆ– <code>fmt.Sprintf</code>ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-10"   >          <a href="#ç¤ºä¾‹ï¼š-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-10" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> builder strings.Builder</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">    builder.WriteString(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">result := builder.String()</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="4-3-é¿å…è¿‡åº¦ä¼˜åŒ–"   >          <a href="#4-3-é¿å…è¿‡åº¦ä¼˜åŒ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-3-é¿å…è¿‡åº¦ä¼˜åŒ–" class="headerlink" title="4.3 é¿å…è¿‡åº¦ä¼˜åŒ–"></a><strong>4.3 é¿å…è¿‡åº¦ä¼˜åŒ–</strong></h3>      <p>â€¢ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§æ¯”æ€§èƒ½æ›´é‡è¦ã€‚<br>â€¢ åªæœ‰åœ¨æ€§èƒ½ç“¶é¢ˆæ˜ç¡®æ—¶ï¼Œæ‰è¿›è¡Œä¼˜åŒ–ã€‚</p><hr>        <h2 id="5-æµ‹è¯•"   >          <a href="#5-æµ‹è¯•" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-æµ‹è¯•" class="headerlink" title="5. æµ‹è¯•"></a><strong>5. æµ‹è¯•</strong></h2>              <h3 id="5-1-ç¼–å†™å•å…ƒæµ‹è¯•"   >          <a href="#5-1-ç¼–å†™å•å…ƒæµ‹è¯•" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-1-ç¼–å†™å•å…ƒæµ‹è¯•" class="headerlink" title="5.1 ç¼–å†™å•å…ƒæµ‹è¯•"></a><strong>5.1 ç¼–å†™å•å…ƒæµ‹è¯•</strong></h3>      <p>â€¢ ä½¿ç”¨ Go çš„å†…ç½®æµ‹è¯•æ¡†æ¶ <code>testing</code> ç¼–å†™å•å…ƒæµ‹è¯•ã€‚<br>â€¢ æµ‹è¯•æ–‡ä»¶ä»¥ <code>_test.go</code> ç»“å°¾ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-11"   >          <a href="#ç¤ºä¾‹ï¼š-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-11" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAdd</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    result := Add(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> result != <span class="number">5</span> &#123;</span><br><span class="line">        t.Errorf(<span class="string">&quot;Expected 5, but got %d&quot;</span>, result)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="5-2-åŸºå‡†æµ‹è¯•"   >          <a href="#5-2-åŸºå‡†æµ‹è¯•" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-2-åŸºå‡†æµ‹è¯•" class="headerlink" title="5.2 åŸºå‡†æµ‹è¯•"></a><strong>5.2 åŸºå‡†æµ‹è¯•</strong></h3>      <p>â€¢ ä½¿ç”¨ <code>Benchmark</code> å‡½æ•°è¿›è¡Œæ€§èƒ½æµ‹è¯•ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-12"   >          <a href="#ç¤ºä¾‹ï¼š-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-12" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkAdd</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        Add(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="5-3-ä½¿ç”¨-Mock-å’Œ-Stub"   >          <a href="#5-3-ä½¿ç”¨-Mock-å’Œ-Stub" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-3-ä½¿ç”¨-Mock-å’Œ-Stub" class="headerlink" title="5.3 ä½¿ç”¨ Mock å’Œ Stub"></a><strong>5.3 ä½¿ç”¨ Mock å’Œ Stub</strong></h3>      <p>â€¢ ä½¿ç”¨ Mock æˆ– Stub æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–ï¼Œæ–¹ä¾¿æµ‹è¯•ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-13"   >          <a href="#ç¤ºä¾‹ï¼š-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-13" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <p>å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ <code>gomock</code> æˆ– <code>testify</code>ï¼‰æ¥ç®€åŒ– Mock çš„å®ç°ã€‚</p><hr>        <h2 id="6-ä¾èµ–ç®¡ç†"   >          <a href="#6-ä¾èµ–ç®¡ç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-ä¾èµ–ç®¡ç†" class="headerlink" title="6. ä¾èµ–ç®¡ç†"></a><strong>6. ä¾èµ–ç®¡ç†</strong></h2>              <h3 id="6-1-ä½¿ç”¨-Go-Modules"   >          <a href="#6-1-ä½¿ç”¨-Go-Modules" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-1-ä½¿ç”¨-Go-Modules" class="headerlink" title="6.1 ä½¿ç”¨ Go Modules"></a><strong>6.1 ä½¿ç”¨ Go Modules</strong></h3>      <p>â€¢ ä» Go 1.11 å¼€å§‹ï¼ŒGo å®˜æ–¹æ¨èä½¿ç”¨ Go Modules ç®¡ç†ä¾èµ–ã€‚<br>â€¢ åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ <code>go mod init</code> åˆå§‹åŒ–æ¨¡å—ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-14"   >          <a href="#ç¤ºä¾‹ï¼š-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-14" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod init github.com/yourname/yourproject</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="6-2-é¿å…è¿‡åº¦ä¾èµ–"   >          <a href="#6-2-é¿å…è¿‡åº¦ä¾èµ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-2-é¿å…è¿‡åº¦ä¾èµ–" class="headerlink" title="6.2 é¿å…è¿‡åº¦ä¾èµ–"></a><strong>6.2 é¿å…è¿‡åº¦ä¾èµ–</strong></h3>      <p>â€¢ å°½é‡å‡å°‘ç¬¬ä¸‰æ–¹ä¾èµ–çš„ä½¿ç”¨ï¼Œé¿å…å¼•å…¥ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚<br>â€¢ å®šæœŸæ›´æ–°ä¾èµ–ï¼Œç¡®ä¿å®‰å…¨æ€§ã€‚</p><hr>        <h2 id="7-ä»£ç é£æ ¼"   >          <a href="#7-ä»£ç é£æ ¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-ä»£ç é£æ ¼" class="headerlink" title="7. ä»£ç é£æ ¼"></a><strong>7. ä»£ç é£æ ¼</strong></h2>              <h3 id="7-1-ä½¿ç”¨-gofmt-æ ¼å¼åŒ–ä»£ç "   >          <a href="#7-1-ä½¿ç”¨-gofmt-æ ¼å¼åŒ–ä»£ç " class="heading-link"><i class="fas fa-link"></i></a><a href="#7-1-ä½¿ç”¨-gofmt-æ ¼å¼åŒ–ä»£ç " class="headerlink" title="7.1 ä½¿ç”¨ gofmt æ ¼å¼åŒ–ä»£ç "></a><strong>7.1 ä½¿ç”¨ <code>gofmt</code> æ ¼å¼åŒ–ä»£ç </strong></h3>      <p>â€¢ Go è¯­è¨€æœ‰ä¸¥æ ¼çš„ä»£ç æ ¼å¼è§„èŒƒï¼Œæ¨èä½¿ç”¨ <code>gofmt</code> å·¥å…·è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-15"   >          <a href="#ç¤ºä¾‹ï¼š-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-15" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gofmt -w your_file.go</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="7-2-ä½¿ç”¨-golint-æ£€æŸ¥ä»£ç é£æ ¼"   >          <a href="#7-2-ä½¿ç”¨-golint-æ£€æŸ¥ä»£ç é£æ ¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-2-ä½¿ç”¨-golint-æ£€æŸ¥ä»£ç é£æ ¼" class="headerlink" title="7.2 ä½¿ç”¨ golint æ£€æŸ¥ä»£ç é£æ ¼"></a><strong>7.2 ä½¿ç”¨ <code>golint</code> æ£€æŸ¥ä»£ç é£æ ¼</strong></h3>      <p>â€¢ ä½¿ç”¨ <code>golint</code> æ£€æŸ¥ä»£ç æ˜¯å¦ç¬¦åˆ Go çš„ç¼–ç è§„èŒƒã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-16"   >          <a href="#ç¤ºä¾‹ï¼š-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-16" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">golint your_file.go</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="7-3-ä½¿ç”¨-go-vet-æ£€æŸ¥æ½œåœ¨é—®é¢˜"   >          <a href="#7-3-ä½¿ç”¨-go-vet-æ£€æŸ¥æ½œåœ¨é—®é¢˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-3-ä½¿ç”¨-go-vet-æ£€æŸ¥æ½œåœ¨é—®é¢˜" class="headerlink" title="7.3 ä½¿ç”¨ go vet æ£€æŸ¥æ½œåœ¨é—®é¢˜"></a><strong>7.3 ä½¿ç”¨ <code>go vet</code> æ£€æŸ¥æ½œåœ¨é—®é¢˜</strong></h3>      <p>â€¢ ä½¿ç”¨ <code>go vet</code> æ£€æŸ¥ä»£ç ä¸­çš„æ½œåœ¨é—®é¢˜ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-17"   >          <a href="#ç¤ºä¾‹ï¼š-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-17" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go vet ./...</span><br></pre></td></tr></table></div></figure><hr>        <h2 id="8-æ–‡æ¡£ä¸æ³¨é‡Š"   >          <a href="#8-æ–‡æ¡£ä¸æ³¨é‡Š" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-æ–‡æ¡£ä¸æ³¨é‡Š" class="headerlink" title="8. æ–‡æ¡£ä¸æ³¨é‡Š"></a><strong>8. æ–‡æ¡£ä¸æ³¨é‡Š</strong></h2>              <h3 id="8-1-åŒ…æ³¨é‡Š"   >          <a href="#8-1-åŒ…æ³¨é‡Š" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-1-åŒ…æ³¨é‡Š" class="headerlink" title="8.1 åŒ…æ³¨é‡Š"></a><strong>8.1 åŒ…æ³¨é‡Š</strong></h3>      <p>â€¢ æ¯ä¸ªåŒ…éƒ½åº”è¯¥æœ‰ä¸€ä¸ªåŒ…æ³¨é‡Šï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šï¼Œæè¿°åŒ…çš„åŠŸèƒ½ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-18"   >          <a href="#ç¤ºä¾‹ï¼š-18" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-18" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package math provides basic mathematical functions.</span></span><br><span class="line"><span class="keyword">package</span> math</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="8-2-å‡½æ•°æ³¨é‡Š"   >          <a href="#8-2-å‡½æ•°æ³¨é‡Š" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-2-å‡½æ•°æ³¨é‡Š" class="headerlink" title="8.2 å‡½æ•°æ³¨é‡Š"></a><strong>8.2 å‡½æ•°æ³¨é‡Š</strong></h3>      <p>â€¢ å¯¼å‡ºå‡½æ•°ï¼ˆåŒ…å¤–å¯è§ï¼‰åº”è¯¥æœ‰æ³¨é‡Šï¼Œæè¿°å‡½æ•°çš„åŠŸèƒ½ã€å‚æ•°å’Œè¿”å›å€¼ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-19"   >          <a href="#ç¤ºä¾‹ï¼š-19" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-19" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AddIntegers è¿”å›ä¸¤ä¸ªæ•´æ•°çš„å’Œã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddIntegers</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="8-3-è¡Œå†…æ³¨é‡Š"   >          <a href="#8-3-è¡Œå†…æ³¨é‡Š" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-3-è¡Œå†…æ³¨é‡Š" class="headerlink" title="8.3 è¡Œå†…æ³¨é‡Š"></a><strong>8.3 è¡Œå†…æ³¨é‡Š</strong></h3>      <p>â€¢ è¡Œå†…æ³¨é‡Šç”¨äºè§£é‡Šå¤æ‚çš„ä»£ç é€»è¾‘ï¼Œé€šå¸¸ä»¥ <code>//</code> å¼€å¤´ã€‚<br>â€¢ é¿å…è¿‡åº¦æ³¨é‡Šï¼Œä»£ç æœ¬èº«åº”è¯¥å°½é‡è‡ªè§£é‡Šã€‚</p><hr>        <h2 id="9-å·¥å…·é“¾"   >          <a href="#9-å·¥å…·é“¾" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-å·¥å…·é“¾" class="headerlink" title="9. å·¥å…·é“¾"></a><strong>9. å·¥å…·é“¾</strong></h2>              <h3 id="9-1-ä½¿ç”¨-go-mod-ç®¡ç†ä¾èµ–"   >          <a href="#9-1-ä½¿ç”¨-go-mod-ç®¡ç†ä¾èµ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-1-ä½¿ç”¨-go-mod-ç®¡ç†ä¾èµ–" class="headerlink" title="9.1 ä½¿ç”¨ go mod ç®¡ç†ä¾èµ–"></a><strong>9.1 ä½¿ç”¨ <code>go mod</code> ç®¡ç†ä¾èµ–</strong></h3>      <p>â€¢ ä½¿ç”¨ <code>go mod tidy</code> æ¸…ç†æœªä½¿ç”¨çš„ä¾èµ–ã€‚</p><hr>        <h3 id="9-2-ä½¿ç”¨é™æ€åˆ†æå·¥å…·"   >          <a href="#9-2-ä½¿ç”¨é™æ€åˆ†æå·¥å…·" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-2-ä½¿ç”¨é™æ€åˆ†æå·¥å…·" class="headerlink" title="9.2 ä½¿ç”¨é™æ€åˆ†æå·¥å…·"></a><strong>9.2 ä½¿ç”¨é™æ€åˆ†æå·¥å…·</strong></h3>      <p>â€¢ ä½¿ç”¨ <code>golangci-lint</code> ç­‰å·¥å…·è¿›è¡Œé™æ€ä»£ç åˆ†æã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-20"   >          <a href="#ç¤ºä¾‹ï¼š-20" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-20" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">golangci-lint run</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="9-3-ä½¿ç”¨-CI-CD-å·¥å…·"   >          <a href="#9-3-ä½¿ç”¨-CI-CD-å·¥å…·" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-3-ä½¿ç”¨-CI-CD-å·¥å…·" class="headerlink" title="9.3 ä½¿ç”¨ CI&#x2F;CD å·¥å…·"></a><strong>9.3 ä½¿ç”¨ CI&#x2F;CD å·¥å…·</strong></h3>      <p>â€¢ é…ç½® CI&#x2F;CD æµæ°´çº¿ï¼Œè‡ªåŠ¨è¿è¡Œæµ‹è¯•ã€æ ¼å¼åŒ–å’Œé™æ€åˆ†æã€‚</p><hr>        <h2 id="10-å…¶ä»–æœ€ä½³å®è·µ"   >          <a href="#10-å…¶ä»–æœ€ä½³å®è·µ" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-å…¶ä»–æœ€ä½³å®è·µ" class="headerlink" title="10. å…¶ä»–æœ€ä½³å®è·µ"></a><strong>10. å…¶ä»–æœ€ä½³å®è·µ</strong></h2>              <h3 id="10-1-é¿å…å…¨å±€å˜é‡"   >          <a href="#10-1-é¿å…å…¨å±€å˜é‡" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-1-é¿å…å…¨å±€å˜é‡" class="headerlink" title="10.1 é¿å…å…¨å±€å˜é‡"></a><strong>10.1 é¿å…å…¨å±€å˜é‡</strong></h3>      <p>â€¢ å°½é‡å‡å°‘å…¨å±€å˜é‡çš„ä½¿ç”¨ï¼Œé¿å…å¼•å…¥ä¸å¯æ§çš„çŠ¶æ€ã€‚</p><hr>        <h3 id="10-2-ä½¿ç”¨åˆ‡ç‰‡ä»£æ›¿æ•°ç»„"   >          <a href="#10-2-ä½¿ç”¨åˆ‡ç‰‡ä»£æ›¿æ•°ç»„" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-2-ä½¿ç”¨åˆ‡ç‰‡ä»£æ›¿æ•°ç»„" class="headerlink" title="10.2 ä½¿ç”¨åˆ‡ç‰‡ä»£æ›¿æ•°ç»„"></a><strong>10.2 ä½¿ç”¨åˆ‡ç‰‡ä»£æ›¿æ•°ç»„</strong></h3>      <p>â€¢ åˆ‡ç‰‡æ¯”æ•°ç»„æ›´çµæ´»ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-21"   >          <a href="#ç¤ºä¾‹ï¼š-21" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-21" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸æ¨è</span></span><br><span class="line"><span class="keyword">var</span> arr [<span class="number">3</span>]<span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨è</span></span><br><span class="line">slice := []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="10-3-ä½¿ç”¨-context-ç®¡ç†è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ"   >          <a href="#10-3-ä½¿ç”¨-context-ç®¡ç†è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-3-ä½¿ç”¨-context-ç®¡ç†è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="10.3 ä½¿ç”¨ context ç®¡ç†è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ"></a><strong>10.3 ä½¿ç”¨ <code>context</code> ç®¡ç†è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ</strong></h3>      <p>â€¢ åœ¨å¤„ç† HTTP è¯·æ±‚æˆ–å…¶ä»–éœ€è¦è¶…æ—¶æ§åˆ¶çš„åœºæ™¯ä¸­ï¼Œä½¿ç”¨ <code>context</code>ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-22"   >          <a href="#ç¤ºä¾‹ï¼š-22" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-22" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">        fmt.Println(<span class="string">&quot;Request canceled&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(<span class="number">2</span> * time.Second):</span><br><span class="line">        fmt.Println(<span class="string">&quot;Request completed&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h2 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h2>      <p>Go è¯­è¨€çš„æœ€ä½³å®è·µæ¶µç›–äº†ä»£ç è®¾è®¡ã€é”™è¯¯å¤„ç†ã€å¹¶å‘ã€æ€§èƒ½ä¼˜åŒ–ã€æµ‹è¯•ã€ä¾èµ–ç®¡ç†ç­‰å¤šä¸ªæ–¹é¢ã€‚ä»¥ä¸‹æ˜¯å…³é”®ç‚¹ï¼š</p><ol><li><strong>ç®€å•æ€§</strong>ï¼šä¿æŒä»£ç ç®€å•ï¼Œé¿å…è¿‡åº¦è®¾è®¡ã€‚</li><li><strong>å¯è¯»æ€§</strong>ï¼šéµå¾ªå‘½åè§„èŒƒï¼Œæ·»åŠ å¿…è¦çš„æ³¨é‡Šã€‚</li><li><strong>å¹¶å‘å®‰å…¨</strong>ï¼šä½¿ç”¨ Goroutine å’Œ Channelï¼Œé¿å…ç«æ€æ¡ä»¶ã€‚</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šåœ¨å¿…è¦æ—¶ä¼˜åŒ–æ€§èƒ½ï¼Œä½†ä¸è¦è¿‡æ—©ä¼˜åŒ–ã€‚</li><li><strong>æµ‹è¯•è¦†ç›–</strong>ï¼šç¼–å†™å•å…ƒæµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•ï¼Œç¡®ä¿ä»£ç è´¨é‡ã€‚</li><li><strong>å·¥å…·æ”¯æŒ</strong>ï¼šä½¿ç”¨ Go çš„å·¥å…·é“¾ï¼ˆå¦‚ <code>gofmt</code>ã€<code>go vet</code>ã€<code>golangci-lint</code>ï¼‰æé«˜å¼€å‘æ•ˆç‡ã€‚</li></ol><p>é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œä½ çš„ Go ä»£ç å°†æ›´åŠ é«˜æ•ˆã€å¯é å’Œæ˜“äºç»´æŠ¤ï¼ ğŸš€</p>]]></content>
    
    
    <summary type="html">Goè¯­è¨€ç¼–ç¨‹æœ€ä½³å®è·µ</summary>
    
    
    
    <category term="Go" scheme="https://ljd0620.github.io/categories/Go/"/>
    
    
    <category term="Go" scheme="https://ljd0620.github.io/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>Goè¯­è¨€panicå‡½æ•°ç”¨æ³•</title>
    <link href="https://ljd0620.github.io/2025/03/03/Go%E8%AF%AD%E8%A8%80panic%E5%87%BD%E6%95%B0%E7%94%A8%E6%B3%95/"/>
    <id>https://ljd0620.github.io/2025/03/03/Go%E8%AF%AD%E8%A8%80panic%E5%87%BD%E6%95%B0%E7%94%A8%E6%B3%95/</id>
    <published>2025-03-03T08:09:09.000Z</published>
    <updated>2025-03-19T08:09:54.436Z</updated>
    
    <content type="html"><![CDATA[<p>Goè¯­è¨€ä¸­çš„<code>panic</code>ç”¨äºè¡¨ç¤ºç¨‹åºé‡åˆ°äº†æ— æ³•ç»§ç»­æ‰§è¡Œçš„ä¸¥é‡é”™è¯¯ã€‚ä»¥ä¸‹æ˜¯<code>panic</code>çš„ä½¿ç”¨æ–¹å¼ã€æœ€ä½³å®è·µä»¥åŠä¸<code>recover</code>çš„ç»“åˆç”¨æ³•ï¼š</p><hr>        <h3 id="ä¸€ã€Panic-åŸºç¡€ç”¨æ³•"   >          <a href="#ä¸€ã€Panic-åŸºç¡€ç”¨æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸€ã€Panic-åŸºç¡€ç”¨æ³•" class="headerlink" title="ä¸€ã€Panic åŸºç¡€ç”¨æ³•"></a><strong>ä¸€ã€Panic åŸºç¡€ç”¨æ³•</strong></h3>              <h4 id="1-è§¦å‘-Panic"   >          <a href="#1-è§¦å‘-Panic" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-è§¦å‘-Panic" class="headerlink" title="1. è§¦å‘ Panic"></a><strong>1. è§¦å‘ Panic</strong></h4>      <p>ä½¿ç”¨<code>panic</code>å‡½æ•°è§¦å‘ä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;something went wrong&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ul><li><p><strong>è¾“å‡º</strong>ï¼š<br>panic: something went wrong</p><pre><code>goroutine 1 [running]:main.main()        /path/to/file.go:4 +0x27</code></pre></li></ul>        <h4 id="2-Panic-çš„ä¼ æ’­"   >          <a href="#2-Panic-çš„ä¼ æ’­" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Panic-çš„ä¼ æ’­" class="headerlink" title="2. Panic çš„ä¼ æ’­"></a><strong>2. Panic çš„ä¼ æ’­</strong></h4>      <p><code>panic</code>ä¼šæ²¿ç€è°ƒç”¨æ ˆå‘ä¸Šä¼ æ’­ï¼Œç›´åˆ°è¢«<code>recover</code>æ•è·æˆ–ç¨‹åºå´©æºƒï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;error in foo&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bar</span><span class="params">()</span></span> &#123;</span><br><span class="line">    foo()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    bar()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ul><li><p><strong>è¾“å‡º</strong>ï¼š<br>panic: error in foo</p><pre><code>goroutine 1 [running]:main.foo()        /path/to/file.go:4 +0x27main.bar()        /path/to/file.go:8 +0x14main.main()        /path/to/file.go:12 +0x14</code></pre></li></ul><hr>        <h3 id="äºŒã€Recover-æ•è·-Panic"   >          <a href="#äºŒã€Recover-æ•è·-Panic" class="heading-link"><i class="fas fa-link"></i></a><a href="#äºŒã€Recover-æ•è·-Panic" class="headerlink" title="äºŒã€Recover æ•è· Panic"></a><strong>äºŒã€Recover æ•è· Panic</strong></h3>              <h4 id="1-ä½¿ç”¨-Recover"   >          <a href="#1-ä½¿ç”¨-Recover" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ä½¿ç”¨-Recover" class="headerlink" title="1. ä½¿ç”¨ Recover"></a><strong>1. ä½¿ç”¨ Recover</strong></h4>      <p><code>recover</code>ç”¨äºæ•è·<code>panic</code>ï¼Œé˜²æ­¢ç¨‹åºå´©æºƒã€‚å¿…é¡»åœ¨<code>defer</code>å‡½æ•°ä¸­è°ƒç”¨ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;Recovered from panic:&quot;</span>, r)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;something went wrong&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><ul><li><strong>è¾“å‡º</strong>ï¼š<br>Recovered from panic: something went wrong</li></ul>        <h4 id="2-Recover-çš„é™åˆ¶"   >          <a href="#2-Recover-çš„é™åˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Recover-çš„é™åˆ¶" class="headerlink" title="2. Recover çš„é™åˆ¶"></a><strong>2. Recover çš„é™åˆ¶</strong></h4>      <ul><li><strong>ä»…åœ¨<code>defer</code>ä¸­æœ‰æ•ˆ</strong>ï¼š<code>recover</code>åªèƒ½åœ¨<code>defer</code>å‡½æ•°ä¸­æ•è·<code>panic</code>ã€‚</li><li><strong>æ— æ³•è·¨<code>goroutine</code></strong>ï¼šæ¯ä¸ª<code>goroutine</code>éœ€è¦ç‹¬ç«‹çš„<code>recover</code>ã€‚</li></ul><hr>        <h3 id="ä¸‰ã€Panic-ä¸-Recover-çš„æœ€ä½³å®è·µ"   >          <a href="#ä¸‰ã€Panic-ä¸-Recover-çš„æœ€ä½³å®è·µ" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸‰ã€Panic-ä¸-Recover-çš„æœ€ä½³å®è·µ" class="headerlink" title="ä¸‰ã€Panic ä¸ Recover çš„æœ€ä½³å®è·µ"></a><strong>ä¸‰ã€Panic ä¸ Recover çš„æœ€ä½³å®è·µ</strong></h3>              <h4 id="1-é”™è¯¯æ¢å¤"   >          <a href="#1-é”™è¯¯æ¢å¤" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-é”™è¯¯æ¢å¤" class="headerlink" title="1. é”™è¯¯æ¢å¤"></a><strong>1. é”™è¯¯æ¢å¤</strong></h4>      <p>åœ¨å…³é”®ä»£ç æ®µä¸­ä½¿ç”¨<code>recover</code>ï¼Œç¡®ä¿ç¨‹åºåœ¨é‡åˆ°é”™è¯¯æ—¶èƒ½å¤Ÿä¼˜é›…æ¢å¤ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">safeCall</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;Recovered:&quot;</span>, r)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="comment">// å¯èƒ½è§¦å‘panicçš„æ“ä½œ</span></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;unexpected error&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    safeCall()</span><br><span class="line">    fmt.Println(<span class="string">&quot;Program continues&quot;</span>) <span class="comment">// è¾“å‡ºæ¢å¤åçš„æ—¥å¿—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="2-èµ„æºæ¸…ç†"   >          <a href="#2-èµ„æºæ¸…ç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-èµ„æºæ¸…ç†" class="headerlink" title="2. èµ„æºæ¸…ç†"></a><strong>2. èµ„æºæ¸…ç†</strong></h4>      <p>åœ¨<code>defer</code>ä¸­ç»“åˆ<code>recover</code>ç¡®ä¿èµ„æºé‡Šæ”¾ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">processFile</span><span class="params">(filename <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    file, err := os.Open(filename)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;Recovered from panic:&quot;</span>, r)</span><br><span class="line">        &#125;</span><br><span class="line">        file.Close() <span class="comment">// ç¡®ä¿æ–‡ä»¶å…³é—­</span></span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†æ–‡ä»¶å†…å®¹...</span></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;file processing error&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="3-æ—¥å¿—è®°å½•"   >          <a href="#3-æ—¥å¿—è®°å½•" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æ—¥å¿—è®°å½•" class="headerlink" title="3. æ—¥å¿—è®°å½•"></a><strong>3. æ—¥å¿—è®°å½•</strong></h4>      <p>åœ¨<code>recover</code>ä¸­è®°å½•<code>panic</code>ä¿¡æ¯ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Printf(<span class="string">&quot;Panic occurred: %v\nStack trace: %s&quot;</span>, r, debug.Stack())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;critical error&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="å››ã€Panic-çš„ä½¿ç”¨åœºæ™¯"   >          <a href="#å››ã€Panic-çš„ä½¿ç”¨åœºæ™¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#å››ã€Panic-çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="å››ã€Panic çš„ä½¿ç”¨åœºæ™¯"></a><strong>å››ã€Panic çš„ä½¿ç”¨åœºæ™¯</strong></h3>              <h4 id="1-ä¸å¯æ¢å¤çš„é”™è¯¯"   >          <a href="#1-ä¸å¯æ¢å¤çš„é”™è¯¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ä¸å¯æ¢å¤çš„é”™è¯¯" class="headerlink" title="1. ä¸å¯æ¢å¤çš„é”™è¯¯"></a><strong>1. ä¸å¯æ¢å¤çš„é”™è¯¯</strong></h4>      <ul><li><strong>ç¤ºä¾‹</strong>ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥ã€é…ç½®æ–‡ä»¶ç¼ºå¤±ã€‚</li><li><strong>ä»£ç </strong>ï¼š<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadConfig</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> _, err := os.Stat(<span class="string">&quot;config.json&quot;</span>); os.IsNotExist(err) &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;config file not found&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li></ul>        <h4 id="2-æ–­è¨€å¤±è´¥"   >          <a href="#2-æ–­è¨€å¤±è´¥" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ–­è¨€å¤±è´¥" class="headerlink" title="2. æ–­è¨€å¤±è´¥"></a><strong>2. æ–­è¨€å¤±è´¥</strong></h4>      <ul><li><strong>ç¤ºä¾‹</strong>ï¼šæ£€æŸ¥å‡½æ•°å‚æ•°æ˜¯å¦åˆæ³•ã€‚</li><li><strong>ä»£ç </strong>ï¼š<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">divide</span><span class="params">(a, b <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;division by zero&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a / b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li></ul>        <h4 id="3-ç¨‹åºåˆå§‹åŒ–å¤±è´¥"   >          <a href="#3-ç¨‹åºåˆå§‹åŒ–å¤±è´¥" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ç¨‹åºåˆå§‹åŒ–å¤±è´¥" class="headerlink" title="3. ç¨‹åºåˆå§‹åŒ–å¤±è´¥"></a><strong>3. ç¨‹åºåˆå§‹åŒ–å¤±è´¥</strong></h4>      <ul><li><strong>ç¤ºä¾‹</strong>ï¼šåˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿå¤±è´¥ã€‚</li><li><strong>ä»£ç </strong>ï¼š<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initLogger</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err := log.Init(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;failed to initialize logger&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li></ul><hr>        <h3 id="äº”ã€Panic-çš„æ›¿ä»£æ–¹æ¡ˆ"   >          <a href="#äº”ã€Panic-çš„æ›¿ä»£æ–¹æ¡ˆ" class="heading-link"><i class="fas fa-link"></i></a><a href="#äº”ã€Panic-çš„æ›¿ä»£æ–¹æ¡ˆ" class="headerlink" title="äº”ã€Panic çš„æ›¿ä»£æ–¹æ¡ˆ"></a><strong>äº”ã€Panic çš„æ›¿ä»£æ–¹æ¡ˆ</strong></h3>              <h4 id="1-è¿”å›é”™è¯¯"   >          <a href="#1-è¿”å›é”™è¯¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-è¿”å›é”™è¯¯" class="headerlink" title="1. è¿”å›é”™è¯¯"></a><strong>1. è¿”å›é”™è¯¯</strong></h4>      <p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¼˜å…ˆä½¿ç”¨è¿”å›é”™è¯¯çš„æ–¹å¼å¤„ç†å¼‚å¸¸ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">divide</span><span class="params">(a, b <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, fmt.Errorf(<span class="string">&quot;division by zero&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a / b, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="2-è‡ªå®šä¹‰é”™è¯¯ç±»å‹"   >          <a href="#2-è‡ªå®šä¹‰é”™è¯¯ç±»å‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-è‡ªå®šä¹‰é”™è¯¯ç±»å‹" class="headerlink" title="2. è‡ªå®šä¹‰é”™è¯¯ç±»å‹"></a><strong>2. è‡ªå®šä¹‰é”™è¯¯ç±»å‹</strong></h4>      <p>é€šè¿‡å®šä¹‰é”™è¯¯ç±»å‹æä¾›æ›´å¤šä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ConfigError <span class="keyword">struct</span> &#123;</span><br><span class="line">    File <span class="type">string</span></span><br><span class="line">    Err  <span class="type">error</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *ConfigError)</span></span> Error() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;config file %s: %v&quot;</span>, e.File, e.Err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadConfig</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> _, err := os.Stat(<span class="string">&quot;config.json&quot;</span>); os.IsNotExist(err) &#123;</span><br><span class="line">        <span class="keyword">return</span> &amp;ConfigError&#123;File: <span class="string">&quot;config.json&quot;</span>, Err: err&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="å…­ã€Panic-çš„æ€§èƒ½å½±å“"   >          <a href="#å…­ã€Panic-çš„æ€§èƒ½å½±å“" class="heading-link"><i class="fas fa-link"></i></a><a href="#å…­ã€Panic-çš„æ€§èƒ½å½±å“" class="headerlink" title="å…­ã€Panic çš„æ€§èƒ½å½±å“"></a><strong>å…­ã€Panic çš„æ€§èƒ½å½±å“</strong></h3>              <h4 id="1-æ€§èƒ½å¼€é”€"   >          <a href="#1-æ€§èƒ½å¼€é”€" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ€§èƒ½å¼€é”€" class="headerlink" title="1. æ€§èƒ½å¼€é”€"></a><strong>1. æ€§èƒ½å¼€é”€</strong></h4>      <ul><li><strong><code>panic</code></strong>ï¼šæ¶‰åŠæ ˆå±•å¼€å’Œ<code>defer</code>è°ƒç”¨ï¼Œæ€§èƒ½å¼€é”€è¾ƒé«˜ã€‚</li><li><strong><code>recover</code></strong>ï¼šæ•è·<code>panic</code>åæ¢å¤æ‰§è¡Œï¼Œå¼€é”€è¾ƒå°ã€‚</li></ul>        <h4 id="2-æ€§èƒ½ä¼˜åŒ–å»ºè®®"   >          <a href="#2-æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="2. æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a><strong>2. æ€§èƒ½ä¼˜åŒ–å»ºè®®</strong></h4>      <ul><li><strong>é¿å…æ»¥ç”¨<code>panic</code></strong>ï¼šä»…åœ¨æ— æ³•æ¢å¤çš„é”™è¯¯ä¸­ä½¿ç”¨ã€‚</li><li><strong>å‡å°‘<code>defer</code>è°ƒç”¨</strong>ï¼šåœ¨æ€§èƒ½æ•æ„Ÿä»£ç ä¸­é¿å…ä¸å¿…è¦çš„<code>defer</code>ã€‚</li></ul><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <ul><li><strong>æ ¸å¿ƒç”¨é€”</strong>ï¼šå¤„ç†ä¸å¯æ¢å¤çš„é”™è¯¯ï¼Œç¡®ä¿ç¨‹åºå¥å£®æ€§ã€‚</li><li><strong>æœ€ä½³å®è·µ</strong>ï¼š<ul><li>åœ¨<code>defer</code>ä¸­ä½¿ç”¨<code>recover</code>æ•è·<code>panic</code>ã€‚</li><li>ç»“åˆæ—¥å¿—è®°å½•å’Œèµ„æºæ¸…ç†ã€‚</li><li>ä¼˜å…ˆä½¿ç”¨è¿”å›é”™è¯¯çš„æ–¹å¼å¤„ç†å¼‚å¸¸ã€‚</li></ul></li><li><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š<ul><li><code>panic</code>å’Œ<code>recover</code>ä¸èƒ½è·¨<code>goroutine</code>ã€‚</li><li>é¿å…åœ¨é«˜é¢‘ä»£ç ä¸­ä½¿ç”¨<code>panic</code>ã€‚</li></ul></li></ul><p>é€šè¿‡åˆç†ä½¿ç”¨<code>panic</code>å’Œ<code>recover</code>ï¼Œå¯ä»¥æ„å»ºæ›´åŠ å¥å£®å’Œå¯é çš„Goç¨‹åºã€‚</p>]]></content>
    
    
    <summary type="html">Goè¯­è¨€panicå‡½æ•°ç”¨æ³•</summary>
    
    
    
    <category term="Go" scheme="https://ljd0620.github.io/categories/Go/"/>
    
    
    <category term="Go" scheme="https://ljd0620.github.io/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>Goè¯­è¨€æŒ‡é’ˆçš„ä½œç”¨è¯¦è§£</title>
    <link href="https://ljd0620.github.io/2025/02/27/Go%E8%AF%AD%E8%A8%80%E6%8C%87%E9%92%88%E7%9A%84%E4%BD%9C%E7%94%A8%E8%AF%A6%E8%A7%A3/"/>
    <id>https://ljd0620.github.io/2025/02/27/Go%E8%AF%AD%E8%A8%80%E6%8C%87%E9%92%88%E7%9A%84%E4%BD%9C%E7%94%A8%E8%AF%A6%E8%A7%A3/</id>
    <published>2025-02-27T08:08:16.000Z</published>
    <updated>2025-03-19T08:08:46.168Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ Go è¯­è¨€ä¸­ï¼ŒæŒ‡é’ˆæ˜¯ä¸€ç§éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå®ƒå…è®¸æˆ‘ä»¬ç›´æ¥æ“ä½œå˜é‡çš„å†…å­˜åœ°å€ã€‚æŒ‡é’ˆçš„ä½¿ç”¨å¯ä»¥å¸¦æ¥è®¸å¤šå¥½å¤„ï¼Œæ¯”å¦‚æé«˜æ€§èƒ½ã€å®ç°æ•°æ®å…±äº«ã€æ”¯æŒå¤æ‚çš„æ•°æ®ç»“æ„ç­‰ã€‚ä»¥ä¸‹æ˜¯æŒ‡é’ˆçš„ä¸»è¦ç”¨é€”å’Œä¼˜ç‚¹ã€‚</p><hr>        <h3 id="1-æŒ‡é’ˆçš„åŸºæœ¬æ¦‚å¿µ"   >          <a href="#1-æŒ‡é’ˆçš„åŸºæœ¬æ¦‚å¿µ" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æŒ‡é’ˆçš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1. æŒ‡é’ˆçš„åŸºæœ¬æ¦‚å¿µ"></a><strong>1. æŒ‡é’ˆçš„åŸºæœ¬æ¦‚å¿µ</strong></h3>      <p>â€¢ <strong>æŒ‡é’ˆ</strong>æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒå­˜å‚¨çš„æ˜¯å¦ä¸€ä¸ªå˜é‡çš„å†…å­˜åœ°å€ã€‚<br>â€¢ ä½¿ç”¨ <code>&amp;</code> æ“ä½œç¬¦å¯ä»¥è·å–å˜é‡çš„åœ°å€ã€‚<br>â€¢ ä½¿ç”¨ <code>*</code> æ“ä½œç¬¦å¯ä»¥è®¿é—®æŒ‡é’ˆæŒ‡å‘çš„å€¼ã€‚</p>        <h4 id="ç¤ºä¾‹ï¼š"   >          <a href="#ç¤ºä¾‹ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h4>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    x := <span class="number">42</span>          <span class="comment">// å®šä¹‰ä¸€ä¸ªå˜é‡ x</span></span><br><span class="line">    p := &amp;x          <span class="comment">// p æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå­˜å‚¨ x çš„åœ°å€</span></span><br><span class="line">    fmt.Println(*p)  <span class="comment">// è¾“å‡ºæŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œå³ x çš„å€¼ï¼š42</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¾“å‡ºï¼š</p><pre><code>42</code></pre><hr>        <h3 id="2-æŒ‡é’ˆçš„ç”¨å¤„"   >          <a href="#2-æŒ‡é’ˆçš„ç”¨å¤„" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æŒ‡é’ˆçš„ç”¨å¤„" class="headerlink" title="2. æŒ‡é’ˆçš„ç”¨å¤„"></a><strong>2. æŒ‡é’ˆçš„ç”¨å¤„</strong></h3>              <h4 id="2-1-ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å˜é‡"   >          <a href="#2-1-ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å˜é‡" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-1-ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å˜é‡" class="headerlink" title="2.1 ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å˜é‡"></a><strong>2.1 ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å˜é‡</strong></h4>      <p>åœ¨ Go ä¸­ï¼Œå‡½æ•°å‚æ•°æ˜¯æŒ‰å€¼ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€å‡½æ•°æ¥æ”¶çš„æ˜¯å˜é‡çš„å‰¯æœ¬ã€‚å¦‚æœéœ€è¦åœ¨å‡½æ•°ä¸­ä¿®æ”¹å¤–éƒ¨å˜é‡çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨æŒ‡é’ˆã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-1"   >          <a href="#ç¤ºä¾‹ï¼š-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-1" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">increment</span><span class="params">(x *<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    *x++ <span class="comment">// é€šè¿‡æŒ‡é’ˆä¿®æ”¹å¤–éƒ¨å˜é‡çš„å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := <span class="number">10</span></span><br><span class="line">    increment(&amp;a) <span class="comment">// ä¼ é€’ a çš„åœ°å€</span></span><br><span class="line">    fmt.Println(a) <span class="comment">// è¾“å‡º 11</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h4 id="2-2-æé«˜æ€§èƒ½ï¼ˆé¿å…å¤§å¯¹è±¡çš„æ‹·è´ï¼‰"   >          <a href="#2-2-æé«˜æ€§èƒ½ï¼ˆé¿å…å¤§å¯¹è±¡çš„æ‹·è´ï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-2-æé«˜æ€§èƒ½ï¼ˆé¿å…å¤§å¯¹è±¡çš„æ‹·è´ï¼‰" class="headerlink" title="2.2 æé«˜æ€§èƒ½ï¼ˆé¿å…å¤§å¯¹è±¡çš„æ‹·è´ï¼‰"></a><strong>2.2 æé«˜æ€§èƒ½ï¼ˆé¿å…å¤§å¯¹è±¡çš„æ‹·è´ï¼‰</strong></h4>      <p>å½“ä¼ é€’å¤§å¯¹è±¡ï¼ˆå¦‚ç»“æ„ä½“ã€æ•°ç»„ç­‰ï¼‰æ—¶ï¼ŒæŒ‰å€¼ä¼ é€’ä¼šå¯¼è‡´æ•´ä¸ªå¯¹è±¡çš„æ‹·è´ï¼Œå¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚é€šè¿‡ä¼ é€’æŒ‡é’ˆï¼Œå¯ä»¥é¿å…è¿™ç§æ‹·è´ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-2"   >          <a href="#ç¤ºä¾‹ï¼š-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-2" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> BigStruct <span class="keyword">struct</span> &#123;</span><br><span class="line">    data [<span class="number">1000000</span>]<span class="type">int</span> <span class="comment">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„ç»“æ„ä½“</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(data *BigStruct)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥æ“ä½œæŒ‡é’ˆï¼Œé¿å…æ‹·è´</span></span><br><span class="line">    data.data[<span class="number">0</span>] = <span class="number">42</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    big := BigStruct&#123;&#125;</span><br><span class="line">    process(&amp;big) <span class="comment">// ä¼ é€’æŒ‡é’ˆ</span></span><br><span class="line">    fmt.Println(big.data[<span class="number">0</span>]) <span class="comment">// è¾“å‡º 42</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h4 id="2-3-å®ç°æ•°æ®å…±äº«"   >          <a href="#2-3-å®ç°æ•°æ®å…±äº«" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-3-å®ç°æ•°æ®å…±äº«" class="headerlink" title="2.3 å®ç°æ•°æ®å…±äº«"></a><strong>2.3 å®ç°æ•°æ®å…±äº«</strong></h4>      <p>æŒ‡é’ˆå¯ä»¥ç”¨æ¥åœ¨å¤šä¸ªå‡½æ•°æˆ–å˜é‡ä¹‹é—´å…±äº«æ•°æ®ã€‚é€šè¿‡æŒ‡é’ˆï¼Œå¤šä¸ªåœ°æ–¹å¯ä»¥è®¿é—®å’Œä¿®æ”¹åŒä¸€ä¸ªå˜é‡ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-3"   >          <a href="#ç¤ºä¾‹ï¼š-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-3" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateValue</span><span class="params">(p *<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    *p = <span class="number">100</span> <span class="comment">// ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    x := <span class="number">10</span></span><br><span class="line">    p := &amp;x</span><br><span class="line">    updateValue(p) <span class="comment">// é€šè¿‡æŒ‡é’ˆä¿®æ”¹ x çš„å€¼</span></span><br><span class="line">    fmt.Println(x) <span class="comment">// è¾“å‡º 100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h4 id="2-4-å®ç°å¤æ‚çš„æ•°æ®ç»“æ„"   >          <a href="#2-4-å®ç°å¤æ‚çš„æ•°æ®ç»“æ„" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-4-å®ç°å¤æ‚çš„æ•°æ®ç»“æ„" class="headerlink" title="2.4 å®ç°å¤æ‚çš„æ•°æ®ç»“æ„"></a><strong>2.4 å®ç°å¤æ‚çš„æ•°æ®ç»“æ„</strong></h4>      <p>æŒ‡é’ˆæ˜¯å®ç°é“¾è¡¨ã€æ ‘ã€å›¾ç­‰å¤æ‚æ•°æ®ç»“æ„çš„åŸºç¡€ã€‚é€šè¿‡æŒ‡é’ˆï¼Œå¯ä»¥å°†å¤šä¸ªèŠ‚ç‚¹è¿æ¥èµ·æ¥ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼šé“¾è¡¨"   >          <a href="#ç¤ºä¾‹ï¼šé“¾è¡¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼šé“¾è¡¨" class="headerlink" title="ç¤ºä¾‹ï¼šé“¾è¡¨"></a>ç¤ºä¾‹ï¼šé“¾è¡¨</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">    value <span class="type">int</span></span><br><span class="line">    next  *Node <span class="comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºé“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line">    head := &amp;Node&#123;value: <span class="number">1</span>&#125;</span><br><span class="line">    second := &amp;Node&#123;value: <span class="number">2</span>&#125;</span><br><span class="line">    third := &amp;Node&#123;value: <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿æ¥èŠ‚ç‚¹</span></span><br><span class="line">    head.next = second</span><br><span class="line">    second.next = third</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†é“¾è¡¨</span></span><br><span class="line">    current := head</span><br><span class="line">    <span class="keyword">for</span> current != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(current.value)</span><br><span class="line">        current = current.next</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¾“å‡ºï¼š</p><pre><code>123</code></pre><hr>        <h4 id="2-5-å®ç°æ¥å£æ–¹æ³•"   >          <a href="#2-5-å®ç°æ¥å£æ–¹æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-5-å®ç°æ¥å£æ–¹æ³•" class="headerlink" title="2.5 å®ç°æ¥å£æ–¹æ³•"></a><strong>2.5 å®ç°æ¥å£æ–¹æ³•</strong></h4>      <p>åœ¨ Go ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•éœ€è¦ä¿®æ”¹æ¥æ”¶è€…ï¼ˆreceiverï¼‰çš„å€¼ï¼Œå¯ä»¥å°†æ¥æ”¶è€…å®šä¹‰ä¸ºæŒ‡é’ˆç±»å‹ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-4"   >          <a href="#ç¤ºä¾‹ï¼š-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-4" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Counter <span class="keyword">struct</span> &#123;</span><br><span class="line">    value <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…ï¼Œå…è®¸ä¿®æ”¹ Counter çš„å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Counter)</span></span> Increment() &#123;</span><br><span class="line">    c.value++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c := Counter&#123;value: <span class="number">0</span>&#125;</span><br><span class="line">    c.Increment()</span><br><span class="line">    fmt.Println(c.value) <span class="comment">// è¾“å‡º 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h4 id="2-6-å®ç°ç©ºå€¼ï¼ˆnilï¼‰"   >          <a href="#2-6-å®ç°ç©ºå€¼ï¼ˆnilï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-6-å®ç°ç©ºå€¼ï¼ˆnilï¼‰" class="headerlink" title="2.6 å®ç°ç©ºå€¼ï¼ˆnilï¼‰"></a><strong>2.6 å®ç°ç©ºå€¼ï¼ˆnilï¼‰</strong></h4>      <p>æŒ‡é’ˆå¯ä»¥ä¸º <code>nil</code>ï¼Œè¡¨ç¤ºå®ƒæ²¡æœ‰æŒ‡å‘ä»»ä½•å€¼ã€‚è¿™åœ¨æŸäº›åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚åˆå§‹åŒ–ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œæˆ–è€…åœ¨éœ€è¦æ—¶è¡¨ç¤ºâ€œæ— â€æˆ–â€œæœªè®¾ç½®â€ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-5"   >          <a href="#ç¤ºä¾‹ï¼š-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-5" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p *<span class="type">int</span> <span class="comment">// p æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé»˜è®¤å€¼ä¸º nil</span></span><br><span class="line">    <span class="keyword">if</span> p == <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Pointer is nil&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    x := <span class="number">42</span></span><br><span class="line">    p = &amp;x <span class="comment">// æŒ‡å‘ x</span></span><br><span class="line">    <span class="keyword">if</span> p != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Pointer is not nil, value:&quot;</span>, *p)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¾“å‡ºï¼š</p><pre><code>Pointer is nilPointer is not nil, value: 42</code></pre><hr>        <h4 id="2-7-å®ç°å‡½æ•°è¿”å›å¤šä¸ªå€¼"   >          <a href="#2-7-å®ç°å‡½æ•°è¿”å›å¤šä¸ªå€¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-7-å®ç°å‡½æ•°è¿”å›å¤šä¸ªå€¼" class="headerlink" title="2.7 å®ç°å‡½æ•°è¿”å›å¤šä¸ªå€¼"></a><strong>2.7 å®ç°å‡½æ•°è¿”å›å¤šä¸ªå€¼</strong></h4>      <p>è™½ç„¶ Go ä¸æ”¯æŒç›´æ¥è¿”å›å¤šä¸ªå€¼ï¼Œä½†å¯ä»¥é€šè¿‡æŒ‡é’ˆé—´æ¥å®ç°ç±»ä¼¼çš„æ•ˆæœã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-6"   >          <a href="#ç¤ºä¾‹ï¼š-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-6" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">divide</span><span class="params">(a, b <span class="type">int</span>, result *<span class="type">float64</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;division by zero&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    *result = <span class="type">float64</span>(a) / <span class="type">float64</span>(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> res <span class="type">float64</span></span><br><span class="line">    divide(<span class="number">10</span>, <span class="number">2</span>, &amp;res) <span class="comment">// ä¼ é€’æŒ‡é’ˆ</span></span><br><span class="line">    fmt.Println(res)    <span class="comment">// è¾“å‡º 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="3-æŒ‡é’ˆçš„æ³¨æ„äº‹é¡¹"   >          <a href="#3-æŒ‡é’ˆçš„æ³¨æ„äº‹é¡¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æŒ‡é’ˆçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="3. æŒ‡é’ˆçš„æ³¨æ„äº‹é¡¹"></a><strong>3. æŒ‡é’ˆçš„æ³¨æ„äº‹é¡¹</strong></h3>              <h4 id="3-1-é¿å…ç©ºæŒ‡é’ˆè§£å¼•ç”¨"   >          <a href="#3-1-é¿å…ç©ºæŒ‡é’ˆè§£å¼•ç”¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-1-é¿å…ç©ºæŒ‡é’ˆè§£å¼•ç”¨" class="headerlink" title="3.1 é¿å…ç©ºæŒ‡é’ˆè§£å¼•ç”¨"></a><strong>3.1 é¿å…ç©ºæŒ‡é’ˆè§£å¼•ç”¨</strong></h4>      <p>å¦‚æœæŒ‡é’ˆä¸º <code>nil</code>ï¼Œç›´æ¥è§£å¼•ç”¨ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ï¼ˆpanicï¼‰ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-7"   >          <a href="#ç¤ºä¾‹ï¼š-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-7" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p *<span class="type">int</span></span><br><span class="line">    fmt.Println(*p) <span class="comment">// è¿è¡Œæ—¶é”™è¯¯ï¼španic: runtime error: invalid memory address or nil pointer dereference</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="3-2-é¿å…å¾ªç¯å¼•ç”¨"   >          <a href="#3-2-é¿å…å¾ªç¯å¼•ç”¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-2-é¿å…å¾ªç¯å¼•ç”¨" class="headerlink" title="3.2 é¿å…å¾ªç¯å¼•ç”¨"></a><strong>3.2 é¿å…å¾ªç¯å¼•ç”¨</strong></h4>      <p>åœ¨ä½¿ç”¨æŒ‡é’ˆæ—¶ï¼Œå°¤å…¶æ˜¯ç»“æ„ä½“ä¸­åµŒå¥—æŒ‡é’ˆï¼Œå¯èƒ½ä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨ï¼Œè¿›è€Œå¼•å‘å†…å­˜æ³„æ¼ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-8"   >          <a href="#ç¤ºä¾‹ï¼š-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-8" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">    next *Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := &amp;Node&#123;&#125;</span><br><span class="line">    b := &amp;Node&#123;next: a&#125;</span><br><span class="line">    a.next = b <span class="comment">// å¾ªç¯å¼•ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><blockquote><p><strong>è§£å†³æ–¹æ³•</strong>ï¼šä½¿ç”¨ <code>weak references</code> æˆ–æ‰‹åŠ¨æ–­å¼€å¼•ç”¨ï¼ˆGo æ²¡æœ‰ç›´æ¥çš„å¼±å¼•ç”¨æœºåˆ¶ï¼Œä½†å¯ä»¥é€šè¿‡è®¾è®¡é¿å…å¾ªç¯å¼•ç”¨ï¼‰ã€‚</p></blockquote>        <h4 id="3-3-æŒ‡é’ˆçš„ä¼ é€’æ•ˆç‡"   >          <a href="#3-3-æŒ‡é’ˆçš„ä¼ é€’æ•ˆç‡" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-3-æŒ‡é’ˆçš„ä¼ é€’æ•ˆç‡" class="headerlink" title="3.3 æŒ‡é’ˆçš„ä¼ é€’æ•ˆç‡"></a><strong>3.3 æŒ‡é’ˆçš„ä¼ é€’æ•ˆç‡</strong></h4>      <p>è™½ç„¶æŒ‡é’ˆå¯ä»¥é¿å…å¤§å¯¹è±¡çš„æ‹·è´ï¼Œä½†é¢‘ç¹ä½¿ç”¨æŒ‡é’ˆå¯èƒ½ä¼šå¢åŠ å†…å­˜è®¿é—®çš„å¼€é”€ï¼Œå°¤å…¶æ˜¯åœ¨æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ä¸­ã€‚</p><hr>        <h3 id="4-æŒ‡é’ˆçš„å¸¸è§è¯¯åŒº"   >          <a href="#4-æŒ‡é’ˆçš„å¸¸è§è¯¯åŒº" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-æŒ‡é’ˆçš„å¸¸è§è¯¯åŒº" class="headerlink" title="4. æŒ‡é’ˆçš„å¸¸è§è¯¯åŒº"></a><strong>4. æŒ‡é’ˆçš„å¸¸è§è¯¯åŒº</strong></h3>              <h4 id="4-1-æŒ‡é’ˆå’Œå€¼ä¼ é€’çš„åŒºåˆ«"   >          <a href="#4-1-æŒ‡é’ˆå’Œå€¼ä¼ é€’çš„åŒºåˆ«" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-1-æŒ‡é’ˆå’Œå€¼ä¼ é€’çš„åŒºåˆ«" class="headerlink" title="4.1 æŒ‡é’ˆå’Œå€¼ä¼ é€’çš„åŒºåˆ«"></a><strong>4.1 æŒ‡é’ˆå’Œå€¼ä¼ é€’çš„åŒºåˆ«</strong></h4>      <p>â€¢ å€¼ä¼ é€’ï¼šä¼ é€’çš„æ˜¯å˜é‡çš„å‰¯æœ¬ï¼Œå‡½æ•°å†…éƒ¨å¯¹å‚æ•°çš„ä¿®æ”¹ä¸ä¼šå½±å“å¤–éƒ¨å˜é‡ã€‚<br>â€¢ æŒ‡é’ˆä¼ é€’ï¼šä¼ é€’çš„æ˜¯å˜é‡çš„åœ°å€ï¼Œå‡½æ•°å†…éƒ¨å¯¹å‚æ•°çš„ä¿®æ”¹ä¼šå½±å“å¤–éƒ¨å˜é‡ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-9"   >          <a href="#ç¤ºä¾‹ï¼š-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-9" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modifyValue</span><span class="params">(x <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    x = <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modifyPointer</span><span class="params">(p *<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    *p = <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    a := <span class="number">10</span></span><br><span class="line">    modifyValue(a) <span class="comment">// ä¿®æ”¹å‰¯æœ¬ï¼Œä¸å½±å“å¤–éƒ¨å˜é‡</span></span><br><span class="line">    fmt.Println(a) <span class="comment">// è¾“å‡º 10</span></span><br><span class="line"></span><br><span class="line">    modifyPointer(&amp;a) <span class="comment">// ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å€¼</span></span><br><span class="line">    fmt.Println(a) <span class="comment">// è¾“å‡º 100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="4-2-æŒ‡é’ˆçš„è§£å¼•ç”¨"   >          <a href="#4-2-æŒ‡é’ˆçš„è§£å¼•ç”¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-2-æŒ‡é’ˆçš„è§£å¼•ç”¨" class="headerlink" title="4.2 æŒ‡é’ˆçš„è§£å¼•ç”¨"></a><strong>4.2 æŒ‡é’ˆçš„è§£å¼•ç”¨</strong></h4>      <p>è§£å¼•ç”¨æ“ä½œï¼ˆ<code>*p</code>ï¼‰æ˜¯è®¿é—®æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œè€Œä¸æ˜¯ä¿®æ”¹æŒ‡é’ˆæœ¬èº«ã€‚</p>        <h5 id="ç¤ºä¾‹ï¼š-10"   >          <a href="#ç¤ºä¾‹ï¼š-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-10" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    x := <span class="number">42</span></span><br><span class="line">    p := &amp;x</span><br><span class="line">    *p = <span class="number">100</span> <span class="comment">// ä¿®æ”¹ x çš„å€¼</span></span><br><span class="line">    fmt.Println(x) <span class="comment">// è¾“å‡º 100</span></span><br><span class="line">    fmt.Println(*p) <span class="comment">// è¾“å‡º 100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="5-æ€»ç»“"   >          <a href="#5-æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a><strong>5. æ€»ç»“</strong></h3>      <p>æŒ‡é’ˆåœ¨ Go ä¸­æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œåˆç†ä½¿ç”¨æŒ‡é’ˆå¯ä»¥å¸¦æ¥ä»¥ä¸‹å¥½å¤„ï¼š</p><ol><li><strong>ä¿®æ”¹å¤–éƒ¨å˜é‡</strong>ï¼šé€šè¿‡æŒ‡é’ˆå¯ä»¥åœ¨å‡½æ•°ä¸­ä¿®æ”¹å¤–éƒ¨å˜é‡çš„å€¼ã€‚</li><li><strong>æé«˜æ€§èƒ½</strong>ï¼šé¿å…å¤§å¯¹è±¡çš„æ‹·è´ï¼ŒèŠ‚çœå†…å­˜å’Œæ—¶é—´ã€‚</li><li><strong>å®ç°æ•°æ®å…±äº«</strong>ï¼šå¤šä¸ªåœ°æ–¹å¯ä»¥å…±äº«åŒä¸€ä¸ªå˜é‡ã€‚</li><li><strong>æ”¯æŒå¤æ‚æ•°æ®ç»“æ„</strong>ï¼šå¦‚é“¾è¡¨ã€æ ‘ã€å›¾ç­‰ã€‚</li><li><strong>å®ç°æ¥å£æ–¹æ³•</strong>ï¼šé€šè¿‡æŒ‡é’ˆæ¥æ”¶è€…å¯ä»¥ä¿®æ”¹æ¥æ”¶è€…çš„å€¼ã€‚</li><li><strong>æ”¯æŒç©ºå€¼</strong>ï¼šæŒ‡é’ˆå¯ä»¥ä¸º <code>nil</code>ï¼Œè¡¨ç¤ºâ€œæ— â€æˆ–â€œæœªè®¾ç½®â€ã€‚</li></ol><p>ä½†éœ€è¦æ³¨æ„ï¼š<br>â€¢ é¿å…æ»¥ç”¨æŒ‡é’ˆï¼Œå°¤å…¶æ˜¯åœ¨æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ä¸­ã€‚<br>â€¢ é¿å…ç©ºæŒ‡é’ˆè§£å¼•ç”¨å’Œå¾ªç¯å¼•ç”¨ã€‚<br>â€¢ æŒ‡é’ˆçš„ä½¿ç”¨éœ€è¦è°¨æ…ï¼Œç¡®ä¿ä»£ç çš„å¯è¯»æ€§å’Œå®‰å…¨æ€§ã€‚</p><p>é€šè¿‡åˆç†ä½¿ç”¨æŒ‡é’ˆï¼Œå¯ä»¥è®© Go ç¨‹åºæ›´åŠ é«˜æ•ˆå’Œçµæ´»ï¼ ğŸš€</p>]]></content>
    
    
    <summary type="html">Goè¯­è¨€æŒ‡é’ˆçš„ä½œç”¨è¯¦è§£</summary>
    
    
    
    <category term="Go" scheme="https://ljd0620.github.io/categories/Go/"/>
    
    
    <category term="Go" scheme="https://ljd0620.github.io/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>Goè¯­è¨€channelåŸç†åŠç”¨æ³•</title>
    <link href="https://ljd0620.github.io/2025/02/19/Go%E8%AF%AD%E8%A8%80channel%E5%8E%9F%E7%90%86%E5%8F%8A%E7%94%A8%E6%B3%95/"/>
    <id>https://ljd0620.github.io/2025/02/19/Go%E8%AF%AD%E8%A8%80channel%E5%8E%9F%E7%90%86%E5%8F%8A%E7%94%A8%E6%B3%95/</id>
    <published>2025-02-19T08:06:56.000Z</published>
    <updated>2025-03-19T08:07:52.375Z</updated>
    
    <content type="html"><![CDATA[<p>Goè¯­è¨€çš„<code>channel</code>æ˜¯å…¶å¹¶å‘ç¼–ç¨‹çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œç”¨äºåœ¨<code>goroutine</code>ä¹‹é—´å®‰å…¨åœ°ä¼ é€’æ•°æ®ã€‚ä»¥ä¸‹æ˜¯<code>channel</code>çš„åŸç†ã€ç”¨æ³•åŠæœ€ä½³å®è·µï¼š</p><hr>        <h3 id="ä¸€ã€Channel-åŸç†"   >          <a href="#ä¸€ã€Channel-åŸç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸€ã€Channel-åŸç†" class="headerlink" title="ä¸€ã€Channel åŸç†"></a><strong>ä¸€ã€Channel åŸç†</strong></h3>              <h4 id="1-æ•°æ®ç»“æ„"   >          <a href="#1-æ•°æ®ç»“æ„" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ•°æ®ç»“æ„" class="headerlink" title="1. æ•°æ®ç»“æ„"></a><strong>1. æ•°æ®ç»“æ„</strong></h4>      <ul><li><strong>åº•å±‚å®ç°</strong>ï¼š<code>channel</code>æ˜¯ä¸€ä¸ªç¯å½¢é˜Ÿåˆ—ï¼ˆcircular bufferï¼‰ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š<ul><li><code>buf</code>ï¼šå­˜å‚¨æ•°æ®çš„ç¼“å†²åŒºï¼ˆæœ‰ç¼“å†²<code>channel</code>ï¼‰ã€‚</li><li><code>sendx</code>ã€<code>recvx</code>ï¼šå‘é€å’Œæ¥æ”¶çš„ç´¢å¼•ã€‚</li><li><code>lock</code>ï¼šäº’æ–¥é”ï¼Œä¿æŠ¤<code>channel</code>çš„å¹¶å‘è®¿é—®ã€‚</li><li><code>sendq</code>ã€<code>recvq</code>ï¼šç­‰å¾…å‘é€å’Œæ¥æ”¶çš„<code>goroutine</code>é˜Ÿåˆ—ã€‚</li></ul></li></ul>        <h4 id="2-åŒæ­¥æœºåˆ¶"   >          <a href="#2-åŒæ­¥æœºåˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-åŒæ­¥æœºåˆ¶" class="headerlink" title="2. åŒæ­¥æœºåˆ¶"></a><strong>2. åŒæ­¥æœºåˆ¶</strong></h4>      <ul><li><strong>æ— ç¼“å†²<code>channel</code></strong>ï¼šå‘é€å’Œæ¥æ”¶æ“ä½œå¿…é¡»åŒæ—¶å‡†å¤‡å¥½ï¼Œå¦åˆ™ä¼šé˜»å¡ã€‚</li><li><strong>æœ‰ç¼“å†²<code>channel</code></strong>ï¼šç¼“å†²åŒºæœªæ»¡æ—¶å‘é€ä¸é˜»å¡ï¼Œç¼“å†²åŒºéç©ºæ—¶æ¥æ”¶ä¸é˜»å¡ã€‚</li></ul>        <h4 id="3-è°ƒåº¦è¡Œä¸º"   >          <a href="#3-è°ƒåº¦è¡Œä¸º" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-è°ƒåº¦è¡Œä¸º" class="headerlink" title="3. è°ƒåº¦è¡Œä¸º"></a><strong>3. è°ƒåº¦è¡Œä¸º</strong></h4>      <ul><li><strong>é˜»å¡ä¸å”¤é†’</strong>ï¼š<ul><li>å½“<code>channel</code>æ“ä½œé˜»å¡æ—¶ï¼Œ<code>goroutine</code>ä¼šè¢«æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚</li><li>å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼ˆå¦‚ç¼“å†²åŒºæœ‰ç©ºä½æˆ–æ•°æ®åˆ°è¾¾ï¼‰ï¼Œ<code>goroutine</code>ä¼šè¢«å”¤é†’ã€‚</li></ul></li></ul><hr>        <h3 id="äºŒã€Channel-åŸºç¡€ç”¨æ³•"   >          <a href="#äºŒã€Channel-åŸºç¡€ç”¨æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#äºŒã€Channel-åŸºç¡€ç”¨æ³•" class="headerlink" title="äºŒã€Channel åŸºç¡€ç”¨æ³•"></a><strong>äºŒã€Channel åŸºç¡€ç”¨æ³•</strong></h3>              <h4 id="1-åˆ›å»º-Channel"   >          <a href="#1-åˆ›å»º-Channel" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-åˆ›å»º-Channel" class="headerlink" title="1. åˆ›å»º Channel"></a><strong>1. åˆ›å»º Channel</strong></h4>      <ul><li><strong>æ— ç¼“å†²<code>channel</code></strong>ï¼š<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br></pre></td></tr></table></div></figure></li><li><strong>æœ‰ç¼“å†²<code>channel</code></strong>ï¼š<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">3</span>) <span class="comment">// ç¼“å†²åŒºå¤§å°ä¸º3</span></span><br></pre></td></tr></table></div></figure></li></ul>        <h4 id="2-å‘é€ä¸æ¥æ”¶"   >          <a href="#2-å‘é€ä¸æ¥æ”¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-å‘é€ä¸æ¥æ”¶" class="headerlink" title="2. å‘é€ä¸æ¥æ”¶"></a><strong>2. å‘é€ä¸æ¥æ”¶</strong></h4>      <ul><li><strong>å‘é€æ•°æ®</strong>ï¼š<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch &lt;- <span class="number">42</span> <span class="comment">// å‘é€æ•°æ®</span></span><br></pre></td></tr></table></div></figure></li><li><strong>æ¥æ”¶æ•°æ®</strong>ï¼š<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value := &lt;-ch <span class="comment">// æ¥æ”¶æ•°æ®</span></span><br></pre></td></tr></table></div></figure></li></ul>        <h4 id="3-å…³é—­-Channel"   >          <a href="#3-å…³é—­-Channel" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-å…³é—­-Channel" class="headerlink" title="3. å…³é—­ Channel"></a><strong>3. å…³é—­ Channel</strong></h4>      <ul><li><strong>å…³é—­<code>channel</code></strong>ï¼š<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">close</span>(ch)</span><br></pre></td></tr></table></div></figure></li><li><strong>æ£€æµ‹å…³é—­</strong>ï¼š<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">value, ok := &lt;-ch</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Channel closed&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li></ul>        <h4 id="4-ç¤ºä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹"   >          <a href="#4-ç¤ºä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-ç¤ºä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹" class="headerlink" title="4. ç¤ºä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹"></a><strong>4. ç¤ºä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</strong></h4>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">producer</span><span class="params">(ch <span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        ch &lt;- i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(ch)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(ch &lt;-<span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> value := <span class="keyword">range</span> ch &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Received:&quot;</span>, value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">    <span class="keyword">go</span> producer(ch)</span><br><span class="line">    consumer(ch)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="ä¸‰ã€Channel-é«˜çº§ç”¨æ³•"   >          <a href="#ä¸‰ã€Channel-é«˜çº§ç”¨æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸‰ã€Channel-é«˜çº§ç”¨æ³•" class="headerlink" title="ä¸‰ã€Channel é«˜çº§ç”¨æ³•"></a><strong>ä¸‰ã€Channel é«˜çº§ç”¨æ³•</strong></h3>              <h4 id="1-Select-å¤šè·¯å¤ç”¨"   >          <a href="#1-Select-å¤šè·¯å¤ç”¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-Select-å¤šè·¯å¤ç”¨" class="headerlink" title="1. Select å¤šè·¯å¤ç”¨"></a><strong>1. Select å¤šè·¯å¤ç”¨</strong></h4>      <p>ç›‘å¬å¤šä¸ª<code>channel</code>æ“ä½œï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line">    ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ch1 &lt;- <span class="string">&quot;from ch1&quot;</span> &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ch2 &lt;- <span class="string">&quot;from ch2&quot;</span> &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> msg := &lt;-ch1:</span><br><span class="line">        fmt.Println(msg)</span><br><span class="line">    <span class="keyword">case</span> msg := &lt;-ch2:</span><br><span class="line">        fmt.Println(msg)</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(time.Second): <span class="comment">// è¶…æ—¶æ§åˆ¶</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;timeout&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="2-å•å‘-Channel"   >          <a href="#2-å•å‘-Channel" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-å•å‘-Channel" class="headerlink" title="2. å•å‘ Channel"></a><strong>2. å•å‘ Channel</strong></h4>      <p>é™åˆ¶<code>channel</code>çš„å‘é€æˆ–æ¥æ”¶æ–¹å‘ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">producer</span><span class="params">(ch <span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        ch &lt;- i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(ch)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(ch &lt;-<span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> value := <span class="keyword">range</span> ch &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Received:&quot;</span>, value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="3-å¸¦ç¼“å†²-Channel-çš„å®¹é‡ä¸é•¿åº¦"   >          <a href="#3-å¸¦ç¼“å†²-Channel-çš„å®¹é‡ä¸é•¿åº¦" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-å¸¦ç¼“å†²-Channel-çš„å®¹é‡ä¸é•¿åº¦" class="headerlink" title="3. å¸¦ç¼“å†² Channel çš„å®¹é‡ä¸é•¿åº¦"></a><strong>3. å¸¦ç¼“å†² Channel çš„å®¹é‡ä¸é•¿åº¦</strong></h4>      <ul><li><strong>å®¹é‡</strong>ï¼š<code>cap(ch)</code>è¿”å›<code>channel</code>çš„ç¼“å†²åŒºå¤§å°ã€‚</li><li><strong>é•¿åº¦</strong>ï¼š<code>len(ch)</code>è¿”å›å½“å‰ç¼“å†²åŒºä¸­çš„æ•°æ®é‡ã€‚</li></ul><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">3</span>)</span><br><span class="line">    ch &lt;- <span class="number">1</span></span><br><span class="line">    ch &lt;- <span class="number">2</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Capacity:&quot;</span>, <span class="built_in">cap</span>(ch)) <span class="comment">// è¾“å‡º 3</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Length:&quot;</span>, <span class="built_in">len</span>(ch))   <span class="comment">// è¾“å‡º 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="å››ã€Channel-æœ€ä½³å®è·µ"   >          <a href="#å››ã€Channel-æœ€ä½³å®è·µ" class="heading-link"><i class="fas fa-link"></i></a><a href="#å››ã€Channel-æœ€ä½³å®è·µ" class="headerlink" title="å››ã€Channel æœ€ä½³å®è·µ"></a><strong>å››ã€Channel æœ€ä½³å®è·µ</strong></h3>              <h4 id="1-é¿å…æ­»é”"   >          <a href="#1-é¿å…æ­»é”" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-é¿å…æ­»é”" class="headerlink" title="1. é¿å…æ­»é”"></a><strong>1. é¿å…æ­»é”</strong></h4>      <ul><li><strong>æ— ç¼“å†²<code>channel</code></strong>ï¼šç¡®ä¿å‘é€å’Œæ¥æ”¶æ“ä½œæˆå¯¹å‡ºç°ã€‚</li><li><strong>æœ‰ç¼“å†²<code>channel</code></strong>ï¼šé¿å…ç¼“å†²åŒºæ»¡æ—¶å‘é€æˆ–ç©ºæ—¶æ¥æ”¶ã€‚</li></ul>        <h4 id="2-ä½¿ç”¨selectå®ç°è¶…æ—¶æ§åˆ¶"   >          <a href="#2-ä½¿ç”¨selectå®ç°è¶…æ—¶æ§åˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ä½¿ç”¨selectå®ç°è¶…æ—¶æ§åˆ¶" class="headerlink" title="2. ä½¿ç”¨selectå®ç°è¶…æ—¶æ§åˆ¶"></a><strong>2. ä½¿ç”¨<code>select</code>å®ç°è¶…æ—¶æ§åˆ¶</strong></h4>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">        ch &lt;- <span class="string">&quot;result&quot;</span></span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> res := &lt;-ch:</span><br><span class="line">        fmt.Println(res)</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(time.Second): <span class="comment">// è¶…æ—¶æ§åˆ¶</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;timeout&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="3-ä½¿ç”¨closeé€šçŸ¥ç»“æŸ"   >          <a href="#3-ä½¿ç”¨closeé€šçŸ¥ç»“æŸ" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ä½¿ç”¨closeé€šçŸ¥ç»“æŸ" class="headerlink" title="3. ä½¿ç”¨closeé€šçŸ¥ç»“æŸ"></a><strong>3. ä½¿ç”¨<code>close</code>é€šçŸ¥ç»“æŸ</strong></h4>      <p>é€šè¿‡å…³é—­<code>channel</code>é€šçŸ¥æ¥æ”¶æ–¹ä»»åŠ¡å®Œæˆï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(done <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line">    <span class="built_in">close</span>(done)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">    <span class="keyword">go</span> worker(done)</span><br><span class="line">    &lt;-done <span class="comment">// ç­‰å¾…ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Done&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="4-é™åˆ¶å¹¶å‘æ•°é‡"   >          <a href="#4-é™åˆ¶å¹¶å‘æ•°é‡" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-é™åˆ¶å¹¶å‘æ•°é‡" class="headerlink" title="4. é™åˆ¶å¹¶å‘æ•°é‡"></a><strong>4. é™åˆ¶å¹¶å‘æ•°é‡</strong></h4>      <p>ä½¿ç”¨å¸¦ç¼“å†²çš„<code>channel</code>å®ç°ä¿¡å·é‡ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">const</span> maxGoroutines = <span class="number">3</span></span><br><span class="line">    sem := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, maxGoroutines)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        sem &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125; <span class="comment">// å ç”¨ä¿¡å·é‡</span></span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(id <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; &lt;-sem &#125;() <span class="comment">// é‡Šæ”¾ä¿¡å·é‡</span></span><br><span class="line">            fmt.Printf(<span class="string">&quot;Goroutine %d running\n&quot;</span>, id)</span><br><span class="line">            time.Sleep(time.Second)</span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; maxGoroutines; i++ &#123;</span><br><span class="line">        sem &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125; <span class="comment">// ç­‰å¾…æ‰€æœ‰goroutineå®Œæˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="äº”ã€Channel-æ€§èƒ½ä¼˜åŒ–"   >          <a href="#äº”ã€Channel-æ€§èƒ½ä¼˜åŒ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#äº”ã€Channel-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="äº”ã€Channel æ€§èƒ½ä¼˜åŒ–"></a><strong>äº”ã€Channel æ€§èƒ½ä¼˜åŒ–</strong></h3>              <h4 id="1-å‡å°‘é”ç«äº‰"   >          <a href="#1-å‡å°‘é”ç«äº‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å‡å°‘é”ç«äº‰" class="headerlink" title="1. å‡å°‘é”ç«äº‰"></a><strong>1. å‡å°‘é”ç«äº‰</strong></h4>      <ul><li>ä½¿ç”¨å¤šä¸ªå°<code>channel</code>ä»£æ›¿å•ä¸ªå¤§<code>channel</code>ã€‚</li><li>é¿å…åœ¨é«˜é¢‘æ“ä½œä¸­ä½¿ç”¨æ— ç¼“å†²<code>channel</code>ã€‚</li></ul>        <h4 id="2-æ‰¹é‡å¤„ç†"   >          <a href="#2-æ‰¹é‡å¤„ç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ‰¹é‡å¤„ç†" class="headerlink" title="2. æ‰¹é‡å¤„ç†"></a><strong>2. æ‰¹é‡å¤„ç†</strong></h4>      <p>åˆå¹¶å°ä»»åŠ¡ï¼Œå‡å°‘<code>channel</code>æ“ä½œæ¬¡æ•°ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> []<span class="type">int</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        batch := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">            batch = <span class="built_in">append</span>(batch, i)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(batch) == <span class="number">10</span> &#123;</span><br><span class="line">                ch &lt;- batch</span><br><span class="line">                batch = <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">close</span>(ch)</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> batch := <span class="keyword">range</span> ch &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Received batch:&quot;</span>, batch)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="3-ä½¿ç”¨sync-Poolå¤ç”¨å¯¹è±¡"   >          <a href="#3-ä½¿ç”¨sync-Poolå¤ç”¨å¯¹è±¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ä½¿ç”¨sync-Poolå¤ç”¨å¯¹è±¡" class="headerlink" title="3. ä½¿ç”¨sync.Poolå¤ç”¨å¯¹è±¡"></a><strong>3. ä½¿ç”¨<code>sync.Pool</code>å¤ç”¨å¯¹è±¡</strong></h4>      <p>å‡å°‘å†…å­˜åˆ†é…å¼€é”€ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pool = sync.Pool&#123;</span><br><span class="line">    New: <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1024</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> []<span class="type">byte</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        buf := pool.Get().([]<span class="type">byte</span>)</span><br><span class="line">        <span class="keyword">defer</span> pool.Put(buf)</span><br><span class="line">        <span class="comment">// ä½¿ç”¨bufå¤„ç†æ•°æ®...</span></span><br><span class="line">        ch &lt;- buf</span><br><span class="line">    &#125;()</span><br><span class="line">    fmt.Println(&lt;-ch)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="å…­ã€Channel-è°ƒè¯•ä¸ç›‘æ§"   >          <a href="#å…­ã€Channel-è°ƒè¯•ä¸ç›‘æ§" class="heading-link"><i class="fas fa-link"></i></a><a href="#å…­ã€Channel-è°ƒè¯•ä¸ç›‘æ§" class="headerlink" title="å…­ã€Channel è°ƒè¯•ä¸ç›‘æ§"></a><strong>å…­ã€Channel è°ƒè¯•ä¸ç›‘æ§</strong></h3>              <h4 id="1-è°ƒè¯•å·¥å…·"   >          <a href="#1-è°ƒè¯•å·¥å…·" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-è°ƒè¯•å·¥å…·" class="headerlink" title="1. è°ƒè¯•å·¥å…·"></a><strong>1. è°ƒè¯•å·¥å…·</strong></h4>      <ul><li><strong>pprof</strong>ï¼šåˆ†æ<code>channel</code>çš„é˜»å¡æƒ…å†µã€‚<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="string">&quot;net/http/pprof&quot;</span></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    log.Println(http.ListenAndServe(<span class="string">&quot;localhost:6060&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></div></figure>è®¿é—®<code>http://localhost:6060/debug/pprof/goroutine?debug=1</code>æŸ¥çœ‹<code>goroutine</code>çŠ¶æ€ã€‚</li></ul>        <h4 id="2-ç›‘æ§æŒ‡æ ‡"   >          <a href="#2-ç›‘æ§æŒ‡æ ‡" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ç›‘æ§æŒ‡æ ‡" class="headerlink" title="2. ç›‘æ§æŒ‡æ ‡"></a><strong>2. ç›‘æ§æŒ‡æ ‡</strong></h4>      <ul><li><strong>runtime.NumGoroutine()</strong>ï¼šè·å–å½“å‰<code>goroutine</code>æ•°é‡ã€‚</li><li><strong>runtime.ReadMemStats()</strong>ï¼šç›‘æ§å†…å­˜ä½¿ç”¨ã€‚</li></ul><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <ul><li><strong>æ ¸å¿ƒç”¨é€”</strong>ï¼š<code>goroutine</code>é—´é€šä¿¡ä¸åŒæ­¥ã€‚</li><li><strong>å…³é”®ç‰¹æ€§</strong>ï¼š<ul><li>æ— ç¼“å†²<code>channel</code>ç”¨äºå¼ºåŒæ­¥ã€‚</li><li>æœ‰ç¼“å†²<code>channel</code>ç”¨äºè§£è€¦ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚</li></ul></li><li><strong>æœ€ä½³å®è·µ</strong>ï¼š<ul><li>ä½¿ç”¨<code>select</code>å®ç°è¶…æ—¶å’Œå¤šè·¯å¤ç”¨ã€‚</li><li>é€šè¿‡<code>close</code>é€šçŸ¥ä»»åŠ¡å®Œæˆã€‚</li><li>åˆç†æ§åˆ¶å¹¶å‘æ•°é‡ï¼Œé¿å…èµ„æºæ³„æ¼ã€‚</li></ul></li></ul><p>é€šè¿‡åˆç†ä½¿ç”¨<code>channel</code>ï¼Œå¯ä»¥æ„å»ºé«˜æ•ˆã€å®‰å…¨çš„å¹¶å‘ç¨‹åºã€‚</p>]]></content>
    
    
    <summary type="html">Goè¯­è¨€channelåŸç†åŠç”¨æ³•</summary>
    
    
    
    <category term="Go" scheme="https://ljd0620.github.io/categories/Go/"/>
    
    
    <category term="Go" scheme="https://ljd0620.github.io/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>Goè¯­è¨€goroutineåŸç†åŠç”¨æ³•</title>
    <link href="https://ljd0620.github.io/2025/02/10/Go%E8%AF%AD%E8%A8%80goroutine%E5%8E%9F%E7%90%86%E5%8F%8A%E7%94%A8%E6%B3%95/"/>
    <id>https://ljd0620.github.io/2025/02/10/Go%E8%AF%AD%E8%A8%80goroutine%E5%8E%9F%E7%90%86%E5%8F%8A%E7%94%A8%E6%B3%95/</id>
    <published>2025-02-10T04:06:14.000Z</published>
    <updated>2025-03-19T08:07:07.067Z</updated>
    
    <content type="html"><![CDATA[<p>Goè¯­è¨€çš„<code>goroutine</code>æ˜¯å…¶å¹¶å‘ç¼–ç¨‹çš„æ ¸å¿ƒç‰¹æ€§ï¼Œå®ƒæ˜¯ä¸€ç§è½»é‡çº§çš„çº¿ç¨‹ï¼Œç”±Goè¿è¡Œæ—¶ï¼ˆruntimeï¼‰ç®¡ç†ã€‚ä»¥ä¸‹æ˜¯<code>goroutine</code>çš„åŸç†ã€ç”¨æ³•åŠæœ€ä½³å®è·µï¼š</p><hr>        <h3 id="ä¸€ã€Goroutine-åŸç†"   >          <a href="#ä¸€ã€Goroutine-åŸç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸€ã€Goroutine-åŸç†" class="headerlink" title="ä¸€ã€Goroutine åŸç†"></a><strong>ä¸€ã€Goroutine åŸç†</strong></h3>              <h4 id="1-è½»é‡çº§çº¿ç¨‹"   >          <a href="#1-è½»é‡çº§çº¿ç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-è½»é‡çº§çº¿ç¨‹" class="headerlink" title="1. è½»é‡çº§çº¿ç¨‹"></a><strong>1. è½»é‡çº§çº¿ç¨‹</strong></h4>      <ul><li><strong>èµ„æºå ç”¨</strong>ï¼šæ¯ä¸ª<code>goroutine</code>åˆå§‹æ ˆå¤§å°ä»…2KBï¼ˆå¯åŠ¨æ€æ‰©å±•ï¼‰ï¼Œè¿œå°äºçº¿ç¨‹çš„MBçº§æ ˆã€‚</li><li><strong>è°ƒåº¦æœºåˆ¶</strong>ï¼šç”±Goè¿è¡Œæ—¶è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰ç®¡ç†ï¼ŒåŸºäºM:Næ¨¡å‹ï¼ˆMä¸ª<code>goroutine</code>æ˜ å°„åˆ°Nä¸ªOSçº¿ç¨‹ï¼‰ã€‚</li><li><strong>åä½œå¼è°ƒåº¦</strong>ï¼šé€šè¿‡<code>GOMAXPROCS</code>æ§åˆ¶å¹¶è¡Œåº¦ï¼Œé»˜è®¤å€¼ä¸ºCPUæ ¸å¿ƒæ•°ã€‚</li></ul>        <h4 id="2-è°ƒåº¦æ¨¡å‹"   >          <a href="#2-è°ƒåº¦æ¨¡å‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-è°ƒåº¦æ¨¡å‹" class="headerlink" title="2. è°ƒåº¦æ¨¡å‹"></a><strong>2. è°ƒåº¦æ¨¡å‹</strong></h4>      <ul><li><strong>G-M-P æ¨¡å‹</strong>ï¼š<ul><li><strong>Gï¼ˆGoroutineï¼‰</strong>ï¼šæ‰§è¡Œå•å…ƒã€‚</li><li><strong>Mï¼ˆMachineï¼‰</strong>ï¼šOSçº¿ç¨‹ã€‚</li><li><strong>Pï¼ˆProcessorï¼‰</strong>ï¼šé€»è¾‘å¤„ç†å™¨ï¼Œç»‘å®šMå’ŒGã€‚</li></ul></li><li><strong>å·¥ä½œçªƒå–ï¼ˆWork Stealingï¼‰</strong>ï¼šç©ºé—²Pä»å…¶ä»–Pçš„é˜Ÿåˆ—ä¸­å·å–Gæ‰§è¡Œã€‚</li></ul>        <h4 id="3-ä¸Šä¸‹æ–‡åˆ‡æ¢"   >          <a href="#3-ä¸Šä¸‹æ–‡åˆ‡æ¢" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="3. ä¸Šä¸‹æ–‡åˆ‡æ¢"></a><strong>3. ä¸Šä¸‹æ–‡åˆ‡æ¢</strong></h4>      <ul><li><strong>ç”¨æˆ·æ€åˆ‡æ¢</strong>ï¼š<code>goroutine</code>åˆ‡æ¢ç”±Goè¿è¡Œæ—¶ç®¡ç†ï¼Œæ— éœ€è¿›å…¥å†…æ ¸æ€ï¼Œå¼€é”€æä½ï¼ˆçº¦100nsï¼‰ã€‚</li><li><strong>è§¦å‘æ—¶æœº</strong>ï¼š<ul><li>ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚æ–‡ä»¶I&#x2F;Oï¼‰</li><li>é€šé“æ“ä½œï¼ˆ<code>channel</code>ï¼‰</li><li>æ˜¾å¼è°ƒç”¨<code>runtime.Gosched()</code></li></ul></li></ul><hr>        <h3 id="äºŒã€Goroutine-åŸºç¡€ç”¨æ³•"   >          <a href="#äºŒã€Goroutine-åŸºç¡€ç”¨æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#äºŒã€Goroutine-åŸºç¡€ç”¨æ³•" class="headerlink" title="äºŒã€Goroutine åŸºç¡€ç”¨æ³•"></a><strong>äºŒã€Goroutine åŸºç¡€ç”¨æ³•</strong></h3>              <h4 id="1-å¯åŠ¨-Goroutine"   >          <a href="#1-å¯åŠ¨-Goroutine" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å¯åŠ¨-Goroutine" class="headerlink" title="1. å¯åŠ¨ Goroutine"></a><strong>1. å¯åŠ¨ Goroutine</strong></h4>      <p>ä½¿ç”¨<code>go</code>å…³é”®å­—å¯åŠ¨ä¸€ä¸ª<code>goroutine</code>ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Hello from goroutine!&quot;</span>)</span><br><span class="line">    &#125;()</span><br><span class="line">    time.Sleep(time.Millisecond) <span class="comment">// ç­‰å¾…goroutineæ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="2-ä¼ é€’å‚æ•°"   >          <a href="#2-ä¼ é€’å‚æ•°" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ä¼ é€’å‚æ•°" class="headerlink" title="2. ä¼ é€’å‚æ•°"></a><strong>2. ä¼ é€’å‚æ•°</strong></h4>      <p>é€šè¿‡é—­åŒ…æˆ–å‡½æ•°å‚æ•°ä¼ é€’æ•°æ®ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printMessage</span><span class="params">(msg <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(msg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    msg := <span class="string">&quot;Hello, Go!&quot;</span></span><br><span class="line">    <span class="keyword">go</span> printMessage(msg) <span class="comment">// é€šè¿‡å‚æ•°ä¼ é€’</span></span><br><span class="line">    time.Sleep(time.Millisecond)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="3-ç­‰å¾…-Goroutine-å®Œæˆ"   >          <a href="#3-ç­‰å¾…-Goroutine-å®Œæˆ" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ç­‰å¾…-Goroutine-å®Œæˆ" class="headerlink" title="3. ç­‰å¾… Goroutine å®Œæˆ"></a><strong>3. ç­‰å¾… Goroutine å®Œæˆ</strong></h4>      <p>ä½¿ç”¨<code>sync.WaitGroup</code>åŒæ­¥å¤šä¸ª<code>goroutine</code>ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(id <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line">            fmt.Printf(<span class="string">&quot;Goroutine %d done\n&quot;</span>, id)</span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait() <span class="comment">// ç­‰å¾…æ‰€æœ‰goroutineå®Œæˆ</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;All goroutines finished&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="ä¸‰ã€Goroutine-é«˜çº§ç”¨æ³•"   >          <a href="#ä¸‰ã€Goroutine-é«˜çº§ç”¨æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸‰ã€Goroutine-é«˜çº§ç”¨æ³•" class="headerlink" title="ä¸‰ã€Goroutine é«˜çº§ç”¨æ³•"></a><strong>ä¸‰ã€Goroutine é«˜çº§ç”¨æ³•</strong></h3>              <h4 id="1-é€šé“ï¼ˆChannelï¼‰é€šä¿¡"   >          <a href="#1-é€šé“ï¼ˆChannelï¼‰é€šä¿¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-é€šé“ï¼ˆChannelï¼‰é€šä¿¡" class="headerlink" title="1. é€šé“ï¼ˆChannelï¼‰é€šä¿¡"></a><strong>1. é€šé“ï¼ˆChannelï¼‰é€šä¿¡</strong></h4>      <ul><li><strong>æ— ç¼“å†²é€šé“</strong>ï¼šåŒæ­¥é€šä¿¡ï¼Œå‘é€å’Œæ¥æ”¶å¿…é¡»åŒæ—¶å‡†å¤‡å¥½ã€‚<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        ch &lt;- <span class="number">42</span> <span class="comment">// å‘é€æ•°æ®</span></span><br><span class="line">    &#125;()</span><br><span class="line">    fmt.Println(&lt;-ch) <span class="comment">// æ¥æ”¶æ•°æ®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li><li><strong>ç¼“å†²é€šé“</strong>ï¼šå¼‚æ­¥é€šä¿¡ï¼Œç¼“å†²åŒºæ»¡æ—¶å‘é€é˜»å¡ã€‚<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">2</span>)</span><br><span class="line">    ch &lt;- <span class="number">1</span></span><br><span class="line">    ch &lt;- <span class="number">2</span></span><br><span class="line">    fmt.Println(&lt;-ch, &lt;-ch)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li></ul>        <h4 id="2-Select-å¤šè·¯å¤ç”¨"   >          <a href="#2-Select-å¤šè·¯å¤ç”¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Select-å¤šè·¯å¤ç”¨" class="headerlink" title="2. Select å¤šè·¯å¤ç”¨"></a><strong>2. Select å¤šè·¯å¤ç”¨</strong></h4>      <p>ç›‘å¬å¤šä¸ªé€šé“æ“ä½œï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line">    ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ch1 &lt;- <span class="string">&quot;from ch1&quot;</span> &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ch2 &lt;- <span class="string">&quot;from ch2&quot;</span> &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> msg := &lt;-ch1:</span><br><span class="line">        fmt.Println(msg)</span><br><span class="line">    <span class="keyword">case</span> msg := &lt;-ch2:</span><br><span class="line">        fmt.Println(msg)</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(time.Second): <span class="comment">// è¶…æ—¶æ§åˆ¶</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;timeout&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="3-ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰æ§åˆ¶"   >          <a href="#3-ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰æ§åˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰æ§åˆ¶" class="headerlink" title="3. ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰æ§åˆ¶"></a><strong>3. ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰æ§åˆ¶</strong></h4>      <p>ç”¨äºå–æ¶ˆ<code>goroutine</code>æˆ–ä¼ é€’è¶…æ—¶ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">        fmt.Println(<span class="string">&quot;cancelled&quot;</span>)</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(time.Second):</span><br><span class="line">        fmt.Println(<span class="string">&quot;work done&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ctx, cancel := context.WithTimeout(context.Background(), <span class="number">500</span>*time.Millisecond)</span><br><span class="line">    <span class="keyword">defer</span> cancel()</span><br><span class="line">    <span class="keyword">go</span> worker(ctx)</span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="å››ã€Goroutine-æœ€ä½³å®è·µ"   >          <a href="#å››ã€Goroutine-æœ€ä½³å®è·µ" class="heading-link"><i class="fas fa-link"></i></a><a href="#å››ã€Goroutine-æœ€ä½³å®è·µ" class="headerlink" title="å››ã€Goroutine æœ€ä½³å®è·µ"></a><strong>å››ã€Goroutine æœ€ä½³å®è·µ</strong></h3>              <h4 id="1-æ§åˆ¶å¹¶å‘æ•°é‡"   >          <a href="#1-æ§åˆ¶å¹¶å‘æ•°é‡" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ§åˆ¶å¹¶å‘æ•°é‡" class="headerlink" title="1. æ§åˆ¶å¹¶å‘æ•°é‡"></a><strong>1. æ§åˆ¶å¹¶å‘æ•°é‡</strong></h4>      <p>ä½¿ç”¨å¸¦ç¼“å†²çš„é€šé“æˆ–<code>semaphore</code>é™åˆ¶å¹¶å‘ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">const</span> maxGoroutines = <span class="number">3</span></span><br><span class="line">    sem := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, maxGoroutines)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        sem &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125; <span class="comment">// å ç”¨ä¿¡å·é‡</span></span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(id <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; &lt;-sem &#125;() <span class="comment">// é‡Šæ”¾ä¿¡å·é‡</span></span><br><span class="line">            fmt.Printf(<span class="string">&quot;Goroutine %d running\n&quot;</span>, id)</span><br><span class="line">            time.Sleep(time.Second)</span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; maxGoroutines; i++ &#123;</span><br><span class="line">        sem &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125; <span class="comment">// ç­‰å¾…æ‰€æœ‰goroutineå®Œæˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="2-é¿å…-Goroutine-æ³„æ¼"   >          <a href="#2-é¿å…-Goroutine-æ³„æ¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-é¿å…-Goroutine-æ³„æ¼" class="headerlink" title="2. é¿å… Goroutine æ³„æ¼"></a><strong>2. é¿å… Goroutine æ³„æ¼</strong></h4>      <p>ç¡®ä¿<code>goroutine</code>åœ¨ä¸å†éœ€è¦æ—¶é€€å‡ºï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> <span class="built_in">close</span>(done)</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            <span class="keyword">select</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> &lt;-done:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="comment">// æ‰§è¡Œä»»åŠ¡...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line">    <span class="built_in">close</span>(done) <span class="comment">// é€šçŸ¥goroutineé€€å‡º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="3-æ€§èƒ½ä¼˜åŒ–"   >          <a href="#3-æ€§èƒ½ä¼˜åŒ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="3. æ€§èƒ½ä¼˜åŒ–"></a><strong>3. æ€§èƒ½ä¼˜åŒ–</strong></h4>      <ul><li><strong>å‡å°‘é”ç«äº‰</strong>ï¼šä½¿ç”¨<code>sync.Pool</code>å¤ç”¨å¯¹è±¡ã€‚</li><li><strong>æ‰¹é‡å¤„ç†</strong>ï¼šåˆå¹¶å°ä»»åŠ¡ï¼Œå‡å°‘<code>goroutine</code>åˆ‡æ¢å¼€é”€ã€‚</li><li><strong>é¿å…é˜»å¡</strong>ï¼šä½¿ç”¨éé˜»å¡I&#x2F;Oæˆ–å¼‚æ­¥æ“ä½œã€‚</li></ul><hr>        <h3 id="äº”ã€Goroutine-è°ƒè¯•ä¸ç›‘æ§"   >          <a href="#äº”ã€Goroutine-è°ƒè¯•ä¸ç›‘æ§" class="heading-link"><i class="fas fa-link"></i></a><a href="#äº”ã€Goroutine-è°ƒè¯•ä¸ç›‘æ§" class="headerlink" title="äº”ã€Goroutine è°ƒè¯•ä¸ç›‘æ§"></a><strong>äº”ã€Goroutine è°ƒè¯•ä¸ç›‘æ§</strong></h3>              <h4 id="1-è°ƒè¯•å·¥å…·"   >          <a href="#1-è°ƒè¯•å·¥å…·" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-è°ƒè¯•å·¥å…·" class="headerlink" title="1. è°ƒè¯•å·¥å…·"></a><strong>1. è°ƒè¯•å·¥å…·</strong></h4>      <ul><li><strong>pprof</strong>ï¼šåˆ†æ<code>goroutine</code>å †æ ˆå’ŒCPUä½¿ç”¨ã€‚<figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="string">&quot;net/http/pprof&quot;</span></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    log.Println(http.ListenAndServe(<span class="string">&quot;localhost:6060&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></div></figure>è®¿é—®<code>http://localhost:6060/debug/pprof/goroutine?debug=1</code>æŸ¥çœ‹<code>goroutine</code>çŠ¶æ€ã€‚</li></ul>        <h4 id="2-ç›‘æ§æŒ‡æ ‡"   >          <a href="#2-ç›‘æ§æŒ‡æ ‡" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ç›‘æ§æŒ‡æ ‡" class="headerlink" title="2. ç›‘æ§æŒ‡æ ‡"></a><strong>2. ç›‘æ§æŒ‡æ ‡</strong></h4>      <ul><li><strong>runtime.NumGoroutine()</strong>ï¼šè·å–å½“å‰<code>goroutine</code>æ•°é‡ã€‚</li><li><strong>runtime.ReadMemStats()</strong>ï¼šç›‘æ§å†…å­˜ä½¿ç”¨ã€‚</li></ul><hr>        <h3 id="å…­ã€Goroutine-ä¸çº¿ç¨‹å¯¹æ¯”"   >          <a href="#å…­ã€Goroutine-ä¸çº¿ç¨‹å¯¹æ¯”" class="heading-link"><i class="fas fa-link"></i></a><a href="#å…­ã€Goroutine-ä¸çº¿ç¨‹å¯¹æ¯”" class="headerlink" title="å…­ã€Goroutine ä¸çº¿ç¨‹å¯¹æ¯”"></a><strong>å…­ã€Goroutine ä¸çº¿ç¨‹å¯¹æ¯”</strong></h3>      <div class="table-container"><table><thead><tr><th>ç‰¹æ€§</th><th>Goroutine</th><th>OS çº¿ç¨‹</th></tr></thead><tbody><tr><td><strong>åˆ›å»ºå¼€é”€</strong></td><td>2KBæ ˆï¼Œçº¦0.3Î¼s</td><td>MBçº§æ ˆï¼Œçº¦10Î¼s</td></tr><tr><td><strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong></td><td>ç”¨æˆ·æ€ï¼Œçº¦100ns</td><td>å†…æ ¸æ€ï¼Œçº¦1Î¼s</td></tr><tr><td><strong>è°ƒåº¦æ–¹å¼</strong></td><td>åä½œå¼ï¼ˆGoè¿è¡Œæ—¶ï¼‰</td><td>æŠ¢å å¼ï¼ˆOSå†…æ ¸ï¼‰</td></tr><tr><td><strong>å¹¶è¡Œåº¦</strong></td><td>å—<code>GOMAXPROCS</code>é™åˆ¶</td><td>å—CPUæ ¸å¿ƒæ•°é™åˆ¶</td></tr></tbody></table></div><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <ul><li><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼šè½»é‡ã€é«˜æ•ˆã€æ˜“ç”¨ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé«˜å¹¶å‘æœåŠ¡ã€å¼‚æ­¥ä»»åŠ¡å¤„ç†ã€å¹¶è¡Œè®¡ç®—ã€‚</li><li><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š<ul><li>é¿å…<code>goroutine</code>æ³„æ¼ã€‚</li><li>åˆç†æ§åˆ¶å¹¶å‘æ•°é‡ã€‚</li><li>ä½¿ç”¨é€šé“å’Œ<code>context</code>å®ç°åŒæ­¥ä¸å–æ¶ˆã€‚</li></ul></li></ul><p>é€šè¿‡åˆç†ä½¿ç”¨<code>goroutine</code>ï¼Œå¯ä»¥è½»æ¾æ„å»ºé«˜æ€§èƒ½ã€é«˜å¹¶å‘çš„Goç¨‹åºã€‚</p>]]></content>
    
    
    <summary type="html">Goè¯­è¨€goroutineåŸç†åŠç”¨æ³•</summary>
    
    
    
    <category term="Go" scheme="https://ljd0620.github.io/categories/Go/"/>
    
    
    <category term="Go" scheme="https://ljd0620.github.io/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>Goè¯­è¨€deferå…³é”®å­—ç”¨æ³•</title>
    <link href="https://ljd0620.github.io/2025/02/01/Go%E8%AF%AD%E8%A8%80defer%E5%85%B3%E9%94%AE%E5%AD%97%E7%94%A8%E6%B3%95/"/>
    <id>https://ljd0620.github.io/2025/02/01/Go%E8%AF%AD%E8%A8%80defer%E5%85%B3%E9%94%AE%E5%AD%97%E7%94%A8%E6%B3%95/</id>
    <published>2025-02-01T08:04:31.000Z</published>
    <updated>2025-03-19T08:07:25.170Z</updated>
    
    <content type="html"><![CDATA[<p>Goè¯­è¨€ä¸­çš„<code>defer</code>å…³é”®å­—ç”¨äºå»¶è¿Ÿæ‰§è¡Œå‡½æ•°è°ƒç”¨ï¼Œé€šå¸¸ç”¨äºèµ„æºç®¡ç†ï¼ˆå¦‚å…³é—­æ–‡ä»¶ã€è§£é”äº’æ–¥é”ï¼‰æˆ–ç¡®ä¿æŸäº›æ“ä½œåœ¨å‡½æ•°è¿”å›å‰æ‰§è¡Œã€‚ä»¥ä¸‹æ˜¯<code>defer</code>çš„è¯¦ç»†ç”¨æ³•åŠæ³¨æ„äº‹é¡¹ï¼š</p><hr>        <h3 id="1-åŸºç¡€ç”¨æ³•"   >          <a href="#1-åŸºç¡€ç”¨æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-åŸºç¡€ç”¨æ³•" class="headerlink" title="1. åŸºç¡€ç”¨æ³•"></a><strong>1. åŸºç¡€ç”¨æ³•</strong></h3>      <p><strong>è¯­æ³•</strong>ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">defer</span> functionCall()</span><br></pre></td></tr></table></div></figure><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li><code>defer</code>åçš„å‡½æ•°ä¼šåœ¨å¤–å±‚å‡½æ•°è¿”å›å‰æ‰§è¡Œã€‚</li><li>å¤šä¸ª<code>defer</code>æŒ‰**åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰**é¡ºåºæ‰§è¡Œã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">&quot;First defer&quot;</span>)  <span class="comment">// ç¬¬ä¸‰ä¸ªæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">&quot;Second defer&quot;</span>) <span class="comment">// ç¬¬äºŒä¸ªæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">&quot;Third defer&quot;</span>)  <span class="comment">// ç¬¬ä¸€ä¸ªæ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">// Third defer</span></span><br><span class="line"><span class="comment">// Second defer</span></span><br><span class="line"><span class="comment">// First defer</span></span><br></pre></td></tr></table></div></figure><hr>        <h3 id="2-å‚æ•°æ±‚å€¼æ—¶æœº"   >          <a href="#2-å‚æ•°æ±‚å€¼æ—¶æœº" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-å‚æ•°æ±‚å€¼æ—¶æœº" class="headerlink" title="2. å‚æ•°æ±‚å€¼æ—¶æœº"></a><strong>2. å‚æ•°æ±‚å€¼æ—¶æœº</strong></h3>      <p><code>defer</code>çš„å‚æ•°åœ¨å£°æ˜æ—¶ç«‹å³æ±‚å€¼ï¼Œè€Œéæ‰§è¡Œæ—¶ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    x := <span class="number">10</span></span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(<span class="string">&quot;Defer x:&quot;</span>, x) <span class="comment">// x=10 è¢«ç«‹å³æ•è·</span></span><br><span class="line">    x = <span class="number">20</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Current x:&quot;</span>, x)     <span class="comment">// è¾“å‡º 20</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">// Current x: 20</span></span><br><span class="line"><span class="comment">// Defer x: 10</span></span><br></pre></td></tr></table></div></figure><hr>        <h3 id="3-ä¿®æ”¹è¿”å›å€¼"   >          <a href="#3-ä¿®æ”¹è¿”å›å€¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ä¿®æ”¹è¿”å›å€¼" class="headerlink" title="3. ä¿®æ”¹è¿”å›å€¼"></a><strong>3. ä¿®æ”¹è¿”å›å€¼</strong></h3>      <p>è‹¥å‡½æ•°ä½¿ç”¨<strong>å‘½åè¿”å›å€¼</strong>ï¼Œ<code>defer</code>å¯ä»¥ä¿®æ”¹è¿”å›å€¼ï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">namedReturn</span><span class="params">()</span></span> (result <span class="type">int</span>) &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; result++ &#125;() <span class="comment">// ä¿®æ”¹å‘½åè¿”å›å€¼</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">5</span>                    <span class="comment">// å®é™…è¿”å› 5+1=6</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unnamedReturn</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">    result := <span class="number">5</span></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; result++ &#125;() <span class="comment">// ä¸å½±å“éå‘½åè¿”å›å€¼</span></span><br><span class="line">    <span class="keyword">return</span> result               <span class="comment">// è¿”å› 5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(namedReturn())   <span class="comment">// è¾“å‡º 6</span></span><br><span class="line">    fmt.Println(unnamedReturn()) <span class="comment">// è¾“å‡º 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="4-é”™è¯¯å¤„ç†ä¸èµ„æºé‡Šæ”¾"   >          <a href="#4-é”™è¯¯å¤„ç†ä¸èµ„æºé‡Šæ”¾" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-é”™è¯¯å¤„ç†ä¸èµ„æºé‡Šæ”¾" class="headerlink" title="4. é”™è¯¯å¤„ç†ä¸èµ„æºé‡Šæ”¾"></a><strong>4. é”™è¯¯å¤„ç†ä¸èµ„æºé‡Šæ”¾</strong></h3>              <h4 id="ï¼ˆ1ï¼‰æ–‡ä»¶æ“ä½œ"   >          <a href="#ï¼ˆ1ï¼‰æ–‡ä»¶æ“ä½œ" class="heading-link"><i class="fas fa-link"></i></a><a href="#ï¼ˆ1ï¼‰æ–‡ä»¶æ“ä½œ" class="headerlink" title="ï¼ˆ1ï¼‰æ–‡ä»¶æ“ä½œ"></a><strong>ï¼ˆ1ï¼‰æ–‡ä»¶æ“ä½œ</strong></h4>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readFile</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    file, err := os.Open(<span class="string">&quot;data.txt&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> file.Close() <span class="comment">// ç¡®ä¿æ–‡ä»¶å…³é—­</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†æ–‡ä»¶å†…å®¹...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="ï¼ˆ2ï¼‰äº’æ–¥é”"   >          <a href="#ï¼ˆ2ï¼‰äº’æ–¥é”" class="heading-link"><i class="fas fa-link"></i></a><a href="#ï¼ˆ2ï¼‰äº’æ–¥é”" class="headerlink" title="ï¼ˆ2ï¼‰äº’æ–¥é”"></a><strong>ï¼ˆ2ï¼‰äº’æ–¥é”</strong></h4>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mu sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateData</span><span class="params">()</span></span> &#123;</span><br><span class="line">    mu.Lock()</span><br><span class="line">    <span class="keyword">defer</span> mu.Unlock() <span class="comment">// ç¡®ä¿é”é‡Šæ”¾</span></span><br><span class="line">    <span class="comment">// æ“ä½œå…±äº«æ•°æ®...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="ï¼ˆ3ï¼‰é”™è¯¯ä¼ é€’"   >          <a href="#ï¼ˆ3ï¼‰é”™è¯¯ä¼ é€’" class="heading-link"><i class="fas fa-link"></i></a><a href="#ï¼ˆ3ï¼‰é”™è¯¯ä¼ é€’" class="headerlink" title="ï¼ˆ3ï¼‰é”™è¯¯ä¼ é€’"></a><strong>ï¼ˆ3ï¼‰é”™è¯¯ä¼ é€’</strong></h4>      <figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">()</span></span> (err <span class="type">error</span>) &#123;</span><br><span class="line">    file, err := os.Open(<span class="string">&quot;data.txt&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> closeErr := file.Close(); closeErr != <span class="literal">nil</span> &amp;&amp; err == <span class="literal">nil</span> &#123;</span><br><span class="line">            err = closeErr <span class="comment">// æ•è·å…³é—­é”™è¯¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†æ–‡ä»¶...</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="5-ç»“åˆé—­åŒ…ä¸åŒ¿åå‡½æ•°"   >          <a href="#5-ç»“åˆé—­åŒ…ä¸åŒ¿åå‡½æ•°" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-ç»“åˆé—­åŒ…ä¸åŒ¿åå‡½æ•°" class="headerlink" title="5. ç»“åˆé—­åŒ…ä¸åŒ¿åå‡½æ•°"></a><strong>5. ç»“åˆé—­åŒ…ä¸åŒ¿åå‡½æ•°</strong></h3>      <p>åœ¨å¾ªç¯ä¸­ä½¿ç”¨<code>defer</code>æ—¶ï¼Œéœ€æ³¨æ„èµ„æºé‡Šæ”¾çš„æ—¶æœºï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç¤ºä¾‹ï¼šdeferåœ¨å¾ªç¯ç»“æŸåç»Ÿä¸€æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">    file, _ := os.Open(fmt.Sprintf(<span class="string">&quot;file%d.txt&quot;</span>, i))</span><br><span class="line">    <span class="keyword">defer</span> file.Close() <span class="comment">// æ‰€æœ‰æ–‡ä»¶åœ¨å¾ªç¯ç»“æŸåå…³é—­ï¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®ç¤ºä¾‹ï¼šä½¿ç”¨åŒ¿åå‡½æ•°ç«‹å³é‡Šæ”¾èµ„æº</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        file, _ := os.Open(fmt.Sprintf(<span class="string">&quot;file%d.txt&quot;</span>, i))</span><br><span class="line">        <span class="keyword">defer</span> file.Close() <span class="comment">// æ¯æ¬¡å¾ªç¯ç»“æŸæ—¶å…³é—­æ–‡ä»¶</span></span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="6-ä¸recover-ç»“åˆå¤„ç†-panic"   >          <a href="#6-ä¸recover-ç»“åˆå¤„ç†-panic" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-ä¸recover-ç»“åˆå¤„ç†-panic" class="headerlink" title="6. ä¸recover()ç»“åˆå¤„ç† panic"></a><strong>6. ä¸<code>recover()</code>ç»“åˆå¤„ç† panic</strong></h3>      <p><code>defer</code>å¸¸ç”¨äºæ¢å¤<code>panic</code>ï¼Œé˜²æ­¢ç¨‹åºå´©æºƒï¼š</p><figure class="highlight go"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">safeCall</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;Recovered from panic:&quot;</span>, r)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="comment">// å¯èƒ½è§¦å‘panicçš„æ“ä½œ</span></span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;something went wrong&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    safeCall()</span><br><span class="line">    fmt.Println(<span class="string">&quot;Program continues&quot;</span>) <span class="comment">// è¾“å‡ºæ¢å¤åçš„æ—¥å¿—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="7-æ€§èƒ½æ³¨æ„äº‹é¡¹"   >          <a href="#7-æ€§èƒ½æ³¨æ„äº‹é¡¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-æ€§èƒ½æ³¨æ„äº‹é¡¹" class="headerlink" title="7. æ€§èƒ½æ³¨æ„äº‹é¡¹"></a><strong>7. æ€§èƒ½æ³¨æ„äº‹é¡¹</strong></h3>      <ul><li><strong>å»¶è¿Ÿå¼€é”€</strong>ï¼š<code>defer</code>ä¼šå¼•å…¥å°‘é‡æ€§èƒ½å¼€é”€ï¼ˆçº¦çº³ç§’çº§ï¼‰ï¼Œåœ¨æ€§èƒ½æ•æ„Ÿä»£ç ä¸­ï¼ˆå¦‚é«˜é¢‘å¾ªç¯ï¼‰éœ€è°¨æ…ä½¿ç”¨ã€‚</li><li><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼šåœ¨æç«¯æ€§èƒ½åœºæ™¯ä¸­ï¼Œå¯æ‰‹åŠ¨ç®¡ç†èµ„æºé‡Šæ”¾ï¼ˆå¦‚ç›´æ¥è°ƒç”¨<code>file.Close()</code>ï¼‰ã€‚</li></ul><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <ul><li><strong>æ ¸å¿ƒç”¨é€”</strong>ï¼šèµ„æºæ¸…ç†ã€é”™è¯¯æ¢å¤ã€ä»£ç é€»è¾‘ç®€åŒ–ã€‚</li><li><strong>å…³é”®è§„åˆ™</strong>ï¼š<ul><li>å‚æ•°ç«‹å³æ±‚å€¼ï¼Œæ‰§è¡Œé¡ºåºä¸ºLIFOã€‚</li><li>å¯ä¿®æ”¹å‘½åè¿”å›å€¼ï¼Œä½†éå‘½åè¿”å›å€¼ä¸å—å½±å“ã€‚</li></ul></li><li><strong>æœ€ä½³å®è·µ</strong>ï¼š<ul><li>åœ¨æ‰“å¼€èµ„æºåç«‹å³ä½¿ç”¨<code>defer</code>å…³é—­ã€‚</li><li>ç»“åˆé—­åŒ…å¤„ç†å¾ªç¯ä¸­çš„èµ„æºé‡Šæ”¾ã€‚</li><li>ä½¿ç”¨<code>defer + recover()</code>å¢å¼ºç¨‹åºå¥å£®æ€§ã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">Goè¯­è¨€deferå…³é”®å­—ç”¨æ³•</summary>
    
    
    
    <category term="Go" scheme="https://ljd0620.github.io/categories/Go/"/>
    
    
    <category term="Go" scheme="https://ljd0620.github.io/tags/Go/"/>
    
  </entry>
  
  <entry>
    <title>MQTTåè®®åŸç†åŠåº”ç”¨</title>
    <link href="https://ljd0620.github.io/2025/01/03/MQTT%E5%8D%8F%E8%AE%AE%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/"/>
    <id>https://ljd0620.github.io/2025/01/03/MQTT%E5%8D%8F%E8%AE%AE%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/</id>
    <published>2025-01-03T07:24:49.000Z</published>
    <updated>2025-03-19T08:05:02.522Z</updated>
    
    <content type="html"><![CDATA[<p>MQTTï¼ˆMessage Queuing Telemetry Transportï¼‰æ˜¯ä¸€ç§åŸºäº<strong>å‘å¸ƒ&#x2F;è®¢é˜…ï¼ˆPub-Subï¼‰æ¨¡å¼</strong>çš„è½»é‡çº§æ¶ˆæ¯ä¼ è¾“åè®®ï¼Œä¸“ä¸º<strong>ä½å¸¦å®½ã€ä¸å¯é ç½‘ç»œç¯å¢ƒ</strong>æˆ–<strong>èµ„æºå—é™è®¾å¤‡</strong>è®¾è®¡ã€‚å®ƒå¹¿æ³›åº”ç”¨äºç‰©è”ç½‘ï¼ˆIoTï¼‰ã€å®æ—¶é€šä¿¡ã€ä¼ æ„Ÿå™¨ç½‘ç»œç­‰é¢†åŸŸã€‚</p><hr>        <h3 id="ä¸€ã€MQTTåè®®æ ¸å¿ƒåŸç†"   >          <a href="#ä¸€ã€MQTTåè®®æ ¸å¿ƒåŸç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸€ã€MQTTåè®®æ ¸å¿ƒåŸç†" class="headerlink" title="ä¸€ã€MQTTåè®®æ ¸å¿ƒåŸç†"></a>ä¸€ã€MQTTåè®®æ ¸å¿ƒåŸç†</h3>              <h4 id="1-åè®®å®šä½"   >          <a href="#1-åè®®å®šä½" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-åè®®å®šä½" class="headerlink" title="1. åè®®å®šä½"></a>1. <strong>åè®®å®šä½</strong></h4>      <ul><li><strong>è½»é‡çº§</strong>ï¼šä¸“ä¸ºä½å¸¦å®½ã€é«˜å»¶è¿Ÿæˆ–ä¸å¯é ç½‘ç»œè®¾è®¡ï¼ŒæŠ¥æ–‡å¤´æœ€å°ä»…2å­—èŠ‚ã€‚</li><li><strong>å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å‹</strong>ï¼šè§£è€¦æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆPublisherï¼‰ä¸æ¶ˆè´¹è€…ï¼ˆSubscriberï¼‰ï¼Œé€šè¿‡ä¸»é¢˜ï¼ˆTopicï¼‰è·¯ç”±æ¶ˆæ¯ã€‚</li><li><strong>TCP&#x2F;IPåŸºç¡€</strong>ï¼šåŸºäºTCPé•¿è¿æ¥ï¼Œé»˜è®¤ç«¯å£1883ï¼ˆéåŠ å¯†ï¼‰&#x2F;8883ï¼ˆSSLåŠ å¯†ï¼‰ã€‚</li></ul>        <h4 id="2-æ ¸å¿ƒç»„ä»¶"   >          <a href="#2-æ ¸å¿ƒç»„ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ ¸å¿ƒç»„ä»¶" class="headerlink" title="2. æ ¸å¿ƒç»„ä»¶"></a>2. <strong>æ ¸å¿ƒç»„ä»¶</strong></h4>      <div class="table-container"><table><thead><tr><th>ç»„ä»¶</th><th>åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td><strong>Broker</strong></td><td>æ¶ˆæ¯ä»£ç†æœåŠ¡å™¨ï¼Œè´Ÿè´£æ¶ˆæ¯è·¯ç”±ã€å®¢æˆ·ç«¯ç®¡ç†å’Œä¼šè¯çŠ¶æ€ç»´æŠ¤ï¼ˆå¦‚EMQXã€Mosquittoï¼‰</td></tr><tr><td><strong>Publisher</strong></td><td>æ¶ˆæ¯å‘å¸ƒè€…ï¼Œå‘æŒ‡å®šä¸»é¢˜å‘é€æ•°æ®</td></tr><tr><td><strong>Subscriber</strong></td><td>æ¶ˆæ¯è®¢é˜…è€…ï¼Œé€šè¿‡è®¢é˜…ä¸»é¢˜æ¥æ”¶æ•°æ®</td></tr><tr><td><strong>Topic</strong></td><td>åˆ†å±‚ç»“æ„çš„æ¶ˆæ¯è·¯ç”±æ ‡è¯†ï¼ˆå¦‚<code>iot/device001/temperature</code>ï¼‰</td></tr></tbody></table></div>        <h4 id="3-QoSç­‰çº§"   >          <a href="#3-QoSç­‰çº§" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-QoSç­‰çº§" class="headerlink" title="3. QoSç­‰çº§"></a>3. <strong>QoSç­‰çº§</strong></h4>      <div class="table-container"><table><thead><tr><th>QoSçº§åˆ«</th><th>å¯é æ€§ä¿éšœæœºåˆ¶</th><th>ç½‘ç»œå¼€é”€</th><th>å…¸å‹åœºæ™¯</th></tr></thead><tbody><tr><td>0</td><td>è‡³å¤šä¸€æ¬¡ï¼ˆAt most onceï¼‰</td><td>æœ€ä½</td><td>ä¼ æ„Ÿå™¨æ•°æ®ä¸ŠæŠ¥ï¼ˆå…è®¸ä¸¢å¤±ï¼‰</td></tr><tr><td>1</td><td>è‡³å°‘ä¸€æ¬¡ï¼ˆAt least onceï¼‰</td><td>ä¸­ç­‰</td><td>è®¾å¤‡æ§åˆ¶æŒ‡ä»¤ï¼ˆéœ€ç¡®è®¤ï¼‰</td></tr><tr><td>2</td><td>æ°å¥½ä¸€æ¬¡ï¼ˆExactly onceï¼‰</td><td>æœ€é«˜</td><td>æ”¯ä»˜äº¤æ˜“ï¼ˆä¸¥æ ¼ä¸€è‡´æ€§ï¼‰</td></tr></tbody></table></div>        <h4 id="4-ä¼šè¯æœºåˆ¶"   >          <a href="#4-ä¼šè¯æœºåˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-ä¼šè¯æœºåˆ¶" class="headerlink" title="4. ä¼šè¯æœºåˆ¶"></a>4. <strong>ä¼šè¯æœºåˆ¶</strong></h4>      <ul><li><strong>Clean Session</strong>ï¼š<ul><li><code>true</code>ï¼šå®¢æˆ·ç«¯æ–­å¼€ååˆ é™¤ä¼šè¯çŠ¶æ€ï¼Œé€‚åˆä¸´æ—¶è®¾å¤‡ã€‚</li><li><code>false</code>ï¼šä¿ç•™è®¢é˜…åˆ—è¡¨å’Œæœªç¡®è®¤æ¶ˆæ¯ï¼ˆQoS 1&#x2F;2ï¼‰ï¼Œæ”¯æŒæ–­çº¿é‡è¿åæ¢å¤ã€‚</li></ul></li><li><strong>Last Willï¼ˆé—å˜±æ¶ˆæ¯ï¼‰</strong>ï¼šå®¢æˆ·ç«¯å¼‚å¸¸æ–­å¼€æ—¶ï¼ŒBrokerè‡ªåŠ¨å‘å¸ƒé¢„è®¾æ¶ˆæ¯ã€‚</li></ul><hr>        <h3 id="äºŒã€MQTTåè®®å·¥ä½œæµç¨‹ï¼ˆæ—¶åºå›¾ï¼‰"   >          <a href="#äºŒã€MQTTåè®®å·¥ä½œæµç¨‹ï¼ˆæ—¶åºå›¾ï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#äºŒã€MQTTåè®®å·¥ä½œæµç¨‹ï¼ˆæ—¶åºå›¾ï¼‰" class="headerlink" title="äºŒã€MQTTåè®®å·¥ä½œæµç¨‹ï¼ˆæ—¶åºå›¾ï¼‰"></a>äºŒã€MQTTåè®®å·¥ä½œæµç¨‹ï¼ˆæ—¶åºå›¾ï¼‰</h3>      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">participant Publisher as P</span><br><span class="line">participant Broker as B</span><br><span class="line">participant Subscriber as S</span><br><span class="line"></span><br><span class="line">P -&gt; B: CONNECT (clientId=pub1)</span><br><span class="line">B --&gt; P: CONNACK (success)</span><br><span class="line"></span><br><span class="line">S -&gt; B: CONNECT (clientId=sub1)</span><br><span class="line">B --&gt; S: CONNACK (success)</span><br><span class="line">S -&gt; B: SUBSCRIBE (topic=iot/+/temp, QoS=1)</span><br><span class="line">B --&gt; S: SUBACK (QoS=1 granted)</span><br><span class="line"></span><br><span class="line">P -&gt; B: PUBLISH (topic=iot/device001/temp, payload=25.6, QoS=1)</span><br><span class="line">B -&gt; S: PUBLISH (topic=iot/device001/temp, payload=25.6, QoS=1)</span><br><span class="line">S -&gt; B: PUBACK (messageId=1)</span><br><span class="line">B -&gt; P: PUBACK (messageId=1)</span><br><span class="line">@enduml</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="ä¸‰ã€å…¸å‹åº”ç”¨åœºæ™¯"   >          <a href="#ä¸‰ã€å…¸å‹åº”ç”¨åœºæ™¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸‰ã€å…¸å‹åº”ç”¨åœºæ™¯" class="headerlink" title="ä¸‰ã€å…¸å‹åº”ç”¨åœºæ™¯"></a>ä¸‰ã€å…¸å‹åº”ç”¨åœºæ™¯</h3>              <h4 id="1-ç‰©è”ç½‘è®¾å¤‡é€šä¿¡"   >          <a href="#1-ç‰©è”ç½‘è®¾å¤‡é€šä¿¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ç‰©è”ç½‘è®¾å¤‡é€šä¿¡" class="headerlink" title="1. ç‰©è”ç½‘è®¾å¤‡é€šä¿¡"></a>1. <strong>ç‰©è”ç½‘è®¾å¤‡é€šä¿¡</strong></h4>      <ul><li><strong>åœºæ™¯ç‰¹ç‚¹</strong>ï¼šæµ·é‡è®¾å¤‡ã€ä½åŠŸè€—ã€å¼±ç½‘ç»œç¯å¢ƒã€‚</li><li><strong>æŠ€æœ¯å®ç°</strong>ï¼š<ul><li>è®¾å¤‡é€šè¿‡MQTTä¸ŠæŠ¥ä¼ æ„Ÿå™¨æ•°æ®ï¼ˆQoS 0ï¼‰ã€‚</li><li>äº‘ç«¯ä¸‹å‘æ§åˆ¶æŒ‡ä»¤ï¼ˆQoS 1ï¼‰ï¼š<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨Eclipse Pahoå‘é€æ§åˆ¶æŒ‡ä»¤</span></span><br><span class="line"><span class="type">MqttMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MqttMessage</span>(<span class="string">&quot;ON&quot;</span>.getBytes());</span><br><span class="line">message.setQos(<span class="number">1</span>);</span><br><span class="line">client.publish(<span class="string">&quot;iot/device001/switch&quot;</span>, message);</span><br></pre></td></tr></table></div></figure></li></ul></li><li><strong>ä¼˜åŠ¿</strong>ï¼šæ”¯æŒè®¾å¤‡ç¦»çº¿æ¶ˆæ¯ç¼“å­˜ï¼ˆQoS 1&#x2F;2ï¼‰ï¼Œé€‚åº”ç½‘ç»œæ³¢åŠ¨ã€‚</li></ul>        <h4 id="2-ç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€"   >          <a href="#2-ç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€" class="headerlink" title="2. ç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€"></a>2. <strong>ç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€</strong></h4>      <ul><li><strong>åœºæ™¯ç‰¹ç‚¹</strong>ï¼šéœ€ä¿æŒé•¿è¿æ¥ã€èŠ‚çœç”µé‡ã€‚</li><li><strong>æŠ€æœ¯å®ç°</strong>ï¼š<ul><li>å®¢æˆ·ç«¯è®¢é˜…ç”¨æˆ·ä¸“å±ä¸»é¢˜ï¼ˆå¦‚<code>user/12345/notify</code>ï¼‰ã€‚</li><li>æœåŠ¡ç«¯è§¦å‘æ¨é€æ—¶å‘å¸ƒåˆ°å¯¹åº”ä¸»é¢˜ï¼š<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pythonç¤ºä¾‹ï¼ˆä½¿ç”¨paho-mqttï¼‰</span></span><br><span class="line">client.publish(<span class="string">&quot;user/12345/notify&quot;</span>, <span class="string">&quot;New message&quot;</span>, qos=<span class="number">1</span>)</span><br></pre></td></tr></table></div></figure></li></ul></li><li><strong>ä¼˜åŠ¿</strong>ï¼šç›¸æ¯”HTTPè½®è¯¢ï¼Œé™ä½ç½‘ç»œæµé‡å’ŒæœåŠ¡å™¨å‹åŠ›ã€‚</li></ul>        <h4 id="3-å®æ—¶ç›‘æ§ç³»ç»Ÿ"   >          <a href="#3-å®æ—¶ç›‘æ§ç³»ç»Ÿ" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-å®æ—¶ç›‘æ§ç³»ç»Ÿ" class="headerlink" title="3. å®æ—¶ç›‘æ§ç³»ç»Ÿ"></a>3. <strong>å®æ—¶ç›‘æ§ç³»ç»Ÿ</strong></h4>      <ul><li><strong>åœºæ™¯ç‰¹ç‚¹</strong>ï¼šæ•°æ®é«˜é¢‘æ›´æ–°ã€å¤šç»ˆç«¯åŒæ­¥ã€‚</li><li><strong>æŠ€æœ¯å®ç°</strong>ï¼š<ul><li>ä½¿ç”¨é€šé…ç¬¦è®¢é˜…ï¼ˆ<code>#</code>å¤šçº§ï¼Œ<code>+</code>å•çº§ï¼‰ï¼š<figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è®¢é˜…æ‰€æœ‰æ¸©åº¦æ•°æ®</span></span><br><span class="line">SUBSCRIBE iot<span class="operator">/</span><span class="operator">+</span><span class="operator">/</span>temperature</span><br></pre></td></tr></table></div></figure></li><li>Brokeré›†ç¾¤éƒ¨ç½²ï¼ˆå¦‚EMQXé›†ç¾¤ï¼‰ï¼Œæ”¯æ’‘ç™¾ä¸‡çº§å¹¶å‘è¿æ¥ã€‚</li></ul></li></ul>        <h4 id="4-è½¦è”ç½‘ï¼ˆV2Xï¼‰"   >          <a href="#4-è½¦è”ç½‘ï¼ˆV2Xï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-è½¦è”ç½‘ï¼ˆV2Xï¼‰" class="headerlink" title="4. è½¦è”ç½‘ï¼ˆV2Xï¼‰"></a>4. <strong>è½¦è”ç½‘ï¼ˆV2Xï¼‰</strong></h4>      <ul><li><strong>åœºæ™¯ç‰¹ç‚¹</strong>ï¼šä½å»¶è¿Ÿã€é«˜å¯é æ€§ã€‚</li><li><strong>æŠ€æœ¯å®ç°</strong>ï¼š<ul><li>è½¦è¾†å‘å¸ƒå®æ—¶çŠ¶æ€ï¼ˆä½ç½®&#x2F;é€Ÿåº¦ï¼‰åˆ°<code>v2x/car001/status</code>ã€‚</li><li>è¾¹ç¼˜è®¡ç®—èŠ‚ç‚¹è®¢é˜…æ•°æ®ï¼Œè§¦å‘ç¢°æ’é¢„è­¦ï¼š<figure class="highlight cpp"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++ç¤ºä¾‹ï¼ˆä½¿ç”¨MQTTAsyncï¼‰</span></span><br><span class="line">MQTTAsync_responseOptions opts = MQTTAsync_responseOptions_initializer;</span><br><span class="line">opts.onSuccess = onPublishSuccess;</span><br><span class="line"><span class="built_in">MQTTAsync_send</span>(client, <span class="string">&quot;v2x/car001/status&quot;</span>, <span class="built_in">strlen</span>(data), data, <span class="number">2</span>, <span class="number">0</span>, &amp;opts);</span><br></pre></td></tr></table></div></figure></li></ul></li></ul><hr>        <h3 id="å››ã€MQTT-5-0å¢å¼ºç‰¹æ€§"   >          <a href="#å››ã€MQTT-5-0å¢å¼ºç‰¹æ€§" class="heading-link"><i class="fas fa-link"></i></a><a href="#å››ã€MQTT-5-0å¢å¼ºç‰¹æ€§" class="headerlink" title="å››ã€MQTT 5.0å¢å¼ºç‰¹æ€§"></a>å››ã€MQTT 5.0å¢å¼ºç‰¹æ€§</h3>      <div class="table-container"><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ä¼šè¯è¿‡æœŸ</strong></td><td>å®¢æˆ·ç«¯å¯è®¾ç½®ä¼šè¯è¿‡æœŸæ—¶é—´ï¼ˆSession Expiry Intervalï¼‰ï¼Œä¼˜åŒ–èµ„æºç®¡ç†</td></tr><tr><td><strong>åŸå› ç </strong></td><td>ç²¾ç»†åŒ–é”™è¯¯åé¦ˆï¼ˆå¦‚0x81è¡¨ç¤ºåè®®ç‰ˆæœ¬ä¸æ”¯æŒï¼‰</td></tr><tr><td><strong>å…±äº«è®¢é˜…</strong></td><td>å®ç°è´Ÿè½½å‡è¡¡ï¼ˆ<code>$share/group1/topic</code>ï¼‰ï¼Œé¿å…å•ä¸ªæ¶ˆè´¹è€…è¿‡è½½</td></tr><tr><td><strong>æ¶ˆæ¯è¿‡æœŸ</strong></td><td>è®¾ç½®æ¶ˆæ¯çš„ç”Ÿå­˜æ—¶é—´ï¼ˆMessage Expiry Intervalï¼‰ï¼Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®</td></tr></tbody></table></div><hr>        <h3 id="äº”ã€ä¸åŒç±»åè®®å¯¹æ¯”"   >          <a href="#äº”ã€ä¸åŒç±»åè®®å¯¹æ¯”" class="heading-link"><i class="fas fa-link"></i></a><a href="#äº”ã€ä¸åŒç±»åè®®å¯¹æ¯”" class="headerlink" title="äº”ã€ä¸åŒç±»åè®®å¯¹æ¯”"></a>äº”ã€ä¸åŒç±»åè®®å¯¹æ¯”</h3>      <div class="table-container"><table><thead><tr><th>åè®®</th><th>ä¼ è¾“å±‚</th><th>æ¶ˆæ¯æ¨¡å‹</th><th>å¤´éƒ¨å¼€é”€</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>MQTT</strong></td><td>TCP</td><td>å‘å¸ƒ&#x2F;è®¢é˜…</td><td>2-4å­—èŠ‚</td><td>ç‰©è”ç½‘ã€ç§»åŠ¨æ¨é€</td></tr><tr><td><strong>CoAP</strong></td><td>UDP</td><td>è¯·æ±‚&#x2F;å“åº”</td><td>4å­—èŠ‚</td><td>å—é™è®¾å¤‡ï¼ˆå¦‚NB-IoTï¼‰</td></tr><tr><td><strong>AMQP</strong></td><td>TCP</td><td>é˜Ÿåˆ—&#x2F;è·¯ç”±</td><td>8å­—èŠ‚</td><td>ä¼ä¸šçº§æ¶ˆæ¯ä¸­é—´ä»¶</td></tr><tr><td><strong>HTTP</strong></td><td>TCP</td><td>è¯·æ±‚&#x2F;å“åº”</td><td>100+å­—èŠ‚</td><td>RESTful APIé€šä¿¡</td></tr></tbody></table></div><hr>        <h3 id="å…­ã€å®‰å…¨æœºåˆ¶"   >          <a href="#å…­ã€å®‰å…¨æœºåˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#å…­ã€å®‰å…¨æœºåˆ¶" class="headerlink" title="å…­ã€å®‰å…¨æœºåˆ¶"></a>å…­ã€å®‰å…¨æœºåˆ¶</h3>      <ol><li><p><strong>è®¤è¯æˆæƒ</strong>ï¼š</p><ul><li>ç”¨æˆ·åå¯†ç è®¤è¯ï¼ˆPLAIN&#x2F;SCRAM-SHA-1ï¼‰ã€‚</li><li>å®¢æˆ·ç«¯è¯ä¹¦åŒå‘è®¤è¯ï¼ˆTLSï¼‰ã€‚</li><li>é›†æˆOAuth 2.0ï¼ˆå¦‚EMQXä¼ä¸šç‰ˆï¼‰ã€‚</li></ul></li><li><p><strong>ä¼ è¾“åŠ å¯†</strong>ï¼š</p><ul><li>TLS 1.3åŠ å¯†é€šä¿¡ï¼ˆé»˜è®¤ç«¯å£8883ï¼‰ã€‚</li><li>PSKï¼ˆPre-Shared Keyï¼‰æ¨¡å¼ï¼Œé€‚ç”¨äºèµ„æºå—é™è®¾å¤‡ã€‚</li></ul></li><li><p><strong>æƒé™æ§åˆ¶</strong>ï¼š</p><ul><li>ACLè§„åˆ™é™åˆ¶å®¢æˆ·ç«¯å‘å¸ƒ&#x2F;è®¢é˜…æƒé™ï¼š<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EMQX ACLç¤ºä¾‹</span></span><br><span class="line">&#123;allow, &#123;user, <span class="string">&quot;admin&quot;</span>&#125;, pubsub, [<span class="string">&quot;<span class="variable">$SYS</span>/#&quot;</span>]&#125;.</span><br><span class="line">&#123;deny, all, subscribe, [<span class="string">&quot;<span class="variable">$SYS</span>/#&quot;</span>]&#125;.</span><br></pre></td></tr></table></div></figure></li></ul></li></ol><hr>        <h3 id="ä¸ƒã€å®æˆ˜å»ºè®®"   >          <a href="#ä¸ƒã€å®æˆ˜å»ºè®®" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸ƒã€å®æˆ˜å»ºè®®" class="headerlink" title="ä¸ƒã€å®æˆ˜å»ºè®®"></a>ä¸ƒã€å®æˆ˜å»ºè®®</h3>      <ol><li><p><strong>Brokeré€‰å‹</strong>ï¼š</p><ul><li>å¼€æºæ–¹æ¡ˆï¼šEMQXï¼ˆæ”¯æŒé›†ç¾¤ï¼‰ã€Mosquittoï¼ˆè½»é‡çº§ï¼‰ã€‚</li><li>å•†ä¸šæ–¹æ¡ˆï¼šAWS IoT Coreã€Azure IoT Hubã€‚</li></ul></li><li><p><strong>å®¢æˆ·ç«¯åº“æ¨è</strong>ï¼š</p><ul><li>Javaï¼šEclipse Paho <code>org.eclipse.paho:org.eclipse.paho.client.mqttv3</code></li><li>Pythonï¼š<code>paho-mqtt</code></li><li>C&#x2F;C++ï¼šEclipse Paho Cåº“</li></ul></li><li><p><strong>æ€§èƒ½è°ƒä¼˜</strong>ï¼š</p><ul><li>å¯ç”¨WebSocketæ”¯æŒï¼ˆç«¯å£8083&#x2F;8084ï¼‰ï¼Œæ–¹ä¾¿æµè§ˆå™¨é›†æˆã€‚</li><li>é…ç½®æŒä¹…åŒ–å­˜å‚¨ï¼ˆå¦‚Redis&#x2F;MySQLï¼‰ï¼Œä¿éšœQoS 1&#x2F;2æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚</li><li>ä½¿ç”¨å…±äº«è®¢é˜…å®ç°æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡ã€‚</li></ul></li></ol><hr><p>é€šè¿‡åˆç†åº”ç”¨MQTTåè®®ï¼Œå¯æœ‰æ•ˆè§£å†³ç‰©è”ç½‘åœºæ™¯ä¸‹çš„æµ·é‡è¿æ¥ã€å¼±ç½‘é€šä¿¡å’Œå®æ—¶æ•°æ®åŒæ­¥é—®é¢˜ï¼Œå»ºè®®ç»“åˆå…·ä½“ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„QoSçº§åˆ«å’Œå®‰å…¨ç­–ç•¥ã€‚</p>]]></content>
    
    
    <summary type="html">MQTTåè®®åŸç†åŠåº”ç”¨</summary>
    
    
    
    <category term="ç‰©è”ç½‘" scheme="https://ljd0620.github.io/categories/%E7%89%A9%E8%81%94%E7%BD%91/"/>
    
    
    <category term="MQTT" scheme="https://ljd0620.github.io/tags/MQTT/"/>
    
  </entry>
  
  <entry>
    <title>Kafkaå·¥ä½œåŸç†è¯¦è§£</title>
    <link href="https://ljd0620.github.io/2024/07/18/Kafka%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/"/>
    <id>https://ljd0620.github.io/2024/07/18/Kafka%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/</id>
    <published>2024-07-18T04:23:44.000Z</published>
    <updated>2025-03-19T01:59:27.540Z</updated>
    
    <content type="html"><![CDATA[<p>Apache Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¤„ç†å¹³å°ï¼Œä¸“ä¸ºé«˜ååã€ä½å»¶è¿Ÿçš„å®æ—¶æ•°æ®ä¼ è¾“è®¾è®¡ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒå·¥ä½œåŸç†çš„åˆ†å±‚è§£æï¼š</p><hr>        <h3 id="ä¸€ã€æ ¸å¿ƒæ¶æ„ç»„ä»¶"   >          <a href="#ä¸€ã€æ ¸å¿ƒæ¶æ„ç»„ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸€ã€æ ¸å¿ƒæ¶æ„ç»„ä»¶" class="headerlink" title="ä¸€ã€æ ¸å¿ƒæ¶æ„ç»„ä»¶"></a>ä¸€ã€æ ¸å¿ƒæ¶æ„ç»„ä»¶</h3>              <h4 id="1-Brokerï¼ˆä»£ç†èŠ‚ç‚¹ï¼‰"   >          <a href="#1-Brokerï¼ˆä»£ç†èŠ‚ç‚¹ï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-Brokerï¼ˆä»£ç†èŠ‚ç‚¹ï¼‰" class="headerlink" title="1. Brokerï¼ˆä»£ç†èŠ‚ç‚¹ï¼‰"></a>1. <strong>Brokerï¼ˆä»£ç†èŠ‚ç‚¹ï¼‰</strong></h4>      <p>â€¢ <strong>è§’è‰²</strong>ï¼šKafka é›†ç¾¤ä¸­çš„å•å°æœåŠ¡å™¨ï¼Œè´Ÿè´£æ•°æ®å­˜å‚¨å’Œæ¶ˆæ¯ä¼ é€’ã€‚<br>â€¢ <strong>é›†ç¾¤æ¨¡å¼</strong>ï¼šå¤šä¸ª Broker ç»„æˆé›†ç¾¤ï¼Œæ¯ä¸ª Broker é€šè¿‡å”¯ä¸€ ID æ ‡è¯†ï¼Œæ”¯æŒåŠ¨æ€æ‰©å®¹ã€‚<br>â€¢ <strong>æ•°æ®å­˜å‚¨</strong>ï¼šæ¯ä¸ª Broker å­˜å‚¨å¤šä¸ª <strong>Topicï¼ˆä¸»é¢˜ï¼‰</strong> çš„åˆ†åŒºï¼ˆPartitionï¼‰å‰¯æœ¬ã€‚</p>        <h4 id="2-Topicï¼ˆä¸»é¢˜ï¼‰"   >          <a href="#2-Topicï¼ˆä¸»é¢˜ï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Topicï¼ˆä¸»é¢˜ï¼‰" class="headerlink" title="2. Topicï¼ˆä¸»é¢˜ï¼‰"></a>2. <strong>Topicï¼ˆä¸»é¢˜ï¼‰</strong></h4>      <p>â€¢ <strong>é€»è¾‘åˆ†ç±»</strong>ï¼šæ¶ˆæ¯çš„ç±»åˆ«æ ‡è¯†ï¼ˆå¦‚ <code>user_click</code>ã€<code>payment_log</code>ï¼‰ã€‚<br>â€¢ <strong>ç‰©ç†åˆ†ç‰‡</strong>ï¼šæ¯ä¸ª Topic åˆ’åˆ†ä¸ºå¤šä¸ª <strong>Partitionï¼ˆåˆ†åŒºï¼‰</strong>ï¼Œæ•°æ®æŒ‰åˆ†åŒºå­˜å‚¨ï¼Œå®ç°å¹¶è¡Œå¤„ç†ã€‚<br>â—¦ <strong>åˆ†åŒºç‰¹æ€§</strong>ï¼š<br>â—¦ æ¯ä¸ªåˆ†åŒºæ˜¯ä¸€ä¸ª <strong>æœ‰åºã€ä¸å¯å˜</strong> çš„æ¶ˆæ¯åºåˆ—ã€‚<br>â—¦ æ¶ˆæ¯é€šè¿‡ <strong>Offsetï¼ˆåç§»é‡ï¼‰</strong> å”¯ä¸€æ ‡è¯†ï¼Œç±»ä¼¼æ•°ç»„ä¸‹æ ‡ã€‚</p>        <h4 id="3-Producerï¼ˆç”Ÿäº§è€…ï¼‰"   >          <a href="#3-Producerï¼ˆç”Ÿäº§è€…ï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-Producerï¼ˆç”Ÿäº§è€…ï¼‰" class="headerlink" title="3. Producerï¼ˆç”Ÿäº§è€…ï¼‰"></a>3. <strong>Producerï¼ˆç”Ÿäº§è€…ï¼‰</strong></h4>      <p>â€¢ <strong>åŠŸèƒ½</strong>ï¼šå‘ Topic å‘é€æ¶ˆæ¯ã€‚<br>â€¢ <strong>è·¯ç”±ç­–ç•¥</strong>ï¼š<br>â—¦ <strong>Key å“ˆå¸Œ</strong>ï¼šè‹¥æ¶ˆæ¯æŒ‡å®š Keyï¼ŒæŒ‰ Key å“ˆå¸Œå€¼åˆ†é…åˆ°ç‰¹å®šåˆ†åŒºï¼Œä¿è¯ç›¸åŒ Key çš„æ¶ˆæ¯è¿›å…¥åŒä¸€åˆ†åŒºã€‚<br>â—¦ <strong>è½®è¯¢åˆ†é…</strong>ï¼šæ—  Key æ—¶è½®è¯¢é€‰æ‹©åˆ†åŒºï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p>        <h4 id="4-Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰"   >          <a href="#4-Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰" class="headerlink" title="4. Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰"></a>4. <strong>Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰</strong></h4>      <p>â€¢ <strong>åŠŸèƒ½</strong>ï¼šä» Topic æ‹‰å–æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚<br>â€¢ <strong>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰</strong>ï¼š<br>â—¦ ç»„å†…æ¶ˆè´¹è€…å…±äº«æ¶ˆè´¹ä»»åŠ¡ï¼Œæ¯ä¸ªåˆ†åŒºåªèƒ½ç”±ç»„å†…ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚<br>â—¦ æ¨ªå‘æ‰©å±•ï¼šå¢åŠ æ¶ˆè´¹è€…æ•°é‡å¯æå‡æ¶ˆè´¹å¹¶è¡Œåº¦ã€‚</p>        <h4 id="5-Zookeeper-KRaftï¼ˆé›†ç¾¤ç®¡ç†ï¼‰"   >          <a href="#5-Zookeeper-KRaftï¼ˆé›†ç¾¤ç®¡ç†ï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-Zookeeper-KRaftï¼ˆé›†ç¾¤ç®¡ç†ï¼‰" class="headerlink" title="5. Zookeeper&#x2F;KRaftï¼ˆé›†ç¾¤ç®¡ç†ï¼‰"></a>5. <strong>Zookeeper&#x2F;KRaftï¼ˆé›†ç¾¤ç®¡ç†ï¼‰</strong></h4>      <p>â€¢ <strong>ä¼ ç»Ÿæ¨¡å¼</strong>ï¼šä¾èµ– Zookeeper ç®¡ç† Broker å…ƒæ•°æ®ã€Leader é€‰ä¸¾ã€æ¶ˆè´¹è€… Offsetã€‚<br>â€¢ <strong>KRaft æ¨¡å¼</strong>ï¼ˆKafka 2.8+ï¼‰ï¼šå» Zookeeper ä¾èµ–ï¼Œé€šè¿‡ Raft åè®®å®ç°é›†ç¾¤å…ƒæ•°æ®è‡ªç®¡ç†ã€‚</p><hr>        <h3 id="äºŒã€æ•°æ®å†™å…¥æµç¨‹ï¼ˆç”Ÿäº§è€…è§†è§’ï¼‰"   >          <a href="#äºŒã€æ•°æ®å†™å…¥æµç¨‹ï¼ˆç”Ÿäº§è€…è§†è§’ï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#äºŒã€æ•°æ®å†™å…¥æµç¨‹ï¼ˆç”Ÿäº§è€…è§†è§’ï¼‰" class="headerlink" title="äºŒã€æ•°æ®å†™å…¥æµç¨‹ï¼ˆç”Ÿäº§è€…è§†è§’ï¼‰"></a>äºŒã€æ•°æ®å†™å…¥æµç¨‹ï¼ˆç”Ÿäº§è€…è§†è§’ï¼‰</h3>              <h4 id="1-æ¶ˆæ¯å‘é€"   >          <a href="#1-æ¶ˆæ¯å‘é€" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ¶ˆæ¯å‘é€" class="headerlink" title="1. æ¶ˆæ¯å‘é€"></a>1. <strong>æ¶ˆæ¯å‘é€</strong></h4>      <p>â€¢ <strong>åºåˆ—åŒ–</strong>ï¼šç”Ÿäº§è€…å°†æ¶ˆæ¯åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼ˆæ”¯æŒ Avroã€JSON ç­‰æ ¼å¼ï¼‰ã€‚<br>â€¢ <strong>åˆ†åŒºé€‰æ‹©</strong>ï¼šæ ¹æ® Key æˆ–è½®è¯¢ç­–ç•¥é€‰æ‹©ç›®æ ‡åˆ†åŒºã€‚<br>â€¢ <strong>æ‰¹æ¬¡å‹ç¼©</strong>ï¼šæ¶ˆæ¯æŒ‰æ‰¹æ¬¡ï¼ˆBatchï¼‰å‹ç¼©åå‘é€ï¼ˆæ”¯æŒ LZ4ã€Snappyã€GZIPï¼‰ã€‚</p>        <h4 id="2-Broker-å¤„ç†"   >          <a href="#2-Broker-å¤„ç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Broker-å¤„ç†" class="headerlink" title="2. Broker å¤„ç†"></a>2. <strong>Broker å¤„ç†</strong></h4>      <p>â€¢ <strong>å†™å…¥ Leader åˆ†åŒº</strong>ï¼šæ¶ˆæ¯é¦–å…ˆå†™å…¥åˆ†åŒºçš„ Leader Brokerã€‚<br>â€¢ <strong>å‰¯æœ¬åŒæ­¥</strong>ï¼šFollower å‰¯æœ¬å¼‚æ­¥&#x2F;åŒæ­¥ï¼ˆ<code>acks=all</code>ï¼‰ä» Leader æ‹‰å–æ•°æ®ã€‚<br>â€¢ <strong>æŒä¹…åŒ–å­˜å‚¨</strong>ï¼š<br>â—¦ <strong>é¡ºåºå†™å…¥ç£ç›˜</strong>ï¼šåˆ©ç”¨ç£ç›˜é¡ºåº I&#x2F;O çš„é«˜æ€§èƒ½ç‰¹æ€§ã€‚<br>â—¦ <strong>é¡µç¼“å­˜ä¼˜åŒ–</strong>ï¼šé€šè¿‡ OS é¡µç¼“å­˜åŠ é€Ÿè¯»å†™ï¼Œè€Œéç›´æ¥å†™ç£ç›˜ã€‚</p>        <h4 id="3-ACK-ç¡®è®¤æœºåˆ¶"   >          <a href="#3-ACK-ç¡®è®¤æœºåˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ACK-ç¡®è®¤æœºåˆ¶" class="headerlink" title="3. ACK ç¡®è®¤æœºåˆ¶"></a>3. <strong>ACK ç¡®è®¤æœºåˆ¶</strong></h4>      <p>â€¢ <strong>å¯é æ€§çº§åˆ«</strong>ï¼š<br>â—¦ <code>acks=0</code>ï¼šä¸ç­‰å¾…ç¡®è®¤ï¼Œå¯èƒ½ä¸¢å¤±æ•°æ®ã€‚<br>â—¦ <code>acks=1</code>ï¼šLeader å†™å…¥æˆåŠŸå³ç¡®è®¤ã€‚<br>â—¦ <code>acks=all</code>ï¼šæ‰€æœ‰ ISRï¼ˆIn-Sync Replicasï¼‰å‰¯æœ¬å†™å…¥æˆåŠŸæ‰ç¡®è®¤ã€‚</p><hr>        <h3 id="ä¸‰ã€æ•°æ®å­˜å‚¨æœºåˆ¶"   >          <a href="#ä¸‰ã€æ•°æ®å­˜å‚¨æœºåˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸‰ã€æ•°æ®å­˜å‚¨æœºåˆ¶" class="headerlink" title="ä¸‰ã€æ•°æ®å­˜å‚¨æœºåˆ¶"></a>ä¸‰ã€æ•°æ®å­˜å‚¨æœºåˆ¶</h3>              <h4 id="1-åˆ†åŒºç»“æ„"   >          <a href="#1-åˆ†åŒºç»“æ„" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-åˆ†åŒºç»“æ„" class="headerlink" title="1. åˆ†åŒºç»“æ„"></a>1. <strong>åˆ†åŒºç»“æ„</strong></h4>      <p>â€¢ <strong>Segment åˆ†æ®µå­˜å‚¨</strong>ï¼š<br>â—¦ æ¯ä¸ªåˆ†åŒºç”±å¤šä¸ª <strong>Segment æ–‡ä»¶</strong> ç»„æˆï¼ˆé»˜è®¤ 1GB&#x2F;ä¸ªï¼‰ã€‚<br>â—¦ æ–‡ä»¶åä»¥èµ·å§‹ Offset å‘½åï¼ˆå¦‚ <code>00000000000000000000.log</code>ï¼‰ã€‚<br>â€¢ <strong>ç´¢å¼•æ–‡ä»¶</strong>ï¼š<code>.index</code> å’Œ <code>.timeindex</code> æ–‡ä»¶åŠ é€Ÿ Offset å’Œæ—¶é—´èŒƒå›´æŸ¥è¯¢ã€‚</p>        <h4 id="2-æ—¥å¿—æ¸…ç†ç­–ç•¥"   >          <a href="#2-æ—¥å¿—æ¸…ç†ç­–ç•¥" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ—¥å¿—æ¸…ç†ç­–ç•¥" class="headerlink" title="2. æ—¥å¿—æ¸…ç†ç­–ç•¥"></a>2. <strong>æ—¥å¿—æ¸…ç†ç­–ç•¥</strong></h4>      <p>â€¢ <strong>åˆ é™¤ç­–ç•¥</strong>ï¼šæŒ‰æ—¶é—´ï¼ˆ<code>retention.ms</code>ï¼‰æˆ–å¤§å°ï¼ˆ<code>retention.bytes</code>ï¼‰åˆ é™¤æ—§æ•°æ®ã€‚<br>â€¢ <strong>å‹ç¼©ç­–ç•¥</strong>ï¼šæŒ‰ Key åˆå¹¶é‡å¤æ¶ˆæ¯ï¼Œä¿ç•™æœ€æ–°å€¼ï¼ˆé€‚ç”¨äºçŠ¶æ€æ›´æ–°åœºæ™¯ï¼‰ã€‚</p><hr>        <h3 id="å››ã€æ•°æ®æ¶ˆè´¹æµç¨‹ï¼ˆæ¶ˆè´¹è€…è§†è§’ï¼‰"   >          <a href="#å››ã€æ•°æ®æ¶ˆè´¹æµç¨‹ï¼ˆæ¶ˆè´¹è€…è§†è§’ï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#å››ã€æ•°æ®æ¶ˆè´¹æµç¨‹ï¼ˆæ¶ˆè´¹è€…è§†è§’ï¼‰" class="headerlink" title="å››ã€æ•°æ®æ¶ˆè´¹æµç¨‹ï¼ˆæ¶ˆè´¹è€…è§†è§’ï¼‰"></a>å››ã€æ•°æ®æ¶ˆè´¹æµç¨‹ï¼ˆæ¶ˆè´¹è€…è§†è§’ï¼‰</h3>              <h4 id="1-æ‹‰å–æ¨¡å¼ï¼ˆPullï¼‰"   >          <a href="#1-æ‹‰å–æ¨¡å¼ï¼ˆPullï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ‹‰å–æ¨¡å¼ï¼ˆPullï¼‰" class="headerlink" title="1. æ‹‰å–æ¨¡å¼ï¼ˆPullï¼‰"></a>1. <strong>æ‹‰å–æ¨¡å¼ï¼ˆPullï¼‰</strong></h4>      <p>â€¢ <strong>ä¸»åŠ¨æ‹‰å–</strong>ï¼šæ¶ˆè´¹è€…é€šè¿‡ <code>poll()</code> æ–¹æ³•ä» Broker æ‹‰å–æ¶ˆæ¯ï¼ŒæŒ‰éœ€æ§åˆ¶æ¶ˆè´¹é€Ÿç‡ã€‚<br>â€¢ <strong>æ‰¹é‡æ¶ˆè´¹</strong>ï¼šä¸€æ¬¡æ‹‰å–å¤šæ¡æ¶ˆæ¯ï¼Œå‡å°‘ç½‘ç»œå¼€é”€ã€‚</p>        <h4 id="2-Offset-ç®¡ç†"   >          <a href="#2-Offset-ç®¡ç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Offset-ç®¡ç†" class="headerlink" title="2. Offset ç®¡ç†"></a>2. <strong>Offset ç®¡ç†</strong></h4>      <p>â€¢ <strong>æäº¤æ–¹å¼</strong>ï¼š<br>â—¦ <strong>è‡ªåŠ¨æäº¤</strong>ï¼šå®šæœŸæäº¤ Offsetï¼Œå¯èƒ½é‡å¤æ¶ˆè´¹ã€‚<br>â—¦ <strong>æ‰‹åŠ¨æäº¤</strong>ï¼šå¤„ç†å®Œæ¶ˆæ¯åæ˜¾å¼æäº¤ï¼ˆ<code>commitSync()</code>&#x2F;<code>commitAsync()</code>ï¼‰ã€‚<br>â€¢ <strong>å­˜å‚¨ä½ç½®</strong>ï¼šOffset å­˜å‚¨åœ¨å†…éƒ¨ Topic <code>__consumer_offsets</code> ä¸­ã€‚</p>        <h4 id="3-æ¶ˆè´¹è€…ç»„-Rebalance"   >          <a href="#3-æ¶ˆè´¹è€…ç»„-Rebalance" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æ¶ˆè´¹è€…ç»„-Rebalance" class="headerlink" title="3. æ¶ˆè´¹è€…ç»„ Rebalance"></a>3. <strong>æ¶ˆè´¹è€…ç»„ Rebalance</strong></h4>      <p>â€¢ <strong>è§¦å‘æ¡ä»¶</strong>ï¼šæ¶ˆè´¹è€…åŠ å…¥&#x2F;é€€å‡ºã€Topic åˆ†åŒºæ•°å˜åŒ–ã€‚<br>â€¢ <strong>åè°ƒè€…ï¼ˆCoordinatorï¼‰</strong>ï¼šç”± Broker æ‹…ä»»ï¼Œè´Ÿè´£åˆ†é…åˆ†åŒºç»™æ¶ˆè´¹è€…ã€‚</p><hr>        <h3 id="äº”ã€é«˜å¯ç”¨æ€§ä¸å®¹é”™"   >          <a href="#äº”ã€é«˜å¯ç”¨æ€§ä¸å®¹é”™" class="heading-link"><i class="fas fa-link"></i></a><a href="#äº”ã€é«˜å¯ç”¨æ€§ä¸å®¹é”™" class="headerlink" title="äº”ã€é«˜å¯ç”¨æ€§ä¸å®¹é”™"></a>äº”ã€é«˜å¯ç”¨æ€§ä¸å®¹é”™</h3>              <h4 id="1-å‰¯æœ¬æœºåˆ¶ï¼ˆReplicationï¼‰"   >          <a href="#1-å‰¯æœ¬æœºåˆ¶ï¼ˆReplicationï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å‰¯æœ¬æœºåˆ¶ï¼ˆReplicationï¼‰" class="headerlink" title="1. å‰¯æœ¬æœºåˆ¶ï¼ˆReplicationï¼‰"></a>1. <strong>å‰¯æœ¬æœºåˆ¶ï¼ˆReplicationï¼‰</strong></h4>      <p>â€¢ <strong>Leader-Follower æ¨¡å‹</strong>ï¼š<br>â—¦ æ¯ä¸ªåˆ†åŒºæœ‰å¤šä¸ªå‰¯æœ¬ï¼ŒLeader å¤„ç†è¯»å†™è¯·æ±‚ï¼ŒFollower åŒæ­¥æ•°æ®ã€‚<br>â—¦ <strong>ISRï¼ˆIn-Sync Replicasï¼‰</strong>ï¼šä¸ Leader æ•°æ®åŒæ­¥çš„å‰¯æœ¬é›†åˆï¼Œç”¨äºæ•…éšœåˆ‡æ¢ã€‚<br>â€¢ <strong>é€‰ä¸¾ç­–ç•¥</strong>ï¼šLeader å®•æœºæ—¶ï¼Œä» ISR ä¸­é€‰ä¸¾æ–° Leaderã€‚</p>        <h4 id="2-æ•°æ®ä¸€è‡´æ€§"   >          <a href="#2-æ•°æ®ä¸€è‡´æ€§" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="2. æ•°æ®ä¸€è‡´æ€§"></a>2. <strong>æ•°æ®ä¸€è‡´æ€§</strong></h4>      <p>â€¢ <strong>HWï¼ˆHigh Watermarkï¼‰</strong>ï¼šå·²æˆåŠŸå¤åˆ¶åˆ°æ‰€æœ‰ ISR å‰¯æœ¬çš„æœ€é«˜ Offsetã€‚<br>â€¢ <strong>æ¶ˆè´¹è€…å¯è§æ€§</strong>ï¼šæ¶ˆè´¹è€…åªèƒ½è¯»å–åˆ° HW ä¹‹å‰çš„æ¶ˆæ¯ï¼Œé¿å…è„è¯»ã€‚</p><hr>        <h3 id="å…­ã€æ€§èƒ½ä¼˜åŒ–å…³é”®æŠ€æœ¯"   >          <a href="#å…­ã€æ€§èƒ½ä¼˜åŒ–å…³é”®æŠ€æœ¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#å…­ã€æ€§èƒ½ä¼˜åŒ–å…³é”®æŠ€æœ¯" class="headerlink" title="å…­ã€æ€§èƒ½ä¼˜åŒ–å…³é”®æŠ€æœ¯"></a>å…­ã€æ€§èƒ½ä¼˜åŒ–å…³é”®æŠ€æœ¯</h3>              <h4 id="1-é›¶æ‹·è´ï¼ˆZero-Copyï¼‰"   >          <a href="#1-é›¶æ‹·è´ï¼ˆZero-Copyï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-é›¶æ‹·è´ï¼ˆZero-Copyï¼‰" class="headerlink" title="1. é›¶æ‹·è´ï¼ˆZero-Copyï¼‰"></a>1. <strong>é›¶æ‹·è´ï¼ˆZero-Copyï¼‰</strong></h4>      <p>â€¢ <strong>åŸç†</strong>ï¼šé€šè¿‡ <code>sendfile()</code> ç³»ç»Ÿè°ƒç”¨ï¼Œæ•°æ®ç›´æ¥ä»ç£ç›˜æ–‡ä»¶å‘é€åˆ°ç½‘ç»œï¼Œç»•è¿‡ç”¨æˆ·æ€å†…å­˜å¤åˆ¶ã€‚<br>â€¢ <strong>æ•ˆæœ</strong>ï¼šé™ä½ CPU å’Œå†…å­˜å¼€é”€ï¼Œæå‡ååé‡ã€‚</p>        <h4 id="2-æ‰¹é‡å¤„ç†"   >          <a href="#2-æ‰¹é‡å¤„ç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ‰¹é‡å¤„ç†" class="headerlink" title="2. æ‰¹é‡å¤„ç†"></a>2. <strong>æ‰¹é‡å¤„ç†</strong></h4>      <p>â€¢ <strong>ç”Ÿäº§è€…æ‰¹é‡å‘é€</strong>ï¼šç´¯ç§¯æ¶ˆæ¯æˆæ‰¹æ¬¡åå‘é€ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ã€‚<br>â€¢ <strong>æ¶ˆè´¹è€…æ‰¹é‡æ‹‰å–</strong>ï¼šå•æ¬¡æ‹‰å–å¤šæ¡æ¶ˆæ¯ï¼Œæå‡æ¶ˆè´¹æ•ˆç‡ã€‚</p><hr>        <h3 id="ä¸ƒã€å…¸å‹åº”ç”¨åœºæ™¯"   >          <a href="#ä¸ƒã€å…¸å‹åº”ç”¨åœºæ™¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸ƒã€å…¸å‹åº”ç”¨åœºæ™¯" class="headerlink" title="ä¸ƒã€å…¸å‹åº”ç”¨åœºæ™¯"></a>ä¸ƒã€å…¸å‹åº”ç”¨åœºæ™¯</h3>              <h4 id="1-å®æ—¶æ—¥å¿—èšåˆ"   >          <a href="#1-å®æ—¶æ—¥å¿—èšåˆ" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å®æ—¶æ—¥å¿—èšåˆ" class="headerlink" title="1. å®æ—¶æ—¥å¿—èšåˆ"></a>1. <strong>å®æ—¶æ—¥å¿—èšåˆ</strong></h4>      <p>â€¢ <strong>åœºæ™¯</strong>ï¼šæ”¶é›†åˆ†å¸ƒå¼ç³»ç»Ÿæ—¥å¿—ï¼Œå†™å…¥ Kafka åä¾› Elasticsearch æˆ– Flink å¤„ç†ã€‚<br>â€¢ <strong>ä¼˜åŠ¿</strong>ï¼šé«˜ååé‡æ”¯æŒæµ·é‡æ—¥å¿—å†™å…¥ã€‚</p>        <h4 id="2-äº‹ä»¶é©±åŠ¨æ¶æ„"   >          <a href="#2-äº‹ä»¶é©±åŠ¨æ¶æ„" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-äº‹ä»¶é©±åŠ¨æ¶æ„" class="headerlink" title="2. äº‹ä»¶é©±åŠ¨æ¶æ„"></a>2. <strong>äº‹ä»¶é©±åŠ¨æ¶æ„</strong></h4>      <p>â€¢ <strong>åœºæ™¯</strong>ï¼šå¾®æœåŠ¡é—´é€šè¿‡ Topic ä¼ é€’äº‹ä»¶ï¼ˆå¦‚è®¢å•åˆ›å»ºè§¦å‘åº“å­˜æ‰£å‡ï¼‰ã€‚<br>â€¢ <strong>ä¼˜åŠ¿</strong>ï¼šè§£è€¦æœåŠ¡ï¼Œæå‡ç³»ç»Ÿæ‰©å±•æ€§ã€‚</p>        <h4 id="3-æµå¼æ•°æ®å¤„ç†"   >          <a href="#3-æµå¼æ•°æ®å¤„ç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æµå¼æ•°æ®å¤„ç†" class="headerlink" title="3. æµå¼æ•°æ®å¤„ç†"></a>3. <strong>æµå¼æ•°æ®å¤„ç†</strong></h4>      <p>â€¢ <strong>å·¥å…·é“¾</strong>ï¼šKafka Streams æˆ– Flink å®æ—¶å¤„ç†æ•°æ®æµï¼ˆå¦‚ç”¨æˆ·è¡Œä¸ºåˆ†æï¼‰ã€‚<br>â€¢ <strong>ä¼˜åŠ¿</strong>ï¼šä½å»¶è¿Ÿå¤„ç†å¤æ‚è®¡ç®—ï¼ˆçª—å£èšåˆã€Join æ“ä½œï¼‰ã€‚</p><hr>        <h3 id="å…«ã€æ ¸å¿ƒä¼˜åŠ¿ä¸å±€é™æ€§"   >          <a href="#å…«ã€æ ¸å¿ƒä¼˜åŠ¿ä¸å±€é™æ€§" class="heading-link"><i class="fas fa-link"></i></a><a href="#å…«ã€æ ¸å¿ƒä¼˜åŠ¿ä¸å±€é™æ€§" class="headerlink" title="å…«ã€æ ¸å¿ƒä¼˜åŠ¿ä¸å±€é™æ€§"></a>å…«ã€æ ¸å¿ƒä¼˜åŠ¿ä¸å±€é™æ€§</h3>      <div class="table-container"><table><thead><tr><th><strong>ä¼˜åŠ¿</strong></th><th><strong>å±€é™æ€§</strong></th></tr></thead><tbody><tr><td>é«˜ååé‡ï¼ˆç™¾ä¸‡çº§ QPSï¼‰</td><td>è¿ç»´å¤æ‚åº¦é«˜ï¼ˆé›†ç¾¤ç®¡ç†ã€è°ƒä¼˜ï¼‰</td></tr><tr><td>ä½å»¶è¿Ÿï¼ˆæ¯«ç§’çº§å“åº”ï¼‰</td><td>å°æ•°æ®åœºæ™¯èµ„æºæµªè´¹</td></tr><tr><td>æŒä¹…åŒ–ä¸é«˜å¯é æ€§</td><td>å…¨å±€æ¶ˆæ¯é¡ºåºæ— æ³•ä¿è¯</td></tr><tr><td>å¼¹æ€§æ‰©å±•ï¼ˆæ°´å¹³æ‰©å®¹ï¼‰</td><td>ä¾èµ–å¤–éƒ¨ç»„ä»¶ï¼ˆæ—©æœŸç‰ˆæœ¬éœ€ Zookeeperï¼‰</td></tr></tbody></table></div><hr>        <h3 id="ä¹ã€æ€»ç»“"   >          <a href="#ä¹ã€æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¹ã€æ€»ç»“" class="headerlink" title="ä¹ã€æ€»ç»“"></a>ä¹ã€æ€»ç»“</h3>      <p>Kafka é€šè¿‡ <strong>åˆ†å¸ƒå¼åˆ†åŒºå­˜å‚¨</strong>ã€<strong>é¡ºåºç£ç›˜ I&#x2F;O</strong> å’Œ <strong>å‰¯æœ¬å®¹é”™æœºåˆ¶</strong>ï¼Œå®ç°äº†é«˜ååã€é«˜å¯é çš„å®æ—¶æ•°æ®æµå¤„ç†ã€‚å…¶æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯ <strong>å°†æ•°æ®è§†ä¸ºä¸å¯å˜äº‹ä»¶æµ</strong>ï¼Œé€‚ç”¨äºæ—¥å¿—å¤„ç†ã€äº‹ä»¶é©±åŠ¨æ¶æ„å’Œå¤§è§„æ¨¡æµå¼è®¡ç®—åœºæ™¯ã€‚ä½†éœ€æ³¨æ„å…¶è¿ç»´æˆæœ¬å’Œèµ„æºæ¶ˆè€—ï¼Œåˆç†æƒè¡¡ä¸šåŠ¡éœ€æ±‚ä¸æŠ€æœ¯é€‰å‹ã€‚</p>]]></content>
    
    
    <summary type="html">Kafkaå·¥ä½œåŸç†è¯¦è§£</summary>
    
    
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://ljd0620.github.io/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    
    <category term="Kafka" scheme="https://ljd0620.github.io/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§</title>
    <link href="https://ljd0620.github.io/2024/05/28/%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7/"/>
    <id>https://ljd0620.github.io/2024/05/28/%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7/</id>
    <published>2024-05-28T04:34:17.000Z</published>
    <updated>2025-03-19T02:00:43.603Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒåŒæ—¶ä¿è¯ MySQLã€Redis å’Œ Elasticsearch çš„æ•°æ®ä¸€è‡´æ€§æ˜¯ä¸€ä¸ªå¤æ‚çš„æŒ‘æˆ˜ï¼Œå› ä¸ºæ¯ä¸ªç»„ä»¶æœ‰ä¸åŒçš„ç‰¹æ€§å’Œæ•°æ®æ›´æ–°æœºåˆ¶ã€‚ä»¥ä¸‹æ˜¯å®ç°æ•°æ®ä¸€è‡´æ€§çš„å¸¸è§ç­–ç•¥å’Œæœ€ä½³å®è·µï¼š</p><hr>        <h3 id="1-æ•°æ®ä¸€è‡´æ€§é—®é¢˜åˆ†æ"   >          <a href="#1-æ•°æ®ä¸€è‡´æ€§é—®é¢˜åˆ†æ" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ•°æ®ä¸€è‡´æ€§é—®é¢˜åˆ†æ" class="headerlink" title="1. æ•°æ®ä¸€è‡´æ€§é—®é¢˜åˆ†æ"></a><strong>1. æ•°æ®ä¸€è‡´æ€§é—®é¢˜åˆ†æ</strong></h3>      <p>åœ¨ MySQLã€Redis å’Œ Elasticsearch ä¹‹é—´ï¼Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜é€šå¸¸æºäºä»¥ä¸‹åŸå› ï¼š</p><ol><li><strong>æ•°æ®æ›´æ–°é¡ºåº</strong>ï¼š<ul><li>æ•°æ®æ›´æ–°å¯èƒ½åœ¨ä¸åŒç»„ä»¶ä¹‹é—´å‡ºç°å»¶è¿Ÿæˆ–é¡ºåºä¸ä¸€è‡´ã€‚</li></ul></li><li><strong>æ•°æ®æ›´æ–°å¤±è´¥</strong>ï¼š<ul><li>åœ¨æ›´æ–°å¤šä¸ªç»„ä»¶æ—¶ï¼Œéƒ¨åˆ†ç»„ä»¶å¯èƒ½æ›´æ–°å¤±è´¥ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li></ul></li><li><strong>ç¼“å­˜å¤±æ•ˆ</strong>ï¼š<ul><li>Redis ç¼“å­˜å¯èƒ½æœªåŠæ—¶æ›´æ–°æˆ–å¤±æ•ˆï¼Œå¯¼è‡´è¯»å–åˆ°æ—§æ•°æ®ã€‚</li></ul></li><li><strong>ç´¢å¼•å»¶è¿Ÿ</strong>ï¼š<ul><li>Elasticsearch çš„ç´¢å¼•å¯èƒ½å­˜åœ¨å»¶è¿Ÿï¼Œå¯¼è‡´æŸ¥è¯¢ç»“æœä¸ä¸€è‡´ã€‚</li></ul></li></ol><hr>        <h3 id="2-æ•°æ®ä¸€è‡´æ€§ç­–ç•¥"   >          <a href="#2-æ•°æ®ä¸€è‡´æ€§ç­–ç•¥" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ•°æ®ä¸€è‡´æ€§ç­–ç•¥" class="headerlink" title="2. æ•°æ®ä¸€è‡´æ€§ç­–ç•¥"></a><strong>2. æ•°æ®ä¸€è‡´æ€§ç­–ç•¥</strong></h3>      <p>ä»¥ä¸‹æ˜¯ä¿è¯ MySQLã€Redis å’Œ Elasticsearch æ•°æ®ä¸€è‡´æ€§çš„å¸¸è§ç­–ç•¥ï¼š</p>        <h4 id="1-å†™æ—¶åŒæ­¥æ›´æ–°"   >          <a href="#1-å†™æ—¶åŒæ­¥æ›´æ–°" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å†™æ—¶åŒæ­¥æ›´æ–°" class="headerlink" title="(1) å†™æ—¶åŒæ­¥æ›´æ–°"></a><strong>(1) å†™æ—¶åŒæ­¥æ›´æ–°</strong></h4>      <p>åœ¨æ•°æ®å†™å…¥æ—¶ï¼ŒåŒæ­¥æ›´æ–° MySQLã€Redis å’Œ Elasticsearchã€‚</p><ul><li><strong>æµç¨‹</strong>ï¼š<ol><li>å†™å…¥ MySQLã€‚</li><li>æ›´æ–° Redis ç¼“å­˜ã€‚</li><li>æ›´æ–° Elasticsearch ç´¢å¼•ã€‚</li></ol></li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>æ•°æ®å®æ—¶ä¸€è‡´ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>å†™å…¥æ€§èƒ½è¾ƒä½ï¼Œå› ä¸ºéœ€è¦åŒæ­¥æ›´æ–°å¤šä¸ªç»„ä»¶ã€‚</li><li>å¦‚æœæŸä¸ªç»„ä»¶æ›´æ–°å¤±è´¥ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li></ul></li></ul>        <h4 id="2-å†™æ—¶å¼‚æ­¥æ›´æ–°"   >          <a href="#2-å†™æ—¶å¼‚æ­¥æ›´æ–°" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-å†™æ—¶å¼‚æ­¥æ›´æ–°" class="headerlink" title="(2) å†™æ—¶å¼‚æ­¥æ›´æ–°"></a><strong>(2) å†™æ—¶å¼‚æ­¥æ›´æ–°</strong></h4>      <p>åœ¨æ•°æ®å†™å…¥æ—¶ï¼Œå¼‚æ­¥æ›´æ–° Redis å’Œ Elasticsearchã€‚</p><ul><li><strong>æµç¨‹</strong>ï¼š<ol><li>å†™å…¥ MySQLã€‚</li><li>å¼‚æ­¥æ›´æ–° Redis ç¼“å­˜ï¼ˆå¦‚é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€‚</li><li>å¼‚æ­¥æ›´æ–° Elasticsearch ç´¢å¼•ï¼ˆå¦‚é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€‚</li></ol></li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>å†™å…¥æ€§èƒ½è¾ƒé«˜ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>æ•°æ®å¯èƒ½å­˜åœ¨çŸ­æš‚çš„ä¸ä¸€è‡´ã€‚</li></ul></li></ul>        <h4 id="3-åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§"   >          <a href="#3-åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="(3) åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§"></a><strong>(3) åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§</strong></h4>      <p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ Kafkaã€RabbitMQï¼‰å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><ul><li><strong>æµç¨‹</strong>ï¼š<ol><li>å†™å…¥ MySQLã€‚</li><li>å‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€šçŸ¥ Redis å’Œ Elasticsearch æ›´æ–°ã€‚</li><li>æ¶ˆè´¹è€…ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–æ¶ˆæ¯ï¼Œæ›´æ–° Redis å’Œ Elasticsearchã€‚</li></ol></li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>è§£è€¦æ•°æ®æ›´æ–°é€»è¾‘ï¼Œæé«˜ç³»ç»Ÿå¯æ‰©å±•æ€§ã€‚</li><li>ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>æ•°æ®å¯èƒ½å­˜åœ¨çŸ­æš‚çš„ä¸ä¸€è‡´ã€‚</li><li>éœ€è¦å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚æ€§ã€‚</li></ul></li></ul>        <h4 id="4-åŒå†™-è¡¥å¿æœºåˆ¶"   >          <a href="#4-åŒå†™-è¡¥å¿æœºåˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-åŒå†™-è¡¥å¿æœºåˆ¶" class="headerlink" title="(4) åŒå†™ + è¡¥å¿æœºåˆ¶"></a><strong>(4) åŒå†™ + è¡¥å¿æœºåˆ¶</strong></h4>      <p>åœ¨æ•°æ®å†™å…¥æ—¶ï¼ŒåŒæ—¶å†™å…¥ MySQLã€Redis å’Œ Elasticsearchï¼Œå¹¶é€šè¿‡è¡¥å¿æœºåˆ¶å¤„ç†å¤±è´¥æƒ…å†µã€‚</p><ul><li><strong>æµç¨‹</strong>ï¼š<ol><li>å†™å…¥ MySQLã€‚</li><li>å†™å…¥ Redisã€‚</li><li>å†™å…¥ Elasticsearchã€‚</li><li>å¦‚æœæŸä¸ªç»„ä»¶å†™å…¥å¤±è´¥ï¼Œè®°å½•æ—¥å¿—å¹¶è§¦å‘è¡¥å¿æœºåˆ¶ï¼ˆå¦‚é‡è¯•æˆ–å›æ»šï¼‰ã€‚</li></ol></li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>æ•°æ®å®æ—¶ä¸€è‡´ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>å®ç°å¤æ‚ï¼Œéœ€è¦å¤„ç†å„ç§å¤±è´¥åœºæ™¯ã€‚</li></ul></li></ul>        <h4 id="5-åŸºäº-CDCï¼ˆChange-Data-Captureï¼‰çš„åŒæ­¥"   >          <a href="#5-åŸºäº-CDCï¼ˆChange-Data-Captureï¼‰çš„åŒæ­¥" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-åŸºäº-CDCï¼ˆChange-Data-Captureï¼‰çš„åŒæ­¥" class="headerlink" title="(5) åŸºäº CDCï¼ˆChange Data Captureï¼‰çš„åŒæ­¥"></a><strong>(5) åŸºäº CDCï¼ˆChange Data Captureï¼‰çš„åŒæ­¥</strong></h4>      <p>ä½¿ç”¨ CDC å·¥å…·ï¼ˆå¦‚ Debeziumã€Canalï¼‰æ•è· MySQL çš„å˜æ›´ï¼Œå¹¶åŒæ­¥åˆ° Redis å’Œ Elasticsearchã€‚</p><ul><li><strong>æµç¨‹</strong>ï¼š<ol><li>MySQL æ•°æ®å˜æ›´æ—¶ï¼ŒCDC å·¥å…·æ•è·å˜æ›´äº‹ä»¶ã€‚</li><li>CDC å·¥å…·å°†å˜æ›´äº‹ä»¶å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€‚</li><li>æ¶ˆè´¹è€…ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–å˜æ›´äº‹ä»¶ï¼Œæ›´æ–° Redis å’Œ Elasticsearchã€‚</li></ol></li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>è§£è€¦æ•°æ®æ›´æ–°é€»è¾‘ï¼Œæé«˜ç³»ç»Ÿå¯æ‰©å±•æ€§ã€‚</li><li>ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>æ•°æ®å¯èƒ½å­˜åœ¨çŸ­æš‚çš„ä¸ä¸€è‡´ã€‚</li><li>éœ€è¦å¼•å…¥ CDC å·¥å…·å’Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚æ€§ã€‚</li></ul></li></ul><hr>        <h3 id="3-å…·ä½“å®ç°æ–¹æ¡ˆ"   >          <a href="#3-å…·ä½“å®ç°æ–¹æ¡ˆ" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-å…·ä½“å®ç°æ–¹æ¡ˆ" class="headerlink" title="3. å…·ä½“å®ç°æ–¹æ¡ˆ"></a><strong>3. å…·ä½“å®ç°æ–¹æ¡ˆ</strong></h3>      <p>ä»¥ä¸‹æ˜¯ç»“åˆä¸Šè¿°ç­–ç•¥çš„å…·ä½“å®ç°æ–¹æ¡ˆï¼š</p>        <h4 id="1-å†™æ—¶åŒæ­¥æ›´æ–°-è¡¥å¿æœºåˆ¶"   >          <a href="#1-å†™æ—¶åŒæ­¥æ›´æ–°-è¡¥å¿æœºåˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å†™æ—¶åŒæ­¥æ›´æ–°-è¡¥å¿æœºåˆ¶" class="headerlink" title="(1) å†™æ—¶åŒæ­¥æ›´æ–° + è¡¥å¿æœºåˆ¶"></a><strong>(1) å†™æ—¶åŒæ­¥æ›´æ–° + è¡¥å¿æœºåˆ¶</strong></h4>      <ul><li><strong>å†™å…¥æµç¨‹</strong>ï¼š<ol><li>å¼€å¯äº‹åŠ¡ï¼Œå†™å…¥ MySQLã€‚</li><li>æ›´æ–° Redis ç¼“å­˜ã€‚</li><li>æ›´æ–° Elasticsearch ç´¢å¼•ã€‚</li><li>æäº¤äº‹åŠ¡ã€‚</li></ol></li><li><strong>è¡¥å¿æœºåˆ¶</strong>ï¼š<ul><li>å¦‚æœæŸä¸ªç»„ä»¶æ›´æ–°å¤±è´¥ï¼Œè®°å½•æ—¥å¿—å¹¶è§¦å‘è¡¥å¿æœºåˆ¶ï¼ˆå¦‚é‡è¯•æˆ–å›æ»šï¼‰ã€‚</li></ul></li></ul>        <h4 id="2-åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§"   >          <a href="#2-åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="(2) åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§"></a><strong>(2) åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§</strong></h4>      <ul><li><strong>å†™å…¥æµç¨‹</strong>ï¼š<ol><li>å†™å…¥ MySQLã€‚</li><li>å‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€šçŸ¥ Redis å’Œ Elasticsearch æ›´æ–°ã€‚</li></ol></li><li><strong>æ¶ˆè´¹è€…æµç¨‹</strong>ï¼š<ol><li>ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–æ¶ˆæ¯ã€‚</li><li>æ›´æ–° Redis ç¼“å­˜ã€‚</li><li>æ›´æ–° Elasticsearch ç´¢å¼•ã€‚</li></ol></li></ul>        <h4 id="3-åŸºäº-CDC-çš„åŒæ­¥"   >          <a href="#3-åŸºäº-CDC-çš„åŒæ­¥" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-åŸºäº-CDC-çš„åŒæ­¥" class="headerlink" title="(3) åŸºäº CDC çš„åŒæ­¥"></a><strong>(3) åŸºäº CDC çš„åŒæ­¥</strong></h4>      <ul><li><strong>CDC å·¥å…·é…ç½®</strong>ï¼š<ol><li>é…ç½® Debezium æˆ– Canalï¼Œæ•è· MySQL çš„å˜æ›´äº‹ä»¶ã€‚</li><li>å°†å˜æ›´äº‹ä»¶å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ Kafkaï¼‰ã€‚</li></ol></li><li><strong>æ¶ˆè´¹è€…æµç¨‹</strong>ï¼š<ol><li>ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–å˜æ›´äº‹ä»¶ã€‚</li><li>æ›´æ–° Redis ç¼“å­˜ã€‚</li><li>æ›´æ–° Elasticsearch ç´¢å¼•ã€‚</li></ol></li></ul><hr>        <h3 id="4-æœ€ä½³å®è·µ"   >          <a href="#4-æœ€ä½³å®è·µ" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-æœ€ä½³å®è·µ" class="headerlink" title="4. æœ€ä½³å®è·µ"></a><strong>4. æœ€ä½³å®è·µ</strong></h3>      <ul><li><strong>åˆç†é€‰æ‹©ä¸€è‡´æ€§ç­–ç•¥</strong>ï¼š<ul><li>æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©å¼ºä¸€è‡´æ€§æˆ–æœ€ç»ˆä¸€è‡´æ€§ã€‚</li></ul></li><li><strong>å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼š<ul><li>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦æ•°æ®æ›´æ–°é€»è¾‘ï¼Œæé«˜ç³»ç»Ÿå¯æ‰©å±•æ€§ã€‚</li></ul></li><li><strong>ç›‘æ§ä¸å‘Šè­¦</strong>ï¼š<ul><li>ç›‘æ§ MySQLã€Redis å’Œ Elasticsearch çš„æ•°æ®ä¸€è‡´æ€§ï¼ŒåŠæ—¶å‘ç°å’Œå¤„ç†é—®é¢˜ã€‚</li></ul></li><li><strong>è¡¥å¿æœºåˆ¶</strong>ï¼š<ul><li>è®¾è®¡å®Œå–„çš„è¡¥å¿æœºåˆ¶ï¼Œå¤„ç†æ•°æ®æ›´æ–°å¤±è´¥çš„æƒ…å†µã€‚</li></ul></li><li><strong>æµ‹è¯•ä¸éªŒè¯</strong>ï¼š<ul><li>åœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­éªŒè¯æ•°æ®ä¸€è‡´æ€§ç­–ç•¥ï¼Œç¡®ä¿å…¶æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚</li></ul></li></ul><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <p>ä¿è¯ MySQLã€Redis å’Œ Elasticsearch æ•°æ®ä¸€è‡´æ€§çš„å¸¸è§ç­–ç•¥åŒ…æ‹¬ï¼š</p><ol><li><strong>å†™æ—¶åŒæ­¥æ›´æ–°</strong>ï¼šé€‚åˆå¼ºä¸€è‡´æ€§åœºæ™¯ï¼Œä½†æ€§èƒ½è¾ƒä½ã€‚</li><li><strong>å†™æ—¶å¼‚æ­¥æ›´æ–°</strong>ï¼šé€‚åˆæœ€ç»ˆä¸€è‡´æ€§åœºæ™¯ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚</li><li><strong>åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šè§£è€¦æ•°æ®æ›´æ–°é€»è¾‘ï¼Œé€‚åˆé«˜æ‰©å±•æ€§åœºæ™¯ã€‚</li><li><strong>åŒå†™ + è¡¥å¿æœºåˆ¶</strong>ï¼šé€‚åˆå¼ºä¸€è‡´æ€§åœºæ™¯ï¼Œä½†å®ç°å¤æ‚ã€‚</li><li><strong>åŸºäº CDC çš„åŒæ­¥</strong>ï¼šé€‚åˆæœ€ç»ˆä¸€è‡´æ€§åœºæ™¯ï¼Œè§£è€¦æ•°æ®æ›´æ–°é€»è¾‘ã€‚</li></ol><p>æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯å’Œæ€§èƒ½éœ€æ±‚ï¼Œé€‰æ‹©åˆé€‚çš„ç­–ç•¥ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ä¿è¯ MySQLã€Redis å’Œ Elasticsearch çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p>]]></content>
    
    
    <summary type="html">å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§</summary>
    
    
    
    <category term="Java" scheme="https://ljd0620.github.io/categories/Java/"/>
    
    
    <category term="Elasticsearch" scheme="https://ljd0620.github.io/tags/Elasticsearch/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://ljd0620.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="MySQL" scheme="https://ljd0620.github.io/tags/MySQL/"/>
    
    <category term="Redis" scheme="https://ljd0620.github.io/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„</title>
    <link href="https://ljd0620.github.io/2024/05/18/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/"/>
    <id>https://ljd0620.github.io/2024/05/18/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/</id>
    <published>2024-05-18T04:36:46.000Z</published>
    <updated>2025-03-19T02:01:23.679Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§å°†åº”ç”¨ç¨‹åºæ‹†åˆ†ä¸ºå¤šä¸ªå°å‹ã€ç‹¬ç«‹æœåŠ¡çš„å¼€å‘æ¨¡å¼ï¼Œæ¯ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²å’Œæ‰©å±•ã€‚è™½ç„¶å¾®æœåŠ¡æ¶æ„æä¾›äº†çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†è®¸å¤šæŒ‘æˆ˜ã€‚ä»¥ä¸‹æ˜¯åˆ†å¸ƒå¼å¾®æœåŠ¡å¼€å‘ä¸­éœ€è¦æ³¨æ„çš„å…³é”®ç‚¹ï¼š</p><hr>        <h3 id="1-æœåŠ¡æ‹†åˆ†ä¸è®¾è®¡"   >          <a href="#1-æœåŠ¡æ‹†åˆ†ä¸è®¾è®¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æœåŠ¡æ‹†åˆ†ä¸è®¾è®¡" class="headerlink" title="1. æœåŠ¡æ‹†åˆ†ä¸è®¾è®¡"></a><strong>1. æœåŠ¡æ‹†åˆ†ä¸è®¾è®¡</strong></h3>              <h4 id="1-æœåŠ¡è¾¹ç•Œ"   >          <a href="#1-æœåŠ¡è¾¹ç•Œ" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æœåŠ¡è¾¹ç•Œ" class="headerlink" title="(1) æœåŠ¡è¾¹ç•Œ"></a><strong>(1) æœåŠ¡è¾¹ç•Œ</strong></h4>      <ul><li><strong>å•ä¸€èŒè´£åŸåˆ™</strong>ï¼š<ul><li>æ¯ä¸ªæœåŠ¡åº”è¯¥åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„ä¸šåŠ¡åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æœåŠ¡åªå¤„ç†ç”¨æˆ·ç›¸å…³çš„é€»è¾‘ï¼Œè®¢å•æœåŠ¡åªå¤„ç†è®¢å•ç›¸å…³çš„é€»è¾‘ã€‚</li><li>é¿å…å°†å¤šä¸ªä¸ç›¸å…³çš„åŠŸèƒ½è€¦åˆåœ¨ä¸€ä¸ªæœåŠ¡ä¸­ï¼Œå¦åˆ™ä¼šå¯¼è‡´æœåŠ¡è‡ƒè‚¿ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚</li></ul></li><li><strong>é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰</strong>ï¼š<ul><li>ä½¿ç”¨ DDD çš„é™ç•Œä¸Šä¸‹æ–‡ï¼ˆBounded Contextï¼‰æ¥åˆ’åˆ†æœåŠ¡è¾¹ç•Œã€‚ä¾‹å¦‚ï¼Œç”µå•†ç³»ç»Ÿä¸­å¯ä»¥å°†â€œè®¢å•â€ã€â€œåº“å­˜â€ã€â€œæ”¯ä»˜â€åˆ’åˆ†ä¸ºä¸åŒçš„é™ç•Œä¸Šä¸‹æ–‡ï¼Œæ¯ä¸ªä¸Šä¸‹æ–‡å¯¹åº”ä¸€ä¸ªæœåŠ¡ã€‚</li><li>é™ç•Œä¸Šä¸‹æ–‡ä¹‹é—´çš„äº¤äº’é€šè¿‡æ˜ç¡®çš„æ¥å£è¿›è¡Œï¼Œé¿å…ç›´æ¥ä¾èµ–å†…éƒ¨å®ç°ã€‚</li></ul></li></ul>        <h4 id="2-æœåŠ¡ç²’åº¦"   >          <a href="#2-æœåŠ¡ç²’åº¦" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æœåŠ¡ç²’åº¦" class="headerlink" title="(2) æœåŠ¡ç²’åº¦"></a><strong>(2) æœåŠ¡ç²’åº¦</strong></h4>      <ul><li><strong>é€‚åº¦æ‹†åˆ†</strong>ï¼š<ul><li>æœåŠ¡ç²’åº¦è¿‡ç»†ä¼šå¢åŠ ç³»ç»Ÿå¤æ‚æ€§ï¼ˆå¦‚æœåŠ¡é—´é€šä¿¡æˆæœ¬å¢åŠ ï¼‰ï¼Œè¿‡ç²—åˆ™æ— æ³•ä½“ç°å¾®æœåŠ¡çš„ä¼˜åŠ¿ã€‚</li><li>ä¾‹å¦‚ï¼ŒåˆæœŸå¯ä»¥å°†â€œç”¨æˆ·æœåŠ¡â€å’Œâ€œæƒé™æœåŠ¡â€åˆå¹¶ä¸ºä¸€ä¸ªâ€œç”¨æˆ·æƒé™æœåŠ¡â€ï¼Œéšç€ä¸šåŠ¡å‘å±•å†æ‹†åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹æœåŠ¡ã€‚</li></ul></li><li><strong>æ¼”è¿›å¼è®¾è®¡</strong>ï¼š<ul><li>åˆæœŸå¯ä»¥è®¾è®¡è¾ƒç²—ç²’åº¦çš„æœåŠ¡ï¼Œéšç€ä¸šåŠ¡å¤æ‚æ€§çš„å¢åŠ é€æ­¥æ‹†åˆ†ã€‚</li><li>ä¾‹å¦‚ï¼Œç”µå•†ç³»ç»ŸåˆæœŸå¯ä»¥å°†â€œè®¢å•æœåŠ¡â€å’Œâ€œåº“å­˜æœåŠ¡â€åˆå¹¶ä¸ºä¸€ä¸ªâ€œäº¤æ˜“æœåŠ¡â€ï¼ŒåæœŸå†æ‹†åˆ†ä¸ºç‹¬ç«‹çš„æœåŠ¡ã€‚</li></ul></li></ul><hr>        <h3 id="2-é€šä¿¡æœºåˆ¶"   >          <a href="#2-é€šä¿¡æœºåˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-é€šä¿¡æœºåˆ¶" class="headerlink" title="2. é€šä¿¡æœºåˆ¶"></a><strong>2. é€šä¿¡æœºåˆ¶</strong></h3>              <h4 id="1-é€šä¿¡åè®®"   >          <a href="#1-é€šä¿¡åè®®" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-é€šä¿¡åè®®" class="headerlink" title="(1) é€šä¿¡åè®®"></a><strong>(1) é€šä¿¡åè®®</strong></h4>      <ul><li><strong>åŒæ­¥é€šä¿¡</strong>ï¼š<ul><li>ä½¿ç”¨ RESTful API æˆ– gRPC è¿›è¡ŒåŒæ­¥è°ƒç”¨ã€‚RESTful API é€‚åˆç®€å•çš„ HTTP é€šä¿¡ï¼ŒgRPC é€‚åˆé«˜æ€§èƒ½ã€å¼ºç±»å‹çš„åœºæ™¯ã€‚</li><li>ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡è°ƒç”¨æ”¯ä»˜æœåŠ¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ RESTful API å‘é€æ”¯ä»˜è¯·æ±‚ã€‚</li></ul></li><li><strong>å¼‚æ­¥é€šä¿¡</strong>ï¼š<ul><li>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ Kafkaã€RabbitMQï¼‰è¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚é€‚åˆè§£è€¦æœåŠ¡é—´çš„ä¾èµ–ï¼Œæé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚</li><li>ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡åˆ›å»ºè®¢å•åï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜ã€‚</li></ul></li></ul>        <h4 id="2-æ•°æ®ä¸€è‡´æ€§"   >          <a href="#2-æ•°æ®ä¸€è‡´æ€§" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="(2) æ•°æ®ä¸€è‡´æ€§"></a><strong>(2) æ•°æ®ä¸€è‡´æ€§</strong></h4>      <ul><li><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼š<ul><li>ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰æˆ– Saga æ¨¡å¼ä¿è¯è·¨æœåŠ¡çš„äº‹åŠ¡ä¸€è‡´æ€§ã€‚</li><li>ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡å’Œåº“å­˜æœåŠ¡é€šè¿‡ Saga æ¨¡å¼å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼šè®¢å•æœåŠ¡åˆ›å»ºè®¢å•åï¼Œåº“å­˜æœåŠ¡æ‰£å‡åº“å­˜ï¼›å¦‚æœåº“å­˜æ‰£å‡å¤±è´¥ï¼Œè®¢å•æœåŠ¡å›æ»šè®¢å•ã€‚</li></ul></li><li><strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼š<ul><li>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡åˆ›å»ºè®¢å•åï¼Œå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåº“å­˜æœåŠ¡æ¶ˆè´¹æ¶ˆæ¯åæ‰£å‡åº“å­˜ã€‚</li></ul></li></ul>        <h4 id="3-æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡"   >          <a href="#3-æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡" class="headerlink" title="(3) æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡"></a><strong>(3) æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡</strong></h4>      <ul><li><strong>æœåŠ¡å‘ç°</strong>ï¼š<ul><li>ä½¿ç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚ Consulã€Eurekaï¼‰åŠ¨æ€å‘ç°æœåŠ¡å®ä¾‹ã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡é€šè¿‡ Eureka å‘ç°åº“å­˜æœåŠ¡çš„å®ä¾‹ã€‚</li></ul></li><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼š<ul><li>ä½¿ç”¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼ˆå¦‚ Ribbonï¼‰æˆ–æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡ï¼ˆå¦‚ Nginxï¼‰ã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡é€šè¿‡ Ribbon è´Ÿè½½å‡è¡¡è°ƒç”¨åº“å­˜æœåŠ¡çš„å¤šä¸ªå®ä¾‹ã€‚</li></ul></li></ul><hr>        <h3 id="3-æ•°æ®ç®¡ç†"   >          <a href="#3-æ•°æ®ç®¡ç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æ•°æ®ç®¡ç†" class="headerlink" title="3. æ•°æ®ç®¡ç†"></a><strong>3. æ•°æ®ç®¡ç†</strong></h3>              <h4 id="1-æ•°æ®åº“è®¾è®¡"   >          <a href="#1-æ•°æ®åº“è®¾è®¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ•°æ®åº“è®¾è®¡" class="headerlink" title="(1) æ•°æ®åº“è®¾è®¡"></a><strong>(1) æ•°æ®åº“è®¾è®¡</strong></h4>      <ul><li><strong>æ•°æ®åº“æ‹†åˆ†</strong>ï¼š<ul><li>æ¯ä¸ªæœåŠ¡ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œé¿å…æ•°æ®è€¦åˆã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡ä½¿ç”¨ MySQL å­˜å‚¨è®¢å•æ•°æ®ï¼Œåº“å­˜æœåŠ¡ä½¿ç”¨ PostgreSQL å­˜å‚¨åº“å­˜æ•°æ®ã€‚</li></ul></li><li><strong>æ•°æ®åŒæ­¥</strong>ï¼š<ul><li>ä½¿ç”¨ CDCï¼ˆChange Data Captureï¼‰å·¥å…·ï¼ˆå¦‚ Debeziumï¼‰åŒæ­¥æ•°æ®ã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡çš„æ•°æ®å˜æ›´é€šè¿‡ Debezium åŒæ­¥åˆ°æ•°æ®ä»“åº“ã€‚</li></ul></li></ul>        <h4 id="2-ç¼“å­˜è®¾è®¡"   >          <a href="#2-ç¼“å­˜è®¾è®¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ç¼“å­˜è®¾è®¡" class="headerlink" title="(2) ç¼“å­˜è®¾è®¡"></a><strong>(2) ç¼“å­˜è®¾è®¡</strong></h4>      <ul><li><strong>åˆ†å¸ƒå¼ç¼“å­˜</strong>ï¼š<ul><li>ä½¿ç”¨ Redis æˆ– Memcached ä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æœåŠ¡å°†ç”¨æˆ·ä¿¡æ¯ç¼“å­˜åˆ° Redis ä¸­ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢å‹åŠ›ã€‚</li></ul></li><li><strong>ç¼“å­˜ä¸€è‡´æ€§</strong>ï¼š<ul><li>ä½¿ç”¨ç¼“å­˜å¤±æ•ˆç­–ç•¥ï¼ˆå¦‚å†™æ—¶å¤±æ•ˆï¼‰ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·ä¿¡æ¯æ›´æ–°æ—¶ï¼ŒåŒæ—¶å¤±æ•ˆ Redis ä¸­çš„ç¼“å­˜ã€‚</li></ul></li></ul><hr>        <h3 id="4-å®¹é”™ä¸å¼¹æ€§"   >          <a href="#4-å®¹é”™ä¸å¼¹æ€§" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-å®¹é”™ä¸å¼¹æ€§" class="headerlink" title="4. å®¹é”™ä¸å¼¹æ€§"></a><strong>4. å®¹é”™ä¸å¼¹æ€§</strong></h3>              <h4 id="1-ç†”æ–­ä¸é™çº§"   >          <a href="#1-ç†”æ–­ä¸é™çº§" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ç†”æ–­ä¸é™çº§" class="headerlink" title="(1) ç†”æ–­ä¸é™çº§"></a><strong>(1) ç†”æ–­ä¸é™çº§</strong></h4>      <ul><li><strong>ç†”æ–­å™¨</strong>ï¼š<ul><li>ä½¿ç”¨ç†”æ–­å™¨ï¼ˆå¦‚ Hystrixã€Resilience4jï¼‰é˜²æ­¢æœåŠ¡é›ªå´©ã€‚ä¾‹å¦‚ï¼Œå½“åº“å­˜æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œè®¢å•æœåŠ¡è§¦å‘ç†”æ–­ï¼Œç›´æ¥è¿”å›é”™è¯¯æç¤ºã€‚</li></ul></li><li><strong>é™çº§ç­–ç•¥</strong>ï¼š<ul><li>åœ¨æœåŠ¡ä¸å¯ç”¨æ—¶è¿”å›é»˜è®¤å€¼æˆ–ç¼“å­˜æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“æ¨èæœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œè¿”å›é»˜è®¤çš„æ¨èåˆ—è¡¨ã€‚</li></ul></li></ul>        <h4 id="2-é‡è¯•ä¸è¶…æ—¶"   >          <a href="#2-é‡è¯•ä¸è¶…æ—¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-é‡è¯•ä¸è¶…æ—¶" class="headerlink" title="(2) é‡è¯•ä¸è¶…æ—¶"></a><strong>(2) é‡è¯•ä¸è¶…æ—¶</strong></h4>      <ul><li><strong>é‡è¯•æœºåˆ¶</strong>ï¼š<ul><li>é…ç½®åˆç†çš„é‡è¯•æ¬¡æ•°å’Œé—´éš”ï¼ˆå¦‚æŒ‡æ•°é€€é¿ï¼‰ã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡è°ƒç”¨æ”¯ä»˜æœåŠ¡å¤±è´¥æ—¶ï¼Œé‡è¯• 3 æ¬¡ï¼Œæ¯æ¬¡é—´éš” 1 ç§’ã€‚</li></ul></li><li><strong>è¶…æ—¶è®¾ç½®</strong>ï¼š<ul><li>è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…è¯·æ±‚é•¿æ—¶é—´é˜»å¡ã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡è°ƒç”¨åº“å­˜æœåŠ¡çš„è¶…æ—¶æ—¶é—´ä¸º 2 ç§’ã€‚</li></ul></li></ul>        <h4 id="3-é™æµä¸é™çº§"   >          <a href="#3-é™æµä¸é™çº§" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-é™æµä¸é™çº§" class="headerlink" title="(3) é™æµä¸é™çº§"></a><strong>(3) é™æµä¸é™çº§</strong></h4>      <ul><li><strong>é™æµ</strong>ï¼š<ul><li>ä½¿ç”¨é™æµç®—æ³•ï¼ˆå¦‚ä»¤ç‰Œæ¡¶ã€æ¼æ¡¶ï¼‰ä¿æŠ¤æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œåº“å­˜æœåŠ¡æ¯ç§’æœ€å¤šå¤„ç† 100 ä¸ªè¯·æ±‚ï¼Œè¶…è¿‡çš„è¯·æ±‚ç›´æ¥æ‹’ç»ã€‚</li></ul></li><li><strong>é™çº§</strong>ï¼š<ul><li>åœ¨ç³»ç»Ÿå‹åŠ›è¿‡å¤§æ—¶ï¼Œå…³é—­éæ ¸å¿ƒåŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œä¿ƒé”€æ´»åŠ¨æœŸé—´å…³é—­æ¨èæœåŠ¡ï¼Œä¼˜å…ˆä¿è¯è®¢å•æœåŠ¡çš„å¯ç”¨æ€§ã€‚</li></ul></li></ul><hr>        <h3 id="5-ç›‘æ§ä¸æ—¥å¿—"   >          <a href="#5-ç›‘æ§ä¸æ—¥å¿—" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-ç›‘æ§ä¸æ—¥å¿—" class="headerlink" title="5. ç›‘æ§ä¸æ—¥å¿—"></a><strong>5. ç›‘æ§ä¸æ—¥å¿—</strong></h3>              <h4 id="1-ç›‘æ§"   >          <a href="#1-ç›‘æ§" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ç›‘æ§" class="headerlink" title="(1) ç›‘æ§"></a><strong>(1) ç›‘æ§</strong></h4>      <ul><li><strong>æŒ‡æ ‡æ”¶é›†</strong>ï¼š<ul><li>ä½¿ç”¨ Prometheus æ”¶é›†æœåŠ¡çš„æ€§èƒ½æŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼Œç›‘æ§è®¢å•æœåŠ¡çš„ QPSã€å“åº”æ—¶é—´ç­‰ã€‚</li></ul></li><li><strong>é“¾è·¯è¿½è¸ª</strong>ï¼š<ul><li>ä½¿ç”¨ Jaeger æˆ– Zipkin è¿½è¸ªè¯·æ±‚é“¾è·¯ã€‚ä¾‹å¦‚ï¼Œè¿½è¸ªè®¢å•æœåŠ¡è°ƒç”¨æ”¯ä»˜æœåŠ¡çš„é“¾è·¯ã€‚</li></ul></li></ul>        <h4 id="2-æ—¥å¿—"   >          <a href="#2-æ—¥å¿—" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ—¥å¿—" class="headerlink" title="(2) æ—¥å¿—"></a><strong>(2) æ—¥å¿—</strong></h4>      <ul><li><strong>é›†ä¸­æ—¥å¿—</strong>ï¼š<ul><li>ä½¿ç”¨ ELKï¼ˆElasticsearchã€Logstashã€Kibanaï¼‰æˆ– Loki é›†ä¸­ç®¡ç†æ—¥å¿—ã€‚ä¾‹å¦‚ï¼Œå°†æ‰€æœ‰æœåŠ¡çš„æ—¥å¿—æ”¶é›†åˆ° Elasticsearch ä¸­ï¼Œé€šè¿‡ Kibana æŸ¥è¯¢ã€‚</li></ul></li><li><strong>ç»“æ„åŒ–æ—¥å¿—</strong>ï¼š<ul><li>ä½¿ç”¨ JSON æ ¼å¼è®°å½•æ—¥å¿—ï¼Œä¾¿äºåˆ†æå’ŒæŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼Œæ—¥å¿—æ ¼å¼ä¸º <code>&#123;&quot;level&quot;:&quot;info&quot;,&quot;message&quot;:&quot;Order created&quot;,&quot;orderId&quot;:123&#125;</code>ã€‚</li></ul></li></ul><hr>        <h3 id="6-å®‰å…¨æ€§"   >          <a href="#6-å®‰å…¨æ€§" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-å®‰å…¨æ€§" class="headerlink" title="6. å®‰å…¨æ€§"></a><strong>6. å®‰å…¨æ€§</strong></h3>              <h4 id="1-è®¤è¯ä¸æˆæƒ"   >          <a href="#1-è®¤è¯ä¸æˆæƒ" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-è®¤è¯ä¸æˆæƒ" class="headerlink" title="(1) è®¤è¯ä¸æˆæƒ"></a><strong>(1) è®¤è¯ä¸æˆæƒ</strong></h4>      <ul><li><strong>è®¤è¯</strong>ï¼š<ul><li>ä½¿ç”¨ OAuth2 æˆ– JWT è¿›è¡Œç”¨æˆ·è®¤è¯ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·ç™»å½•åè·å– JWTï¼Œåç»­è¯·æ±‚æºå¸¦ JWT è¿›è¡Œè®¤è¯ã€‚</li></ul></li><li><strong>æˆæƒ</strong>ï¼š<ul><li>ä½¿ç”¨ RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰æˆ– ABACï¼ˆåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼‰è¿›è¡Œæƒé™ç®¡ç†ã€‚ä¾‹å¦‚ï¼Œç®¡ç†å‘˜è§’è‰²å¯ä»¥è®¿é—®æ‰€æœ‰è®¢å•æ•°æ®ï¼Œæ™®é€šç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„è®¢å•æ•°æ®ã€‚</li></ul></li></ul>        <h4 id="2-æ•°æ®å®‰å…¨"   >          <a href="#2-æ•°æ®å®‰å…¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ•°æ®å®‰å…¨" class="headerlink" title="(2) æ•°æ®å®‰å…¨"></a><strong>(2) æ•°æ®å®‰å…¨</strong></h4>      <ul><li><strong>åŠ å¯†ä¼ è¾“</strong>ï¼š<ul><li>ä½¿ç”¨ HTTPS åŠ å¯†é€šä¿¡æ•°æ®ã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡ä¸æ”¯ä»˜æœåŠ¡ä¹‹é—´çš„é€šä¿¡ä½¿ç”¨ HTTPSã€‚</li></ul></li><li><strong>æ•°æ®è„±æ•</strong>ï¼š<ul><li>å¯¹æ•æ„Ÿæ•°æ®è¿›è¡Œè„±æ•å¤„ç†ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æ‰‹æœºå·æ˜¾ç¤ºä¸º <code>138****1234</code>ã€‚</li></ul></li></ul><hr>        <h3 id="7-éƒ¨ç½²ä¸è¿ç»´"   >          <a href="#7-éƒ¨ç½²ä¸è¿ç»´" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-éƒ¨ç½²ä¸è¿ç»´" class="headerlink" title="7. éƒ¨ç½²ä¸è¿ç»´"></a><strong>7. éƒ¨ç½²ä¸è¿ç»´</strong></h3>              <h4 id="1-å®¹å™¨åŒ–"   >          <a href="#1-å®¹å™¨åŒ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å®¹å™¨åŒ–" class="headerlink" title="(1) å®¹å™¨åŒ–"></a><strong>(1) å®¹å™¨åŒ–</strong></h4>      <ul><li><strong>Docker</strong>ï¼š<ul><li>ä½¿ç”¨ Docker å®¹å™¨åŒ–æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œå°†è®¢å•æœåŠ¡æ‰“åŒ…ä¸º Docker é•œåƒã€‚</li></ul></li><li><strong>Kubernetes</strong>ï¼š<ul><li>ä½¿ç”¨ Kubernetes ç®¡ç†å®¹å™¨åŒ–æœåŠ¡çš„éƒ¨ç½²å’Œæ‰©å±•ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ Kubernetes è‡ªåŠ¨æ‰©å±•è®¢å•æœåŠ¡çš„å®ä¾‹æ•°é‡ã€‚</li></ul></li></ul>        <h4 id="2-CI-CD"   >          <a href="#2-CI-CD" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-CI-CD" class="headerlink" title="(2) CI&#x2F;CD"></a><strong>(2) CI&#x2F;CD</strong></h4>      <ul><li><strong>æŒç»­é›†æˆ</strong>ï¼š<ul><li>ä½¿ç”¨ Jenkins æˆ– GitLab CI å®ç°æŒç»­é›†æˆã€‚ä¾‹å¦‚ï¼Œæ¯æ¬¡ä»£ç æäº¤åè‡ªåŠ¨è¿è¡Œå•å…ƒæµ‹è¯•ã€‚</li></ul></li><li><strong>æŒç»­äº¤ä»˜</strong>ï¼š<ul><li>ä½¿ç”¨ ArgoCD æˆ– Spinnaker å®ç°æŒç»­äº¤ä»˜ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ ArgoCD è‡ªåŠ¨å°†æ–°ç‰ˆæœ¬éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒã€‚</li></ul></li></ul>        <h4 id="3-é…ç½®ç®¡ç†"   >          <a href="#3-é…ç½®ç®¡ç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-é…ç½®ç®¡ç†" class="headerlink" title="(3) é…ç½®ç®¡ç†"></a><strong>(3) é…ç½®ç®¡ç†</strong></h4>      <ul><li><strong>é›†ä¸­é…ç½®</strong>ï¼š<ul><li>ä½¿ç”¨ Spring Cloud Config æˆ– Apollo ç®¡ç†é…ç½®ã€‚ä¾‹å¦‚ï¼Œå°†æ‰€æœ‰æœåŠ¡çš„é…ç½®é›†ä¸­å­˜å‚¨åœ¨ Apollo ä¸­ã€‚</li></ul></li><li><strong>åŠ¨æ€æ›´æ–°</strong>ï¼š<ul><li>æ”¯æŒé…ç½®çš„åŠ¨æ€æ›´æ–°ï¼Œé¿å…é‡å¯æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ Apollo åŠ¨æ€ä¿®æ”¹è®¢å•æœåŠ¡çš„è¶…æ—¶æ—¶é—´ã€‚</li></ul></li></ul><hr>        <h3 id="8-æµ‹è¯•ä¸éªŒè¯"   >          <a href="#8-æµ‹è¯•ä¸éªŒè¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-æµ‹è¯•ä¸éªŒè¯" class="headerlink" title="8. æµ‹è¯•ä¸éªŒè¯"></a><strong>8. æµ‹è¯•ä¸éªŒè¯</strong></h3>              <h4 id="1-å•å…ƒæµ‹è¯•"   >          <a href="#1-å•å…ƒæµ‹è¯•" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å•å…ƒæµ‹è¯•" class="headerlink" title="(1) å•å…ƒæµ‹è¯•"></a><strong>(1) å•å…ƒæµ‹è¯•</strong></h4>      <ul><li><strong>è¦†ç›–ç‡</strong>ï¼š<ul><li>ç¡®ä¿å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒé€»è¾‘ã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡çš„å•å…ƒæµ‹è¯•è¦†ç›–åˆ›å»ºè®¢å•ã€å–æ¶ˆè®¢å•ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚</li></ul></li><li><strong>Mock æµ‹è¯•</strong>ï¼š<ul><li>ä½¿ç”¨ Mockito æˆ– WireMock æ¨¡æ‹Ÿä¾èµ–æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œæ¨¡æ‹Ÿæ”¯ä»˜æœåŠ¡çš„å“åº”ï¼Œæµ‹è¯•è®¢å•æœåŠ¡çš„é€»è¾‘ã€‚</li></ul></li></ul>        <h4 id="2-é›†æˆæµ‹è¯•"   >          <a href="#2-é›†æˆæµ‹è¯•" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-é›†æˆæµ‹è¯•" class="headerlink" title="(2) é›†æˆæµ‹è¯•"></a><strong>(2) é›†æˆæµ‹è¯•</strong></h4>      <ul><li><strong>æœåŠ¡é—´æµ‹è¯•</strong>ï¼š<ul><li>æµ‹è¯•æœåŠ¡ä¹‹é—´çš„é€šä¿¡å’Œæ•°æ®ä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼Œæµ‹è¯•è®¢å•æœåŠ¡è°ƒç”¨åº“å­˜æœåŠ¡çš„æ¥å£ã€‚</li></ul></li><li><strong>ç«¯åˆ°ç«¯æµ‹è¯•</strong>ï¼š<ul><li>æ¨¡æ‹ŸçœŸå®ç”¨æˆ·åœºæ™¯ï¼ŒéªŒè¯ç³»ç»Ÿæ•´ä½“åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæ¨¡æ‹Ÿç”¨æˆ·ä»ä¸‹å•åˆ°æ”¯ä»˜çš„å®Œæ•´æµç¨‹ã€‚</li></ul></li></ul>        <h4 id="3-æ€§èƒ½æµ‹è¯•"   >          <a href="#3-æ€§èƒ½æµ‹è¯•" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æ€§èƒ½æµ‹è¯•" class="headerlink" title="(3) æ€§èƒ½æµ‹è¯•"></a><strong>(3) æ€§èƒ½æµ‹è¯•</strong></h4>      <ul><li><strong>å‹åŠ›æµ‹è¯•</strong>ï¼š<ul><li>ä½¿ç”¨ JMeter æˆ– Gatling è¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œæ¨¡æ‹Ÿ 1000 ä¸ªç”¨æˆ·åŒæ—¶ä¸‹å•ï¼Œæµ‹è¯•ç³»ç»Ÿçš„æ€§èƒ½ã€‚</li></ul></li><li><strong>å®¹é‡è§„åˆ’</strong>ï¼š<ul><li>æ ¹æ®æµ‹è¯•ç»“æœè§„åˆ’ç³»ç»Ÿå®¹é‡ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®å‹åŠ›æµ‹è¯•ç»“æœå†³å®šéœ€è¦éƒ¨ç½²å¤šå°‘å°æœåŠ¡å™¨ã€‚</li></ul></li></ul><hr>        <h3 id="9-æ–‡æ¡£ä¸åä½œ"   >          <a href="#9-æ–‡æ¡£ä¸åä½œ" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-æ–‡æ¡£ä¸åä½œ" class="headerlink" title="9. æ–‡æ¡£ä¸åä½œ"></a><strong>9. æ–‡æ¡£ä¸åä½œ</strong></h3>              <h4 id="1-API-æ–‡æ¡£"   >          <a href="#1-API-æ–‡æ¡£" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-API-æ–‡æ¡£" class="headerlink" title="(1) API æ–‡æ¡£"></a><strong>(1) API æ–‡æ¡£</strong></h4>      <ul><li><strong>Swagger</strong>ï¼š<ul><li>ä½¿ç”¨ Swagger ç”Ÿæˆ API æ–‡æ¡£ã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡çš„ API æ–‡æ¡£é€šè¿‡ Swagger è‡ªåŠ¨ç”Ÿæˆã€‚</li></ul></li><li><strong>ç‰ˆæœ¬ç®¡ç†</strong>ï¼š<ul><li>å¯¹ API è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œé¿å…å…¼å®¹æ€§é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œè®¢å•æœåŠ¡çš„ API ç‰ˆæœ¬ä¸º <code>v1</code> å’Œ <code>v2</code>ï¼Œæ—§ç‰ˆæœ¬é€æ­¥æ·˜æ±°ã€‚</li></ul></li></ul>        <h4 id="2-å›¢é˜Ÿåä½œ"   >          <a href="#2-å›¢é˜Ÿåä½œ" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-å›¢é˜Ÿåä½œ" class="headerlink" title="(2) å›¢é˜Ÿåä½œ"></a><strong>(2) å›¢é˜Ÿåä½œ</strong></h4>      <ul><li><strong>ä»£ç è§„èŒƒ</strong>ï¼š<ul><li>åˆ¶å®šç»Ÿä¸€çš„ä»£ç è§„èŒƒï¼Œä¾¿äºå›¢é˜Ÿåä½œã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ Google Java Style Guide è§„èŒƒä»£ç æ ¼å¼ã€‚</li></ul></li><li><strong>çŸ¥è¯†å…±äº«</strong>ï¼š<ul><li>å®šæœŸè¿›è¡ŒæŠ€æœ¯åˆ†äº«ï¼Œæå‡å›¢é˜Ÿæ•´ä½“æ°´å¹³ã€‚ä¾‹å¦‚ï¼Œæ¯å‘¨ç»„ç»‡ä¸€æ¬¡æŠ€æœ¯åˆ†äº«ä¼šã€‚</li></ul></li></ul><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <p>åˆ†å¸ƒå¼å¾®æœåŠ¡å¼€å‘éœ€è¦æ³¨æ„ä»¥ä¸‹å…³é”®ç‚¹ï¼š</p><ol><li><strong>æœåŠ¡æ‹†åˆ†ä¸è®¾è®¡</strong>ï¼šåˆç†å®šä¹‰æœåŠ¡è¾¹ç•Œå’Œç²’åº¦ã€‚</li><li><strong>é€šä¿¡æœºåˆ¶</strong>ï¼šé€‰æ‹©åˆé€‚çš„é€šä¿¡åè®®å’Œæ•°æ®ä¸€è‡´æ€§æ–¹æ¡ˆã€‚</li><li><strong>æ•°æ®ç®¡ç†</strong>ï¼šè®¾è®¡ç‹¬ç«‹çš„æ•°æ®åº“å’Œç¼“å­˜ç­–ç•¥ã€‚</li><li><strong>å®¹é”™ä¸å¼¹æ€§</strong>ï¼šå®ç°ç†”æ–­ã€é™çº§ã€é™æµç­‰æœºåˆ¶ã€‚</li><li><strong>ç›‘æ§ä¸æ—¥å¿—</strong>ï¼šé›†ä¸­ç®¡ç†ç›‘æ§æŒ‡æ ‡å’Œæ—¥å¿—ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šç¡®ä¿è®¤è¯ã€æˆæƒå’Œæ•°æ®å®‰å…¨ã€‚</li><li><strong>éƒ¨ç½²ä¸è¿ç»´</strong>ï¼šä½¿ç”¨å®¹å™¨åŒ–å’Œ CI&#x2F;CD å·¥å…·ã€‚</li><li><strong>æµ‹è¯•ä¸éªŒè¯</strong>ï¼šè¿›è¡Œå…¨é¢çš„å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ã€‚</li><li><strong>æ–‡æ¡£ä¸åä½œ</strong>ï¼šç»´æŠ¤ API æ–‡æ¡£å’Œå›¢é˜Ÿåä½œè§„èŒƒã€‚</li></ol><p>é€šè¿‡å…³æ³¨è¿™äº›å…³é”®ç‚¹ï¼Œå¯ä»¥æ„å»ºé«˜æ•ˆã€å¯é çš„åˆ†å¸ƒå¼å¾®æœåŠ¡ç³»ç»Ÿã€‚</p>]]></content>
    
    
    <summary type="html">åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„</summary>
    
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://ljd0620.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="å¾®æœåŠ¡" scheme="https://ljd0620.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="åˆ†å¸ƒå¼" scheme="https://ljd0620.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Resilience4jçš„å·¥ä½œåŸç†</title>
    <link href="https://ljd0620.github.io/2024/04/13/Resilience4j%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/"/>
    <id>https://ljd0620.github.io/2024/04/13/Resilience4j%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</id>
    <published>2024-04-13T04:20:48.000Z</published>
    <updated>2025-03-19T02:03:26.173Z</updated>
    
    <content type="html"><![CDATA[<p>Resilience4j æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å®¹é”™åº“ï¼Œä¸“ä¸º Java 8 å’Œå‡½æ•°å¼ç¼–ç¨‹è®¾è®¡ã€‚å®ƒæä¾›äº†ç†”æ–­å™¨ã€é™æµå™¨ã€é‡è¯•æœºåˆ¶ã€éš”èˆ±æ¨¡å¼ç­‰åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºå¥å£®çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚Resilience4j çš„è®¾è®¡ç›®æ ‡æ˜¯<strong>ç®€å•ã€è½»é‡ã€æ¨¡å—åŒ–</strong>ï¼Œå¹¶ä¸”ä¸ Spring Boot å’Œ Spring Cloud é›†æˆè‰¯å¥½ã€‚ä»¥ä¸‹æ˜¯ Resilience4j çš„å·¥ä½œåŸç†åŠå…¶æ ¸å¿ƒæœºåˆ¶çš„è¯¦ç»†è§£æï¼š</p><hr>        <h3 id="1-Resilience4j-çš„æ ¸å¿ƒåŠŸèƒ½"   >          <a href="#1-Resilience4j-çš„æ ¸å¿ƒåŠŸèƒ½" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-Resilience4j-çš„æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="1. Resilience4j çš„æ ¸å¿ƒåŠŸèƒ½"></a><strong>1. Resilience4j çš„æ ¸å¿ƒåŠŸèƒ½</strong></h3>      <p>Resilience4j æä¾›äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š</p><ol><li><strong>ç†”æ–­å™¨ï¼ˆCircuit Breakerï¼‰</strong>ï¼š<ul><li>é˜²æ­¢ç³»ç»Ÿå› æŸä¸ªæœåŠ¡çš„æ•…éšœè€Œå´©æºƒã€‚</li></ul></li><li><strong>é™æµå™¨ï¼ˆRate Limiterï¼‰</strong>ï¼š<ul><li>æ§åˆ¶è¯·æ±‚çš„é€Ÿç‡ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½ã€‚</li></ul></li><li><strong>é‡è¯•æœºåˆ¶ï¼ˆRetryï¼‰</strong>ï¼š<ul><li>åœ¨è¯·æ±‚å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ã€‚</li></ul></li><li><strong>éš”èˆ±æ¨¡å¼ï¼ˆBulkheadï¼‰</strong>ï¼š<ul><li>éš”ç¦»èµ„æºï¼Œé¿å…æŸä¸ªæœåŠ¡çš„æ•…éšœå½±å“å…¶ä»–æœåŠ¡ã€‚</li></ul></li><li><strong>ç¼“å­˜ï¼ˆCacheï¼‰</strong>ï¼š<ul><li>å¯¹è¯·æ±‚ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå‡å°‘é‡å¤è¯·æ±‚çš„å¼€é”€ã€‚</li></ul></li><li><strong>æ—¶é—´é™åˆ¶å™¨ï¼ˆTime Limiterï¼‰</strong>ï¼š<ul><li>é™åˆ¶æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´é˜»å¡ã€‚</li></ul></li></ol><hr>        <h3 id="2-Resilience4j-çš„å·¥ä½œåŸç†"   >          <a href="#2-Resilience4j-çš„å·¥ä½œåŸç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Resilience4j-çš„å·¥ä½œåŸç†" class="headerlink" title="2. Resilience4j çš„å·¥ä½œåŸç†"></a><strong>2. Resilience4j çš„å·¥ä½œåŸç†</strong></h3>      <p>Resilience4j çš„å·¥ä½œåŸç†åŸºäº<strong>è£…é¥°å™¨æ¨¡å¼</strong>ï¼Œé€šè¿‡è£…é¥°å™¨å¯¹æ–¹æ³•è°ƒç”¨è¿›è¡Œå¢å¼ºï¼Œä»è€Œå®ç°å®¹é”™åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ Resilience4j çš„å·¥ä½œæµç¨‹ï¼š</p>        <h4 id="1-å®šä¹‰æ ¸å¿ƒé€»è¾‘"   >          <a href="#1-å®šä¹‰æ ¸å¿ƒé€»è¾‘" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å®šä¹‰æ ¸å¿ƒé€»è¾‘" class="headerlink" title="(1) å®šä¹‰æ ¸å¿ƒé€»è¾‘"></a><strong>(1) å®šä¹‰æ ¸å¿ƒé€»è¾‘</strong></h4>      <p>å¼€å‘è€…å®šä¹‰éœ€è¦ä¿æŠ¤çš„æ ¸å¿ƒé€»è¾‘ï¼ˆå¦‚è°ƒç”¨å¤–éƒ¨æœåŠ¡ï¼‰ã€‚</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">callExternalService</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨å¤–éƒ¨æœåŠ¡</span></span><br><span class="line">    <span class="keyword">return</span> externalService.call();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="2-åˆ›å»ºè£…é¥°å™¨"   >          <a href="#2-åˆ›å»ºè£…é¥°å™¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-åˆ›å»ºè£…é¥°å™¨" class="headerlink" title="(2) åˆ›å»ºè£…é¥°å™¨"></a><strong>(2) åˆ›å»ºè£…é¥°å™¨</strong></h4>      <p>ä½¿ç”¨ Resilience4j æä¾›çš„è£…é¥°å™¨å¯¹æ ¸å¿ƒé€»è¾‘è¿›è¡Œå¢å¼ºã€‚</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CircuitBreaker</span> <span class="variable">circuitBreaker</span> <span class="operator">=</span> CircuitBreaker.ofDefaults(<span class="string">&quot;externalService&quot;</span>);</span><br><span class="line"><span class="type">RateLimiter</span> <span class="variable">rateLimiter</span> <span class="operator">=</span> RateLimiter.ofDefaults(<span class="string">&quot;externalService&quot;</span>);</span><br><span class="line"><span class="type">Retry</span> <span class="variable">retry</span> <span class="operator">=</span> Retry.ofDefaults(<span class="string">&quot;externalService&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> CircuitBreaker.decorateSupplier(circuitBreaker, () -&gt;</span><br><span class="line">    RateLimiter.decorateSupplier(rateLimiter, () -&gt;</span><br><span class="line">        Retry.decorateSupplier(retry, () -&gt;</span><br><span class="line">            callExternalService()</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">).get();</span><br></pre></td></tr></table></div></figure>        <h4 id="3-æ‰§è¡Œè£…é¥°åçš„é€»è¾‘"   >          <a href="#3-æ‰§è¡Œè£…é¥°åçš„é€»è¾‘" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æ‰§è¡Œè£…é¥°åçš„é€»è¾‘" class="headerlink" title="(3) æ‰§è¡Œè£…é¥°åçš„é€»è¾‘"></a><strong>(3) æ‰§è¡Œè£…é¥°åçš„é€»è¾‘</strong></h4>      <p>è°ƒç”¨è£…é¥°åçš„é€»è¾‘ï¼ŒResilience4j ä¼šæ ¹æ®é…ç½®çš„è§„åˆ™ï¼ˆå¦‚ç†”æ–­ã€é™æµã€é‡è¯•ç­‰ï¼‰æ‰§è¡Œæ ¸å¿ƒé€»è¾‘ã€‚</p><hr>        <h3 id="3-Resilience4j-çš„æ ¸å¿ƒæœºåˆ¶"   >          <a href="#3-Resilience4j-çš„æ ¸å¿ƒæœºåˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-Resilience4j-çš„æ ¸å¿ƒæœºåˆ¶" class="headerlink" title="3. Resilience4j çš„æ ¸å¿ƒæœºåˆ¶"></a><strong>3. Resilience4j çš„æ ¸å¿ƒæœºåˆ¶</strong></h3>      <p>ä»¥ä¸‹æ˜¯ Resilience4j çš„æ ¸å¿ƒæœºåˆ¶åŠå…¶å®ç°åŸç†ï¼š</p>        <h4 id="1-ç†”æ–­å™¨ï¼ˆCircuit-Breakerï¼‰"   >          <a href="#1-ç†”æ–­å™¨ï¼ˆCircuit-Breakerï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ç†”æ–­å™¨ï¼ˆCircuit-Breakerï¼‰" class="headerlink" title="(1) ç†”æ–­å™¨ï¼ˆCircuit Breakerï¼‰"></a><strong>(1) ç†”æ–­å™¨ï¼ˆCircuit Breakerï¼‰</strong></h4>      <ul><li><strong>å·¥ä½œåŸç†</strong>ï¼š<ul><li>ç›‘æ§è¯·æ±‚çš„æˆåŠŸä¸å¤±è´¥æƒ…å†µã€‚</li><li>å½“å¤±è´¥ç‡è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œç†”æ–­å™¨æ‰“å¼€ï¼Œæ‰€æœ‰è¯·æ±‚å¿«é€Ÿå¤±è´¥ã€‚</li><li>ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œç†”æ–­å™¨è¿›å…¥åŠå¼€çŠ¶æ€ï¼Œå…è®¸éƒ¨åˆ†è¯·æ±‚é€šè¿‡ä»¥æ£€æµ‹æœåŠ¡æ˜¯å¦æ¢å¤ã€‚</li></ul></li><li><strong>é…ç½®å‚æ•°</strong>ï¼š<ul><li><code>failureRateThreshold</code>ï¼šå¤±è´¥ç‡é˜ˆå€¼ï¼ˆé»˜è®¤ 50%ï¼‰ã€‚</li><li><code>waitDurationInOpenState</code>ï¼šç†”æ–­å™¨æ‰“å¼€åè¿›å…¥åŠå¼€çŠ¶æ€çš„æ—¶é—´ï¼ˆé»˜è®¤ 60 ç§’ï¼‰ã€‚</li><li><code>ringBufferSizeInHalfOpenState</code>ï¼šåŠå¼€çŠ¶æ€ä¸‹çš„è¯·æ±‚æ•°ï¼ˆé»˜è®¤ 10ï¼‰ã€‚</li><li><code>ringBufferSizeInClosedState</code>ï¼šå…³é—­çŠ¶æ€ä¸‹çš„è¯·æ±‚æ•°ï¼ˆé»˜è®¤ 100ï¼‰ã€‚</li></ul></li></ul>        <h4 id="2-é™æµå™¨ï¼ˆRate-Limiterï¼‰"   >          <a href="#2-é™æµå™¨ï¼ˆRate-Limiterï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-é™æµå™¨ï¼ˆRate-Limiterï¼‰" class="headerlink" title="(2) é™æµå™¨ï¼ˆRate Limiterï¼‰"></a><strong>(2) é™æµå™¨ï¼ˆRate Limiterï¼‰</strong></h4>      <ul><li><strong>å·¥ä½œåŸç†</strong>ï¼š<ul><li>æ§åˆ¶è¯·æ±‚çš„é€Ÿç‡ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½ã€‚</li><li>ä½¿ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•å®ç°é™æµã€‚</li></ul></li><li><strong>é…ç½®å‚æ•°</strong>ï¼š<ul><li><code>limitRefreshPeriod</code>ï¼šä»¤ç‰Œåˆ·æ–°å‘¨æœŸï¼ˆé»˜è®¤ 500 çº³ç§’ï¼‰ã€‚</li><li><code>limitForPeriod</code>ï¼šæ¯ä¸ªå‘¨æœŸçš„è¯·æ±‚é™åˆ¶ï¼ˆé»˜è®¤ 50ï¼‰ã€‚</li></ul></li></ul>        <h4 id="3-é‡è¯•æœºåˆ¶ï¼ˆRetryï¼‰"   >          <a href="#3-é‡è¯•æœºåˆ¶ï¼ˆRetryï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-é‡è¯•æœºåˆ¶ï¼ˆRetryï¼‰" class="headerlink" title="(3) é‡è¯•æœºåˆ¶ï¼ˆRetryï¼‰"></a><strong>(3) é‡è¯•æœºåˆ¶ï¼ˆRetryï¼‰</strong></h4>      <ul><li><strong>å·¥ä½œåŸç†</strong>ï¼š<ul><li>åœ¨è¯·æ±‚å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ã€‚</li><li>æ”¯æŒé…ç½®é‡è¯•æ¬¡æ•°ã€é‡è¯•é—´éš”ç­‰ã€‚</li></ul></li><li><strong>é…ç½®å‚æ•°</strong>ï¼š<ul><li><code>maxAttempts</code>ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆé»˜è®¤ 3ï¼‰ã€‚</li><li><code>waitDuration</code>ï¼šé‡è¯•é—´éš”ï¼ˆé»˜è®¤ 500 æ¯«ç§’ï¼‰ã€‚</li></ul></li></ul>        <h4 id="4-éš”èˆ±æ¨¡å¼ï¼ˆBulkheadï¼‰"   >          <a href="#4-éš”èˆ±æ¨¡å¼ï¼ˆBulkheadï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-éš”èˆ±æ¨¡å¼ï¼ˆBulkheadï¼‰" class="headerlink" title="(4) éš”èˆ±æ¨¡å¼ï¼ˆBulkheadï¼‰"></a><strong>(4) éš”èˆ±æ¨¡å¼ï¼ˆBulkheadï¼‰</strong></h4>      <ul><li><strong>å·¥ä½œåŸç†</strong>ï¼š<ul><li>éš”ç¦»èµ„æºï¼Œé¿å…æŸä¸ªæœåŠ¡çš„æ•…éšœå½±å“å…¶ä»–æœåŠ¡ã€‚</li><li>æ”¯æŒçº¿ç¨‹æ± éš”ç¦»å’Œä¿¡å·é‡éš”ç¦»ã€‚</li></ul></li><li><strong>é…ç½®å‚æ•°</strong>ï¼š<ul><li><code>maxConcurrentCalls</code>ï¼šæœ€å¤§å¹¶å‘è°ƒç”¨æ•°ï¼ˆé»˜è®¤ 25ï¼‰ã€‚</li><li><code>maxWaitDuration</code>ï¼šæœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆé»˜è®¤ 0 æ¯«ç§’ï¼‰ã€‚</li></ul></li></ul>        <h4 id="5-æ—¶é—´é™åˆ¶å™¨ï¼ˆTime-Limiterï¼‰"   >          <a href="#5-æ—¶é—´é™åˆ¶å™¨ï¼ˆTime-Limiterï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-æ—¶é—´é™åˆ¶å™¨ï¼ˆTime-Limiterï¼‰" class="headerlink" title="(5) æ—¶é—´é™åˆ¶å™¨ï¼ˆTime Limiterï¼‰"></a><strong>(5) æ—¶é—´é™åˆ¶å™¨ï¼ˆTime Limiterï¼‰</strong></h4>      <ul><li><strong>å·¥ä½œåŸç†</strong>ï¼š<ul><li>é™åˆ¶æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´é˜»å¡ã€‚</li><li>å¦‚æœæ–¹æ³•æ‰§è¡Œè¶…æ—¶ï¼ŒæŠ›å‡º <code>TimeoutException</code>ã€‚</li></ul></li><li><strong>é…ç½®å‚æ•°</strong>ï¼š<ul><li><code>timeoutDuration</code>ï¼šè¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ 1 ç§’ï¼‰ã€‚</li></ul></li></ul><hr>        <h3 id="4-Resilience4j-çš„ç¤ºä¾‹ä»£ç "   >          <a href="#4-Resilience4j-çš„ç¤ºä¾‹ä»£ç " class="heading-link"><i class="fas fa-link"></i></a><a href="#4-Resilience4j-çš„ç¤ºä¾‹ä»£ç " class="headerlink" title="4. Resilience4j çš„ç¤ºä¾‹ä»£ç "></a><strong>4. Resilience4j çš„ç¤ºä¾‹ä»£ç </strong></h3>      <p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Resilience4j ç¤ºä¾‹ï¼š</p>        <h4 id="1-æ·»åŠ ä¾èµ–"   >          <a href="#1-æ·»åŠ ä¾èµ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ·»åŠ ä¾èµ–" class="headerlink" title="(1) æ·»åŠ ä¾èµ–"></a><strong>(1) æ·»åŠ ä¾èµ–</strong></h4>      <figure class="highlight xml"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.resilience4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>resilience4j-spring-boot2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></div></figure>        <h4 id="2-é…ç½®-Resilience4j"   >          <a href="#2-é…ç½®-Resilience4j" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-é…ç½®-Resilience4j" class="headerlink" title="(2) é…ç½® Resilience4j"></a><strong>(2) é…ç½® Resilience4j</strong></h4>      <figure class="highlight yaml"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resilience4j:</span></span><br><span class="line">  <span class="attr">circuitbreaker:</span></span><br><span class="line">    <span class="attr">instances:</span></span><br><span class="line">      <span class="attr">externalService:</span></span><br><span class="line">        <span class="attr">failureRateThreshold:</span> <span class="number">50</span></span><br><span class="line">        <span class="attr">waitDurationInOpenState:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">ringBufferSizeInHalfOpenState:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">ringBufferSizeInClosedState:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">ratelimiter:</span></span><br><span class="line">    <span class="attr">instances:</span></span><br><span class="line">      <span class="attr">externalService:</span></span><br><span class="line">        <span class="attr">limitForPeriod:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">limitRefreshPeriod:</span> <span class="string">1s</span></span><br><span class="line">  <span class="attr">retry:</span></span><br><span class="line">    <span class="attr">instances:</span></span><br><span class="line">      <span class="attr">externalService:</span></span><br><span class="line">        <span class="attr">maxAttempts:</span> <span class="number">3</span></span><br><span class="line">        <span class="attr">waitDuration:</span> <span class="string">500ms</span></span><br></pre></td></tr></table></div></figure>        <h4 id="3-ä½¿ç”¨-Resilience4j"   >          <a href="#3-ä½¿ç”¨-Resilience4j" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ä½¿ç”¨-Resilience4j" class="headerlink" title="(3) ä½¿ç”¨ Resilience4j"></a><strong>(3) ä½¿ç”¨ Resilience4j</strong></h4>      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExternalService</span> &#123;</span><br><span class="line">    <span class="meta">@CircuitBreaker(name = &quot;externalService&quot;, fallbackMethod = &quot;fallback&quot;)</span></span><br><span class="line">    <span class="meta">@RateLimiter(name = &quot;externalService&quot;)</span></span><br><span class="line">    <span class="meta">@Retry(name = &quot;externalService&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">callExternalService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨å¤–éƒ¨æœåŠ¡</span></span><br><span class="line">        <span class="keyword">return</span> externalService.call();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fallback</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Fallback response&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="5-Resilience4j-çš„ä¼˜ç¼ºç‚¹"   >          <a href="#5-Resilience4j-çš„ä¼˜ç¼ºç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-Resilience4j-çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="5. Resilience4j çš„ä¼˜ç¼ºç‚¹"></a><strong>5. Resilience4j çš„ä¼˜ç¼ºç‚¹</strong></h3>              <h4 id="1-ä¼˜ç‚¹"   >          <a href="#1-ä¼˜ç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ä¼˜ç‚¹" class="headerlink" title="(1) ä¼˜ç‚¹"></a><strong>(1) ä¼˜ç‚¹</strong></h4>      <ul><li><strong>è½»é‡çº§</strong>ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼ŒæŒ‰éœ€å¼•å…¥åŠŸèƒ½ã€‚</li><li><strong>æ˜“äºé›†æˆ</strong>ï¼šä¸ Spring Boot å’Œ Spring Cloud é›†æˆè‰¯å¥½ã€‚</li><li><strong>ä¸°å¯Œçš„åŠŸèƒ½</strong>ï¼šæ”¯æŒç†”æ–­ã€é™æµã€é‡è¯•ã€éš”èˆ±ç­‰å¤šç§å®¹é”™æœºåˆ¶ã€‚</li><li><strong>çµæ´»çš„é…ç½®</strong>ï¼šæ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶æˆ–ä»£ç è¿›è¡Œé…ç½®ã€‚</li></ul>        <h4 id="2-ç¼ºç‚¹"   >          <a href="#2-ç¼ºç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ç¼ºç‚¹" class="headerlink" title="(2) ç¼ºç‚¹"></a><strong>(2) ç¼ºç‚¹</strong></h4>      <ul><li><strong>å­¦ä¹ æˆæœ¬</strong>ï¼šéœ€è¦ç†Ÿæ‚‰ Resilience4j çš„ API å’Œé…ç½®ã€‚</li><li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šè£…é¥°å™¨æ¨¡å¼ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚</li></ul><hr>        <h3 id="6-Resilience4j-çš„æ›¿ä»£æ–¹æ¡ˆ"   >          <a href="#6-Resilience4j-çš„æ›¿ä»£æ–¹æ¡ˆ" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-Resilience4j-çš„æ›¿ä»£æ–¹æ¡ˆ" class="headerlink" title="6. Resilience4j çš„æ›¿ä»£æ–¹æ¡ˆ"></a><strong>6. Resilience4j çš„æ›¿ä»£æ–¹æ¡ˆ</strong></h3>      <ol><li><strong>Hystrix</strong>ï¼š<ul><li>Netflix å¼€æºçš„å®¹é”™åº“ï¼Œå·²åœæ­¢ç»´æŠ¤ã€‚</li></ul></li><li><strong>Sentinel</strong>ï¼š<ul><li>é˜¿é‡Œå·´å·´å¼€æºçš„æµé‡æ§åˆ¶å’Œç†”æ–­é™çº§æ¡†æ¶ã€‚</li></ul></li><li><strong>Spring Cloud Circuit Breaker</strong>ï¼š<ul><li>Spring Cloud æä¾›çš„ç»Ÿä¸€ç†”æ–­å™¨æŠ½è±¡ï¼Œæ”¯æŒå¤šç§å®ç°ï¼ˆå¦‚ Resilience4jã€Sentinel ç­‰ï¼‰ã€‚</li></ul></li></ol><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <p>Resilience4j é€šè¿‡è£…é¥°å™¨æ¨¡å¼æä¾›äº†ç†”æ–­ã€é™æµã€é‡è¯•ã€éš”èˆ±ç­‰å®¹é”™æœºåˆ¶ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºå¥å£®çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å…¶è½»é‡çº§ã€æ¨¡å—åŒ–çš„è®¾è®¡ä½¿å…¶æ˜“äºé›†æˆå’Œæ‰©å±•ã€‚å°½ç®¡ Resilience4j æœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬å’Œæ€§èƒ½å¼€é”€ï¼Œä½†å…¶ä¸°å¯Œçš„åŠŸèƒ½å’Œçµæ´»çš„é…ç½®ä½¿å…¶æˆä¸ºç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ç†æƒ³é€‰æ‹©ã€‚</p>]]></content>
    
    
    <summary type="html">Resilience4jçš„å·¥ä½œåŸç†</summary>
    
    
    
    <category term="Java" scheme="https://ljd0620.github.io/categories/Java/"/>
    
    
    <category term="å¾®æœåŠ¡" scheme="https://ljd0620.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="Resilience4j" scheme="https://ljd0620.github.io/tags/Resilience4j/"/>
    
  </entry>
  
  <entry>
    <title>Feignå®šåˆ¶åŒ–å¼€å‘æŒ‡å—</title>
    <link href="https://ljd0620.github.io/2024/03/26/Feign%E5%AE%9A%E5%88%B6%E5%8C%96%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/"/>
    <id>https://ljd0620.github.io/2024/03/26/Feign%E5%AE%9A%E5%88%B6%E5%8C%96%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/</id>
    <published>2024-03-26T04:33:52.000Z</published>
    <updated>2025-03-19T02:01:58.712Z</updated>
    
    <content type="html"><![CDATA[<p>Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„ Web æœåŠ¡å®¢æˆ·ç«¯ï¼Œä¸»è¦ç”¨äºç®€åŒ– HTTP è¯·æ±‚çš„è°ƒç”¨ã€‚ç„¶è€Œï¼Œåœ¨é HTTP è¯·æ±‚çš„åœºæ™¯ä¸‹ï¼Œä¾‹å¦‚åŒºå—é“¾åº”ç”¨ä¸­å¸¸è§çš„ gRPCã€WebSocket æˆ–è€…ç›´æ¥çš„ TCP&#x2F;IP åè®®é€šä¿¡ï¼ŒFeign å¹¶ä¸æ˜¯ç›´æ¥é€‚ç”¨çš„ã€‚ä½†æ˜¯ï¼Œé€šè¿‡ä¸€äº›å®šåˆ¶åŒ–å¼€å‘ï¼Œä½ å¯ä»¥æ‰©å±• Feign æ¥é€‚åº”è¿™äº›ä¸åŒçš„åè®®ã€‚</p><p>è¦åœ¨é HTTP è¯·æ±‚çš„åœºæ™¯ä¸‹ï¼Œä¾‹å¦‚åŒºå—é“¾æ™ºèƒ½åˆçº¦è°ƒç”¨ä¸­ä½¿ç”¨ Feign æ¡†æ¶è¿›è¡Œå®šåˆ¶åŒ–å¼€å‘ï¼Œä½ éœ€è¦å¯¹ Feign è¿›è¡Œæ‰©å±•æˆ–æ›¿æ¢å…¶æ ¸å¿ƒç»„ä»¶ä»¥é€‚åº”æ–°çš„åè®®ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªè¯¦ç»†çš„æ­¥éª¤æŒ‡å—ï¼Œå¸®åŠ©ä½ åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ Feignï¼š</p>        <h3 id="1-ç†è§£éœ€æ±‚"   >          <a href="#1-ç†è§£éœ€æ±‚" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ç†è§£éœ€æ±‚" class="headerlink" title="1. ç†è§£éœ€æ±‚"></a>1. ç†è§£éœ€æ±‚</h3>      <p>é¦–å…ˆæ˜ç¡®ä½ å¸Œæœ›å®ç°çš„ç›®æ ‡ã€‚å¯¹äºåŒºå—é“¾æ™ºèƒ½åˆçº¦è°ƒç”¨ï¼Œé€šå¸¸éœ€è¦é€šè¿‡æŸç§æ–¹å¼ä¸åŒºå—é“¾èŠ‚ç‚¹é€šä¿¡ï¼ˆå¦‚é€šè¿‡ JSON-RPCã€gRPC æˆ–è€… WebSocketï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥çš„ HTTP è¯·æ±‚ã€‚</p>        <h3 id="2-è®¾è®¡æ¥å£"   >          <a href="#2-è®¾è®¡æ¥å£" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-è®¾è®¡æ¥å£" class="headerlink" title="2. è®¾è®¡æ¥å£"></a>2. è®¾è®¡æ¥å£</h3>      <p>è®¾è®¡ä¸€ä¸ªæ¥å£æ¥è¡¨ç¤ºä½ æƒ³è¦æ‰§è¡Œçš„æ“ä½œã€‚è¿™ä¸ªæ¥å£å°†ä½œä¸º Feign çš„å®¢æˆ·ç«¯æ¥å£ï¼Œå¹¶ä¸”åº”è¯¥åŒ…å«æ‰€æœ‰å¿…è¦çš„æ–¹æ³•å®šä¹‰ã€‚</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(name = &quot;blockchain-client&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlockchainClient</span> &#123;</span><br><span class="line">    <span class="meta">@RequestLine(&quot;GET /eth_call&quot;)</span></span><br><span class="line">    String <span class="title function_">callSmartContract</span><span class="params">(<span class="meta">@Param(&quot;data&quot;)</span> String data)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¯·æ³¨æ„ï¼Œè¿™é‡Œçš„ <code>@RequestLine</code> æ³¨è§£æ˜¯ç”¨äºæŒ‡å®šè¯·æ±‚çš„æ–¹æ³•å’Œè·¯å¾„ï¼Œè€Œåœ¨å®é™…çš„åŒºå—é“¾äº¤äº’ä¸­ï¼Œè¿™å¯èƒ½å¹¶ä¸é€‚ç”¨ã€‚å› æ­¤ï¼Œä½ å¯èƒ½éœ€è¦è‡ªå®šä¹‰æ³¨è§£æˆ–è€…å®Œå…¨ä¸ä½¿ç”¨è¿™äº›æ³¨è§£ã€‚</p>        <h3 id="3-åˆ›å»ºè‡ªå®šä¹‰-Client-å®ç°"   >          <a href="#3-åˆ›å»ºè‡ªå®šä¹‰-Client-å®ç°" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-åˆ›å»ºè‡ªå®šä¹‰-Client-å®ç°" class="headerlink" title="3. åˆ›å»ºè‡ªå®šä¹‰ Client å®ç°"></a>3. åˆ›å»ºè‡ªå®šä¹‰ Client å®ç°</h3>      <p>ç”±äº Feign é»˜è®¤æ˜¯ä¸º HTTP è®¾è®¡çš„ï¼Œæ‰€ä»¥ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>feign.Client</code> å®ç°ç±»æ¥å¤„ç†ç‰¹å®šäºåŒºå—é“¾çš„é€šä¿¡é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Web3j åº“ä¸ Ethereum åŒºå—é“¾äº¤äº’ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> feign.Client;</span><br><span class="line"><span class="keyword">import</span> feign.Request;</span><br><span class="line"><span class="keyword">import</span> feign.Response;</span><br><span class="line"><span class="keyword">import</span> org.web3j.protocol.Web3j;</span><br><span class="line"><span class="keyword">import</span> org.web3j.protocol.core.methods.response.EthCall;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Web3jClient</span> <span class="keyword">implements</span> <span class="title class_">Client</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Web3j web3j;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Web3jClient</span><span class="params">(Web3j web3j)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.web3j = web3j;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Response <span class="title function_">execute</span><span class="params">(Request request, Request.Options options)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// è§£æè¯·æ±‚ä¸­çš„å‚æ•°å¹¶æ„é€ ç›¸åº”çš„ Web3j è°ƒç”¨</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">requestBody</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(request.body());</span><br><span class="line">        <span class="type">EthCall</span> <span class="variable">response</span> <span class="operator">=</span> web3j.ethCall(</span><br><span class="line">                <span class="comment">// æ ¹æ®ä½ çš„éœ€æ±‚è§£æ requestBody å¹¶æ„é€ æ­£ç¡®çš„å‚æ•°</span></span><br><span class="line">                <span class="comment">// è¿™é‡Œåªæ˜¯ä¸€ä¸ªç¤ºä¾‹</span></span><br><span class="line">                Transaction.createEthCallTransaction(</span><br><span class="line">                        <span class="string">&quot;fromAddress&quot;</span>, </span><br><span class="line">                        <span class="string">&quot;toAddress&quot;</span>, </span><br><span class="line">                        <span class="string">&quot;data&quot;</span></span><br><span class="line">                ),</span><br><span class="line">                DefaultBlockParameterName.LATEST</span><br><span class="line">        ).send();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ„é€  Feign çš„ Response å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Response.builder()</span><br><span class="line">                .status(<span class="number">200</span>)</span><br><span class="line">                .reason(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">                .body(response.getResult(), StandardCharsets.UTF_8)</span><br><span class="line">                .headers(<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h3 id="4-é…ç½®-Feign-ä½¿ç”¨è‡ªå®šä¹‰-Client"   >          <a href="#4-é…ç½®-Feign-ä½¿ç”¨è‡ªå®šä¹‰-Client" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-é…ç½®-Feign-ä½¿ç”¨è‡ªå®šä¹‰-Client" class="headerlink" title="4. é…ç½® Feign ä½¿ç”¨è‡ªå®šä¹‰ Client"></a>4. é…ç½® Feign ä½¿ç”¨è‡ªå®šä¹‰ Client</h3>      <p>åœ¨ Spring Boot ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æˆ–ç¼–ç¨‹æ–¹å¼æŒ‡å®šè‡ªå®šä¹‰çš„ <code>Client</code> å®ç°ã€‚</p><ul><li><p><strong>ç¼–ç¨‹æ–¹å¼</strong>ï¼š</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Client <span class="title function_">feignClient</span><span class="params">(Web3j web3j)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Web3jClient</span>(web3j);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li><li><p><strong>é…ç½®æ–‡ä»¶æ–¹å¼</strong>ï¼š</p><p>å¦‚æœä½ æœ‰å¤šä¸ªä¸åŒçš„å®¢æˆ·ç«¯é…ç½®ï¼Œå¯ä»¥åœ¨ <code>application.yml</code> ä¸­è¿›è¡Œé…ç½®ã€‚</p><figure class="highlight yaml"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">blockchain-client:</span></span><br><span class="line">        <span class="attr">client:</span> <span class="string">com.example.Web3jClient</span></span><br></pre></td></tr></table></div></figure></li></ul>        <h3 id="5-å¤„ç†å¤æ‚åœºæ™¯"   >          <a href="#5-å¤„ç†å¤æ‚åœºæ™¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-å¤„ç†å¤æ‚åœºæ™¯" class="headerlink" title="5. å¤„ç†å¤æ‚åœºæ™¯"></a>5. å¤„ç†å¤æ‚åœºæ™¯</h3>      <p>å¯¹äºæ›´å¤æ‚çš„åœºæ™¯ï¼Œæ¯”å¦‚åŒºå—é“¾ä¸­çš„ P2P é€šä¿¡æˆ–è€…æ™ºèƒ½åˆçº¦è°ƒç”¨ï¼Œä½ å¯èƒ½éœ€è¦è¿›ä¸€æ­¥å®šåˆ¶åŒ– Feign çš„è¡Œä¸ºã€‚è¿™åŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li><p><strong>ç¼–ç å™¨ä¸è§£ç å™¨</strong>ï¼šæ ¹æ®å…·ä½“åè®®çš„è¦æ±‚ï¼Œç¼–å†™è‡ªå®šä¹‰çš„ <code>Encoder</code> å’Œ <code>Decoder</code> æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¯·æ±‚å’Œå“åº”æ•°æ®ã€‚</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Encoder <span class="title function_">feignEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomBlockchainEncoder</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Decoder <span class="title function_">feignDecoder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomBlockchainDecoder</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li><li><p><strong>æ‹¦æˆªå™¨</strong>ï¼šä½¿ç”¨ <code>RequestInterceptor</code> æ¥æ·»åŠ å¿…è¦çš„å¤´ä¿¡æ¯æˆ–è€…å…¶ä»–é¢„å¤„ç†é€»è¾‘ã€‚</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RequestInterceptor <span class="title function_">customRequestInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> template -&gt; &#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ å¿…è¦çš„é¢„å¤„ç†é€»è¾‘</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li><li><p><strong>é”™è¯¯å¤„ç†å™¨</strong>ï¼šå®ç°è‡ªå®šä¹‰çš„ <code>ErrorDecoder</code> æ¥å¤„ç†ä¸åŒç±»å‹çš„é”™è¯¯å“åº”ã€‚</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ErrorDecoder <span class="title function_">errorDecoder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomBlockchainErrorDecoder</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li></ul>        <h3 id="6-æµ‹è¯•ä¸è°ƒè¯•"   >          <a href="#6-æµ‹è¯•ä¸è°ƒè¯•" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-æµ‹è¯•ä¸è°ƒè¯•" class="headerlink" title="6. æµ‹è¯•ä¸è°ƒè¯•"></a>6. æµ‹è¯•ä¸è°ƒè¯•</h3>      <p>å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œç¡®ä¿å¯¹ä½ çš„ Feign å®¢æˆ·ç«¯è¿›è¡Œå…¨é¢çš„æµ‹è¯•ï¼Œä»¥éªŒè¯å®ƒæ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°ä¸åŒºå—é“¾èŠ‚ç‚¹è¿›è¡Œäº¤äº’ï¼Œå¹¶å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µã€‚</p>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3>      <p>è™½ç„¶ Feign ä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ– HTTP è¯·æ±‚è€Œè®¾è®¡çš„ï¼Œä½†é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰çš„ <code>Client</code> å®ç°ï¼Œä½ å¯ä»¥ä½¿å…¶é€‚åº”å…¶ä»–åè®®çš„éœ€æ±‚ã€‚å…³é”®åœ¨äºç†è§£ Feign çš„æ’ä»¶åŒ–æ¶æ„ï¼Œå¹¶åˆ©ç”¨å…¶æä¾›çš„æ‰©å±•ç‚¹æ¥æ’å…¥é€‚åˆç‰¹å®šåè®®çš„å®ç°ã€‚è¿™æ ·ï¼Œå³ä½¿åœ¨é HTTP è¯·æ±‚çš„åœºæ™¯ä¸‹ï¼Œå¦‚åŒºå—é“¾æ™ºèƒ½åˆçº¦è°ƒç”¨ï¼Œä½ ä¹Ÿèƒ½äº«å—åˆ° Feign å¸¦æ¥çš„ä¾¿æ·æ€§å’Œä¸€è‡´æ€§ã€‚</p>]]></content>
    
    
    <summary type="html">Feignå®šåˆ¶åŒ–å¼€å‘æŒ‡å—</summary>
    
    
    
    <category term="Java" scheme="https://ljd0620.github.io/categories/Java/"/>
    
    
    <category term="å¾®æœåŠ¡" scheme="https://ljd0620.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="Feign" scheme="https://ljd0620.github.io/tags/Feign/"/>
    
  </entry>
  
  <entry>
    <title>Hystrixçš„ç†”æ–­æœºåˆ¶</title>
    <link href="https://ljd0620.github.io/2024/03/01/Hystrix%E7%9A%84%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6/"/>
    <id>https://ljd0620.github.io/2024/03/01/Hystrix%E7%9A%84%E7%86%94%E6%96%AD%E6%9C%BA%E5%88%B6/</id>
    <published>2024-03-01T04:21:36.000Z</published>
    <updated>2025-03-19T02:02:10.228Z</updated>
    
    <content type="html"><![CDATA[<p>Hystrixé€šè¿‡ç›‘æ§è¯·æ±‚çš„æˆåŠŸä¸å¤±è´¥æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´ç†”æ–­å™¨çš„çŠ¶æ€ã€‚ä»¥ä¸‹æ˜¯Hystrixç†”æ–­å™¨å…³é—­çš„å…·ä½“æ¡ä»¶å’Œæœºåˆ¶ï¼š</p><hr>        <h3 id="1-ç†”æ–­å™¨çš„ä¸‰ç§çŠ¶æ€"   >          <a href="#1-ç†”æ–­å™¨çš„ä¸‰ç§çŠ¶æ€" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ç†”æ–­å™¨çš„ä¸‰ç§çŠ¶æ€" class="headerlink" title="1. ç†”æ–­å™¨çš„ä¸‰ç§çŠ¶æ€"></a><strong>1. ç†”æ–­å™¨çš„ä¸‰ç§çŠ¶æ€</strong></h3>      <p>Hystrixç†”æ–­å™¨æœ‰ä¸‰ç§çŠ¶æ€ï¼š</p><ol><li><p><strong>Closedï¼ˆå…³é—­çŠ¶æ€ï¼‰</strong>ï¼š</p><ul><li>é»˜è®¤çŠ¶æ€ï¼Œå…è®¸è¯·æ±‚é€šè¿‡ã€‚</li><li>Hystrixä¼šç»Ÿè®¡è¯·æ±‚çš„æˆåŠŸä¸å¤±è´¥æƒ…å†µã€‚</li></ul></li><li><p><strong>Openï¼ˆæ‰“å¼€çŠ¶æ€ï¼‰</strong>ï¼š</p><ul><li>å½“å¤±è´¥ç‡è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œç†”æ–­å™¨ä¼šè¿›å…¥æ‰“å¼€çŠ¶æ€ã€‚</li><li>åœ¨æ‰“å¼€çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«å¿«é€Ÿå¤±è´¥ï¼ˆç›´æ¥è°ƒç”¨é™çº§é€»è¾‘ï¼‰ï¼Œä¸ä¼šå°è¯•æ‰§è¡Œå®é™…é€»è¾‘ã€‚</li></ul></li><li><p><strong>Half-Openï¼ˆåŠå¼€çŠ¶æ€ï¼‰</strong>ï¼š</p><ul><li>ç†”æ–­å™¨åœ¨æ‰“å¼€çŠ¶æ€ä¸€æ®µæ—¶é—´åï¼Œä¼šå°è¯•è¿›å…¥åŠå¼€çŠ¶æ€ã€‚</li><li>åœ¨åŠå¼€çŠ¶æ€ä¸‹ï¼Œå…è®¸éƒ¨åˆ†è¯·æ±‚é€šè¿‡ï¼Œç”¨äºæ£€æµ‹åç«¯æœåŠ¡æ˜¯å¦æ¢å¤ã€‚</li></ul></li></ol><hr>        <h3 id="2-ç†”æ–­å™¨å…³é—­çš„æ¡ä»¶"   >          <a href="#2-ç†”æ–­å™¨å…³é—­çš„æ¡ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ç†”æ–­å™¨å…³é—­çš„æ¡ä»¶" class="headerlink" title="2. ç†”æ–­å™¨å…³é—­çš„æ¡ä»¶"></a><strong>2. ç†”æ–­å™¨å…³é—­çš„æ¡ä»¶</strong></h3>      <p>ç†”æ–­å™¨ä»<strong>OpençŠ¶æ€</strong>åˆ‡æ¢åˆ°<strong>ClosedçŠ¶æ€</strong>çš„æ¡ä»¶å¦‚ä¸‹ï¼š</p><ol><li><p><strong>æ—¶é—´çª—å£åˆ°æœŸ</strong>ï¼š</p><ul><li>ç†”æ–­å™¨åœ¨æ‰“å¼€çŠ¶æ€åä¼šä¿æŒä¸€æ®µæ—¶é—´ï¼ˆé»˜è®¤5ç§’ï¼‰ï¼Œè¿™æ®µæ—¶é—´å†…æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«å¿«é€Ÿå¤±è´¥ã€‚</li><li>å½“æ—¶é—´çª—å£åˆ°æœŸåï¼Œç†”æ–­å™¨ä¼šè¿›å…¥åŠå¼€çŠ¶æ€ã€‚</li></ul></li><li><p><strong>åŠå¼€çŠ¶æ€ä¸‹çš„è¯·æ±‚æˆåŠŸ</strong>ï¼š</p><ul><li>åœ¨åŠå¼€çŠ¶æ€ä¸‹ï¼ŒHystrixä¼šå…è®¸éƒ¨åˆ†è¯·æ±‚é€šè¿‡ï¼ˆé»˜è®¤æ˜¯1ä¸ªè¯·æ±‚ï¼‰ã€‚</li><li>å¦‚æœè¿™äº›è¯·æ±‚æˆåŠŸï¼Œç†”æ–­å™¨ä¼šè®¤ä¸ºåç«¯æœåŠ¡å·²æ¢å¤ï¼Œä»è€Œå…³é—­ç†”æ–­å™¨ï¼Œè¿›å…¥ClosedçŠ¶æ€ã€‚</li><li>å¦‚æœè¿™äº›è¯·æ±‚å¤±è´¥ï¼Œç†”æ–­å™¨ä¼šé‡æ–°è¿›å…¥OpençŠ¶æ€ï¼Œå¹¶ç»§ç»­ç­‰å¾…ä¸‹ä¸€ä¸ªæ—¶é—´çª—å£ã€‚</li></ul></li></ol><hr>        <h3 id="3-ç›¸å…³é…ç½®å‚æ•°"   >          <a href="#3-ç›¸å…³é…ç½®å‚æ•°" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ç›¸å…³é…ç½®å‚æ•°" class="headerlink" title="3. ç›¸å…³é…ç½®å‚æ•°"></a><strong>3. ç›¸å…³é…ç½®å‚æ•°</strong></h3>      <p>Hystrixç†”æ–­å™¨çš„è¡Œä¸ºå¯ä»¥é€šè¿‡ä»¥ä¸‹å‚æ•°è¿›è¡Œé…ç½®ï¼š</p><ul><li><strong><code>circuitBreaker.enabled</code></strong>ï¼šæ˜¯å¦å¯ç”¨ç†”æ–­å™¨ï¼ˆé»˜è®¤<code>true</code>ï¼‰ã€‚</li><li><strong><code>circuitBreaker.requestVolumeThreshold</code></strong>ï¼šåœ¨æ—¶é—´çª—å£å†…è§¦å‘ç†”æ–­çš„æœ€å°è¯·æ±‚æ•°ï¼ˆé»˜è®¤20ï¼‰ã€‚</li><li><strong><code>circuitBreaker.errorThresholdPercentage</code></strong>ï¼šè§¦å‘ç†”æ–­çš„å¤±è´¥ç‡é˜ˆå€¼ï¼ˆé»˜è®¤50%ï¼Œå³50%çš„è¯·æ±‚å¤±è´¥ä¼šè§¦å‘ç†”æ–­ï¼‰ã€‚</li><li><strong><code>circuitBreaker.sleepWindowInMilliseconds</code></strong>ï¼šç†”æ–­å™¨æ‰“å¼€åè¿›å…¥åŠå¼€çŠ¶æ€çš„æ—¶é—´çª—å£ï¼ˆé»˜è®¤5000æ¯«ç§’ï¼‰ã€‚</li><li><strong><code>circuitBreaker.forceClosed</code></strong>ï¼šå¼ºåˆ¶å…³é—­ç†”æ–­å™¨ï¼ˆé»˜è®¤<code>false</code>ï¼‰ã€‚</li><li><strong><code>circuitBreaker.forceOpen</code></strong>ï¼šå¼ºåˆ¶æ‰“å¼€ç†”æ–­å™¨ï¼ˆé»˜è®¤<code>false</code>ï¼‰ã€‚</li></ul><hr>        <h3 id="4-ç†”æ–­å™¨å…³é—­çš„æµç¨‹"   >          <a href="#4-ç†”æ–­å™¨å…³é—­çš„æµç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-ç†”æ–­å™¨å…³é—­çš„æµç¨‹" class="headerlink" title="4. ç†”æ–­å™¨å…³é—­çš„æµç¨‹"></a><strong>4. ç†”æ–­å™¨å…³é—­çš„æµç¨‹</strong></h3>      <p>ä»¥ä¸‹æ˜¯ç†”æ–­å™¨å…³é—­çš„å…·ä½“æµç¨‹ï¼š</p><ol><li><p><strong>ç†”æ–­å™¨æ‰“å¼€</strong>ï¼š</p><ul><li>å½“å¤±è´¥ç‡è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œç†”æ–­å™¨è¿›å…¥OpençŠ¶æ€ï¼Œæ‰€æœ‰è¯·æ±‚å¿«é€Ÿå¤±è´¥ã€‚</li></ul></li><li><p><strong>æ—¶é—´çª—å£åˆ°æœŸ</strong>ï¼š</p><ul><li>ç»è¿‡<code>sleepWindowInMilliseconds</code>æ—¶é—´åï¼Œç†”æ–­å™¨è¿›å…¥Half-OpençŠ¶æ€ã€‚</li></ul></li><li><p><strong>å°è¯•è¯·æ±‚</strong>ï¼š</p><ul><li>åœ¨åŠå¼€çŠ¶æ€ä¸‹ï¼Œå…è®¸éƒ¨åˆ†è¯·æ±‚é€šè¿‡ï¼Œæ‰§è¡Œå®é™…é€»è¾‘ã€‚</li></ul></li><li><p><strong>åˆ¤æ–­è¯·æ±‚ç»“æœ</strong>ï¼š</p><ul><li>å¦‚æœè¯·æ±‚æˆåŠŸï¼Œç†”æ–­å™¨å…³é—­ï¼Œè¿›å…¥ClosedçŠ¶æ€ã€‚</li><li>å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œç†”æ–­å™¨é‡æ–°è¿›å…¥OpençŠ¶æ€ã€‚</li></ul></li></ol><hr>        <h3 id="5-ç¤ºä¾‹"   >          <a href="#5-ç¤ºä¾‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-ç¤ºä¾‹" class="headerlink" title="5. ç¤ºä¾‹"></a><strong>5. ç¤ºä¾‹</strong></h3>      <p>å‡è®¾é…ç½®å¦‚ä¸‹ï¼š</p><ul><li><code>circuitBreaker.requestVolumeThreshold = 20</code></li><li><code>circuitBreaker.errorThresholdPercentage = 50</code></li><li><code>circuitBreaker.sleepWindowInMilliseconds = 5000</code></li></ul><p><strong>æµç¨‹</strong>ï¼š</p><ol><li>åœ¨æ—¶é—´çª—å£å†…ï¼Œå¦‚æœè¯·æ±‚æ•°è¾¾åˆ°20ï¼Œä¸”å¤±è´¥ç‡è¶…è¿‡50%ï¼Œç†”æ–­å™¨æ‰“å¼€ã€‚</li><li>ç†”æ–­å™¨ä¿æŒæ‰“å¼€çŠ¶æ€5ç§’ï¼ŒæœŸé—´æ‰€æœ‰è¯·æ±‚å¿«é€Ÿå¤±è´¥ã€‚</li><li>5ç§’åï¼Œç†”æ–­å™¨è¿›å…¥åŠå¼€çŠ¶æ€ï¼Œå…è®¸1ä¸ªè¯·æ±‚é€šè¿‡ã€‚</li><li>å¦‚æœè¯¥è¯·æ±‚æˆåŠŸï¼Œç†”æ–­å™¨å…³é—­ï¼›å¦‚æœå¤±è´¥ï¼Œç†”æ–­å™¨é‡æ–°æ‰“å¼€ã€‚</li></ol><hr>        <h3 id="6-æ³¨æ„äº‹é¡¹"   >          <a href="#6-æ³¨æ„äº‹é¡¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-æ³¨æ„äº‹é¡¹" class="headerlink" title="6. æ³¨æ„äº‹é¡¹"></a><strong>6. æ³¨æ„äº‹é¡¹</strong></h3>      <ul><li><strong>ç†”æ–­å™¨çš„ç›®çš„æ˜¯ä¿æŠ¤ç³»ç»Ÿ</strong>ï¼šé¿å…å› åç«¯æœåŠ¡ä¸å¯ç”¨å¯¼è‡´ç³»ç»Ÿé›ªå´©ã€‚</li><li><strong>åˆç†é…ç½®å‚æ•°</strong>ï¼šæ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯è°ƒæ•´ç†”æ–­å™¨çš„å‚æ•°ï¼Œé¿å…è¿‡äºæ•æ„Ÿæˆ–è¿Ÿé’ã€‚</li><li><strong>ç»“åˆé™çº§é€»è¾‘</strong>ï¼šåœ¨ç†”æ–­å™¨æ‰“å¼€æ—¶ï¼Œæä¾›åˆç†çš„é™çº§é€»è¾‘ï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒã€‚</li></ul><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <p>Hystrixç†”æ–­å™¨åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¼šå…³é—­ï¼š</p><ol><li>ç†”æ–­å™¨è¿›å…¥åŠå¼€çŠ¶æ€åï¼Œå…è®¸çš„è¯·æ±‚æˆåŠŸæ‰§è¡Œã€‚</li><li>ç†”æ–­å™¨çš„æ—¶é—´çª—å£åˆ°æœŸï¼Œä¸”åç«¯æœåŠ¡æ¢å¤æ­£å¸¸ã€‚</li></ol><p>é€šè¿‡åˆç†é…ç½®ç†”æ–­å™¨å‚æ•°ï¼Œå¯ä»¥ç¡®ä¿ç³»ç»Ÿåœ¨é«˜å¹¶å‘æˆ–åç«¯æœåŠ¡ä¸ç¨³å®šçš„æƒ…å†µä¸‹ä»èƒ½ä¿æŒç¨³å®šè¿è¡Œã€‚</p>]]></content>
    
    
    <summary type="html">Hystrixçš„ç†”æ–­æœºåˆ¶</summary>
    
    
    
    <category term="Java" scheme="https://ljd0620.github.io/categories/Java/"/>
    
    
    <category term="å¾®æœåŠ¡" scheme="https://ljd0620.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="Hystrix" scheme="https://ljd0620.github.io/tags/Hystrix/"/>
    
    <category term="ç†”æ–­é™çº§" scheme="https://ljd0620.github.io/tags/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7/"/>
    
  </entry>
  
  <entry>
    <title>Feignçš„å·¥ä½œåŸç†</title>
    <link href="https://ljd0620.github.io/2024/01/18/Feign%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/"/>
    <id>https://ljd0620.github.io/2024/01/18/Feign%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</id>
    <published>2024-01-18T04:19:02.000Z</published>
    <updated>2025-03-19T02:02:03.473Z</updated>
    
    <content type="html"><![CDATA[<p>Feign æ˜¯ Netflix å¼€æºçš„ä¸€ä¸ªå£°æ˜å¼çš„ HTTP å®¢æˆ·ç«¯ï¼Œæ—¨åœ¨ç®€åŒ– HTTP API çš„è°ƒç”¨ã€‚å®ƒé€šè¿‡æ³¨è§£å’Œæ¥å£å®šä¹‰çš„æ–¹å¼ï¼Œè®©å¼€å‘è€…å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡ã€‚Feign çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>å°† HTTP è¯·æ±‚æŠ½è±¡ä¸º Java æ¥å£</strong>ï¼Œä»è€Œéšè—äº†åº•å±‚çš„ HTTP é€šä¿¡ç»†èŠ‚ã€‚ä»¥ä¸‹æ˜¯ Feign çš„å·¥ä½œåŸç†åŠå…¶æ ¸å¿ƒæœºåˆ¶çš„è¯¦ç»†è§£æï¼š</p><hr>        <h3 id="1-Feign-çš„æ ¸å¿ƒç‰¹ç‚¹"   >          <a href="#1-Feign-çš„æ ¸å¿ƒç‰¹ç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-Feign-çš„æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="1. Feign çš„æ ¸å¿ƒç‰¹ç‚¹"></a><strong>1. Feign çš„æ ¸å¿ƒç‰¹ç‚¹</strong></h3>      <ul><li><strong>å£°æ˜å¼ API</strong>ï¼šé€šè¿‡ Java æ¥å£å’Œæ³¨è§£å®šä¹‰ HTTP è¯·æ±‚ã€‚</li><li><strong>é›†æˆ Ribbon</strong>ï¼šæ”¯æŒå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‚</li><li><strong>é›†æˆ Hystrix</strong>ï¼šæ”¯æŒç†”æ–­å’Œé™çº§ã€‚</li><li><strong>æ˜“äºæ‰©å±•</strong>ï¼šæ”¯æŒè‡ªå®šä¹‰ç¼–ç å™¨ã€è§£ç å™¨ã€æ‹¦æˆªå™¨ç­‰ã€‚</li></ul><hr>        <h3 id="2-Feign-çš„å·¥ä½œåŸç†"   >          <a href="#2-Feign-çš„å·¥ä½œåŸç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Feign-çš„å·¥ä½œåŸç†" class="headerlink" title="2. Feign çš„å·¥ä½œåŸç†"></a><strong>2. Feign çš„å·¥ä½œåŸç†</strong></h3>      <p>Feign çš„å·¥ä½œåŸç†å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>        <h4 id="1-å®šä¹‰æ¥å£"   >          <a href="#1-å®šä¹‰æ¥å£" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å®šä¹‰æ¥å£" class="headerlink" title="(1) å®šä¹‰æ¥å£"></a><strong>(1) å®šä¹‰æ¥å£</strong></h4>      <p>å¼€å‘è€…é€šè¿‡ Java æ¥å£å®šä¹‰ HTTP è¯·æ±‚ï¼Œä½¿ç”¨æ³¨è§£æè¿°è¯·æ±‚çš„ç»†èŠ‚ï¼ˆå¦‚ URLã€HTTP æ–¹æ³•ã€å‚æ•°ç­‰ï¼‰ã€‚</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(name = &quot;user-service&quot;, url = &quot;http://localhost:8080&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserServiceClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/users&quot;)</span></span><br><span class="line">    User <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="2-åŠ¨æ€ä»£ç†"   >          <a href="#2-åŠ¨æ€ä»£ç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-åŠ¨æ€ä»£ç†" class="headerlink" title="(2) åŠ¨æ€ä»£ç†"></a><strong>(2) åŠ¨æ€ä»£ç†</strong></h4>      <p>Feign åœ¨è¿è¡Œæ—¶é€šè¿‡ <strong>JDK åŠ¨æ€ä»£ç†</strong> æˆ– <strong>CGLIB</strong> ä¸ºæ¥å£ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚å½“è°ƒç”¨æ¥å£æ–¹æ³•æ—¶ï¼Œä»£ç†å¯¹è±¡ä¼šæ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œå¹¶æ ¹æ®æ³¨è§£ç”Ÿæˆ HTTP è¯·æ±‚ã€‚</p>        <h4 id="3-è§£ææ³¨è§£"   >          <a href="#3-è§£ææ³¨è§£" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-è§£ææ³¨è§£" class="headerlink" title="(3) è§£ææ³¨è§£"></a><strong>(3) è§£ææ³¨è§£</strong></h4>      <p>Feign è§£ææ¥å£æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼ˆå¦‚ <code>@GetMapping</code>ã€<code>@PostMapping</code>ã€<code>@PathVariable</code> ç­‰ï¼‰ï¼Œç”Ÿæˆ HTTP è¯·æ±‚çš„ URLã€æ–¹æ³•ã€å‚æ•°ç­‰ä¿¡æ¯ã€‚</p>        <h4 id="4-ç¼–ç è¯·æ±‚"   >          <a href="#4-ç¼–ç è¯·æ±‚" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-ç¼–ç è¯·æ±‚" class="headerlink" title="(4) ç¼–ç è¯·æ±‚"></a><strong>(4) ç¼–ç è¯·æ±‚</strong></h4>      <p>Feign ä½¿ç”¨ <strong>ç¼–ç å™¨ï¼ˆEncoderï¼‰</strong> å°† Java å¯¹è±¡è½¬æ¢ä¸º HTTP è¯·æ±‚ä½“ï¼ˆå¦‚ JSONã€XML ç­‰ï¼‰ã€‚</p>        <h4 id="5-å‘é€è¯·æ±‚"   >          <a href="#5-å‘é€è¯·æ±‚" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-å‘é€è¯·æ±‚" class="headerlink" title="(5) å‘é€è¯·æ±‚"></a><strong>(5) å‘é€è¯·æ±‚</strong></h4>      <p>Feign ä½¿ç”¨åº•å±‚çš„ HTTP å®¢æˆ·ç«¯ï¼ˆå¦‚ <code>java.net.HttpURLConnection</code>ã€<code>OkHttp</code>ã€<code>Apache HttpClient</code> ç­‰ï¼‰å‘é€ HTTP è¯·æ±‚ã€‚</p>        <h4 id="6-è§£ç å“åº”"   >          <a href="#6-è§£ç å“åº”" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-è§£ç å“åº”" class="headerlink" title="(6) è§£ç å“åº”"></a><strong>(6) è§£ç å“åº”</strong></h4>      <p>Feign ä½¿ç”¨ <strong>è§£ç å™¨ï¼ˆDecoderï¼‰</strong> å°† HTTP å“åº”ä½“ï¼ˆå¦‚ JSONã€XML ç­‰ï¼‰è½¬æ¢ä¸º Java å¯¹è±¡ã€‚</p>        <h4 id="7-è¿”å›ç»“æœ"   >          <a href="#7-è¿”å›ç»“æœ" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-è¿”å›ç»“æœ" class="headerlink" title="(7) è¿”å›ç»“æœ"></a><strong>(7) è¿”å›ç»“æœ</strong></h4>      <p>å°†è§£ç åçš„ç»“æœè¿”å›ç»™è°ƒç”¨æ–¹ã€‚</p><hr>        <h3 id="3-Feign-çš„æ ¸å¿ƒç»„ä»¶"   >          <a href="#3-Feign-çš„æ ¸å¿ƒç»„ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-Feign-çš„æ ¸å¿ƒç»„ä»¶" class="headerlink" title="3. Feign çš„æ ¸å¿ƒç»„ä»¶"></a><strong>3. Feign çš„æ ¸å¿ƒç»„ä»¶</strong></h3>      <p>Feign çš„æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š</p>        <h4 id="1-æ³¨è§£å¤„ç†å™¨"   >          <a href="#1-æ³¨è§£å¤„ç†å™¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ³¨è§£å¤„ç†å™¨" class="headerlink" title="(1) æ³¨è§£å¤„ç†å™¨"></a><strong>(1) æ³¨è§£å¤„ç†å™¨</strong></h4>      <ul><li>è´Ÿè´£è§£ææ¥å£æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼ˆå¦‚ <code>@RequestLine</code>ã€<code>@Param</code>ã€<code>@Headers</code> ç­‰ï¼‰ã€‚</li><li>ç”Ÿæˆ HTTP è¯·æ±‚çš„å…ƒæ•°æ®ï¼ˆå¦‚ URLã€æ–¹æ³•ã€å‚æ•°ç­‰ï¼‰ã€‚</li></ul>        <h4 id="2-åŠ¨æ€ä»£ç†-1"   >          <a href="#2-åŠ¨æ€ä»£ç†-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-åŠ¨æ€ä»£ç†-1" class="headerlink" title="(2) åŠ¨æ€ä»£ç†"></a><strong>(2) åŠ¨æ€ä»£ç†</strong></h4>      <ul><li>é€šè¿‡ JDK åŠ¨æ€ä»£ç†æˆ– CGLIB ç”Ÿæˆæ¥å£çš„ä»£ç†å¯¹è±¡ã€‚</li><li>æ‹¦æˆªæ–¹æ³•è°ƒç”¨å¹¶è§¦å‘ HTTP è¯·æ±‚ã€‚</li></ul>        <h4 id="3-ç¼–ç å™¨ï¼ˆEncoderï¼‰"   >          <a href="#3-ç¼–ç å™¨ï¼ˆEncoderï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ç¼–ç å™¨ï¼ˆEncoderï¼‰" class="headerlink" title="(3) ç¼–ç å™¨ï¼ˆEncoderï¼‰"></a><strong>(3) ç¼–ç å™¨ï¼ˆEncoderï¼‰</strong></h4>      <ul><li>å°† Java å¯¹è±¡è½¬æ¢ä¸º HTTP è¯·æ±‚ä½“ã€‚</li><li>é»˜è®¤ä½¿ç”¨ <code>Jackson</code> æˆ– <code>Gson</code> å°†å¯¹è±¡ç¼–ç ä¸º JSONã€‚</li></ul>        <h4 id="4-è§£ç å™¨ï¼ˆDecoderï¼‰"   >          <a href="#4-è§£ç å™¨ï¼ˆDecoderï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-è§£ç å™¨ï¼ˆDecoderï¼‰" class="headerlink" title="(4) è§£ç å™¨ï¼ˆDecoderï¼‰"></a><strong>(4) è§£ç å™¨ï¼ˆDecoderï¼‰</strong></h4>      <ul><li>å°† HTTP å“åº”ä½“è½¬æ¢ä¸º Java å¯¹è±¡ã€‚</li><li>é»˜è®¤ä½¿ç”¨ <code>Jackson</code> æˆ– <code>Gson</code> å°† JSON è§£ç ä¸ºå¯¹è±¡ã€‚</li></ul>        <h4 id="5-HTTP-å®¢æˆ·ç«¯"   >          <a href="#5-HTTP-å®¢æˆ·ç«¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-HTTP-å®¢æˆ·ç«¯" class="headerlink" title="(5) HTTP å®¢æˆ·ç«¯"></a><strong>(5) HTTP å®¢æˆ·ç«¯</strong></h4>      <ul><li>è´Ÿè´£å‘é€ HTTP è¯·æ±‚ã€‚</li><li>æ”¯æŒå¤šç§åº•å±‚å®ç°ï¼ˆå¦‚ <code>java.net.HttpURLConnection</code>ã€<code>OkHttp</code>ã€<code>Apache HttpClient</code> ç­‰ï¼‰ã€‚</li></ul>        <h4 id="6-æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰"   >          <a href="#6-æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰" class="headerlink" title="(6) æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰"></a><strong>(6) æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong></h4>      <ul><li>åœ¨è¯·æ±‚å‘é€å‰æˆ–å“åº”è¿”å›åæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚</li><li>å¯ä»¥ç”¨äºæ·»åŠ è¯·æ±‚å¤´ã€è®°å½•æ—¥å¿—ç­‰ã€‚</li></ul>        <h4 id="7-è´Ÿè½½å‡è¡¡ï¼ˆRibbonï¼‰"   >          <a href="#7-è´Ÿè½½å‡è¡¡ï¼ˆRibbonï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-è´Ÿè½½å‡è¡¡ï¼ˆRibbonï¼‰" class="headerlink" title="(7) è´Ÿè½½å‡è¡¡ï¼ˆRibbonï¼‰"></a><strong>(7) è´Ÿè½½å‡è¡¡ï¼ˆRibbonï¼‰</strong></h4>      <ul><li>Feign é»˜è®¤é›†æˆ Ribbonï¼Œæ”¯æŒå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‚</li><li>æ ¹æ®æœåŠ¡åä»æ³¨å†Œä¸­å¿ƒè·å–å¯ç”¨å®ä¾‹åˆ—è¡¨ï¼Œå¹¶é€‰æ‹©å…¶ä¸­ä¸€ä¸ªå®ä¾‹å‘é€è¯·æ±‚ã€‚</li></ul>        <h4 id="8-ç†”æ–­å™¨ï¼ˆHystrixï¼‰"   >          <a href="#8-ç†”æ–­å™¨ï¼ˆHystrixï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-ç†”æ–­å™¨ï¼ˆHystrixï¼‰" class="headerlink" title="(8) ç†”æ–­å™¨ï¼ˆHystrixï¼‰"></a><strong>(8) ç†”æ–­å™¨ï¼ˆHystrixï¼‰</strong></h4>      <ul><li>Feign æ”¯æŒé›†æˆ Hystrixï¼Œæä¾›ç†”æ–­å’Œé™çº§åŠŸèƒ½ã€‚</li><li>å½“æœåŠ¡è°ƒç”¨å¤±è´¥æ—¶ï¼Œæ‰§è¡Œé™çº§é€»è¾‘ã€‚</li></ul><hr>        <h3 id="4-Feign-çš„å·¥ä½œæµç¨‹"   >          <a href="#4-Feign-çš„å·¥ä½œæµç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-Feign-çš„å·¥ä½œæµç¨‹" class="headerlink" title="4. Feign çš„å·¥ä½œæµç¨‹"></a><strong>4. Feign çš„å·¥ä½œæµç¨‹</strong></h3>      <p>ä»¥ä¸‹æ˜¯ Feign çš„å·¥ä½œæµç¨‹ï¼š</p><ol><li><strong>å®šä¹‰æ¥å£</strong>ï¼šå¼€å‘è€…é€šè¿‡ Java æ¥å£å®šä¹‰ HTTP è¯·æ±‚ã€‚</li><li><strong>ç”Ÿæˆä»£ç†</strong>ï¼šFeign åœ¨è¿è¡Œæ—¶ä¸ºæ¥å£ç”Ÿæˆä»£ç†å¯¹è±¡ã€‚</li><li><strong>è§£ææ³¨è§£</strong>ï¼šä»£ç†å¯¹è±¡è§£ææ–¹æ³•ä¸Šçš„æ³¨è§£ï¼Œç”Ÿæˆ HTTP è¯·æ±‚å…ƒæ•°æ®ã€‚</li><li><strong>ç¼–ç è¯·æ±‚</strong>ï¼šä½¿ç”¨ç¼–ç å™¨å°† Java å¯¹è±¡è½¬æ¢ä¸º HTTP è¯·æ±‚ä½“ã€‚</li><li><strong>å‘é€è¯·æ±‚</strong>ï¼šé€šè¿‡ HTTP å®¢æˆ·ç«¯å‘é€è¯·æ±‚ã€‚</li><li><strong>è§£ç å“åº”</strong>ï¼šä½¿ç”¨è§£ç å™¨å°† HTTP å“åº”ä½“è½¬æ¢ä¸º Java å¯¹è±¡ã€‚</li><li><strong>è¿”å›ç»“æœ</strong>ï¼šå°†ç»“æœè¿”å›ç»™è°ƒç”¨æ–¹ã€‚</li></ol><hr>        <h3 id="5-Feign-çš„é›†æˆä¸æ‰©å±•"   >          <a href="#5-Feign-çš„é›†æˆä¸æ‰©å±•" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-Feign-çš„é›†æˆä¸æ‰©å±•" class="headerlink" title="5. Feign çš„é›†æˆä¸æ‰©å±•"></a><strong>5. Feign çš„é›†æˆä¸æ‰©å±•</strong></h3>              <h4 id="1-é›†æˆ-Spring-Cloud"   >          <a href="#1-é›†æˆ-Spring-Cloud" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-é›†æˆ-Spring-Cloud" class="headerlink" title="(1) é›†æˆ Spring Cloud"></a><strong>(1) é›†æˆ Spring Cloud</strong></h4>      <ul><li>åœ¨ Spring Cloud ä¸­ï¼ŒFeign è¢«æ·±åº¦é›†æˆï¼Œæ”¯æŒè‡ªåŠ¨é…ç½®å’ŒæœåŠ¡å‘ç°ã€‚</li><li>é€šè¿‡ <code>@EnableFeignClients</code> æ³¨è§£å¯ç”¨ Feign å®¢æˆ·ç«¯ã€‚</li></ul>        <h4 id="2-è‡ªå®šä¹‰ç¼–ç å™¨å’Œè§£ç å™¨"   >          <a href="#2-è‡ªå®šä¹‰ç¼–ç å™¨å’Œè§£ç å™¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-è‡ªå®šä¹‰ç¼–ç å™¨å’Œè§£ç å™¨" class="headerlink" title="(2) è‡ªå®šä¹‰ç¼–ç å™¨å’Œè§£ç å™¨"></a><strong>(2) è‡ªå®šä¹‰ç¼–ç å™¨å’Œè§£ç å™¨</strong></h4>      <ul><li>å¯ä»¥é€šè¿‡å®ç° <code>Encoder</code> å’Œ <code>Decoder</code> æ¥å£è‡ªå®šä¹‰ç¼–ç å™¨å’Œè§£ç å™¨ã€‚</li></ul>        <h4 id="3-è‡ªå®šä¹‰æ‹¦æˆªå™¨"   >          <a href="#3-è‡ªå®šä¹‰æ‹¦æˆªå™¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-è‡ªå®šä¹‰æ‹¦æˆªå™¨" class="headerlink" title="(3) è‡ªå®šä¹‰æ‹¦æˆªå™¨"></a><strong>(3) è‡ªå®šä¹‰æ‹¦æˆªå™¨</strong></h4>      <ul><li>å¯ä»¥é€šè¿‡å®ç° <code>RequestInterceptor</code> æ¥å£è‡ªå®šä¹‰æ‹¦æˆªå™¨ã€‚</li></ul>        <h4 id="4-æ—¥å¿—é…ç½®"   >          <a href="#4-æ—¥å¿—é…ç½®" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-æ—¥å¿—é…ç½®" class="headerlink" title="(4) æ—¥å¿—é…ç½®"></a><strong>(4) æ—¥å¿—é…ç½®</strong></h4>      <ul><li>å¯ä»¥é€šè¿‡é…ç½® <code>Logger.Level</code> æ§åˆ¶ Feign çš„æ—¥å¿—çº§åˆ«ã€‚</li></ul><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Logger.Level <span class="title function_">feignLoggerLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="6-Feign-çš„ä¼˜ç¼ºç‚¹"   >          <a href="#6-Feign-çš„ä¼˜ç¼ºç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-Feign-çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="6. Feign çš„ä¼˜ç¼ºç‚¹"></a><strong>6. Feign çš„ä¼˜ç¼ºç‚¹</strong></h3>              <h4 id="1-ä¼˜ç‚¹"   >          <a href="#1-ä¼˜ç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ä¼˜ç‚¹" class="headerlink" title="(1) ä¼˜ç‚¹"></a><strong>(1) ä¼˜ç‚¹</strong></h4>      <ul><li><strong>å£°æ˜å¼è°ƒç”¨</strong>ï¼šç®€åŒ– HTTP è¯·æ±‚çš„å®šä¹‰å’Œè°ƒç”¨ã€‚</li><li><strong>é›†æˆè´Ÿè½½å‡è¡¡</strong>ï¼šé»˜è®¤é›†æˆ Ribbonï¼Œæ”¯æŒå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‚</li><li><strong>æ”¯æŒç†”æ–­å’Œé™çº§</strong>ï¼šé›†æˆ Hystrixï¼Œæä¾›å®¹é”™èƒ½åŠ›ã€‚</li><li><strong>æ˜“äºæ‰©å±•</strong>ï¼šæ”¯æŒè‡ªå®šä¹‰ç¼–ç å™¨ã€è§£ç å™¨ã€æ‹¦æˆªå™¨ç­‰ã€‚</li></ul>        <h4 id="2-ç¼ºç‚¹"   >          <a href="#2-ç¼ºç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ç¼ºç‚¹" class="headerlink" title="(2) ç¼ºç‚¹"></a><strong>(2) ç¼ºç‚¹</strong></h4>      <ul><li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šåŠ¨æ€ä»£ç†å’Œæ³¨è§£è§£æä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚</li><li><strong>å­¦ä¹ æˆæœ¬</strong>ï¼šéœ€è¦ç†Ÿæ‚‰ Feign çš„æ³¨è§£å’Œé…ç½®ã€‚</li></ul><hr>        <h3 id="7-ç¤ºä¾‹ä»£ç "   >          <a href="#7-ç¤ºä¾‹ä»£ç " class="heading-link"><i class="fas fa-link"></i></a><a href="#7-ç¤ºä¾‹ä»£ç " class="headerlink" title="7. ç¤ºä¾‹ä»£ç "></a><strong>7. ç¤ºä¾‹ä»£ç </strong></h3>      <p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Feign ç¤ºä¾‹ï¼š</p>        <h4 id="1-å®šä¹‰æ¥å£-1"   >          <a href="#1-å®šä¹‰æ¥å£-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å®šä¹‰æ¥å£-1" class="headerlink" title="(1) å®šä¹‰æ¥å£"></a><strong>(1) å®šä¹‰æ¥å£</strong></h4>      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(name = &quot;user-service&quot;, url = &quot;http://localhost:8080&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserServiceClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/users&quot;)</span></span><br><span class="line">    User <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="2-å¯ç”¨-Feign-å®¢æˆ·ç«¯"   >          <a href="#2-å¯ç”¨-Feign-å®¢æˆ·ç«¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-å¯ç”¨-Feign-å®¢æˆ·ç«¯" class="headerlink" title="(2) å¯ç”¨ Feign å®¢æˆ·ç«¯"></a><strong>(2) å¯ç”¨ Feign å®¢æˆ·ç«¯</strong></h4>      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="3-è°ƒç”¨-Feign-å®¢æˆ·ç«¯"   >          <a href="#3-è°ƒç”¨-Feign-å®¢æˆ·ç«¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-è°ƒç”¨-Feign-å®¢æˆ·ç«¯" class="headerlink" title="(3) è°ƒç”¨ Feign å®¢æˆ·ç«¯"></a><strong>(3) è°ƒç”¨ Feign å®¢æˆ·ç«¯</strong></h4>      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserServiceClient userServiceClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userServiceClient.getUserById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">createUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userServiceClient.createUser(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <p>Feign é€šè¿‡å£°æ˜å¼ API å’ŒåŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œç®€åŒ–äº† HTTP è¯·æ±‚çš„å®šä¹‰å’Œè°ƒç”¨ã€‚å…¶æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬æ³¨è§£å¤„ç†å™¨ã€åŠ¨æ€ä»£ç†ã€ç¼–ç å™¨ã€è§£ç å™¨ã€HTTP å®¢æˆ·ç«¯ç­‰ã€‚Feign é»˜è®¤é›†æˆ Ribbon å’Œ Hystrixï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡å’Œç†”æ–­é™çº§ã€‚ç†è§£ Feign çš„å·¥ä½œåŸç†åŠå…¶æ ¸å¿ƒæœºåˆ¶ï¼Œæœ‰åŠ©äºæ›´å¥½åœ°ä½¿ç”¨å’Œæ‰©å±• Feignã€‚</p>]]></content>
    
    
    <summary type="html">Feignçš„å·¥ä½œåŸç†</summary>
    
    
    
    <category term="Java" scheme="https://ljd0620.github.io/categories/Java/"/>
    
    
    <category term="å¾®æœåŠ¡" scheme="https://ljd0620.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="Feign" scheme="https://ljd0620.github.io/tags/Feign/"/>
    
  </entry>
  
  <entry>
    <title>Hystrixçš„å·¥ä½œåŸç†</title>
    <link href="https://ljd0620.github.io/2024/01/01/Hystrix%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/"/>
    <id>https://ljd0620.github.io/2024/01/01/Hystrix%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</id>
    <published>2024-01-01T04:20:08.000Z</published>
    <updated>2025-03-19T02:02:05.851Z</updated>
    
    <content type="html"><![CDATA[<p>Hystrix æ˜¯ Netflix å¼€æºçš„ä¸€æ¬¾å®¹é”™åº“ï¼Œä¸»è¦ç”¨äºå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å»¶è¿Ÿå’Œæ•…éšœã€‚å…¶æ ¸å¿ƒç›®æ ‡æ˜¯<strong>é˜²æ­¢é›ªå´©æ•ˆåº”</strong>ï¼Œé€šè¿‡éš”ç¦»ã€ç†”æ–­ã€é™çº§ç­‰æœºåˆ¶ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨éƒ¨åˆ†æœåŠ¡ä¸å¯ç”¨æ—¶ä»èƒ½ç¨³å®šè¿è¡Œã€‚ä»¥ä¸‹æ˜¯ Hystrix çš„å·¥ä½œåŸç†åŠå…¶æ ¸å¿ƒæœºåˆ¶çš„è¯¦ç»†è§£æï¼š</p><hr>        <h3 id="1-Hystrix-çš„æ ¸å¿ƒç›®æ ‡"   >          <a href="#1-Hystrix-çš„æ ¸å¿ƒç›®æ ‡" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-Hystrix-çš„æ ¸å¿ƒç›®æ ‡" class="headerlink" title="1. Hystrix çš„æ ¸å¿ƒç›®æ ‡"></a><strong>1. Hystrix çš„æ ¸å¿ƒç›®æ ‡</strong></h3>      <p>Hystrix çš„è®¾è®¡ç›®æ ‡æ˜¯ï¼š</p><ol><li><strong>é˜²æ­¢é›ªå´©æ•ˆåº”</strong>ï¼šé€šè¿‡éš”ç¦»å’Œç†”æ–­æœºåˆ¶ï¼Œé¿å…å•ä¸ªæœåŠ¡çš„æ•…éšœå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚</li><li><strong>å¿«é€Ÿå¤±è´¥</strong>ï¼šåœ¨æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œå¿«é€Ÿè¿”å›é™çº§ç»“æœï¼Œè€Œä¸æ˜¯è®©è¯·æ±‚é•¿æ—¶é—´ç­‰å¾…ã€‚</li><li><strong>è‡ªåŠ¨æ¢å¤</strong>ï¼šå½“æœåŠ¡æ¢å¤åï¼Œè‡ªåŠ¨é‡æ–°å°è¯•è°ƒç”¨ã€‚</li></ol><hr>        <h3 id="2-Hystrix-çš„æ ¸å¿ƒæœºåˆ¶"   >          <a href="#2-Hystrix-çš„æ ¸å¿ƒæœºåˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Hystrix-çš„æ ¸å¿ƒæœºåˆ¶" class="headerlink" title="2. Hystrix çš„æ ¸å¿ƒæœºåˆ¶"></a><strong>2. Hystrix çš„æ ¸å¿ƒæœºåˆ¶</strong></h3>      <p>Hystrix é€šè¿‡ä»¥ä¸‹æ ¸å¿ƒæœºåˆ¶å®ç°å…¶ç›®æ ‡ï¼š</p>        <h4 id="1-å‘½ä»¤æ¨¡å¼ï¼ˆCommand-Patternï¼‰"   >          <a href="#1-å‘½ä»¤æ¨¡å¼ï¼ˆCommand-Patternï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å‘½ä»¤æ¨¡å¼ï¼ˆCommand-Patternï¼‰" class="headerlink" title="(1) å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰"></a><strong>(1) å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰</strong></h4>      <ul><li>Hystrix å°†æ¯ä¸ªå¤–éƒ¨è°ƒç”¨å°è£…ä¸ºä¸€ä¸ª <code>HystrixCommand</code> æˆ– <code>HystrixObservableCommand</code> å¯¹è±¡ã€‚</li><li>é€šè¿‡å‘½ä»¤æ¨¡å¼ï¼ŒHystrix å¯ä»¥å¯¹æ¯ä¸ªè°ƒç”¨è¿›è¡Œéš”ç¦»ã€ç›‘æ§å’Œæ§åˆ¶ã€‚</li></ul>        <h4 id="2-çº¿ç¨‹æ± éš”ç¦»ï¼ˆThread-Pool-Isolationï¼‰"   >          <a href="#2-çº¿ç¨‹æ± éš”ç¦»ï¼ˆThread-Pool-Isolationï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-çº¿ç¨‹æ± éš”ç¦»ï¼ˆThread-Pool-Isolationï¼‰" class="headerlink" title="(2) çº¿ç¨‹æ± éš”ç¦»ï¼ˆThread Pool Isolationï¼‰"></a><strong>(2) çº¿ç¨‹æ± éš”ç¦»ï¼ˆThread Pool Isolationï¼‰</strong></h4>      <ul><li>Hystrix ä¸ºæ¯ä¸ªä¾èµ–æœåŠ¡åˆ†é…ç‹¬ç«‹çš„çº¿ç¨‹æ± ï¼Œé¿å…æŸä¸ªæœåŠ¡çš„æ•…éšœå½±å“å…¶ä»–æœåŠ¡ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒHystrix ä½¿ç”¨çº¿ç¨‹æ± éš”ç¦»ï¼Œä½†ä¹Ÿå¯ä»¥é…ç½®ä¸ºä¿¡å·é‡éš”ç¦»ã€‚</li></ul>        <h4 id="3-ç†”æ–­å™¨ï¼ˆCircuit-Breakerï¼‰"   >          <a href="#3-ç†”æ–­å™¨ï¼ˆCircuit-Breakerï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ç†”æ–­å™¨ï¼ˆCircuit-Breakerï¼‰" class="headerlink" title="(3) ç†”æ–­å™¨ï¼ˆCircuit Breakerï¼‰"></a><strong>(3) ç†”æ–­å™¨ï¼ˆCircuit Breakerï¼‰</strong></h4>      <ul><li>Hystrix é€šè¿‡ç†”æ–­å™¨æœºåˆ¶ç›‘æ§è¯·æ±‚çš„æˆåŠŸä¸å¤±è´¥æƒ…å†µã€‚</li><li>å½“å¤±è´¥ç‡è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œç†”æ–­å™¨æ‰“å¼€ï¼Œæ‰€æœ‰è¯·æ±‚å¿«é€Ÿå¤±è´¥ã€‚</li><li>ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œç†”æ–­å™¨è¿›å…¥åŠå¼€çŠ¶æ€ï¼Œå…è®¸éƒ¨åˆ†è¯·æ±‚é€šè¿‡ä»¥æ£€æµ‹æœåŠ¡æ˜¯å¦æ¢å¤ã€‚</li></ul>        <h4 id="4-é™çº§ï¼ˆFallbackï¼‰"   >          <a href="#4-é™çº§ï¼ˆFallbackï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-é™çº§ï¼ˆFallbackï¼‰" class="headerlink" title="(4) é™çº§ï¼ˆFallbackï¼‰"></a><strong>(4) é™çº§ï¼ˆFallbackï¼‰</strong></h4>      <ul><li>å½“è¯·æ±‚å¤±è´¥æˆ–ç†”æ–­å™¨æ‰“å¼€æ—¶ï¼ŒHystrix ä¼šæ‰§è¡Œé™çº§é€»è¾‘ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤å€¼æˆ–é”™è¯¯ä¿¡æ¯ã€‚</li><li>é™çº§é€»è¾‘å¯ä»¥æ˜¯ä¸€ä¸ªé™æ€å€¼ã€ç¼“å­˜æ•°æ®æˆ–è°ƒç”¨å…¶ä»–æœåŠ¡ã€‚</li></ul>        <h4 id="5-è¯·æ±‚ç¼“å­˜ï¼ˆRequest-Cachingï¼‰"   >          <a href="#5-è¯·æ±‚ç¼“å­˜ï¼ˆRequest-Cachingï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-è¯·æ±‚ç¼“å­˜ï¼ˆRequest-Cachingï¼‰" class="headerlink" title="(5) è¯·æ±‚ç¼“å­˜ï¼ˆRequest Cachingï¼‰"></a><strong>(5) è¯·æ±‚ç¼“å­˜ï¼ˆRequest Cachingï¼‰</strong></h4>      <ul><li>Hystrix æ”¯æŒå¯¹è¯·æ±‚ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå‡å°‘é‡å¤è¯·æ±‚çš„å¼€é”€ã€‚</li><li>ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸä¸è¯·æ±‚ä¸€è‡´ï¼Œè¯·æ±‚ç»“æŸåç¼“å­˜å¤±æ•ˆã€‚</li></ul>        <h4 id="6-è¯·æ±‚åˆå¹¶ï¼ˆRequest-Collapsingï¼‰"   >          <a href="#6-è¯·æ±‚åˆå¹¶ï¼ˆRequest-Collapsingï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-è¯·æ±‚åˆå¹¶ï¼ˆRequest-Collapsingï¼‰" class="headerlink" title="(6) è¯·æ±‚åˆå¹¶ï¼ˆRequest Collapsingï¼‰"></a><strong>(6) è¯·æ±‚åˆå¹¶ï¼ˆRequest Collapsingï¼‰</strong></h4>      <ul><li>Hystrix æ”¯æŒå°†å¤šä¸ªè¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ªæ‰¹é‡è¯·æ±‚ï¼Œå‡å°‘ç½‘ç»œå¼€é”€ã€‚</li><li>é€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ã€‚</li></ul>        <h4 id="7-å®æ—¶ç›‘æ§ï¼ˆReal-time-Monitoringï¼‰"   >          <a href="#7-å®æ—¶ç›‘æ§ï¼ˆReal-time-Monitoringï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-å®æ—¶ç›‘æ§ï¼ˆReal-time-Monitoringï¼‰" class="headerlink" title="(7) å®æ—¶ç›‘æ§ï¼ˆReal-time Monitoringï¼‰"></a><strong>(7) å®æ—¶ç›‘æ§ï¼ˆReal-time Monitoringï¼‰</strong></h4>      <ul><li>Hystrix æä¾›äº†å®æ—¶çš„ç›‘æ§æ•°æ®ï¼ŒåŒ…æ‹¬è¯·æ±‚é‡ã€å¤±è´¥ç‡ã€ç†”æ–­å™¨çŠ¶æ€ç­‰ã€‚</li><li>å¯ä»¥é€šè¿‡ Hystrix Dashboard æˆ– Turbine æŸ¥çœ‹ç›‘æ§æ•°æ®ã€‚</li></ul><hr>        <h3 id="3-Hystrix-çš„å·¥ä½œæµç¨‹"   >          <a href="#3-Hystrix-çš„å·¥ä½œæµç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-Hystrix-çš„å·¥ä½œæµç¨‹" class="headerlink" title="3. Hystrix çš„å·¥ä½œæµç¨‹"></a><strong>3. Hystrix çš„å·¥ä½œæµç¨‹</strong></h3>      <p>ä»¥ä¸‹æ˜¯ Hystrix çš„å·¥ä½œæµç¨‹ï¼š</p><ol><li><p><strong>å°è£…è¯·æ±‚</strong>ï¼š</p><ul><li>å°†æ¯ä¸ªå¤–éƒ¨è°ƒç”¨å°è£…ä¸º <code>HystrixCommand</code> æˆ– <code>HystrixObservableCommand</code>ã€‚</li></ul></li><li><p><strong>æ£€æŸ¥ç†”æ–­å™¨çŠ¶æ€</strong>ï¼š</p><ul><li>å¦‚æœç†”æ–­å™¨æ‰“å¼€ï¼Œç›´æ¥æ‰§è¡Œé™çº§é€»è¾‘ã€‚</li><li>å¦‚æœç†”æ–­å™¨å…³é—­ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚</li></ul></li><li><p><strong>æ£€æŸ¥çº¿ç¨‹æ± &#x2F;ä¿¡å·é‡èµ„æº</strong>ï¼š</p><ul><li>å¦‚æœçº¿ç¨‹æ± æˆ–ä¿¡å·é‡èµ„æºå·²æ»¡ï¼Œæ‹’ç»è¯·æ±‚å¹¶æ‰§è¡Œé™çº§é€»è¾‘ã€‚</li><li>å¦‚æœèµ„æºå¯ç”¨ï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚</li></ul></li><li><p><strong>æ‰§è¡Œè¯·æ±‚</strong>ï¼š</p><ul><li>è°ƒç”¨å¤–éƒ¨æœåŠ¡ï¼Œè·å–ç»“æœã€‚</li></ul></li><li><p><strong>ç»Ÿè®¡è¯·æ±‚ç»“æœ</strong>ï¼š</p><ul><li>æ ¹æ®è¯·æ±‚çš„æˆåŠŸä¸å¤±è´¥æƒ…å†µï¼Œæ›´æ–°ç†”æ–­å™¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</li></ul></li><li><p><strong>è¿”å›ç»“æœæˆ–é™çº§</strong>ï¼š</p><ul><li>å¦‚æœè¯·æ±‚æˆåŠŸï¼Œè¿”å›ç»“æœã€‚</li><li>å¦‚æœè¯·æ±‚å¤±è´¥æˆ–è¶…æ—¶ï¼Œæ‰§è¡Œé™çº§é€»è¾‘ã€‚</li></ul></li><li><p><strong>æ›´æ–°ç†”æ–­å™¨çŠ¶æ€</strong>ï¼š</p><ul><li>æ ¹æ®ç»Ÿè®¡ä¿¡æ¯ï¼Œå†³å®šæ˜¯å¦æ‰“å¼€æˆ–å…³é—­ç†”æ–­å™¨ã€‚</li></ul></li></ol><hr>        <h3 id="4-Hystrix-çš„æ ¸å¿ƒé…ç½®"   >          <a href="#4-Hystrix-çš„æ ¸å¿ƒé…ç½®" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-Hystrix-çš„æ ¸å¿ƒé…ç½®" class="headerlink" title="4. Hystrix çš„æ ¸å¿ƒé…ç½®"></a><strong>4. Hystrix çš„æ ¸å¿ƒé…ç½®</strong></h3>      <p>Hystrix çš„è¡Œä¸ºå¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®å‚æ•°è¿›è¡Œè°ƒæ•´ï¼š</p><div class="table-container"><table><thead><tr><th>å‚æ•°å</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>execution.isolation.strategy</code></td><td><code>THREAD</code></td><td>éš”ç¦»ç­–ç•¥ï¼ˆ<code>THREAD</code> æˆ– <code>SEMAPHORE</code>ï¼‰ã€‚</td></tr><tr><td><code>execution.isolation.thread.timeoutInMilliseconds</code></td><td><code>1000</code></td><td>è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚</td></tr><tr><td><code>circuitBreaker.enabled</code></td><td><code>true</code></td><td>æ˜¯å¦å¯ç”¨ç†”æ–­å™¨ã€‚</td></tr><tr><td><code>circuitBreaker.requestVolumeThreshold</code></td><td><code>20</code></td><td>åœ¨æ—¶é—´çª—å£å†…è§¦å‘ç†”æ–­çš„æœ€å°è¯·æ±‚æ•°ã€‚</td></tr><tr><td><code>circuitBreaker.errorThresholdPercentage</code></td><td><code>50</code></td><td>è§¦å‘ç†”æ–­çš„å¤±è´¥ç‡é˜ˆå€¼ï¼ˆç™¾åˆ†æ¯”ï¼‰ã€‚</td></tr><tr><td><code>circuitBreaker.sleepWindowInMilliseconds</code></td><td><code>5000</code></td><td>ç†”æ–­å™¨æ‰“å¼€åè¿›å…¥åŠå¼€çŠ¶æ€çš„æ—¶é—´çª—å£ï¼ˆæ¯«ç§’ï¼‰ã€‚</td></tr><tr><td><code>fallback.enabled</code></td><td><code>true</code></td><td>æ˜¯å¦å¯ç”¨é™çº§é€»è¾‘ã€‚</td></tr><tr><td><code>metrics.rollingStats.timeInMilliseconds</code></td><td><code>10000</code></td><td>ç»Ÿè®¡æ—¶é—´çª—å£ï¼ˆæ¯«ç§’ï¼‰ã€‚</td></tr></tbody></table></div><hr>        <h3 id="5-Hystrix-çš„ç¤ºä¾‹ä»£ç "   >          <a href="#5-Hystrix-çš„ç¤ºä¾‹ä»£ç " class="heading-link"><i class="fas fa-link"></i></a><a href="#5-Hystrix-çš„ç¤ºä¾‹ä»£ç " class="headerlink" title="5. Hystrix çš„ç¤ºä¾‹ä»£ç "></a><strong>5. Hystrix çš„ç¤ºä¾‹ä»£ç </strong></h3>      <p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Hystrix ç¤ºä¾‹ï¼š</p>        <h4 id="1-å®šä¹‰-HystrixCommand"   >          <a href="#1-å®šä¹‰-HystrixCommand" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å®šä¹‰-HystrixCommand" class="headerlink" title="(1) å®šä¹‰ HystrixCommand"></a><strong>(1) å®šä¹‰ HystrixCommand</strong></h4>      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserCommand</span> <span class="keyword">extends</span> <span class="title class_">HystrixCommand</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long userId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserCommand</span><span class="params">(UserService userService, Long userId)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(HystrixCommandGroupKey.Factory.asKey(<span class="string">&quot;UserGroup&quot;</span>));</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">        <span class="built_in">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> User <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getUserById(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> User <span class="title function_">getFallback</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(-<span class="number">1L</span>, <span class="string">&quot;Fallback User&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="2-ä½¿ç”¨-HystrixCommand"   >          <a href="#2-ä½¿ç”¨-HystrixCommand" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ä½¿ç”¨-HystrixCommand" class="headerlink" title="(2) ä½¿ç”¨ HystrixCommand"></a><strong>(2) ä½¿ç”¨ HystrixCommand</strong></h4>      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserCommand</span>(userService, <span class="number">1L</span>).execute();</span><br><span class="line">System.out.println(user);</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="6-Hystrix-çš„ä¼˜ç¼ºç‚¹"   >          <a href="#6-Hystrix-çš„ä¼˜ç¼ºç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-Hystrix-çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="6. Hystrix çš„ä¼˜ç¼ºç‚¹"></a><strong>6. Hystrix çš„ä¼˜ç¼ºç‚¹</strong></h3>              <h4 id="1-ä¼˜ç‚¹"   >          <a href="#1-ä¼˜ç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ä¼˜ç‚¹" class="headerlink" title="(1) ä¼˜ç‚¹"></a><strong>(1) ä¼˜ç‚¹</strong></h4>      <ul><li><strong>é˜²æ­¢é›ªå´©æ•ˆåº”</strong>ï¼šé€šè¿‡éš”ç¦»å’Œç†”æ–­æœºåˆ¶ï¼Œé¿å…ç³»ç»Ÿå´©æºƒã€‚</li><li><strong>å¿«é€Ÿå¤±è´¥</strong>ï¼šåœ¨æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œå¿«é€Ÿè¿”å›é™çº§ç»“æœã€‚</li><li><strong>è‡ªåŠ¨æ¢å¤</strong>ï¼šå½“æœåŠ¡æ¢å¤åï¼Œè‡ªåŠ¨é‡æ–°å°è¯•è°ƒç”¨ã€‚</li><li><strong>å®æ—¶ç›‘æ§</strong>ï¼šæä¾›ä¸°å¯Œçš„ç›‘æ§æ•°æ®ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥ã€‚</li></ul>        <h4 id="2-ç¼ºç‚¹"   >          <a href="#2-ç¼ºç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ç¼ºç‚¹" class="headerlink" title="(2) ç¼ºç‚¹"></a><strong>(2) ç¼ºç‚¹</strong></h4>      <ul><li><strong>é…ç½®å¤æ‚</strong>ï¼šéœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯è°ƒæ•´å¤§é‡å‚æ•°ã€‚</li><li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šçº¿ç¨‹æ± éš”ç¦»å’Œç†”æ–­å™¨æœºåˆ¶ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚</li><li><strong>å·²åœæ­¢ç»´æŠ¤</strong>ï¼šHystrix å·²åœæ­¢ç»´æŠ¤ï¼Œå»ºè®®ä½¿ç”¨ Resilience4j ç­‰æ›¿ä»£æ–¹æ¡ˆã€‚</li></ul><hr>        <h3 id="7-Hystrix-çš„æ›¿ä»£æ–¹æ¡ˆ"   >          <a href="#7-Hystrix-çš„æ›¿ä»£æ–¹æ¡ˆ" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-Hystrix-çš„æ›¿ä»£æ–¹æ¡ˆ" class="headerlink" title="7. Hystrix çš„æ›¿ä»£æ–¹æ¡ˆ"></a><strong>7. Hystrix çš„æ›¿ä»£æ–¹æ¡ˆ</strong></h3>      <p>ç”±äº Hystrix å·²åœæ­¢ç»´æŠ¤ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ›¿ä»£æ–¹æ¡ˆï¼š</p><ol><li><p><strong>Resilience4j</strong>ï¼š</p><ul><li>è½»é‡çº§çš„å®¹é”™åº“ï¼Œæ”¯æŒç†”æ–­ã€é™æµã€é‡è¯•ç­‰åŠŸèƒ½ã€‚</li><li>ä¸ Spring Cloud é›†æˆè‰¯å¥½ã€‚</li></ul></li><li><p><strong>Sentinel</strong>ï¼š</p><ul><li>é˜¿é‡Œå·´å·´å¼€æºçš„æµé‡æ§åˆ¶å’Œç†”æ–­é™çº§æ¡†æ¶ã€‚</li><li>æ”¯æŒå®æ—¶ç›‘æ§å’ŒåŠ¨æ€é…ç½®ã€‚</li></ul></li><li><p><strong>Spring Cloud Circuit Breaker</strong>ï¼š</p><ul><li>Spring Cloud æä¾›çš„ç»Ÿä¸€ç†”æ–­å™¨æŠ½è±¡ï¼Œæ”¯æŒå¤šç§å®ç°ï¼ˆå¦‚ Resilience4jã€Sentinel ç­‰ï¼‰ã€‚</li></ul></li></ol><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <p>Hystrix é€šè¿‡å‘½ä»¤æ¨¡å¼ã€çº¿ç¨‹æ± éš”ç¦»ã€ç†”æ–­å™¨ã€é™çº§ç­‰æœºåˆ¶ï¼Œæœ‰æ•ˆé˜²æ­¢äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é›ªå´©æ•ˆåº”ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å¿«é€Ÿå¤±è´¥å’Œè‡ªåŠ¨æ¢å¤ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨é«˜å¹¶å‘æˆ–æœåŠ¡æ•…éšœæ—¶ä»èƒ½ç¨³å®šè¿è¡Œã€‚å°½ç®¡ Hystrix å·²åœæ­¢ç»´æŠ¤ï¼Œä½†å…¶è®¾è®¡æ€æƒ³å’Œå®ç°æœºåˆ¶ä»ç„¶å€¼å¾—å­¦ä¹ å’Œå€Ÿé‰´ã€‚</p>]]></content>
    
    
    <summary type="html">Hystrixçš„å·¥ä½œåŸç†</summary>
    
    
    
    <category term="Java" scheme="https://ljd0620.github.io/categories/Java/"/>
    
    
    <category term="å¾®æœåŠ¡" scheme="https://ljd0620.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="Hystrix" scheme="https://ljd0620.github.io/tags/Hystrix/"/>
    
  </entry>
  
  <entry>
    <title>Elasticsearchæ·±åº¦åˆ†é¡µä¼˜åŒ–</title>
    <link href="https://ljd0620.github.io/2023/12/12/Elasticsearch%E6%B7%B1%E5%BA%A6%E5%88%86%E9%A1%B5%E4%BC%98%E5%8C%96/"/>
    <id>https://ljd0620.github.io/2023/12/12/Elasticsearch%E6%B7%B1%E5%BA%A6%E5%88%86%E9%A1%B5%E4%BC%98%E5%8C%96/</id>
    <published>2023-12-12T04:32:39.000Z</published>
    <updated>2025-03-19T02:01:50.700Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ Elasticsearch ä¸­ï¼Œæ·±åº¦åˆ†é¡µï¼ˆDeep Paginationï¼‰æ˜¯æŒ‡æŸ¥è¯¢ç»“æœçš„åˆ†é¡µå‚æ•° <code>from</code> å€¼è¾ƒå¤§çš„æƒ…å†µï¼ˆä¾‹å¦‚ <code>from=10000</code>ï¼‰ã€‚æ·±åº¦åˆ†é¡µä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå› ä¸º Elasticsearch éœ€è¦ä»æ¯ä¸ªåˆ†ç‰‡ä¸­è·å–å¤§é‡çš„æ–‡æ¡£ï¼Œå¹¶åœ¨åè°ƒèŠ‚ç‚¹ä¸Šåˆå¹¶å’Œæ’åºè¿™äº›æ–‡æ¡£ï¼Œè¿™ä¼šæ¶ˆè€—å¤§é‡çš„å†…å­˜å’Œ CPU èµ„æºã€‚ä»¥ä¸‹æ˜¯ä¼˜åŒ– Elasticsearch æ·±åº¦åˆ†é¡µæ€§èƒ½çš„å‡ ç§å¸¸è§ç­–ç•¥ï¼š</p><hr>        <h3 id="1-é¿å…æ·±åº¦åˆ†é¡µ"   >          <a href="#1-é¿å…æ·±åº¦åˆ†é¡µ" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-é¿å…æ·±åº¦åˆ†é¡µ" class="headerlink" title="1. é¿å…æ·±åº¦åˆ†é¡µ"></a><strong>1. é¿å…æ·±åº¦åˆ†é¡µ</strong></h3>      <p>æ·±åº¦åˆ†é¡µé€šå¸¸ä¸æ˜¯ç”¨æˆ·å®é™…éœ€è¦çš„åœºæ™¯ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é¿å…æ·±åº¦åˆ†é¡µï¼š</p><ul><li><strong>é™åˆ¶åˆ†é¡µæ·±åº¦</strong>ï¼š<ul><li>åœ¨å‰ç«¯æˆ– API å±‚é¢é™åˆ¶ <code>from</code> çš„æœ€å¤§å€¼ï¼ˆä¾‹å¦‚ <code>from &lt;= 1000</code>ï¼‰ã€‚</li></ul></li><li><strong>ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</strong>ï¼š<ul><li>æä¾›æ›´ç²¾ç¡®çš„æœç´¢æ¡ä»¶ï¼Œå‡å°‘ç»“æœé›†çš„å¤§å°ã€‚</li><li>ä½¿ç”¨æ’åºå’Œè¿‡æ»¤æ¡ä»¶ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®šä½æ‰€éœ€æ•°æ®ã€‚</li></ul></li></ul><hr>        <h3 id="2-ä½¿ç”¨-search-after-å‚æ•°"   >          <a href="#2-ä½¿ç”¨-search-after-å‚æ•°" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ä½¿ç”¨-search-after-å‚æ•°" class="headerlink" title="2. ä½¿ç”¨ search_after å‚æ•°"></a><strong>2. ä½¿ç”¨ <code>search_after</code> å‚æ•°</strong></h3>      <p><code>search_after</code> æ˜¯ä¸€ç§åŸºäºæ¸¸æ ‡çš„åˆ†é¡µæ–¹å¼ï¼Œé€‚åˆæ·±åº¦åˆ†é¡µåœºæ™¯ã€‚å®ƒé€šè¿‡æŒ‡å®šä¸Šä¸€é¡µæœ€åä¸€æ¡è®°å½•çš„æ’åºå€¼æ¥è·å–ä¸‹ä¸€é¡µæ•°æ®ï¼Œé¿å…äº†ä¼ ç»Ÿåˆ†é¡µçš„æ€§èƒ½é—®é¢˜ã€‚</p>        <h4 id="ä½¿ç”¨æ–¹æ³•ï¼š"   >          <a href="#ä½¿ç”¨æ–¹æ³•ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä½¿ç”¨æ–¹æ³•ï¼š" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ï¼š"></a><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š</h4>      <ol><li>åœ¨æŸ¥è¯¢ä¸­æŒ‡å®šæ’åºå­—æ®µï¼ˆå¿…é¡»åŒ…å«å”¯ä¸€å­—æ®µï¼Œå¦‚ <code>_id</code>ï¼‰ã€‚</li><li>ä½¿ç”¨ <code>search_after</code> å‚æ•°ä¼ é€’ä¸Šä¸€é¡µæœ€åä¸€æ¡è®°å½•çš„æ’åºå€¼ã€‚</li></ol>        <h4 id="ç¤ºä¾‹ï¼š"   >          <a href="#ç¤ºä¾‹ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a><strong>ç¤ºä¾‹</strong>ï¼š</h4>      <figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;search_after&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">1696166400000</span><span class="punctuation">,</span> <span class="string">&quot;abc123&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></div></figure>        <h4 id="ä¼˜ç‚¹ï¼š"   >          <a href="#ä¼˜ç‚¹ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a><strong>ä¼˜ç‚¹</strong>ï¼š</h4>      <ul><li>é¿å…äº†ä¼ ç»Ÿåˆ†é¡µçš„æ€§èƒ½ç“¶é¢ˆã€‚</li><li>é€‚åˆæ·±åº¦åˆ†é¡µå’Œå®æ—¶æ•°æ®æŸ¥è¯¢ã€‚</li></ul>        <h4 id="ç¼ºç‚¹ï¼š"   >          <a href="#ç¼ºç‚¹ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a><strong>ç¼ºç‚¹</strong>ï¼š</h4>      <ul><li>éœ€è¦å®¢æˆ·ç«¯ç»´æŠ¤æ¸¸æ ‡çŠ¶æ€ã€‚</li><li>ä¸æ”¯æŒè·³è½¬åˆ°ä»»æ„é¡µç ã€‚</li></ul><hr>        <h3 id="3-ä½¿ç”¨æ»šåŠ¨æŸ¥è¯¢ï¼ˆScroll-APIï¼‰"   >          <a href="#3-ä½¿ç”¨æ»šåŠ¨æŸ¥è¯¢ï¼ˆScroll-APIï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ä½¿ç”¨æ»šåŠ¨æŸ¥è¯¢ï¼ˆScroll-APIï¼‰" class="headerlink" title="3. ä½¿ç”¨æ»šåŠ¨æŸ¥è¯¢ï¼ˆScroll APIï¼‰"></a><strong>3. ä½¿ç”¨æ»šåŠ¨æŸ¥è¯¢ï¼ˆScroll APIï¼‰</strong></h3>      <p>æ»šåŠ¨æŸ¥è¯¢ï¼ˆScroll APIï¼‰é€‚åˆä¸€æ¬¡æ€§è·å–å¤§é‡æ•°æ®çš„åœºæ™¯ï¼ˆå¦‚æ•°æ®å¯¼å‡ºï¼‰ã€‚å®ƒé€šè¿‡åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼ˆSnapshotï¼‰æ¥ä¿æŒæŸ¥è¯¢çš„ä¸Šä¸‹æ–‡ï¼Œå…è®¸åˆ†æ‰¹æ¬¡è·å–æ•°æ®ã€‚</p>        <h4 id="ä½¿ç”¨æ–¹æ³•ï¼š-1"   >          <a href="#ä½¿ç”¨æ–¹æ³•ï¼š-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä½¿ç”¨æ–¹æ³•ï¼š-1" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ï¼š"></a><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š</h4>      <ol><li>åˆå§‹åŒ–æ»šåŠ¨æŸ¥è¯¢ï¼Œè®¾ç½®æ»šåŠ¨æ—¶é—´çª—å£ï¼ˆå¦‚ <code>1m</code>ï¼‰ã€‚</li><li>ä½¿ç”¨ <code>scroll_id</code> è·å–ä¸‹ä¸€æ‰¹æ•°æ®ã€‚</li></ol>        <h4 id="ç¤ºä¾‹ï¼š-1"   >          <a href="#ç¤ºä¾‹ï¼š-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-1" class="headerlink" title="ç¤ºä¾‹ï¼š"></a><strong>ç¤ºä¾‹</strong>ï¼š</h4>      <p>åˆå§‹åŒ–æ»šåŠ¨æŸ¥è¯¢ï¼š</p><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /my_index/_search?scroll=<span class="number">1</span>m</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></div></figure><p>è·å–ä¸‹ä¸€æ‰¹æ•°æ®ï¼š</p><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /_search/scroll</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scroll&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1m&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scroll_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DnF1ZXJ5VGhlbkZldGNoBQAAAAAAAABIFj...&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></div></figure>        <h4 id="ä¼˜ç‚¹ï¼š-1"   >          <a href="#ä¼˜ç‚¹ï¼š-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¼˜ç‚¹ï¼š-1" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a><strong>ä¼˜ç‚¹</strong>ï¼š</h4>      <ul><li>é€‚åˆä¸€æ¬¡æ€§è·å–å¤§é‡æ•°æ®çš„åœºæ™¯ã€‚</li><li>é¿å…äº†æ·±åº¦åˆ†é¡µçš„æ€§èƒ½é—®é¢˜ã€‚</li></ul>        <h4 id="ç¼ºç‚¹ï¼š-1"   >          <a href="#ç¼ºç‚¹ï¼š-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¼ºç‚¹ï¼š-1" class="headerlink" title="ç¼ºç‚¹ï¼š"></a><strong>ç¼ºç‚¹</strong>ï¼š</h4>      <ul><li>æ»šåŠ¨æŸ¥è¯¢ä¼šå ç”¨èµ„æºï¼Œç›´åˆ°æ»šåŠ¨æ—¶é—´çª—å£è¿‡æœŸã€‚</li><li>ä¸é€‚åˆå®æ—¶åˆ†é¡µåœºæ™¯ã€‚</li></ul><hr>        <h3 id="4-ä½¿ç”¨-Point-In-Timeï¼ˆPITï¼‰"   >          <a href="#4-ä½¿ç”¨-Point-In-Timeï¼ˆPITï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-ä½¿ç”¨-Point-In-Timeï¼ˆPITï¼‰" class="headerlink" title="4. ä½¿ç”¨ Point In Timeï¼ˆPITï¼‰"></a><strong>4. ä½¿ç”¨ <code>Point In Time</code>ï¼ˆPITï¼‰</strong></h3>      <p><code>Point In Time</code>ï¼ˆPITï¼‰æ˜¯ Elasticsearch 7.10 å¼•å…¥çš„åŠŸèƒ½ï¼Œç”¨äºåœ¨æ»šåŠ¨æŸ¥è¯¢çš„åŸºç¡€ä¸Šæä¾›æ›´é«˜æ•ˆçš„åˆ†é¡µæ–¹å¼ã€‚å®ƒé€šè¿‡åˆ›å»ºä¸€ä¸ªæ—¶é—´ç‚¹è§†å›¾ï¼ˆPoint-in-Time Viewï¼‰ï¼Œå…è®¸åœ¨å›ºå®šçš„æ•°æ®è§†å›¾ä¸Šè¿›è¡Œåˆ†é¡µã€‚</p>        <h4 id="ä½¿ç”¨æ–¹æ³•ï¼š-2"   >          <a href="#ä½¿ç”¨æ–¹æ³•ï¼š-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä½¿ç”¨æ–¹æ³•ï¼š-2" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ï¼š"></a><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š</h4>      <ol><li>åˆ›å»ºä¸€ä¸ª PITã€‚</li><li>ä½¿ç”¨ <code>search_after</code> å’Œ PIT è¿›è¡Œåˆ†é¡µã€‚</li></ol>        <h4 id="ç¤ºä¾‹ï¼š-2"   >          <a href="#ç¤ºä¾‹ï¼š-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-2" class="headerlink" title="ç¤ºä¾‹ï¼š"></a><strong>ç¤ºä¾‹</strong>ï¼š</h4>      <p>åˆ›å»º PITï¼š</p><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /my_index/_pit?keep_alive=<span class="number">1</span>m</span><br></pre></td></tr></table></div></figure><p>ä½¿ç”¨ PIT å’Œ <code>search_after</code> åˆ†é¡µï¼š</p><figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pit&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;46ToAwMDaWR5BXV1aWQyKwZub2RlXzMAAAAAAAAAACoBYwADaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQADaWR5BXV1aWQyKgZub2RlXzIAAAAAAAAAAAwBYgACBXV1aWQyAAAFdXVpZDEAAQltYXRjaF9hbGw_gAAAAA==&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;keep_alive&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1m&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;search_after&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">1696166400000</span><span class="punctuation">,</span> <span class="string">&quot;abc123&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></div></figure>        <h4 id="ä¼˜ç‚¹ï¼š-2"   >          <a href="#ä¼˜ç‚¹ï¼š-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¼˜ç‚¹ï¼š-2" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a><strong>ä¼˜ç‚¹</strong>ï¼š</h4>      <ul><li>æä¾›æ›´é«˜æ•ˆçš„åˆ†é¡µæ–¹å¼ã€‚</li><li>é€‚åˆå®æ—¶åˆ†é¡µåœºæ™¯ã€‚</li></ul>        <h4 id="ç¼ºç‚¹ï¼š-2"   >          <a href="#ç¼ºç‚¹ï¼š-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¼ºç‚¹ï¼š-2" class="headerlink" title="ç¼ºç‚¹ï¼š"></a><strong>ç¼ºç‚¹</strong>ï¼š</h4>      <ul><li>éœ€è¦ Elasticsearch 7.10 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚</li></ul><hr>        <h3 id="5-ä½¿ç”¨-slice-åˆ†ç‰‡æŸ¥è¯¢"   >          <a href="#5-ä½¿ç”¨-slice-åˆ†ç‰‡æŸ¥è¯¢" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-ä½¿ç”¨-slice-åˆ†ç‰‡æŸ¥è¯¢" class="headerlink" title="5. ä½¿ç”¨ slice åˆ†ç‰‡æŸ¥è¯¢"></a><strong>5. ä½¿ç”¨ <code>slice</code> åˆ†ç‰‡æŸ¥è¯¢</strong></h3>      <p><code>slice</code> åˆ†ç‰‡æŸ¥è¯¢å…è®¸å°†æŸ¥è¯¢åˆ†æˆå¤šä¸ªå­æŸ¥è¯¢ï¼Œæ¯ä¸ªå­æŸ¥è¯¢å¤„ç†æ•°æ®çš„ä¸€ä¸ªå­é›†ã€‚é€šè¿‡å¹¶è¡Œæ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼Œå¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</p>        <h4 id="ä½¿ç”¨æ–¹æ³•ï¼š-3"   >          <a href="#ä½¿ç”¨æ–¹æ³•ï¼š-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä½¿ç”¨æ–¹æ³•ï¼š-3" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ï¼š"></a><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š</h4>      <ol><li>æŒ‡å®š <code>slice</code> å‚æ•°ï¼Œå°†æŸ¥è¯¢åˆ†æˆå¤šä¸ªå­æŸ¥è¯¢ã€‚</li><li>å¹¶è¡Œæ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ã€‚</li></ol>        <h4 id="ç¤ºä¾‹ï¼š-3"   >          <a href="#ç¤ºä¾‹ï¼š-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-3" class="headerlink" title="ç¤ºä¾‹ï¼š"></a><strong>ç¤ºä¾‹</strong>ï¼š</h4>      <figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;slice&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></div></figure>        <h4 id="ä¼˜ç‚¹ï¼š-3"   >          <a href="#ä¼˜ç‚¹ï¼š-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¼˜ç‚¹ï¼š-3" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a><strong>ä¼˜ç‚¹</strong>ï¼š</h4>      <ul><li>æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œé€‚åˆå¤§æ•°æ®é›†ã€‚</li><li>å¯ä»¥å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå­æŸ¥è¯¢ã€‚</li></ul>        <h4 id="ç¼ºç‚¹ï¼š-3"   >          <a href="#ç¼ºç‚¹ï¼š-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¼ºç‚¹ï¼š-3" class="headerlink" title="ç¼ºç‚¹ï¼š"></a><strong>ç¼ºç‚¹</strong>ï¼š</h4>      <ul><li>éœ€è¦å®¢æˆ·ç«¯åˆå¹¶å¤šä¸ªå­æŸ¥è¯¢çš„ç»“æœã€‚</li><li>ä¸é€‚åˆå®æ—¶åˆ†é¡µåœºæ™¯ã€‚</li></ul><hr>        <h3 id="6-ä¼˜åŒ–ç´¢å¼•è®¾è®¡"   >          <a href="#6-ä¼˜åŒ–ç´¢å¼•è®¾è®¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-ä¼˜åŒ–ç´¢å¼•è®¾è®¡" class="headerlink" title="6. ä¼˜åŒ–ç´¢å¼•è®¾è®¡"></a><strong>6. ä¼˜åŒ–ç´¢å¼•è®¾è®¡</strong></h3>      <p>é€šè¿‡ä¼˜åŒ–ç´¢å¼•è®¾è®¡ï¼Œå¯ä»¥å‡å°‘æŸ¥è¯¢æ—¶éœ€è¦æ‰«æçš„æ•°æ®é‡ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</p>        <h4 id="ä¼˜åŒ–ç­–ç•¥ï¼š"   >          <a href="#ä¼˜åŒ–ç­–ç•¥ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¼˜åŒ–ç­–ç•¥ï¼š" class="headerlink" title="ä¼˜åŒ–ç­–ç•¥ï¼š"></a><strong>ä¼˜åŒ–ç­–ç•¥</strong>ï¼š</h4>      <ul><li><strong>ä½¿ç”¨åˆé€‚çš„å­—æ®µç±»å‹</strong>ï¼š<ul><li>é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹ï¼ˆå¦‚ <code>keyword</code>ã€<code>text</code>ã€<code>date</code> ç­‰ï¼‰ï¼Œé¿å…ä¸å¿…è¦çš„åˆ†è¯å’Œåˆ†æã€‚</li></ul></li><li><strong>ä½¿ç”¨è¿‡æ»¤æ¡ä»¶</strong>ï¼š<ul><li>åœ¨æŸ¥è¯¢ä¸­æ·»åŠ è¿‡æ»¤æ¡ä»¶ï¼Œå‡å°‘éœ€è¦æ‰«æçš„æ•°æ®é‡ã€‚</li></ul></li><li><strong>ä½¿ç”¨ç´¢å¼•æ¨¡æ¿</strong>ï¼š<ul><li>ä½¿ç”¨ç´¢å¼•æ¨¡æ¿ç»Ÿä¸€ç®¡ç†ç´¢å¼•çš„é…ç½®å’Œæ˜ å°„ã€‚</li></ul></li></ul><hr>        <h3 id="7-ä½¿ç”¨ç¼“å­˜"   >          <a href="#7-ä½¿ç”¨ç¼“å­˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-ä½¿ç”¨ç¼“å­˜" class="headerlink" title="7. ä½¿ç”¨ç¼“å­˜"></a><strong>7. ä½¿ç”¨ç¼“å­˜</strong></h3>      <p>å¯¹äºä¸ç»å¸¸å˜åŒ–çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰æ¥å­˜å‚¨åˆ†é¡µç»“æœï¼Œå‡å°‘ Elasticsearch çš„æŸ¥è¯¢å‹åŠ›ã€‚</p>        <h4 id="ç¤ºä¾‹ï¼š-4"   >          <a href="#ç¤ºä¾‹ï¼š-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¤ºä¾‹ï¼š-4" class="headerlink" title="ç¤ºä¾‹ï¼š"></a><strong>ç¤ºä¾‹</strong>ï¼š</h4>      <ol><li>å°†æŸ¥è¯¢ç»“æœç¼“å­˜åˆ° Redis ä¸­ã€‚</li><li>ä»ç¼“å­˜ä¸­è·å–åˆ†é¡µæ•°æ®ã€‚</li></ol>        <h4 id="ä¼˜ç‚¹ï¼š-4"   >          <a href="#ä¼˜ç‚¹ï¼š-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¼˜ç‚¹ï¼š-4" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a><strong>ä¼˜ç‚¹</strong>ï¼š</h4>      <ul><li>å‡å°‘ Elasticsearch çš„æŸ¥è¯¢å‹åŠ›ã€‚</li><li>æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</li></ul>        <h4 id="ç¼ºç‚¹ï¼š-4"   >          <a href="#ç¼ºç‚¹ï¼š-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¼ºç‚¹ï¼š-4" class="headerlink" title="ç¼ºç‚¹ï¼š"></a><strong>ç¼ºç‚¹</strong>ï¼š</h4>      <ul><li>æ•°æ®å˜åŒ–æ—¶éœ€è¦æ›´æ–°ç¼“å­˜ã€‚</li><li>é€‚åˆä¸ç»å¸¸å˜åŒ–çš„æ•°æ®ã€‚</li></ul><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <p>ä¼˜åŒ– Elasticsearch æ·±åº¦åˆ†é¡µæ€§èƒ½çš„å¸¸è§ç­–ç•¥åŒ…æ‹¬ï¼š</p><ol><li><strong>é¿å…æ·±åº¦åˆ†é¡µ</strong>ï¼šé™åˆ¶åˆ†é¡µæ·±åº¦ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚</li><li><strong>ä½¿ç”¨ <code>search_after</code></strong>ï¼šé€‚åˆæ·±åº¦åˆ†é¡µå’Œå®æ—¶æ•°æ®æŸ¥è¯¢ã€‚</li><li><strong>ä½¿ç”¨æ»šåŠ¨æŸ¥è¯¢ï¼ˆScroll APIï¼‰</strong>ï¼šé€‚åˆä¸€æ¬¡æ€§è·å–å¤§é‡æ•°æ®çš„åœºæ™¯ã€‚</li><li><strong>ä½¿ç”¨ <code>Point In Time</code>ï¼ˆPITï¼‰</strong>ï¼šæä¾›æ›´é«˜æ•ˆçš„åˆ†é¡µæ–¹å¼ï¼Œé€‚åˆå®æ—¶åˆ†é¡µåœºæ™¯ã€‚</li><li><strong>ä½¿ç”¨ <code>slice</code> åˆ†ç‰‡æŸ¥è¯¢</strong>ï¼šæé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œé€‚åˆå¤§æ•°æ®é›†ã€‚</li><li><strong>ä¼˜åŒ–ç´¢å¼•è®¾è®¡</strong>ï¼šå‡å°‘æŸ¥è¯¢æ—¶éœ€è¦æ‰«æçš„æ•°æ®é‡ã€‚</li><li><strong>ä½¿ç”¨ç¼“å­˜</strong>ï¼šå‡å°‘ Elasticsearch çš„æŸ¥è¯¢å‹åŠ›ï¼Œé€‚åˆä¸ç»å¸¸å˜åŒ–çš„æ•°æ®ã€‚</li></ol><p>æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯å’Œæ•°æ®ç‰¹ç‚¹ï¼Œé€‰æ‹©åˆé€‚çš„ä¼˜åŒ–ç­–ç•¥ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ Elasticsearch æ·±åº¦åˆ†é¡µçš„æ€§èƒ½ã€‚</p>]]></content>
    
    
    <summary type="html">Elasticsearchæ·±åº¦åˆ†é¡µä¼˜åŒ–</summary>
    
    
    
    <category term="æœç´¢å¼•æ“" scheme="https://ljd0620.github.io/categories/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/"/>
    
    
    <category term="Elasticsearch" scheme="https://ljd0620.github.io/tags/Elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>JVMæ€§èƒ½è°ƒä¼˜ç­–ç•¥</title>
    <link href="https://ljd0620.github.io/2023/12/10/JVM%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E7%AD%96%E7%95%A5/"/>
    <id>https://ljd0620.github.io/2023/12/10/JVM%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E7%AD%96%E7%95%A5/</id>
    <published>2023-12-10T04:28:05.000Z</published>
    <updated>2025-03-19T02:02:29.960Z</updated>
    
    <content type="html"><![CDATA[<p>JVM æ€§èƒ½è°ƒä¼˜æ˜¯ Java åº”ç”¨ç¨‹åºä¼˜åŒ–çš„é‡è¦ç¯èŠ‚ï¼Œæ—¨åœ¨é€šè¿‡è°ƒæ•´ JVM å‚æ•°ã€ä¼˜åŒ–ä»£ç å’Œé€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨ï¼Œæå‡åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€å‡å°‘å†…å­˜å ç”¨ã€é™ä½åƒåœ¾å›æ”¶çš„å¼€é”€ã€‚ä»¥ä¸‹æ˜¯ JVM æ€§èƒ½è°ƒä¼˜çš„ä¸»è¦ç­–ç•¥åŠå…¶è¯¦ç»†è§£æï¼š</p><hr>        <h3 id="1-å†…å­˜è°ƒä¼˜"   >          <a href="#1-å†…å­˜è°ƒä¼˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å†…å­˜è°ƒä¼˜" class="headerlink" title="1. å†…å­˜è°ƒä¼˜"></a><strong>1. å†…å­˜è°ƒä¼˜</strong></h3>      <p>å†…å­˜è°ƒä¼˜æ˜¯ JVM æ€§èƒ½è°ƒä¼˜çš„æ ¸å¿ƒï¼Œä¸»è¦ç›®æ ‡æ˜¯åˆç†åˆ†é…å †å†…å­˜ã€æ–¹æ³•åŒºå’Œç›´æ¥å†…å­˜ï¼Œé¿å… <code>OutOfMemoryError</code> å’Œé¢‘ç¹çš„åƒåœ¾å›æ”¶ã€‚</p>        <h4 id="1-å †å†…å­˜è°ƒä¼˜"   >          <a href="#1-å †å†…å­˜è°ƒä¼˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å †å†…å­˜è°ƒä¼˜" class="headerlink" title="(1) å †å†…å­˜è°ƒä¼˜"></a><strong>(1) å †å†…å­˜è°ƒä¼˜</strong></h4>      <ul><li><strong>å‚æ•°</strong>ï¼š<ul><li><code>-Xms</code>ï¼šè®¾ç½®å †çš„åˆå§‹å¤§å°ï¼ˆå¦‚ <code>-Xms512m</code>ï¼‰ã€‚</li><li><code>-Xmx</code>ï¼šè®¾ç½®å †çš„æœ€å¤§å¤§å°ï¼ˆå¦‚ <code>-Xmx2048m</code>ï¼‰ã€‚</li></ul></li><li><strong>å»ºè®®</strong>ï¼š<ul><li>å°† <code>-Xms</code> å’Œ <code>-Xmx</code> è®¾ç½®ä¸ºç›¸åŒçš„å€¼ï¼Œé¿å…å †å†…å­˜åŠ¨æ€æ‰©å±•å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚</li><li>æ ¹æ®åº”ç”¨ç¨‹åºçš„å†…å­˜éœ€æ±‚ï¼Œåˆç†è®¾ç½®å †å¤§å°ï¼Œé¿å…è¿‡å°å¯¼è‡´é¢‘ç¹ GC æˆ–è¿‡å¤§å¯¼è‡´å†…å­˜æµªè´¹ã€‚</li></ul></li></ul>        <h4 id="2-æ–°ç”Ÿä»£å’Œè€å¹´ä»£è°ƒä¼˜"   >          <a href="#2-æ–°ç”Ÿä»£å’Œè€å¹´ä»£è°ƒä¼˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ–°ç”Ÿä»£å’Œè€å¹´ä»£è°ƒä¼˜" class="headerlink" title="(2) æ–°ç”Ÿä»£å’Œè€å¹´ä»£è°ƒä¼˜"></a><strong>(2) æ–°ç”Ÿä»£å’Œè€å¹´ä»£è°ƒä¼˜</strong></h4>      <ul><li><strong>å‚æ•°</strong>ï¼š<ul><li><code>-XX:NewRatio</code>ï¼šè®¾ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„æ¯”ä¾‹ï¼ˆå¦‚ <code>-XX:NewRatio=2</code> è¡¨ç¤ºæ–°ç”Ÿä»£å  1&#x2F;3ï¼Œè€å¹´ä»£å  2&#x2F;3ï¼‰ã€‚</li><li><code>-XX:SurvivorRatio</code>ï¼šè®¾ç½® Eden åŒºä¸ Survivor åŒºçš„æ¯”ä¾‹ï¼ˆå¦‚ <code>-XX:SurvivorRatio=8</code> è¡¨ç¤º Eden åŒºå  8&#x2F;10ï¼Œæ¯ä¸ª Survivor åŒºå  1&#x2F;10ï¼‰ã€‚</li></ul></li><li><strong>å»ºè®®</strong>ï¼š<ul><li>æ ¹æ®å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸè°ƒæ•´æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ï¼Œé¿å…è€å¹´ä»£è¿‡æ—©è¢«å¡«æ»¡ã€‚</li><li>æ ¹æ®å¯¹è±¡çš„å­˜æ´»ç‡è°ƒæ•´ Survivor åŒºçš„å¤§å°ï¼Œé¿å…å¯¹è±¡è¿‡æ—©è¿›å…¥è€å¹´ä»£ã€‚</li></ul></li></ul>        <h4 id="3-æ–¹æ³•åŒºè°ƒä¼˜"   >          <a href="#3-æ–¹æ³•åŒºè°ƒä¼˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æ–¹æ³•åŒºè°ƒä¼˜" class="headerlink" title="(3) æ–¹æ³•åŒºè°ƒä¼˜"></a><strong>(3) æ–¹æ³•åŒºè°ƒä¼˜</strong></h4>      <ul><li><strong>å‚æ•°</strong>ï¼š<ul><li><code>-XX:MetaspaceSize</code>ï¼šè®¾ç½®å…ƒç©ºé—´çš„åˆå§‹å¤§å°ï¼ˆå¦‚ <code>-XX:MetaspaceSize=128m</code>ï¼‰ã€‚</li><li><code>-XX:MaxMetaspaceSize</code>ï¼šè®¾ç½®å…ƒç©ºé—´çš„æœ€å¤§å¤§å°ï¼ˆå¦‚ <code>-XX:MaxMetaspaceSize=512m</code>ï¼‰ã€‚</li></ul></li><li><strong>å»ºè®®</strong>ï¼š<ul><li>æ ¹æ®åº”ç”¨ç¨‹åºçš„ç±»åŠ è½½éœ€æ±‚ï¼Œåˆç†è®¾ç½®å…ƒç©ºé—´å¤§å°ï¼Œé¿å…é¢‘ç¹çš„å…ƒç©ºé—´åƒåœ¾å›æ”¶ã€‚</li></ul></li></ul>        <h4 id="4-ç›´æ¥å†…å­˜è°ƒä¼˜"   >          <a href="#4-ç›´æ¥å†…å­˜è°ƒä¼˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-ç›´æ¥å†…å­˜è°ƒä¼˜" class="headerlink" title="(4) ç›´æ¥å†…å­˜è°ƒä¼˜"></a><strong>(4) ç›´æ¥å†…å­˜è°ƒä¼˜</strong></h4>      <ul><li><strong>å‚æ•°</strong>ï¼š<ul><li><code>-XX:MaxDirectMemorySize</code>ï¼šè®¾ç½®ç›´æ¥å†…å­˜çš„æœ€å¤§å¤§å°ï¼ˆå¦‚ <code>-XX:MaxDirectMemorySize=512m</code>ï¼‰ã€‚</li></ul></li><li><strong>å»ºè®®</strong>ï¼š<ul><li>æ ¹æ® NIO æ“ä½œçš„éœ€æ±‚ï¼Œåˆç†è®¾ç½®ç›´æ¥å†…å­˜å¤§å°ï¼Œé¿å…ç›´æ¥å†…å­˜ä¸è¶³ã€‚</li></ul></li></ul><hr>        <h3 id="2-åƒåœ¾å›æ”¶è°ƒä¼˜"   >          <a href="#2-åƒåœ¾å›æ”¶è°ƒä¼˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-åƒåœ¾å›æ”¶è°ƒä¼˜" class="headerlink" title="2. åƒåœ¾å›æ”¶è°ƒä¼˜"></a><strong>2. åƒåœ¾å›æ”¶è°ƒä¼˜</strong></h3>      <p>åƒåœ¾å›æ”¶è°ƒä¼˜çš„ç›®æ ‡æ˜¯å‡å°‘åƒåœ¾å›æ”¶çš„é¢‘ç‡å’Œæ—¶é—´ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„ååé‡å’Œå“åº”é€Ÿåº¦ã€‚</p>        <h4 id="1-é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨"   >          <a href="#1-é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="(1) é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨"></a><strong>(1) é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨</strong></h4>      <ul><li><strong>ä¸²è¡Œæ”¶é›†å™¨ï¼ˆSerial GCï¼‰</strong>ï¼š<ul><li>é€‚ç”¨äºå•æ ¸ CPU æˆ–å°å‹åº”ç”¨ã€‚</li><li>å‚æ•°ï¼š<code>-XX:+UseSerialGC</code>ã€‚</li></ul></li><li><strong>å¹¶è¡Œæ”¶é›†å™¨ï¼ˆParallel GCï¼‰</strong>ï¼š<ul><li>é€‚ç”¨äºå¤šæ ¸ CPU ä¸”è¿½æ±‚é«˜ååé‡çš„åº”ç”¨ã€‚</li><li>å‚æ•°ï¼š<code>-XX:+UseParallelGC</code>ã€‚</li></ul></li><li><strong>CMS æ”¶é›†å™¨ï¼ˆConcurrent Mark Sweep GCï¼‰</strong>ï¼š<ul><li>é€‚ç”¨äºè¿½æ±‚ä½å»¶è¿Ÿçš„åº”ç”¨ã€‚</li><li>å‚æ•°ï¼š<code>-XX:+UseConcMarkSweepGC</code>ã€‚</li></ul></li><li><strong>G1 æ”¶é›†å™¨ï¼ˆGarbage-First GCï¼‰</strong>ï¼š<ul><li>é€‚ç”¨äºå¤§å†…å­˜ã€ä½å»¶è¿Ÿçš„åº”ç”¨ã€‚</li><li>å‚æ•°ï¼š<code>-XX:+UseG1GC</code>ã€‚</li></ul></li><li><strong>ZGC æ”¶é›†å™¨ï¼ˆZ Garbage Collectorï¼‰</strong>ï¼š<ul><li>é€‚ç”¨äºè¶…å¤§å†…å­˜ã€æä½å»¶è¿Ÿçš„åº”ç”¨ã€‚</li><li>å‚æ•°ï¼š<code>-XX:+UseZGC</code>ã€‚</li></ul></li></ul>        <h4 id="2-è°ƒæ•´åƒåœ¾å›æ”¶å‚æ•°"   >          <a href="#2-è°ƒæ•´åƒåœ¾å›æ”¶å‚æ•°" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-è°ƒæ•´åƒåœ¾å›æ”¶å‚æ•°" class="headerlink" title="(2) è°ƒæ•´åƒåœ¾å›æ”¶å‚æ•°"></a><strong>(2) è°ƒæ•´åƒåœ¾å›æ”¶å‚æ•°</strong></h4>      <ul><li><strong>å‚æ•°</strong>ï¼š<ul><li><code>-XX:MaxGCPauseMillis</code>ï¼šè®¾ç½®æœ€å¤§åƒåœ¾å›æ”¶åœé¡¿æ—¶é—´ï¼ˆå¦‚ <code>-XX:MaxGCPauseMillis=200</code>ï¼‰ã€‚</li><li><code>-XX:GCTimeRatio</code>ï¼šè®¾ç½®åƒåœ¾å›æ”¶æ—¶é—´ä¸åº”ç”¨ç¨‹åºæ—¶é—´çš„æ¯”ä¾‹ï¼ˆå¦‚ <code>-XX:GCTimeRatio=19</code> è¡¨ç¤ºåƒåœ¾å›æ”¶æ—¶é—´å  5%ï¼‰ã€‚</li></ul></li><li><strong>å»ºè®®</strong>ï¼š<ul><li>æ ¹æ®åº”ç”¨ç¨‹åºçš„æ€§èƒ½éœ€æ±‚ï¼Œåˆç†è®¾ç½®åƒåœ¾å›æ”¶å‚æ•°ï¼Œå¹³è¡¡ååé‡å’Œå»¶è¿Ÿã€‚</li></ul></li></ul><hr>        <h3 id="3-çº¿ç¨‹è°ƒä¼˜"   >          <a href="#3-çº¿ç¨‹è°ƒä¼˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-çº¿ç¨‹è°ƒä¼˜" class="headerlink" title="3. çº¿ç¨‹è°ƒä¼˜"></a><strong>3. çº¿ç¨‹è°ƒä¼˜</strong></h3>      <p>çº¿ç¨‹è°ƒä¼˜çš„ç›®æ ‡æ˜¯åˆç†é…ç½®çº¿ç¨‹æ ˆå¤§å°å’Œçº¿ç¨‹æ± å‚æ•°ï¼Œé¿å… <code>StackOverflowError</code> å’Œçº¿ç¨‹èµ„æºæµªè´¹ã€‚</p>        <h4 id="1-çº¿ç¨‹æ ˆå¤§å°è°ƒä¼˜"   >          <a href="#1-çº¿ç¨‹æ ˆå¤§å°è°ƒä¼˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-çº¿ç¨‹æ ˆå¤§å°è°ƒä¼˜" class="headerlink" title="(1) çº¿ç¨‹æ ˆå¤§å°è°ƒä¼˜"></a><strong>(1) çº¿ç¨‹æ ˆå¤§å°è°ƒä¼˜</strong></h4>      <ul><li><strong>å‚æ•°</strong>ï¼š<ul><li><code>-Xss</code>ï¼šè®¾ç½®çº¿ç¨‹æ ˆçš„å¤§å°ï¼ˆå¦‚ <code>-Xss1m</code>ï¼‰ã€‚</li></ul></li><li><strong>å»ºè®®</strong>ï¼š<ul><li>æ ¹æ®åº”ç”¨ç¨‹åºçš„çº¿ç¨‹æ•°é‡å’Œé€’å½’æ·±åº¦ï¼Œåˆç†è®¾ç½®çº¿ç¨‹æ ˆå¤§å°ï¼Œé¿å…æ ˆæº¢å‡ºæˆ–å†…å­˜æµªè´¹ã€‚</li></ul></li></ul>        <h4 id="2-çº¿ç¨‹æ± è°ƒä¼˜"   >          <a href="#2-çº¿ç¨‹æ± è°ƒä¼˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-çº¿ç¨‹æ± è°ƒä¼˜" class="headerlink" title="(2) çº¿ç¨‹æ± è°ƒä¼˜"></a><strong>(2) çº¿ç¨‹æ± è°ƒä¼˜</strong></h4>      <ul><li><strong>å‚æ•°</strong>ï¼š<ul><li>æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€é˜Ÿåˆ—å¤§å°ç­‰ã€‚</li></ul></li><li><strong>å»ºè®®</strong>ï¼š<ul><li>æ ¹æ®ä»»åŠ¡çš„ç±»å‹å’Œæ•°é‡ï¼Œåˆç†é…ç½®çº¿ç¨‹æ± å‚æ•°ï¼Œé¿å…çº¿ç¨‹èµ„æºæµªè´¹æˆ–ä»»åŠ¡å †ç§¯ã€‚</li></ul></li></ul><hr>        <h3 id="4-JIT-ç¼–è¯‘å™¨è°ƒä¼˜"   >          <a href="#4-JIT-ç¼–è¯‘å™¨è°ƒä¼˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-JIT-ç¼–è¯‘å™¨è°ƒä¼˜" class="headerlink" title="4. JIT ç¼–è¯‘å™¨è°ƒä¼˜"></a><strong>4. JIT ç¼–è¯‘å™¨è°ƒä¼˜</strong></h3>      <p>JITï¼ˆJust-In-Timeï¼‰ç¼–è¯‘å™¨æ˜¯ JVM æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ï¼Œé€šè¿‡å°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ã€‚</p>        <h4 id="1-å¯ç”¨åˆ†å±‚ç¼–è¯‘"   >          <a href="#1-å¯ç”¨åˆ†å±‚ç¼–è¯‘" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å¯ç”¨åˆ†å±‚ç¼–è¯‘" class="headerlink" title="(1) å¯ç”¨åˆ†å±‚ç¼–è¯‘"></a><strong>(1) å¯ç”¨åˆ†å±‚ç¼–è¯‘</strong></h4>      <ul><li><strong>å‚æ•°</strong>ï¼š<ul><li><code>-XX:+TieredCompilation</code>ï¼šå¯ç”¨åˆ†å±‚ç¼–è¯‘ã€‚</li></ul></li><li><strong>å»ºè®®</strong>ï¼š<ul><li>åˆ†å±‚ç¼–è¯‘å¯ä»¥åœ¨å¯åŠ¨é˜¶æ®µä½¿ç”¨è§£é‡Šå™¨æ‰§è¡Œä»£ç ï¼Œåœ¨è¿è¡Œé˜¶æ®µä½¿ç”¨ JIT ç¼–è¯‘å™¨ä¼˜åŒ–çƒ­ç‚¹ä»£ç ã€‚</li></ul></li></ul>        <h4 id="2-è°ƒæ•´ç¼–è¯‘é˜ˆå€¼"   >          <a href="#2-è°ƒæ•´ç¼–è¯‘é˜ˆå€¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-è°ƒæ•´ç¼–è¯‘é˜ˆå€¼" class="headerlink" title="(2) è°ƒæ•´ç¼–è¯‘é˜ˆå€¼"></a><strong>(2) è°ƒæ•´ç¼–è¯‘é˜ˆå€¼</strong></h4>      <ul><li><strong>å‚æ•°</strong>ï¼š<ul><li><code>-XX:CompileThreshold</code>ï¼šè®¾ç½®æ–¹æ³•è°ƒç”¨æ¬¡æ•°è¾¾åˆ°è¯¥å€¼æ—¶è§¦å‘ JIT ç¼–è¯‘ï¼ˆå¦‚ <code>-XX:CompileThreshold=10000</code>ï¼‰ã€‚</li></ul></li><li><strong>å»ºè®®</strong>ï¼š<ul><li>æ ¹æ®åº”ç”¨ç¨‹åºçš„ç‰¹ç‚¹ï¼Œåˆç†è°ƒæ•´ç¼–è¯‘é˜ˆå€¼ï¼Œé¿å…è¿‡æ—©æˆ–è¿‡æ™šè§¦å‘ JIT ç¼–è¯‘ã€‚</li></ul></li></ul><hr>        <h3 id="5-ç›‘æ§ä¸è¯Šæ–­"   >          <a href="#5-ç›‘æ§ä¸è¯Šæ–­" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-ç›‘æ§ä¸è¯Šæ–­" class="headerlink" title="5. ç›‘æ§ä¸è¯Šæ–­"></a><strong>5. ç›‘æ§ä¸è¯Šæ–­</strong></h3>      <p>é€šè¿‡ç›‘æ§å’Œè¯Šæ–­å·¥å…·ï¼Œå¯ä»¥å®æ—¶äº†è§£ JVM çš„è¿è¡ŒçŠ¶æ€ï¼Œå‘ç°æ€§èƒ½ç“¶é¢ˆã€‚</p>        <h4 id="1-ä½¿ç”¨-JVM-å†…ç½®å·¥å…·"   >          <a href="#1-ä½¿ç”¨-JVM-å†…ç½®å·¥å…·" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ä½¿ç”¨-JVM-å†…ç½®å·¥å…·" class="headerlink" title="(1) ä½¿ç”¨ JVM å†…ç½®å·¥å…·"></a><strong>(1) ä½¿ç”¨ JVM å†…ç½®å·¥å…·</strong></h4>      <ul><li><strong>jstat</strong>ï¼šç›‘æ§ JVM çš„å†…å­˜å’Œåƒåœ¾å›æ”¶æƒ…å†µã€‚</li><li><strong>jmap</strong>ï¼šç”Ÿæˆå †å†…å­˜å¿«ç…§ã€‚</li><li><strong>jstack</strong>ï¼šç”Ÿæˆçº¿ç¨‹å¿«ç…§ã€‚</li><li><strong>jvisualvm</strong>ï¼šå›¾å½¢åŒ–ç›‘æ§å·¥å…·ã€‚</li></ul>        <h4 id="2-ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·"   >          <a href="#2-ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·" class="headerlink" title="(2) ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·"></a><strong>(2) ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·</strong></h4>      <ul><li><strong>Prometheus + Grafana</strong>ï¼šå®æ—¶ç›‘æ§å’Œå¯è§†åŒ– JVM æŒ‡æ ‡ã€‚</li><li><strong>Arthas</strong>ï¼šåŠ¨æ€è¯Šæ–­ Java åº”ç”¨ç¨‹åºã€‚</li></ul><hr>        <h3 id="6-ä»£ç ä¼˜åŒ–"   >          <a href="#6-ä»£ç ä¼˜åŒ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-ä»£ç ä¼˜åŒ–" class="headerlink" title="6. ä»£ç ä¼˜åŒ–"></a><strong>6. ä»£ç ä¼˜åŒ–</strong></h3>      <p>JVM è°ƒä¼˜ä¸ä»…ä»…æ˜¯å‚æ•°è°ƒæ•´ï¼Œè¿˜éœ€è¦ç»“åˆä»£ç ä¼˜åŒ–ï¼Œä»æºå¤´ä¸Šå‡å°‘èµ„æºæ¶ˆè€—ã€‚</p>        <h4 id="1-å‡å°‘å¯¹è±¡åˆ›å»º"   >          <a href="#1-å‡å°‘å¯¹è±¡åˆ›å»º" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å‡å°‘å¯¹è±¡åˆ›å»º" class="headerlink" title="(1) å‡å°‘å¯¹è±¡åˆ›å»º"></a><strong>(1) å‡å°‘å¯¹è±¡åˆ›å»º</strong></h4>      <ul><li>é¿å…é¢‘ç¹åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡æ± æˆ–ç¼“å­˜ã€‚</li></ul>        <h4 id="2-ä¼˜åŒ–æ•°æ®ç»“æ„"   >          <a href="#2-ä¼˜åŒ–æ•°æ®ç»“æ„" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ä¼˜åŒ–æ•°æ®ç»“æ„" class="headerlink" title="(2) ä¼˜åŒ–æ•°æ®ç»“æ„"></a><strong>(2) ä¼˜åŒ–æ•°æ®ç»“æ„</strong></h4>      <ul><li>æ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ï¼Œå¦‚ä½¿ç”¨ <code>ArrayList</code> ä»£æ›¿ <code>LinkedList</code>ã€‚</li></ul>        <h4 id="3-å‡å°‘é”ç«äº‰"   >          <a href="#3-å‡å°‘é”ç«äº‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-å‡å°‘é”ç«äº‰" class="headerlink" title="(3) å‡å°‘é”ç«äº‰"></a><strong>(3) å‡å°‘é”ç«äº‰</strong></h4>      <ul><li>ä½¿ç”¨æ— é”æ•°æ®ç»“æ„ï¼ˆå¦‚ <code>ConcurrentHashMap</code>ï¼‰æˆ–å‡å°é”ç²’åº¦ã€‚</li></ul><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <p>JVM æ€§èƒ½è°ƒä¼˜æ˜¯ä¸€ä¸ªç³»ç»Ÿæ€§çš„å·¥ä½œï¼Œéœ€è¦ä»å†…å­˜ã€åƒåœ¾å›æ”¶ã€çº¿ç¨‹ã€JIT ç¼–è¯‘å™¨å’Œä»£ç ç­‰å¤šä¸ªæ–¹é¢è¿›è¡Œä¼˜åŒ–ã€‚é€šè¿‡åˆç†é…ç½® JVM å‚æ•°ã€é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨ã€ä¼˜åŒ–ä»£ç ç»“æ„ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ Java åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚åŒæ—¶ï¼Œç»“åˆç›‘æ§å’Œè¯Šæ–­å·¥å…·ï¼Œå¯ä»¥å®æ—¶å‘ç°å’Œè§£å†³æ€§èƒ½ç“¶é¢ˆã€‚</p>]]></content>
    
    
    <summary type="html">JVMæ€§èƒ½è°ƒä¼˜ç­–ç•¥</summary>
    
    
    
    <category term="Java" scheme="https://ljd0620.github.io/categories/Java/"/>
    
    
    <category term="JVM" scheme="https://ljd0620.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>Elasticsearchçš„å·¥ä½œåŸç†</title>
    <link href="https://ljd0620.github.io/2023/11/05/Elasticsearch%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/"/>
    <id>https://ljd0620.github.io/2023/11/05/Elasticsearch%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</id>
    <published>2023-11-05T04:22:33.000Z</published>
    <updated>2025-03-19T02:01:53.565Z</updated>
    
    <content type="html"><![CDATA[<p>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æœç´¢å’Œåˆ†æå¼•æ“ï¼ŒåŸºäº Apache Lucene æ„å»ºã€‚å®ƒèƒ½å¤Ÿå¿«é€Ÿåœ°å­˜å‚¨ã€æœç´¢å’Œåˆ†æå¤§é‡æ•°æ®ï¼Œå¹¿æ³›åº”ç”¨äºæ—¥å¿—åˆ†æã€å…¨æ–‡æœç´¢ã€å®æ—¶æ•°æ®åˆ†æç­‰åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯ Elasticsearch çš„å·¥ä½œåŸç†åŠå…¶æ ¸å¿ƒæœºåˆ¶çš„è¯¦ç»†è§£æï¼š</p><hr>        <h3 id="1-Elasticsearch-çš„æ ¸å¿ƒæ¦‚å¿µ"   >          <a href="#1-Elasticsearch-çš„æ ¸å¿ƒæ¦‚å¿µ" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-Elasticsearch-çš„æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="1. Elasticsearch çš„æ ¸å¿ƒæ¦‚å¿µ"></a><strong>1. Elasticsearch çš„æ ¸å¿ƒæ¦‚å¿µ</strong></h3>      <p>åœ¨ç†è§£ Elasticsearch çš„å·¥ä½œåŸç†ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£å…¶æ ¸å¿ƒæ¦‚å¿µï¼š</p>        <h4 id="1-æ–‡æ¡£ï¼ˆDocumentï¼‰"   >          <a href="#1-æ–‡æ¡£ï¼ˆDocumentï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ–‡æ¡£ï¼ˆDocumentï¼‰" class="headerlink" title="(1) æ–‡æ¡£ï¼ˆDocumentï¼‰"></a><strong>(1) æ–‡æ¡£ï¼ˆDocumentï¼‰</strong></h4>      <ul><li>Elasticsearch ä¸­çš„åŸºæœ¬æ•°æ®å•å…ƒï¼Œç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„ä¸€è¡Œè®°å½•ã€‚</li><li>æ–‡æ¡£æ˜¯ä»¥ JSON æ ¼å¼å­˜å‚¨çš„ã€‚</li></ul>        <h4 id="2-ç´¢å¼•ï¼ˆIndexï¼‰"   >          <a href="#2-ç´¢å¼•ï¼ˆIndexï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ç´¢å¼•ï¼ˆIndexï¼‰" class="headerlink" title="(2) ç´¢å¼•ï¼ˆIndexï¼‰"></a><strong>(2) ç´¢å¼•ï¼ˆIndexï¼‰</strong></h4>      <ul><li>ç´¢å¼•æ˜¯æ–‡æ¡£çš„é›†åˆï¼Œç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ã€‚</li><li>æ¯ä¸ªç´¢å¼•æœ‰ä¸€ä¸ªå”¯ä¸€çš„åç§°ï¼Œç”¨äºæ ‡è¯†å’ŒæŸ¥è¯¢ã€‚</li></ul>        <h4 id="3-ç±»å‹ï¼ˆTypeï¼‰ï¼ˆå·²å¼ƒç”¨ï¼‰"   >          <a href="#3-ç±»å‹ï¼ˆTypeï¼‰ï¼ˆå·²å¼ƒç”¨ï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ç±»å‹ï¼ˆTypeï¼‰ï¼ˆå·²å¼ƒç”¨ï¼‰" class="headerlink" title="(3) ç±»å‹ï¼ˆTypeï¼‰ï¼ˆå·²å¼ƒç”¨ï¼‰"></a><strong>(3) ç±»å‹ï¼ˆTypeï¼‰</strong>ï¼ˆå·²å¼ƒç”¨ï¼‰</h4>      <ul><li>åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œç´¢å¼•å¯ä»¥åŒ…å«å¤šä¸ªç±»å‹ï¼Œç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ç»“æ„ã€‚</li><li>ä» Elasticsearch 7.x å¼€å§‹ï¼Œç±»å‹å·²è¢«å¼ƒç”¨ï¼Œæ¯ä¸ªç´¢å¼•åªèƒ½åŒ…å«ä¸€ä¸ªç±»å‹ <code>_doc</code>ã€‚</li></ul>        <h4 id="4-åˆ†ç‰‡ï¼ˆShardï¼‰"   >          <a href="#4-åˆ†ç‰‡ï¼ˆShardï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-åˆ†ç‰‡ï¼ˆShardï¼‰" class="headerlink" title="(4) åˆ†ç‰‡ï¼ˆShardï¼‰"></a><strong>(4) åˆ†ç‰‡ï¼ˆShardï¼‰</strong></h4>      <ul><li>ç´¢å¼•å¯ä»¥è¢«åˆ†æˆå¤šä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Lucene ç´¢å¼•ã€‚</li><li>åˆ†ç‰‡åˆ†ä¸ºä¸»åˆ†ç‰‡ï¼ˆPrimary Shardï¼‰å’Œå‰¯æœ¬åˆ†ç‰‡ï¼ˆReplica Shardï¼‰ã€‚</li></ul>        <h4 id="5-èŠ‚ç‚¹ï¼ˆNodeï¼‰"   >          <a href="#5-èŠ‚ç‚¹ï¼ˆNodeï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-èŠ‚ç‚¹ï¼ˆNodeï¼‰" class="headerlink" title="(5) èŠ‚ç‚¹ï¼ˆNodeï¼‰"></a><strong>(5) èŠ‚ç‚¹ï¼ˆNodeï¼‰</strong></h4>      <ul><li>ä¸€ä¸ªè¿è¡Œä¸­çš„ Elasticsearch å®ä¾‹ç§°ä¸ºèŠ‚ç‚¹ã€‚</li><li>èŠ‚ç‚¹å¯ä»¥åŠ å…¥é›†ç¾¤ï¼ˆClusterï¼‰ï¼Œé›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆã€‚</li></ul>        <h4 id="6-é›†ç¾¤ï¼ˆClusterï¼‰"   >          <a href="#6-é›†ç¾¤ï¼ˆClusterï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-é›†ç¾¤ï¼ˆClusterï¼‰" class="headerlink" title="(6) é›†ç¾¤ï¼ˆClusterï¼‰"></a><strong>(6) é›†ç¾¤ï¼ˆClusterï¼‰</strong></h4>      <ul><li>é›†ç¾¤æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹çš„é›†åˆï¼Œå…±åŒå­˜å‚¨æ•°æ®å¹¶æä¾›æœç´¢æœåŠ¡ã€‚</li><li>é›†ç¾¤æœ‰ä¸€ä¸ªå”¯ä¸€çš„åç§°ï¼Œé»˜è®¤åç§°ä¸º <code>elasticsearch</code>ã€‚</li></ul><hr>        <h3 id="2-Elasticsearch-çš„å·¥ä½œåŸç†"   >          <a href="#2-Elasticsearch-çš„å·¥ä½œåŸç†" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Elasticsearch-çš„å·¥ä½œåŸç†" class="headerlink" title="2. Elasticsearch çš„å·¥ä½œåŸç†"></a><strong>2. Elasticsearch çš„å·¥ä½œåŸç†</strong></h3>      <p>Elasticsearch çš„å·¥ä½œåŸç†å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>        <h4 id="1-æ•°æ®å†™å…¥"   >          <a href="#1-æ•°æ®å†™å…¥" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ•°æ®å†™å…¥" class="headerlink" title="(1) æ•°æ®å†™å…¥"></a><strong>(1) æ•°æ®å†™å…¥</strong></h4>      <ol><li><strong>å®¢æˆ·ç«¯å‘é€è¯·æ±‚</strong>ï¼š<ul><li>å®¢æˆ·ç«¯å‘ Elasticsearch å‘é€å†™å…¥è¯·æ±‚ï¼ˆå¦‚æ’å…¥ã€æ›´æ–°ã€åˆ é™¤æ–‡æ¡£ï¼‰ã€‚</li></ul></li><li><strong>è·¯ç”±åˆ°ä¸»åˆ†ç‰‡</strong>ï¼š<ul><li>Elasticsearch æ ¹æ®æ–‡æ¡£çš„ <code>_id</code> å’Œç´¢å¼•çš„åˆ†ç‰‡æ•°é‡ï¼Œè®¡ç®—æ–‡æ¡£åº”å­˜å‚¨çš„ä¸»åˆ†ç‰‡ã€‚</li></ul></li><li><strong>å†™å…¥ä¸»åˆ†ç‰‡</strong>ï¼š<ul><li>ä¸»åˆ†ç‰‡å°†æ–‡æ¡£å†™å…¥ Lucene ç´¢å¼•ï¼Œå¹¶ç”Ÿæˆå€’æ’ç´¢å¼•ã€‚</li></ul></li><li><strong>åŒæ­¥å‰¯æœ¬åˆ†ç‰‡</strong>ï¼š<ul><li>ä¸»åˆ†ç‰‡å°†æ•°æ®åŒæ­¥åˆ°å‰¯æœ¬åˆ†ç‰‡ï¼Œç¡®ä¿æ•°æ®å†—ä½™å’Œé«˜å¯ç”¨æ€§ã€‚</li></ul></li><li><strong>è¿”å›å“åº”</strong>ï¼š<ul><li>å®¢æˆ·ç«¯æ”¶åˆ°å†™å…¥æˆåŠŸçš„å“åº”ã€‚</li></ul></li></ol>        <h4 id="2-æ•°æ®æœç´¢"   >          <a href="#2-æ•°æ®æœç´¢" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ•°æ®æœç´¢" class="headerlink" title="(2) æ•°æ®æœç´¢"></a><strong>(2) æ•°æ®æœç´¢</strong></h4>      <ol><li><strong>å®¢æˆ·ç«¯å‘é€è¯·æ±‚</strong>ï¼š<ul><li>å®¢æˆ·ç«¯å‘ Elasticsearch å‘é€æœç´¢è¯·æ±‚ã€‚</li></ul></li><li><strong>è·¯ç”±åˆ°æ‰€æœ‰åˆ†ç‰‡</strong>ï¼š<ul><li>Elasticsearch å°†æœç´¢è¯·æ±‚å‘é€åˆ°ç´¢å¼•çš„æ‰€æœ‰åˆ†ç‰‡ï¼ˆä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡ï¼‰ã€‚</li></ul></li><li><strong>æ‰§è¡Œæœç´¢</strong>ï¼š<ul><li>æ¯ä¸ªåˆ†ç‰‡åœ¨æœ¬åœ°æ‰§è¡Œæœç´¢ï¼Œå¹¶è¿”å›ç»“æœã€‚</li></ul></li><li><strong>åˆå¹¶ç»“æœ</strong>ï¼š<ul><li>Elasticsearch å°†å„ä¸ªåˆ†ç‰‡çš„ç»“æœåˆå¹¶ï¼Œæ’åºåè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ul></li></ol>        <h4 id="3-æ•°æ®å­˜å‚¨"   >          <a href="#3-æ•°æ®å­˜å‚¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æ•°æ®å­˜å‚¨" class="headerlink" title="(3) æ•°æ®å­˜å‚¨"></a><strong>(3) æ•°æ®å­˜å‚¨</strong></h4>      <ul><li>Elasticsearch ä½¿ç”¨ Lucene ä½œä¸ºåº•å±‚å­˜å‚¨å¼•æ“ã€‚</li><li>æ•°æ®ä»¥å€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰çš„å½¢å¼å­˜å‚¨ï¼Œæ”¯æŒé«˜æ•ˆçš„å…¨æ–‡æœç´¢ã€‚</li></ul>        <h4 id="4-æ•°æ®åˆ†å¸ƒ"   >          <a href="#4-æ•°æ®åˆ†å¸ƒ" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-æ•°æ®åˆ†å¸ƒ" class="headerlink" title="(4) æ•°æ®åˆ†å¸ƒ"></a><strong>(4) æ•°æ®åˆ†å¸ƒ</strong></h4>      <ul><li>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹å’Œåˆ†ç‰‡ä¸Šã€‚</li><li>é€šè¿‡åˆ†ç‰‡å’Œå‰¯æœ¬æœºåˆ¶ï¼ŒElasticsearch å®ç°äº†æ•°æ®çš„é«˜å¯ç”¨æ€§å’Œæ‰©å±•æ€§ã€‚</li></ul><hr>        <h3 id="3-Elasticsearch-çš„æ ¸å¿ƒæœºåˆ¶"   >          <a href="#3-Elasticsearch-çš„æ ¸å¿ƒæœºåˆ¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-Elasticsearch-çš„æ ¸å¿ƒæœºåˆ¶" class="headerlink" title="3. Elasticsearch çš„æ ¸å¿ƒæœºåˆ¶"></a><strong>3. Elasticsearch çš„æ ¸å¿ƒæœºåˆ¶</strong></h3>      <p>ä»¥ä¸‹æ˜¯ Elasticsearch çš„æ ¸å¿ƒæœºåˆ¶åŠå…¶å®ç°åŸç†ï¼š</p>        <h4 id="1-å€’æ’ç´¢å¼•ï¼ˆInverted-Indexï¼‰"   >          <a href="#1-å€’æ’ç´¢å¼•ï¼ˆInverted-Indexï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å€’æ’ç´¢å¼•ï¼ˆInverted-Indexï¼‰" class="headerlink" title="(1) å€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰"></a><strong>(1) å€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰</strong></h4>      <ul><li><strong>å®šä¹‰</strong>ï¼š<ul><li>å€’æ’ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œç”¨äºå¿«é€ŸæŸ¥æ‰¾åŒ…å«æŸä¸ªè¯æ¡çš„æ–‡æ¡£ã€‚</li><li>å€’æ’ç´¢å¼•ç”±è¯æ¡è¯å…¸ï¼ˆTerm Dictionaryï¼‰å’Œå€’æ’åˆ—è¡¨ï¼ˆPosting Listï¼‰ç»„æˆã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>ï¼š<ul><li>æ–‡æ¡£ 1ï¼š<code>&#123;&quot;content&quot;: &quot;hello world&quot;&#125;</code></li><li>æ–‡æ¡£ 2ï¼š<code>&#123;&quot;content&quot;: &quot;hello elasticsearch&quot;&#125;</code></li><li>å€’æ’ç´¢å¼•ï¼š<br>hello -&gt; [1, 2]<br>world -&gt; [1]<br>elasticsearch -&gt; [2]</li></ul></li></ul>        <h4 id="2-åˆ†ç‰‡å’Œå‰¯æœ¬"   >          <a href="#2-åˆ†ç‰‡å’Œå‰¯æœ¬" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-åˆ†ç‰‡å’Œå‰¯æœ¬" class="headerlink" title="(2) åˆ†ç‰‡å’Œå‰¯æœ¬"></a><strong>(2) åˆ†ç‰‡å’Œå‰¯æœ¬</strong></h4>      <ul><li><strong>ä¸»åˆ†ç‰‡ï¼ˆPrimary Shardï¼‰</strong>ï¼š<ul><li>æ¯ä¸ªç´¢å¼•è¢«åˆ†æˆå¤šä¸ªä¸»åˆ†ç‰‡ï¼Œä¸»åˆ†ç‰‡è´Ÿè´£æ•°æ®çš„å†™å…¥å’Œæœç´¢ã€‚</li></ul></li><li><strong>å‰¯æœ¬åˆ†ç‰‡ï¼ˆReplica Shardï¼‰</strong>ï¼š<ul><li>æ¯ä¸ªä¸»åˆ†ç‰‡å¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬åˆ†ç‰‡ï¼Œå‰¯æœ¬åˆ†ç‰‡æä¾›æ•°æ®å†—ä½™å’Œé«˜å¯ç”¨æ€§ã€‚</li></ul></li></ul>        <h4 id="3-åˆ†å¸ƒå¼æœç´¢"   >          <a href="#3-åˆ†å¸ƒå¼æœç´¢" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-åˆ†å¸ƒå¼æœç´¢" class="headerlink" title="(3) åˆ†å¸ƒå¼æœç´¢"></a><strong>(3) åˆ†å¸ƒå¼æœç´¢</strong></h4>      <ul><li><strong>æŸ¥è¯¢é˜¶æ®µï¼ˆQuery Phaseï¼‰</strong>ï¼š<ul><li>å®¢æˆ·ç«¯å‘é€æœç´¢è¯·æ±‚ï¼ŒElasticsearch å°†è¯·æ±‚è·¯ç”±åˆ°æ‰€æœ‰åˆ†ç‰‡ã€‚</li><li>æ¯ä¸ªåˆ†ç‰‡åœ¨æœ¬åœ°æ‰§è¡Œæœç´¢ï¼Œå¹¶è¿”å›ç»“æœã€‚</li></ul></li><li><strong>å–å›é˜¶æ®µï¼ˆFetch Phaseï¼‰</strong>ï¼š<ul><li>Elasticsearch å°†å„ä¸ªåˆ†ç‰‡çš„ç»“æœåˆå¹¶ï¼Œæ’åºåè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ul></li></ul>        <h4 id="4-è¿‘å®æ—¶æœç´¢ï¼ˆNear-Real-Time-Searchï¼‰"   >          <a href="#4-è¿‘å®æ—¶æœç´¢ï¼ˆNear-Real-Time-Searchï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-è¿‘å®æ—¶æœç´¢ï¼ˆNear-Real-Time-Searchï¼‰" class="headerlink" title="(4) è¿‘å®æ—¶æœç´¢ï¼ˆNear Real-Time Searchï¼‰"></a><strong>(4) è¿‘å®æ—¶æœç´¢ï¼ˆNear Real-Time Searchï¼‰</strong></h4>      <ul><li><strong>åˆ·æ–°ï¼ˆRefreshï¼‰</strong>ï¼š<ul><li>Elasticsearch é»˜è®¤æ¯éš” 1 ç§’åˆ·æ–°ä¸€æ¬¡ç´¢å¼•ï¼Œä½¿æ–°å†™å…¥çš„æ–‡æ¡£å¯è¢«æœç´¢ã€‚</li></ul></li><li><strong>äº‹åŠ¡æ—¥å¿—ï¼ˆTranslogï¼‰</strong>ï¼š<ul><li>äº‹åŠ¡æ—¥å¿—ç”¨äºä¿è¯æ•°æ®çš„æŒä¹…æ€§ï¼Œåœ¨åˆ·æ–°ç´¢å¼•ä¹‹å‰ï¼Œæ•°æ®ä¼šå…ˆå†™å…¥äº‹åŠ¡æ—¥å¿—ã€‚</li></ul></li></ul>        <h4 id="5-é›†ç¾¤å‘ç°å’Œé€‰ä¸¾"   >          <a href="#5-é›†ç¾¤å‘ç°å’Œé€‰ä¸¾" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-é›†ç¾¤å‘ç°å’Œé€‰ä¸¾" class="headerlink" title="(5) é›†ç¾¤å‘ç°å’Œé€‰ä¸¾"></a><strong>(5) é›†ç¾¤å‘ç°å’Œé€‰ä¸¾</strong></h4>      <ul><li><strong>é›†ç¾¤å‘ç°</strong>ï¼š<ul><li>Elasticsearch ä½¿ç”¨ Zen Discovery æœºåˆ¶å‘ç°é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ã€‚</li></ul></li><li><strong>ä¸»èŠ‚ç‚¹é€‰ä¸¾</strong>ï¼š<ul><li>é›†ç¾¤ä¸­çš„èŠ‚ç‚¹é€šè¿‡é€‰ä¸¾äº§ç”Ÿä¸»èŠ‚ç‚¹ï¼ˆMaster Nodeï¼‰ï¼Œä¸»èŠ‚ç‚¹è´Ÿè´£ç®¡ç†é›†ç¾¤çŠ¶æ€ã€‚</li></ul></li></ul><hr>        <h3 id="4-Elasticsearch-çš„æ¶æ„"   >          <a href="#4-Elasticsearch-çš„æ¶æ„" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-Elasticsearch-çš„æ¶æ„" class="headerlink" title="4. Elasticsearch çš„æ¶æ„"></a><strong>4. Elasticsearch çš„æ¶æ„</strong></h3>      <p>Elasticsearch çš„æ¶æ„å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>        <h4 id="1-å®¢æˆ·ç«¯èŠ‚ç‚¹ï¼ˆClient-Nodeï¼‰"   >          <a href="#1-å®¢æˆ·ç«¯èŠ‚ç‚¹ï¼ˆClient-Nodeï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å®¢æˆ·ç«¯èŠ‚ç‚¹ï¼ˆClient-Nodeï¼‰" class="headerlink" title="(1) å®¢æˆ·ç«¯èŠ‚ç‚¹ï¼ˆClient Nodeï¼‰"></a><strong>(1) å®¢æˆ·ç«¯èŠ‚ç‚¹ï¼ˆClient Nodeï¼‰</strong></h4>      <ul><li>è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚è·¯ç”±åˆ°æ•°æ®èŠ‚ç‚¹ã€‚</li></ul>        <h4 id="2-æ•°æ®èŠ‚ç‚¹ï¼ˆData-Nodeï¼‰"   >          <a href="#2-æ•°æ®èŠ‚ç‚¹ï¼ˆData-Nodeï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ•°æ®èŠ‚ç‚¹ï¼ˆData-Nodeï¼‰" class="headerlink" title="(2) æ•°æ®èŠ‚ç‚¹ï¼ˆData Nodeï¼‰"></a><strong>(2) æ•°æ®èŠ‚ç‚¹ï¼ˆData Nodeï¼‰</strong></h4>      <ul><li>è´Ÿè´£å­˜å‚¨æ•°æ®ï¼Œå¹¶æ‰§è¡Œæœç´¢å’Œèšåˆæ“ä½œã€‚</li></ul>        <h4 id="3-ä¸»èŠ‚ç‚¹ï¼ˆMaster-Nodeï¼‰"   >          <a href="#3-ä¸»èŠ‚ç‚¹ï¼ˆMaster-Nodeï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ä¸»èŠ‚ç‚¹ï¼ˆMaster-Nodeï¼‰" class="headerlink" title="(3) ä¸»èŠ‚ç‚¹ï¼ˆMaster Nodeï¼‰"></a><strong>(3) ä¸»èŠ‚ç‚¹ï¼ˆMaster Nodeï¼‰</strong></h4>      <ul><li>è´Ÿè´£ç®¡ç†é›†ç¾¤çŠ¶æ€ï¼Œå¦‚åˆ›å»ºç´¢å¼•ã€åˆ†é…åˆ†ç‰‡ç­‰ã€‚</li></ul>        <h4 id="4-åè°ƒèŠ‚ç‚¹ï¼ˆCoordinating-Nodeï¼‰"   >          <a href="#4-åè°ƒèŠ‚ç‚¹ï¼ˆCoordinating-Nodeï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-åè°ƒèŠ‚ç‚¹ï¼ˆCoordinating-Nodeï¼‰" class="headerlink" title="(4) åè°ƒèŠ‚ç‚¹ï¼ˆCoordinating Nodeï¼‰"></a><strong>(4) åè°ƒèŠ‚ç‚¹ï¼ˆCoordinating Nodeï¼‰</strong></h4>      <ul><li>è´Ÿè´£åè°ƒæœç´¢è¯·æ±‚ï¼Œåˆå¹¶å„ä¸ªåˆ†ç‰‡çš„ç»“æœã€‚</li></ul><hr>        <h3 id="5-Elasticsearch-çš„ç¤ºä¾‹"   >          <a href="#5-Elasticsearch-çš„ç¤ºä¾‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-Elasticsearch-çš„ç¤ºä¾‹" class="headerlink" title="5. Elasticsearch çš„ç¤ºä¾‹"></a><strong>5. Elasticsearch çš„ç¤ºä¾‹</strong></h3>      <p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Elasticsearch ç¤ºä¾‹ï¼š</p>        <h4 id="1-åˆ›å»ºç´¢å¼•"   >          <a href="#1-åˆ›å»ºç´¢å¼•" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-åˆ›å»ºç´¢å¼•" class="headerlink" title="(1) åˆ›å»ºç´¢å¼•"></a><strong>(1) åˆ›å»ºç´¢å¼•</strong></h4>      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT /my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;number_of_shards&quot;</span>: 3,</span><br><span class="line">    <span class="string">&quot;number_of_replicas&quot;</span>: 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="2-æ’å…¥æ–‡æ¡£"   >          <a href="#2-æ’å…¥æ–‡æ¡£" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ’å…¥æ–‡æ¡£" class="headerlink" title="(2) æ’å…¥æ–‡æ¡£"></a><strong>(2) æ’å…¥æ–‡æ¡£</strong></h4>      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /my_index/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span>,</span><br><span class="line">  <span class="string">&quot;age&quot;</span>: 30</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="3-æœç´¢æ–‡æ¡£"   >          <a href="#3-æœç´¢æ–‡æ¡£" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æœç´¢æ–‡æ¡£" class="headerlink" title="(3) æœç´¢æ–‡æ¡£"></a><strong>(3) æœç´¢æ–‡æ¡£</strong></h4>      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="6-Elasticsearch-çš„ä¼˜ç¼ºç‚¹"   >          <a href="#6-Elasticsearch-çš„ä¼˜ç¼ºç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-Elasticsearch-çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="6. Elasticsearch çš„ä¼˜ç¼ºç‚¹"></a><strong>6. Elasticsearch çš„ä¼˜ç¼ºç‚¹</strong></h3>              <h4 id="1-ä¼˜ç‚¹"   >          <a href="#1-ä¼˜ç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ä¼˜ç‚¹" class="headerlink" title="(1) ä¼˜ç‚¹"></a><strong>(1) ä¼˜ç‚¹</strong></h4>      <ul><li><strong>é«˜æ€§èƒ½</strong>ï¼šæ”¯æŒå¿«é€Ÿçš„å…¨æ–‡æœç´¢å’Œå®æ—¶æ•°æ®åˆ†æã€‚</li><li><strong>åˆ†å¸ƒå¼</strong>ï¼šæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œé€‚åˆå¤„ç†å¤§è§„æ¨¡æ•°æ®ã€‚</li><li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šé€šè¿‡åˆ†ç‰‡å’Œå‰¯æœ¬æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®çš„é«˜å¯ç”¨æ€§ã€‚</li><li><strong>æ˜“ç”¨æ€§</strong>ï¼šæä¾› RESTful APIï¼Œæ˜“äºé›†æˆå’Œä½¿ç”¨ã€‚</li></ul>        <h4 id="2-ç¼ºç‚¹"   >          <a href="#2-ç¼ºç‚¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ç¼ºç‚¹" class="headerlink" title="(2) ç¼ºç‚¹"></a><strong>(2) ç¼ºç‚¹</strong></h4>      <ul><li><strong>èµ„æºæ¶ˆè€—</strong>ï¼šElasticsearch å¯¹å†…å­˜å’Œ CPU çš„éœ€æ±‚è¾ƒé«˜ã€‚</li><li><strong>å¤æ‚æ€§</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿçš„ç®¡ç†å’Œç»´æŠ¤è¾ƒä¸ºå¤æ‚ã€‚</li><li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œæ•°æ®ä¸€è‡´æ€§å¯èƒ½å—åˆ°å½±å“ã€‚</li></ul><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <p>Elasticsearch æ˜¯ä¸€ä¸ªå¼ºå¤§çš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ï¼ŒåŸºäºå€’æ’ç´¢å¼•å’Œåˆ†å¸ƒå¼æ¶æ„ï¼Œèƒ½å¤Ÿå¿«é€Ÿå¤„ç†å¤§è§„æ¨¡æ•°æ®ã€‚å…¶æ ¸å¿ƒæœºåˆ¶åŒ…æ‹¬å€’æ’ç´¢å¼•ã€åˆ†ç‰‡å’Œå‰¯æœ¬ã€åˆ†å¸ƒå¼æœç´¢ã€è¿‘å®æ—¶æœç´¢ç­‰ã€‚ç†è§£ Elasticsearch çš„å·¥ä½œåŸç†åŠå…¶æ ¸å¿ƒæœºåˆ¶ï¼Œæœ‰åŠ©äºæ›´å¥½åœ°ä½¿ç”¨å’Œä¼˜åŒ– Elasticsearchã€‚</p>]]></content>
    
    
    <summary type="html">Elasticsearchçš„å·¥ä½œåŸç†</summary>
    
    
    
    <category term="æœç´¢å¼•æ“" scheme="https://ljd0620.github.io/categories/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/"/>
    
    
    <category term="Elasticsearch" scheme="https://ljd0620.github.io/tags/Elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>ESé›†ç¾¤å¦‚ä½•å¤„ç†æŸ¥è¯¢è¯·æ±‚</title>
    <link href="https://ljd0620.github.io/2023/10/18/ES%E9%9B%86%E7%BE%A4%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E6%9F%A5%E8%AF%A2%E8%AF%B7%E6%B1%82/"/>
    <id>https://ljd0620.github.io/2023/10/18/ES%E9%9B%86%E7%BE%A4%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E6%9F%A5%E8%AF%A2%E8%AF%B7%E6%B1%82/</id>
    <published>2023-10-18T04:29:25.000Z</published>
    <updated>2025-03-19T02:01:56.375Z</updated>
    
    <content type="html"><![CDATA[<p>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æœç´¢å’Œåˆ†æå¼•æ“ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†å¤§è§„æ¨¡æ•°æ®çš„æŸ¥è¯¢è¯·æ±‚ã€‚åœ¨ Elasticsearch é›†ç¾¤ä¸­ï¼ŒæŸ¥è¯¢è¯·æ±‚çš„å¤„ç†æ¶‰åŠå¤šä¸ªæ­¥éª¤å’Œç»„ä»¶ï¼ŒåŒ…æ‹¬å®¢æˆ·ç«¯è¯·æ±‚ã€åè°ƒèŠ‚ç‚¹ã€æ•°æ®èŠ‚ç‚¹å’Œåˆ†ç‰‡ç­‰ã€‚ä»¥ä¸‹æ˜¯ Elasticsearch é›†ç¾¤å¤„ç†æŸ¥è¯¢è¯·æ±‚çš„è¯¦ç»†æµç¨‹ï¼š</p><hr>        <h3 id="1-æŸ¥è¯¢è¯·æ±‚çš„å‘èµ·"   >          <a href="#1-æŸ¥è¯¢è¯·æ±‚çš„å‘èµ·" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æŸ¥è¯¢è¯·æ±‚çš„å‘èµ·" class="headerlink" title="1. æŸ¥è¯¢è¯·æ±‚çš„å‘èµ·"></a><strong>1. æŸ¥è¯¢è¯·æ±‚çš„å‘èµ·</strong></h3>      <ul><li><strong>å®¢æˆ·ç«¯å‘é€è¯·æ±‚</strong>ï¼š<ul><li>å®¢æˆ·ç«¯ï¼ˆå¦‚åº”ç”¨ç¨‹åºæˆ–ç”¨æˆ·ï¼‰å‘ Elasticsearch é›†ç¾¤å‘é€æŸ¥è¯¢è¯·æ±‚ã€‚</li><li>è¯·æ±‚å¯ä»¥å‘é€åˆ°é›†ç¾¤ä¸­çš„ä»»æ„èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ç§°ä¸º<strong>åè°ƒèŠ‚ç‚¹ï¼ˆCoordinating Nodeï¼‰</strong>ã€‚</li></ul></li></ul><hr>        <h3 id="2-åè°ƒèŠ‚ç‚¹æ¥æ”¶è¯·æ±‚"   >          <a href="#2-åè°ƒèŠ‚ç‚¹æ¥æ”¶è¯·æ±‚" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-åè°ƒèŠ‚ç‚¹æ¥æ”¶è¯·æ±‚" class="headerlink" title="2. åè°ƒèŠ‚ç‚¹æ¥æ”¶è¯·æ±‚"></a><strong>2. åè°ƒèŠ‚ç‚¹æ¥æ”¶è¯·æ±‚</strong></h3>      <ul><li><strong>åè°ƒèŠ‚ç‚¹çš„è§’è‰²</strong>ï¼š<ul><li>åè°ƒèŠ‚ç‚¹è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚åˆ†å‘åˆ°ç›¸å…³çš„æ•°æ®èŠ‚ç‚¹ã€‚</li><li>åè°ƒèŠ‚ç‚¹æœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œè€Œæ˜¯è´Ÿè´£åè°ƒæŸ¥è¯¢çš„æ‰§è¡Œå’Œç»“æœçš„åˆå¹¶ã€‚</li></ul></li></ul><hr>        <h3 id="3-æŸ¥è¯¢è§£æä¸è·¯ç”±"   >          <a href="#3-æŸ¥è¯¢è§£æä¸è·¯ç”±" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æŸ¥è¯¢è§£æä¸è·¯ç”±" class="headerlink" title="3. æŸ¥è¯¢è§£æä¸è·¯ç”±"></a><strong>3. æŸ¥è¯¢è§£æä¸è·¯ç”±</strong></h3>      <ul><li><strong>è§£ææŸ¥è¯¢</strong>ï¼š<ul><li>åè°ƒèŠ‚ç‚¹è§£ææŸ¥è¯¢è¯·æ±‚ï¼Œç¡®å®šéœ€è¦æŸ¥è¯¢çš„ç´¢å¼•å’Œåˆ†ç‰‡ã€‚</li></ul></li><li><strong>è·¯ç”±è¯·æ±‚</strong>ï¼š<ul><li>æ ¹æ®ç´¢å¼•çš„åˆ†ç‰‡é…ç½®ï¼Œåè°ƒèŠ‚ç‚¹å°†æŸ¥è¯¢è¯·æ±‚è·¯ç”±åˆ°åŒ…å«ç›¸å…³æ•°æ®çš„åˆ†ç‰‡ã€‚</li><li>æ¯ä¸ªåˆ†ç‰‡å¯èƒ½ä½äºé›†ç¾¤ä¸­çš„ä¸åŒæ•°æ®èŠ‚ç‚¹ä¸Šã€‚</li></ul></li></ul><hr>        <h3 id="4-åˆ†ç‰‡æ‰§è¡ŒæŸ¥è¯¢"   >          <a href="#4-åˆ†ç‰‡æ‰§è¡ŒæŸ¥è¯¢" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-åˆ†ç‰‡æ‰§è¡ŒæŸ¥è¯¢" class="headerlink" title="4. åˆ†ç‰‡æ‰§è¡ŒæŸ¥è¯¢"></a><strong>4. åˆ†ç‰‡æ‰§è¡ŒæŸ¥è¯¢</strong></h3>      <ul><li><strong>åˆ†ç‰‡çš„è§’è‰²</strong>ï¼š<ul><li>æ¯ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Lucene ç´¢å¼•ï¼Œè´Ÿè´£å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ã€‚</li></ul></li><li><strong>æŸ¥è¯¢æ‰§è¡Œ</strong>ï¼š<ul><li>æ¯ä¸ªåˆ†ç‰‡åœ¨æœ¬åœ°æ‰§è¡ŒæŸ¥è¯¢ï¼Œæœç´¢åŒ¹é…çš„æ–‡æ¡£ã€‚</li><li>åˆ†ç‰‡è¿”å›æŸ¥è¯¢ç»“æœï¼ˆé€šå¸¸æ˜¯æ–‡æ¡£ ID å’Œç›¸å…³æ€§åˆ†æ•°ï¼‰ç»™åè°ƒèŠ‚ç‚¹ã€‚</li></ul></li></ul><hr>        <h3 id="5-ç»“æœåˆå¹¶ä¸æ’åº"   >          <a href="#5-ç»“æœåˆå¹¶ä¸æ’åº" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-ç»“æœåˆå¹¶ä¸æ’åº" class="headerlink" title="5. ç»“æœåˆå¹¶ä¸æ’åº"></a><strong>5. ç»“æœåˆå¹¶ä¸æ’åº</strong></h3>      <ul><li><strong>åè°ƒèŠ‚ç‚¹åˆå¹¶ç»“æœ</strong>ï¼š<ul><li>åè°ƒèŠ‚ç‚¹ä»æ‰€æœ‰ç›¸å…³åˆ†ç‰‡æ”¶é›†æŸ¥è¯¢ç»“æœã€‚</li><li>æ ¹æ®æŸ¥è¯¢çš„æ’åºè§„åˆ™ï¼ˆå¦‚ç›¸å…³æ€§åˆ†æ•°ã€å­—æ®µå€¼ç­‰ï¼‰ï¼Œåè°ƒèŠ‚ç‚¹å¯¹ç»“æœè¿›è¡Œåˆå¹¶å’Œæ’åºã€‚</li></ul></li><li><strong>åˆ†é¡µå¤„ç†</strong>ï¼š<ul><li>å¦‚æœæŸ¥è¯¢è¯·æ±‚åŒ…å«åˆ†é¡µå‚æ•°ï¼ˆå¦‚ <code>from</code> å’Œ <code>size</code>ï¼‰ï¼Œåè°ƒèŠ‚ç‚¹ä¼šæ ¹æ®åˆ†é¡µå‚æ•°æˆªå–ç»“æœã€‚</li></ul></li></ul><hr>        <h3 id="6-è¿”å›æœ€ç»ˆç»“æœ"   >          <a href="#6-è¿”å›æœ€ç»ˆç»“æœ" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-è¿”å›æœ€ç»ˆç»“æœ" class="headerlink" title="6. è¿”å›æœ€ç»ˆç»“æœ"></a><strong>6. è¿”å›æœ€ç»ˆç»“æœ</strong></h3>      <ul><li><strong>è¿”å›ç»“æœç»™å®¢æˆ·ç«¯</strong>ï¼š<ul><li>åè°ƒèŠ‚ç‚¹å°†æœ€ç»ˆçš„æŸ¥è¯¢ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li>ç»“æœé€šå¸¸åŒ…æ‹¬åŒ¹é…çš„æ–‡æ¡£åˆ—è¡¨ã€æ€»å‘½ä¸­æ•°ã€åˆ†é¡µä¿¡æ¯ç­‰ã€‚</li></ul></li></ul><hr>        <h3 id="7-æŸ¥è¯¢ç±»å‹ä¸ä¼˜åŒ–"   >          <a href="#7-æŸ¥è¯¢ç±»å‹ä¸ä¼˜åŒ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-æŸ¥è¯¢ç±»å‹ä¸ä¼˜åŒ–" class="headerlink" title="7. æŸ¥è¯¢ç±»å‹ä¸ä¼˜åŒ–"></a><strong>7. æŸ¥è¯¢ç±»å‹ä¸ä¼˜åŒ–</strong></h3>      <p>Elasticsearch æ”¯æŒå¤šç§æŸ¥è¯¢ç±»å‹ï¼Œæ¯ç§æŸ¥è¯¢ç±»å‹çš„å¤„ç†æ–¹å¼å¯èƒ½æœ‰æ‰€ä¸åŒï¼š</p>        <h4 id="1-ç®€å•æŸ¥è¯¢ï¼ˆå¦‚-match-æŸ¥è¯¢ï¼‰"   >          <a href="#1-ç®€å•æŸ¥è¯¢ï¼ˆå¦‚-match-æŸ¥è¯¢ï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ç®€å•æŸ¥è¯¢ï¼ˆå¦‚-match-æŸ¥è¯¢ï¼‰" class="headerlink" title="(1) ç®€å•æŸ¥è¯¢ï¼ˆå¦‚ match æŸ¥è¯¢ï¼‰"></a><strong>(1) ç®€å•æŸ¥è¯¢ï¼ˆå¦‚ <code>match</code> æŸ¥è¯¢ï¼‰</strong></h4>      <ul><li>ç›´æ¥åœ¨å€’æ’ç´¢å¼•ä¸­æŸ¥æ‰¾åŒ¹é…çš„æ–‡æ¡£ã€‚</li><li>é€‚ç”¨äºå…¨æ–‡æœç´¢ã€‚</li></ul>        <h4 id="2-èšåˆæŸ¥è¯¢ï¼ˆAggregationï¼‰"   >          <a href="#2-èšåˆæŸ¥è¯¢ï¼ˆAggregationï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-èšåˆæŸ¥è¯¢ï¼ˆAggregationï¼‰" class="headerlink" title="(2) èšåˆæŸ¥è¯¢ï¼ˆAggregationï¼‰"></a><strong>(2) èšåˆæŸ¥è¯¢ï¼ˆAggregationï¼‰</strong></h4>      <ul><li>åœ¨æŸ¥è¯¢ç»“æœçš„åŸºç¡€ä¸Šè¿›è¡Œç»Ÿè®¡åˆ†æï¼ˆå¦‚æ±‚å’Œã€å¹³å‡å€¼ã€åˆ†ç»„ç­‰ï¼‰ã€‚</li><li>èšåˆæŸ¥è¯¢éœ€è¦åœ¨æ‰€æœ‰åˆ†ç‰‡ä¸Šæ‰§è¡Œï¼Œå¹¶å°†ç»“æœåˆå¹¶ã€‚</li></ul>        <h4 id="3-è¿‡æ»¤æŸ¥è¯¢ï¼ˆFilterï¼‰"   >          <a href="#3-è¿‡æ»¤æŸ¥è¯¢ï¼ˆFilterï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-è¿‡æ»¤æŸ¥è¯¢ï¼ˆFilterï¼‰" class="headerlink" title="(3) è¿‡æ»¤æŸ¥è¯¢ï¼ˆFilterï¼‰"></a><strong>(3) è¿‡æ»¤æŸ¥è¯¢ï¼ˆFilterï¼‰</strong></h4>      <ul><li>è¿‡æ»¤æŸ¥è¯¢ä¸ä¼šè®¡ç®—ç›¸å…³æ€§åˆ†æ•°ï¼Œé€šå¸¸ç”¨äºç²¾ç¡®åŒ¹é…ã€‚</li><li>è¿‡æ»¤æŸ¥è¯¢çš„ç»“æœä¼šè¢«ç¼“å­˜ï¼Œä»¥æé«˜æ€§èƒ½ã€‚</li></ul>        <h4 id="4-æ’åºæŸ¥è¯¢ï¼ˆSortï¼‰"   >          <a href="#4-æ’åºæŸ¥è¯¢ï¼ˆSortï¼‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-æ’åºæŸ¥è¯¢ï¼ˆSortï¼‰" class="headerlink" title="(4) æ’åºæŸ¥è¯¢ï¼ˆSortï¼‰"></a><strong>(4) æ’åºæŸ¥è¯¢ï¼ˆSortï¼‰</strong></h4>      <ul><li>æ ¹æ®æŒ‡å®šçš„å­—æ®µå¯¹ç»“æœè¿›è¡Œæ’åºã€‚</li><li>å¦‚æœæ’åºå­—æ®µæœªç´¢å¼•ï¼Œå¯èƒ½éœ€è¦åŠ è½½æ–‡æ¡£å­—æ®µå€¼ã€‚</li></ul><hr>        <h3 id="8-æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥"   >          <a href="#8-æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="8. æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥"></a><strong>8. æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥</strong></h3>      <p>ä¸ºäº†æé«˜æŸ¥è¯¢æ€§èƒ½ï¼ŒElasticsearch æä¾›äº†å¤šç§ä¼˜åŒ–ç­–ç•¥ï¼š</p>        <h4 id="1-ä½¿ç”¨è¿‡æ»¤å™¨ç¼“å­˜"   >          <a href="#1-ä½¿ç”¨è¿‡æ»¤å™¨ç¼“å­˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ä½¿ç”¨è¿‡æ»¤å™¨ç¼“å­˜" class="headerlink" title="(1) ä½¿ç”¨è¿‡æ»¤å™¨ç¼“å­˜"></a><strong>(1) ä½¿ç”¨è¿‡æ»¤å™¨ç¼“å­˜</strong></h4>      <ul><li>è¿‡æ»¤æŸ¥è¯¢çš„ç»“æœä¼šè¢«ç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚</li><li>é€‚ç”¨äºé¢‘ç¹æ‰§è¡Œçš„è¿‡æ»¤æ¡ä»¶ã€‚</li></ul>        <h4 id="2-åˆ†ç‰‡åˆ†é…ä¸å‰¯æœ¬"   >          <a href="#2-åˆ†ç‰‡åˆ†é…ä¸å‰¯æœ¬" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-åˆ†ç‰‡åˆ†é…ä¸å‰¯æœ¬" class="headerlink" title="(2) åˆ†ç‰‡åˆ†é…ä¸å‰¯æœ¬"></a><strong>(2) åˆ†ç‰‡åˆ†é…ä¸å‰¯æœ¬</strong></h4>      <ul><li>åˆç†åˆ†é…åˆ†ç‰‡å’Œå‰¯æœ¬ï¼Œé¿å…æŸ¥è¯¢é›†ä¸­åœ¨å°‘æ•°èŠ‚ç‚¹ä¸Šã€‚</li><li>å¢åŠ å‰¯æœ¬åˆ†ç‰‡å¯ä»¥æé«˜æŸ¥è¯¢çš„å¹¶å‘èƒ½åŠ›ã€‚</li></ul>        <h4 id="3-ä½¿ç”¨æœç´¢æ¨¡æ¿"   >          <a href="#3-ä½¿ç”¨æœç´¢æ¨¡æ¿" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-ä½¿ç”¨æœç´¢æ¨¡æ¿" class="headerlink" title="(3) ä½¿ç”¨æœç´¢æ¨¡æ¿"></a><strong>(3) ä½¿ç”¨æœç´¢æ¨¡æ¿</strong></h4>      <ul><li>å°†å¸¸ç”¨çš„æŸ¥è¯¢ä¿å­˜ä¸ºæ¨¡æ¿ï¼Œå‡å°‘æŸ¥è¯¢è§£æçš„å¼€é”€ã€‚</li></ul>        <h4 id="4-ä¼˜åŒ–ç´¢å¼•è®¾è®¡"   >          <a href="#4-ä¼˜åŒ–ç´¢å¼•è®¾è®¡" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-ä¼˜åŒ–ç´¢å¼•è®¾è®¡" class="headerlink" title="(4) ä¼˜åŒ–ç´¢å¼•è®¾è®¡"></a><strong>(4) ä¼˜åŒ–ç´¢å¼•è®¾è®¡</strong></h4>      <ul><li>ä½¿ç”¨åˆé€‚çš„åˆ†è¯å™¨å’Œå­—æ®µç±»å‹ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li><li>é¿å…ä½¿ç”¨è¿‡å¤šçš„åµŒå¥—å­—æ®µå’Œè„šæœ¬ã€‚</li></ul>        <h4 id="5-åˆ†é¡µä¼˜åŒ–"   >          <a href="#5-åˆ†é¡µä¼˜åŒ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-åˆ†é¡µä¼˜åŒ–" class="headerlink" title="(5) åˆ†é¡µä¼˜åŒ–"></a><strong>(5) åˆ†é¡µä¼˜åŒ–</strong></h4>      <ul><li>é¿å…æ·±åº¦åˆ†é¡µï¼ˆå¦‚ <code>from</code> å€¼è¿‡å¤§ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>search_after</code> æˆ–æ»šåŠ¨æŸ¥è¯¢ï¼ˆScroll APIï¼‰ã€‚</li></ul><hr>        <h3 id="9-æŸ¥è¯¢è¯·æ±‚çš„ç¤ºä¾‹"   >          <a href="#9-æŸ¥è¯¢è¯·æ±‚çš„ç¤ºä¾‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-æŸ¥è¯¢è¯·æ±‚çš„ç¤ºä¾‹" class="headerlink" title="9. æŸ¥è¯¢è¯·æ±‚çš„ç¤ºä¾‹"></a><strong>9. æŸ¥è¯¢è¯·æ±‚çš„ç¤ºä¾‹</strong></h3>      <p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢è¯·æ±‚ç¤ºä¾‹ï¼š</p>        <h4 id="1-æŸ¥è¯¢è¯·æ±‚"   >          <a href="#1-æŸ¥è¯¢è¯·æ±‚" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æŸ¥è¯¢è¯·æ±‚" class="headerlink" title="(1) æŸ¥è¯¢è¯·æ±‚"></a><strong>(1) æŸ¥è¯¢è¯·æ±‚</strong></h4>      <figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Elasticsearch&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></div></figure>        <h4 id="2-æŸ¥è¯¢ç»“æœ"   >          <a href="#2-æŸ¥è¯¢ç»“æœ" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æŸ¥è¯¢ç»“æœ" class="headerlink" title="(2) æŸ¥è¯¢ç»“æœ"></a><strong>(2) æŸ¥è¯¢ç»“æœ</strong></h4>      <figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;took&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hits&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;relation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eq&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hits&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_index&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Elasticsearch is awesome&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-10-01T12:00:00Z&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="number">1696166400000</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></div></figure><hr>        <h3 id="æ€»ç»“"   >          <a href="#æ€»ç»“" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3>      <p>Elasticsearch é›†ç¾¤å¤„ç†æŸ¥è¯¢è¯·æ±‚çš„æµç¨‹åŒ…æ‹¬å®¢æˆ·ç«¯è¯·æ±‚ã€åè°ƒèŠ‚ç‚¹è·¯ç”±ã€åˆ†ç‰‡æ‰§è¡ŒæŸ¥è¯¢ã€ç»“æœåˆå¹¶ä¸æ’åºï¼Œæœ€ç»ˆè¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚é€šè¿‡åˆç†è®¾è®¡ç´¢å¼•ã€ä¼˜åŒ–æŸ¥è¯¢å’Œä½¿ç”¨ç¼“å­˜ç­‰ç­–ç•¥ï¼Œå¯ä»¥æ˜¾è‘—æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚ç†è§£ Elasticsearch çš„æŸ¥è¯¢å¤„ç†æœºåˆ¶ï¼Œæœ‰åŠ©äºæ›´å¥½åœ°ä½¿ç”¨å’Œä¼˜åŒ– Elasticsearchã€‚</p>]]></content>
    
    
    <summary type="html">ESé›†ç¾¤å¦‚ä½•å¤„ç†æŸ¥è¯¢è¯·æ±‚</summary>
    
    
    
    <category term="æœç´¢å¼•æ“" scheme="https://ljd0620.github.io/categories/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/"/>
    
    
    <category term="Elasticsearch" scheme="https://ljd0620.github.io/tags/Elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ</title>
    <link href="https://ljd0620.github.io/2023/09/22/%E5%88%86%E5%B8%83%E5%BC%8FID%E7%94%9F%E6%88%90%E6%96%B9%E6%A1%88/"/>
    <id>https://ljd0620.github.io/2023/09/22/%E5%88%86%E5%B8%83%E5%BC%8FID%E7%94%9F%E6%88%90%E6%96%B9%E6%A1%88/</id>
    <published>2023-09-22T04:39:31.000Z</published>
    <updated>2025-03-19T02:03:36.345Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ ¸å¿ƒé—®é¢˜ä¹‹ä¸€ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘ã€é«˜å¯ç”¨çš„åœºæ™¯ä¸‹ï¼Œéœ€è¦ä¿è¯ç”Ÿæˆçš„IDå…·å¤‡ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ol><li><strong>å…¨å±€å”¯ä¸€æ€§</strong>ï¼šIDåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¿…é¡»å”¯ä¸€ã€‚</li><li><strong>æœ‰åºæ€§</strong>ï¼šIDæœ€å¥½æ˜¯æœ‰åºçš„ï¼Œä¾¿äºæ•°æ®åº“ç´¢å¼•å’ŒæŸ¥è¯¢ã€‚</li><li><strong>é«˜æ€§èƒ½</strong>ï¼šIDç”Ÿæˆé€Ÿåº¦è¦å¿«ï¼Œä¸èƒ½æˆä¸ºç³»ç»Ÿç“¶é¢ˆã€‚</li><li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šIDç”ŸæˆæœåŠ¡å¿…é¡»é«˜å¯ç”¨ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚</li><li><strong>å¯æ‰©å±•æ€§</strong>ï¼šæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œé€‚åº”ä¸šåŠ¡å¢é•¿ã€‚</li></ol><p>ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆåŠå…¶å®ç°ç»†èŠ‚ï¼š</p><hr>        <h3 id="ä¸€ã€å¸¸è§åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ"   >          <a href="#ä¸€ã€å¸¸è§åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸€ã€å¸¸è§åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ" class="headerlink" title="ä¸€ã€å¸¸è§åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ"></a>ä¸€ã€å¸¸è§åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ</h3>              <h4 id="1-UUID"   >          <a href="#1-UUID" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-UUID" class="headerlink" title="1. UUID"></a>1. <strong>UUID</strong></h4>      <ul><li><strong>åŸç†</strong>ï¼šåŸºäºéšæœºæ•°ç”Ÿæˆ128ä½çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>ç®€å•æ˜“ç”¨ï¼Œæ— éœ€ä¸­å¿ƒåŒ–æœåŠ¡ã€‚</li><li>ç”Ÿæˆé€Ÿåº¦å¿«ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>æ— åºï¼Œä¸é€‚åˆä½œä¸ºæ•°æ®åº“ä¸»é”®ã€‚</li><li>å­˜å‚¨ç©ºé—´å¤§ï¼ˆ36å­—ç¬¦ï¼‰ã€‚</li><li>æŸ¥è¯¢æ€§èƒ½å·®ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå°è§„æ¨¡ã€éè¿ç»­IDåœºæ™¯ã€‚</li></ul><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UUIDGenerator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h4 id="2-æ•°æ®åº“è‡ªå¢ID"   >          <a href="#2-æ•°æ®åº“è‡ªå¢ID" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ•°æ®åº“è‡ªå¢ID" class="headerlink" title="2. æ•°æ®åº“è‡ªå¢ID"></a>2. <strong>æ•°æ®åº“è‡ªå¢ID</strong></h4>      <ul><li><strong>åŸç†</strong>ï¼šåˆ©ç”¨æ•°æ®åº“çš„è‡ªå¢ä¸»é”®ç‰¹æ€§ç”ŸæˆIDã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>ç®€å•æ˜“å®ç°ã€‚</li><li>IDæœ‰åºã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>æ€§èƒ½ç“¶é¢ˆï¼Œå•ç‚¹æ•…éšœã€‚</li><li>ä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå°è§„æ¨¡ã€ä½å¹¶å‘åœºæ™¯ã€‚</li></ul><figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> id_generator (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT</span><br><span class="line">);</span><br></pre></td></tr></table></div></figure><hr>        <h4 id="3-Redisè‡ªå¢ID"   >          <a href="#3-Redisè‡ªå¢ID" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-Redisè‡ªå¢ID" class="headerlink" title="3. Redisè‡ªå¢ID"></a>3. <strong>Redisè‡ªå¢ID</strong></h4>      <ul><li><strong>åŸç†</strong>ï¼šåˆ©ç”¨Redisçš„<code>INCR</code>å‘½ä»¤ç”Ÿæˆè‡ªå¢IDã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>é«˜æ€§èƒ½ï¼Œæ”¯æŒåˆ†å¸ƒå¼ã€‚</li><li>ç®€å•æ˜“ç”¨ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>ä¾èµ–Redisï¼Œéœ€è€ƒè™‘æŒä¹…åŒ–å’Œé«˜å¯ç”¨ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä¸­ç­‰è§„æ¨¡ã€é«˜å¹¶å‘åœºæ™¯ã€‚</li></ul><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisIdGenerator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ID_KEY</span> <span class="operator">=</span> <span class="string">&quot;global:id&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisIdGenerator</span><span class="params">(Jedis jedis)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jedis = jedis;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">nextId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> jedis.incr(ID_KEY);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h4 id="4-Snowflakeç®—æ³•"   >          <a href="#4-Snowflakeç®—æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-Snowflakeç®—æ³•" class="headerlink" title="4. Snowflakeç®—æ³•"></a>4. <strong>Snowflakeç®—æ³•</strong></h4>      <ul><li><strong>åŸç†</strong>ï¼šç”Ÿæˆ64ä½çš„IDï¼ŒåŒ…å«æ—¶é—´æˆ³ã€æœºå™¨IDå’Œåºåˆ—å·ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>é«˜æ€§èƒ½ï¼Œåˆ†å¸ƒå¼ç”Ÿæˆã€‚</li><li>IDæœ‰åºã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>ä¾èµ–æœºå™¨æ—¶é’Ÿï¼Œæ—¶é’Ÿå›æ‹¨é—®é¢˜ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤§è§„æ¨¡ã€é«˜å¹¶å‘åœºæ™¯ã€‚</li></ul><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SnowflakeIdGenerator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">epoch</span> <span class="operator">=</span> <span class="number">1609459200000L</span>; <span class="comment">// 2021-01-01 00:00:00</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">workerIdBits</span> <span class="operator">=</span> <span class="number">10L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">sequenceBits</span> <span class="operator">=</span> <span class="number">12L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">maxWorkerId</span> <span class="operator">=</span> ~(-<span class="number">1L</span> &lt;&lt; workerIdBits);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">workerIdShift</span> <span class="operator">=</span> sequenceBits;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">timestampShift</span> <span class="operator">=</span> sequenceBits + workerIdBits;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">sequenceMask</span> <span class="operator">=</span> ~(-<span class="number">1L</span> &lt;&lt; sequenceBits);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> workerId;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">sequence</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">lastTimestamp</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SnowflakeIdGenerator</span><span class="params">(<span class="type">long</span> workerId)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (workerId &gt; maxWorkerId || workerId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Worker IDè¶…å‡ºèŒƒå›´&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.workerId = workerId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">long</span> <span class="title function_">nextId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">if</span> (timestamp &lt; lastTimestamp) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ—¶é’Ÿå›æ‹¨å¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (timestamp == lastTimestamp) &#123;</span><br><span class="line">            sequence = (sequence + <span class="number">1</span>) &amp; sequenceMask;</span><br><span class="line">            <span class="keyword">if</span> (sequence == <span class="number">0</span>) &#123;</span><br><span class="line">                timestamp = tilNextMillis(lastTimestamp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sequence = <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        lastTimestamp = timestamp;</span><br><span class="line">        <span class="keyword">return</span> ((timestamp - epoch) &lt;&lt; timestampShift)</span><br><span class="line">                | (workerId &lt;&lt; workerIdShift)</span><br><span class="line">                | sequence;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">tilNextMillis</span><span class="params">(<span class="type">long</span> lastTimestamp)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">while</span> (timestamp &lt;= lastTimestamp) &#123;</span><br><span class="line">            timestamp = System.currentTimeMillis();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> timestamp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h4 id="5-Leafç®—æ³•"   >          <a href="#5-Leafç®—æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-Leafç®—æ³•" class="headerlink" title="5. Leafç®—æ³•"></a>5. <strong>Leafç®—æ³•</strong></h4>      <ul><li><strong>åŸç†</strong>ï¼šç¾å›¢å¼€æºçš„åˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡ï¼Œæ”¯æŒå·æ®µæ¨¡å¼å’ŒSnowflakeæ¨¡å¼ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>é«˜æ€§èƒ½ï¼Œæ”¯æŒåˆ†æ®µç¼“å­˜ã€‚</li><li>IDæœ‰åºã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>ä¾èµ–æ•°æ®åº“ï¼Œå®ç°å¤æ‚ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤§è§„æ¨¡ã€é«˜å¹¶å‘åœºæ™¯ã€‚</li></ul><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeafSegmentService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> AtomicLong currentId;</span><br><span class="line">    <span class="keyword">private</span> AtomicLong maxId;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> step;</span><br><span class="line">    <span class="keyword">private</span> String bizTag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LeafSegmentService</span><span class="params">(String bizTag)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bizTag = bizTag;</span><br><span class="line">        loadSegment();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loadSegment</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä»æ•°æ®åº“è·å–å·æ®µ</span></span><br><span class="line">        <span class="type">IdSegment</span> <span class="variable">segment</span> <span class="operator">=</span> idSegmentDAO.getSegment(bizTag);</span><br><span class="line">        currentId = <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(segment.getMaxId() - segment.getStep());</span><br><span class="line">        maxId = <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(segment.getMaxId());</span><br><span class="line">        step = segment.getStep();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">nextId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> currentId.incrementAndGet();</span><br><span class="line">        <span class="keyword">if</span> (id &gt;= maxId.get()) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (id &gt;= maxId.get()) &#123;</span><br><span class="line">                    loadSegment();</span><br><span class="line">                    id = currentId.incrementAndGet();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><hr>        <h3 id="äºŒã€æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®"   >          <a href="#äºŒã€æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®" class="heading-link"><i class="fas fa-link"></i></a><a href="#äºŒã€æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®" class="headerlink" title="äºŒã€æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®"></a>äºŒã€æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®</h3>      <div class="table-container"><table><thead><tr><th>æ–¹æ¡ˆ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>UUID</strong></td><td>ç®€å•ã€æ— éœ€ä¸­å¿ƒåŒ–æœåŠ¡</td><td>æ— åºã€å­˜å‚¨ç©ºé—´å¤§ã€æŸ¥è¯¢æ€§èƒ½å·®</td><td>å°è§„æ¨¡ã€éè¿ç»­IDåœºæ™¯</td></tr><tr><td><strong>æ•°æ®åº“è‡ªå¢ID</strong></td><td>ç®€å•ã€æœ‰åº</td><td>æ€§èƒ½ç“¶é¢ˆã€å•ç‚¹æ•…éšœ</td><td>å°è§„æ¨¡ã€ä½å¹¶å‘åœºæ™¯</td></tr><tr><td><strong>Redisè‡ªå¢ID</strong></td><td>æ€§èƒ½é«˜ã€æ”¯æŒåˆ†å¸ƒå¼</td><td>ä¾èµ–Redisã€æŒä¹…åŒ–é—®é¢˜</td><td>ä¸­ç­‰è§„æ¨¡ã€é«˜å¹¶å‘åœºæ™¯</td></tr><tr><td><strong>Snowflakeç®—æ³•</strong></td><td>é«˜æ€§èƒ½ã€æœ‰åºã€åˆ†å¸ƒå¼</td><td>ä¾èµ–æœºå™¨æ—¶é’Ÿã€æ—¶é’Ÿå›æ‹¨é—®é¢˜</td><td>å¤§è§„æ¨¡ã€é«˜å¹¶å‘åœºæ™¯</td></tr><tr><td><strong>Leafç®—æ³•</strong></td><td>é«˜æ€§èƒ½ã€æ”¯æŒåˆ†æ®µç¼“å­˜</td><td>ä¾èµ–æ•°æ®åº“ã€å®ç°å¤æ‚</td><td>å¤§è§„æ¨¡ã€é«˜å¹¶å‘åœºæ™¯</td></tr></tbody></table></div><hr>        <h3 id="ä¸‰ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®"   >          <a href="#ä¸‰ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸‰ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="ä¸‰ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>ä¸‰ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>      <ol><li><p><strong>Snowflakeä¼˜åŒ–</strong>ï¼š</p><ul><li>ä½¿ç”¨Zookeeperæˆ–NacosåŠ¨æ€åˆ†é…<code>workerId</code>ã€‚</li><li>å¢åŠ æ—¶é’Ÿå›æ‹¨æ£€æµ‹æœºåˆ¶ã€‚</li></ul></li><li><p><strong>Leaf-Segmentä¼˜åŒ–</strong>ï¼š</p><ul><li>å¢åŠ åŒBufferæœºåˆ¶ï¼Œé¢„åŠ è½½ä¸‹ä¸€ä¸ªå·æ®µã€‚</li><li>ä½¿ç”¨æœ¬åœ°ç¼“å­˜å‡å°‘æ•°æ®åº“è®¿é—®ã€‚</li></ul></li><li><p><strong>Redisä¼˜åŒ–</strong>ï¼š</p><ul><li>ä½¿ç”¨Redisé›†ç¾¤æé«˜å¯ç”¨æ€§ã€‚</li><li>è®¾ç½®åˆç†çš„<code>INCR</code>æ­¥é•¿ï¼Œå‡å°‘ç½‘ç»œå¼€é”€ã€‚</li></ul></li></ol><hr>        <h3 id="å››ã€å…¸å‹åœºæ™¯ç¤ºä¾‹"   >          <a href="#å››ã€å…¸å‹åœºæ™¯ç¤ºä¾‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#å››ã€å…¸å‹åœºæ™¯ç¤ºä¾‹" class="headerlink" title="å››ã€å…¸å‹åœºæ™¯ç¤ºä¾‹"></a>å››ã€å…¸å‹åœºæ™¯ç¤ºä¾‹</h3>              <h4 id="1-ç”µå•†è®¢å•IDç”Ÿæˆ"   >          <a href="#1-ç”µå•†è®¢å•IDç”Ÿæˆ" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ç”µå•†è®¢å•IDç”Ÿæˆ" class="headerlink" title="1. ç”µå•†è®¢å•IDç”Ÿæˆ"></a>1. <strong>ç”µå•†è®¢å•IDç”Ÿæˆ</strong></h4>      <ul><li>ä½¿ç”¨Snowflakeç®—æ³•ï¼Œç¡®ä¿IDæœ‰åºä¸”é«˜æ€§èƒ½ã€‚</li><li>ä¸šåŠ¡æ ‡è¯†åµŒå…¥<code>workerId</code>ï¼Œä¾¿äºåˆ†åº“åˆ†è¡¨ã€‚</li></ul>        <h4 id="2-æ—¥å¿—è¿½è¸ªIDç”Ÿæˆ"   >          <a href="#2-æ—¥å¿—è¿½è¸ªIDç”Ÿæˆ" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-æ—¥å¿—è¿½è¸ªIDç”Ÿæˆ" class="headerlink" title="2. æ—¥å¿—è¿½è¸ªIDç”Ÿæˆ"></a>2. <strong>æ—¥å¿—è¿½è¸ªIDç”Ÿæˆ</strong></h4>      <ul><li>ä½¿ç”¨Leaf-Segmentæ–¹æ¡ˆï¼Œæ”¯æŒå¤§èŒƒå›´IDåˆ†é…ã€‚</li><li>ç»“åˆä¸šåŠ¡æ ‡è¯†ï¼ˆå¦‚<code>biz_tag</code>ï¼‰å®ç°å¤šä¸šåŠ¡éš”ç¦»ã€‚</li></ul>        <h4 id="3-åˆ†å¸ƒå¼é”IDç”Ÿæˆ"   >          <a href="#3-åˆ†å¸ƒå¼é”IDç”Ÿæˆ" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-åˆ†å¸ƒå¼é”IDç”Ÿæˆ" class="headerlink" title="3. åˆ†å¸ƒå¼é”IDç”Ÿæˆ"></a>3. <strong>åˆ†å¸ƒå¼é”IDç”Ÿæˆ</strong></h4>      <ul><li>ä½¿ç”¨Redisè‡ªå¢IDï¼Œç®€å•é«˜æ•ˆã€‚</li><li>ç»“åˆ<code>EXPIRE</code>å‘½ä»¤å®ç°é”è¶…æ—¶æœºåˆ¶ã€‚</li></ul><hr><p>é€šè¿‡ä»¥ä¸Šæ–¹æ¡ˆï¼Œå¯ä»¥æ ¹æ®å…·ä½“ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„åˆ†å¸ƒå¼IDç”Ÿæˆç­–ç•¥ï¼Œç¡®ä¿ç³»ç»Ÿçš„é«˜æ€§èƒ½å’Œé«˜å¯ç”¨æ€§ã€‚</p>]]></content>
    
    
    <summary type="html">åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ</summary>
    
    
    
    <category term="æ¶æ„" scheme="https://ljd0620.github.io/categories/%E6%9E%B6%E6%9E%84/"/>
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://ljd0620.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
</feed>
